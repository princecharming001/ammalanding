var u0=l=>{throw TypeError(l)};var rd=(l,e,t)=>e.has(l)||u0("Cannot "+t);var tt=(l,e,t)=>(rd(l,e,"read from private field"),t?t.call(l):e.get(l)),$i=(l,e,t)=>e.has(l)?u0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),ei=(l,e,t,i)=>(rd(l,e,"write to private field"),i?i.call(l,t):e.set(l,t),t),Gi=(l,e,t)=>(rd(l,e,"access private method"),t);var h0=(l,e,t,i)=>({set _(s){ei(l,e,s,t)},get _(){return tt(l,e,i)}});function R1(l,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in l)){const a=Object.getOwnPropertyDescriptor(i,s);a&&Object.defineProperty(l,s,a.get?a:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function Of(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function k1(l){if(Object.prototype.hasOwnProperty.call(l,"__esModule"))return l;var e=l.default;if(typeof e=="function"){var t=function i(){var s=!1;try{s=this instanceof i}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(l).forEach(function(i){var s=Object.getOwnPropertyDescriptor(l,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return l[i]}})}),t}var ad={exports:{}},$a={};var d0;function O1(){if(d0)return $a;d0=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var o=null;if(a!==void 0&&(o=""+a),s.key!==void 0&&(o=""+s.key),"key"in s){a={};for(var u in s)u!=="key"&&(a[u]=s[u])}else a=s;return s=a.ref,{$$typeof:l,type:i,key:o,ref:s!==void 0?s:null,props:a}}return $a.Fragment=e,$a.jsx=t,$a.jsxs=t,$a}var f0;function D1(){return f0||(f0=1,ad.exports=O1()),ad.exports}var _=D1(),od={exports:{}},Ee={};var p0;function M1(){if(p0)return Ee;p0=1;var l=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),b=Symbol.iterator;function v(O){return O===null||typeof O!="object"?null:(O=b&&O[b]||O["@@iterator"],typeof O=="function"?O:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,E={};function x(O,U,q){this.props=O,this.context=U,this.refs=E,this.updater=q||S}x.prototype.isReactComponent={},x.prototype.setState=function(O,U){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,U,"setState")},x.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function C(){}C.prototype=x.prototype;function T(O,U,q){this.props=O,this.context=U,this.refs=E,this.updater=q||S}var D=T.prototype=new C;D.constructor=T,w(D,x.prototype),D.isPureReactComponent=!0;var M=Array.isArray;function N(){}var k={H:null,A:null,T:null,S:null},z=Object.prototype.hasOwnProperty;function H(O,U,q){var se=q.ref;return{$$typeof:l,type:O,key:U,ref:se!==void 0?se:null,props:q}}function ne(O,U){return H(O.type,U,O.props)}function ie(O){return typeof O=="object"&&O!==null&&O.$$typeof===l}function ce(O){var U={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(q){return U[q]})}var ge=/\/+/g;function le(O,U){return typeof O=="object"&&O!==null&&O.key!=null?ce(""+O.key):U.toString(36)}function ue(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(N,N):(O.status="pending",O.then(function(U){O.status==="pending"&&(O.status="fulfilled",O.value=U)},function(U){O.status==="pending"&&(O.status="rejected",O.reason=U)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function j(O,U,q,se,V){var I=typeof O;(I==="undefined"||I==="boolean")&&(O=null);var W=!1;if(O===null)W=!0;else switch(I){case"bigint":case"string":case"number":W=!0;break;case"object":switch(O.$$typeof){case l:case e:W=!0;break;case p:return W=O._init,j(W(O._payload),U,q,se,V)}}if(W)return V=V(O),W=se===""?"."+le(O,0):se,M(V)?(q="",W!=null&&(q=W.replace(ge,"$&/")+"/"),j(V,U,q,"",function(de){return de})):V!=null&&(ie(V)&&(V=ne(V,q+(V.key==null||O&&O.key===V.key?"":(""+V.key).replace(ge,"$&/")+"/")+W)),U.push(V)),1;W=0;var ae=se===""?".":se+":";if(M(O))for(var re=0;re<O.length;re++)se=O[re],I=ae+le(se,re),W+=j(se,U,q,I,V);else if(re=v(O),typeof re=="function")for(O=re.call(O),re=0;!(se=O.next()).done;)se=se.value,I=ae+le(se,re++),W+=j(se,U,q,I,V);else if(I==="object"){if(typeof O.then=="function")return j(ue(O),U,q,se,V);throw U=String(O),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return W}function J(O,U,q){if(O==null)return O;var se=[],V=0;return j(O,se,"","",function(I){return U.call(q,I,V++)}),se}function oe(O){if(O._status===-1){var U=O._result;U=U(),U.then(function(q){(O._status===0||O._status===-1)&&(O._status=1,O._result=q)},function(q){(O._status===0||O._status===-1)&&(O._status=2,O._result=q)}),O._status===-1&&(O._status=0,O._result=U)}if(O._status===1)return O._result.default;throw O._result}var K=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},X={map:J,forEach:function(O,U,q){J(O,function(){U.apply(this,arguments)},q)},count:function(O){var U=0;return J(O,function(){U++}),U},toArray:function(O){return J(O,function(U){return U})||[]},only:function(O){if(!ie(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Ee.Activity=m,Ee.Children=X,Ee.Component=x,Ee.Fragment=t,Ee.Profiler=s,Ee.PureComponent=T,Ee.StrictMode=i,Ee.Suspense=d,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,Ee.__COMPILER_RUNTIME={__proto__:null,c:function(O){return k.H.useMemoCache(O)}},Ee.cache=function(O){return function(){return O.apply(null,arguments)}},Ee.cacheSignal=function(){return null},Ee.cloneElement=function(O,U,q){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var se=w({},O.props),V=O.key;if(U!=null)for(I in U.key!==void 0&&(V=""+U.key),U)!z.call(U,I)||I==="key"||I==="__self"||I==="__source"||I==="ref"&&U.ref===void 0||(se[I]=U[I]);var I=arguments.length-2;if(I===1)se.children=q;else if(1<I){for(var W=Array(I),ae=0;ae<I;ae++)W[ae]=arguments[ae+2];se.children=W}return H(O.type,V,se)},Ee.createContext=function(O){return O={$$typeof:o,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:a,_context:O},O},Ee.createElement=function(O,U,q){var se,V={},I=null;if(U!=null)for(se in U.key!==void 0&&(I=""+U.key),U)z.call(U,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(V[se]=U[se]);var W=arguments.length-2;if(W===1)V.children=q;else if(1<W){for(var ae=Array(W),re=0;re<W;re++)ae[re]=arguments[re+2];V.children=ae}if(O&&O.defaultProps)for(se in W=O.defaultProps,W)V[se]===void 0&&(V[se]=W[se]);return H(O,I,V)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(O){return{$$typeof:u,render:O}},Ee.isValidElement=ie,Ee.lazy=function(O){return{$$typeof:p,_payload:{_status:-1,_result:O},_init:oe}},Ee.memo=function(O,U){return{$$typeof:f,type:O,compare:U===void 0?null:U}},Ee.startTransition=function(O){var U=k.T,q={};k.T=q;try{var se=O(),V=k.S;V!==null&&V(q,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(N,K)}catch(I){K(I)}finally{U!==null&&q.types!==null&&(U.types=q.types),k.T=U}},Ee.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},Ee.use=function(O){return k.H.use(O)},Ee.useActionState=function(O,U,q){return k.H.useActionState(O,U,q)},Ee.useCallback=function(O,U){return k.H.useCallback(O,U)},Ee.useContext=function(O){return k.H.useContext(O)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(O,U){return k.H.useDeferredValue(O,U)},Ee.useEffect=function(O,U){return k.H.useEffect(O,U)},Ee.useEffectEvent=function(O){return k.H.useEffectEvent(O)},Ee.useId=function(){return k.H.useId()},Ee.useImperativeHandle=function(O,U,q){return k.H.useImperativeHandle(O,U,q)},Ee.useInsertionEffect=function(O,U){return k.H.useInsertionEffect(O,U)},Ee.useLayoutEffect=function(O,U){return k.H.useLayoutEffect(O,U)},Ee.useMemo=function(O,U){return k.H.useMemo(O,U)},Ee.useOptimistic=function(O,U){return k.H.useOptimistic(O,U)},Ee.useReducer=function(O,U,q){return k.H.useReducer(O,U,q)},Ee.useRef=function(O){return k.H.useRef(O)},Ee.useState=function(O){return k.H.useState(O)},Ee.useSyncExternalStore=function(O,U,q){return k.H.useSyncExternalStore(O,U,q)},Ee.useTransition=function(){return k.H.useTransition()},Ee.version="19.2.0",Ee}var g0;function Df(){return g0||(g0=1,od.exports=M1()),od.exports}var B=Df();const xn=Of(B);var ld={exports:{}},Ga={},cd={exports:{}},ud={};var m0;function N1(){return m0||(m0=1,(function(l){function e(j,J){var oe=j.length;j.push(J);e:for(;0<oe;){var K=oe-1>>>1,X=j[K];if(0<s(X,J))j[K]=J,j[oe]=X,oe=K;else break e}}function t(j){return j.length===0?null:j[0]}function i(j){if(j.length===0)return null;var J=j[0],oe=j.pop();if(oe!==J){j[0]=oe;e:for(var K=0,X=j.length,O=X>>>1;K<O;){var U=2*(K+1)-1,q=j[U],se=U+1,V=j[se];if(0>s(q,oe))se<X&&0>s(V,q)?(j[K]=V,j[se]=oe,K=se):(j[K]=q,j[U]=oe,K=U);else if(se<X&&0>s(V,oe))j[K]=V,j[se]=oe,K=se;else break e}}return J}function s(j,J){var oe=j.sortIndex-J.sortIndex;return oe!==0?oe:j.id-J.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;l.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();l.unstable_now=function(){return o.now()-u}}var d=[],f=[],p=1,m=null,b=3,v=!1,S=!1,w=!1,E=!1,x=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function D(j){for(var J=t(f);J!==null;){if(J.callback===null)i(f);else if(J.startTime<=j)i(f),J.sortIndex=J.expirationTime,e(d,J);else break;J=t(f)}}function M(j){if(w=!1,D(j),!S)if(t(d)!==null)S=!0,N||(N=!0,ce());else{var J=t(f);J!==null&&ue(M,J.startTime-j)}}var N=!1,k=-1,z=5,H=-1;function ne(){return E?!0:!(l.unstable_now()-H<z)}function ie(){if(E=!1,N){var j=l.unstable_now();H=j;var J=!0;try{e:{S=!1,w&&(w=!1,C(k),k=-1),v=!0;var oe=b;try{t:{for(D(j),m=t(d);m!==null&&!(m.expirationTime>j&&ne());){var K=m.callback;if(typeof K=="function"){m.callback=null,b=m.priorityLevel;var X=K(m.expirationTime<=j);if(j=l.unstable_now(),typeof X=="function"){m.callback=X,D(j),J=!0;break t}m===t(d)&&i(d),D(j)}else i(d);m=t(d)}if(m!==null)J=!0;else{var O=t(f);O!==null&&ue(M,O.startTime-j),J=!1}}break e}finally{m=null,b=oe,v=!1}J=void 0}}finally{J?ce():N=!1}}}var ce;if(typeof T=="function")ce=function(){T(ie)};else if(typeof MessageChannel<"u"){var ge=new MessageChannel,le=ge.port2;ge.port1.onmessage=ie,ce=function(){le.postMessage(null)}}else ce=function(){x(ie,0)};function ue(j,J){k=x(function(){j(l.unstable_now())},J)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(j){j.callback=null},l.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<j?Math.floor(1e3/j):5},l.unstable_getCurrentPriorityLevel=function(){return b},l.unstable_next=function(j){switch(b){case 1:case 2:case 3:var J=3;break;default:J=b}var oe=b;b=J;try{return j()}finally{b=oe}},l.unstable_requestPaint=function(){E=!0},l.unstable_runWithPriority=function(j,J){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var oe=b;b=j;try{return J()}finally{b=oe}},l.unstable_scheduleCallback=function(j,J,oe){var K=l.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?K+oe:K):oe=K,j){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=oe+X,j={id:p++,callback:J,priorityLevel:j,startTime:oe,expirationTime:X,sortIndex:-1},oe>K?(j.sortIndex=oe,e(f,j),t(d)===null&&j===t(f)&&(w?(C(k),k=-1):w=!0,ue(M,oe-K))):(j.sortIndex=X,e(d,j),S||v||(S=!0,N||(N=!0,ce()))),j},l.unstable_shouldYield=ne,l.unstable_wrapCallback=function(j){var J=b;return function(){var oe=b;b=J;try{return j.apply(this,arguments)}finally{b=oe}}}})(ud)),ud}var y0;function L1(){return y0||(y0=1,cd.exports=N1()),cd.exports}var hd={exports:{}},Ut={};var b0;function P1(){if(b0)return Ut;b0=1;var l=Df();function e(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(d,f,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:d,containerInfo:f,implementation:p}}var o=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Ut.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ut.createPortal=function(d,f){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return a(d,f,null,p)},Ut.flushSync=function(d){var f=o.T,p=i.p;try{if(o.T=null,i.p=2,d)return d()}finally{o.T=f,i.p=p,i.d.f()}},Ut.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(d,f))},Ut.prefetchDNS=function(d){typeof d=="string"&&i.d.D(d)},Ut.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var p=f.as,m=u(p,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;p==="style"?i.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:m,integrity:b,fetchPriority:v}):p==="script"&&i.d.X(d,{crossOrigin:m,integrity:b,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Ut.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var p=u(f.as,f.crossOrigin);i.d.M(d,{crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(d)},Ut.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var p=f.as,m=u(p,f.crossOrigin);i.d.L(d,p,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Ut.preloadModule=function(d,f){if(typeof d=="string")if(f){var p=u(f.as,f.crossOrigin);i.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:p,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(d)},Ut.requestFormReset=function(d){i.d.r(d)},Ut.unstable_batchedUpdates=function(d,f){return d(f)},Ut.useFormState=function(d,f,p){return o.H.useFormState(d,f,p)},Ut.useFormStatus=function(){return o.H.useHostTransitionStatus()},Ut.version="19.2.0",Ut}var v0;function j1(){if(v0)return hd.exports;v0=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),hd.exports=P1(),hd.exports}var w0;function I1(){if(w0)return Ga;w0=1;var l=L1(),e=Df(),t=j1();function i(n){var r="https://react.dev/errors/"+n;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function a(n){var r=n,c=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(c=r.return),n=r.return;while(n)}return r.tag===3?c:null}function o(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function u(n){if(n.tag===31){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function d(n){if(a(n)!==n)throw Error(i(188))}function f(n){var r=n.alternate;if(!r){if(r=a(n),r===null)throw Error(i(188));return r!==n?null:n}for(var c=n,h=r;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return d(g),n;if(y===h)return d(g),r;y=y.sibling}throw Error(i(188))}if(c.return!==h.return)c=g,h=y;else{for(var A=!1,R=g.child;R;){if(R===c){A=!0,c=g,h=y;break}if(R===h){A=!0,h=g,c=y;break}R=R.sibling}if(!A){for(R=y.child;R;){if(R===c){A=!0,c=y,h=g;break}if(R===h){A=!0,h=y,c=g;break}R=R.sibling}if(!A)throw Error(i(189))}}if(c.alternate!==h)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?n:r}function p(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n;for(n=n.child;n!==null;){if(r=p(n),r!==null)return r;n=n.sibling}return null}var m=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),T=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),z=Symbol.for("react.lazy"),H=Symbol.for("react.activity"),ne=Symbol.for("react.memo_cache_sentinel"),ie=Symbol.iterator;function ce(n){return n===null||typeof n!="object"?null:(n=ie&&n[ie]||n["@@iterator"],typeof n=="function"?n:null)}var ge=Symbol.for("react.client.reference");function le(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ge?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case w:return"Fragment";case x:return"Profiler";case E:return"StrictMode";case M:return"Suspense";case N:return"SuspenseList";case H:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case S:return"Portal";case T:return n.displayName||"Context";case C:return(n._context.displayName||"Context")+".Consumer";case D:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case k:return r=n.displayName||null,r!==null?r:le(n.type)||"Memo";case z:r=n._payload,n=n._init;try{return le(n(r))}catch{}}return null}var ue=Array.isArray,j=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},K=[],X=-1;function O(n){return{current:n}}function U(n){0>X||(n.current=K[X],K[X]=null,X--)}function q(n,r){X++,K[X]=n.current,n.current=r}var se=O(null),V=O(null),I=O(null),W=O(null);function ae(n,r){switch(q(I,r),q(V,n),q(se,null),r.nodeType){case 9:case 11:n=(n=r.documentElement)&&(n=n.namespaceURI)?Ny(n):0;break;default:if(n=r.tagName,r=r.namespaceURI)r=Ny(r),n=Ly(r,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}U(se),q(se,n)}function re(){U(se),U(V),U(I)}function de(n){n.memoizedState!==null&&q(W,n);var r=se.current,c=Ly(r,n.type);r!==c&&(q(V,n),q(se,c))}function Se(n){V.current===n&&(U(se),U(V)),W.current===n&&(U(W),Fa._currentValue=oe)}var ot,ht;function dt(n){if(ot===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);ot=r&&r[1]||"",ht=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ot+n+ht}var kn=!1;function en(n,r){if(!n||kn)return"";kn=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(r){var te=function(){throw Error()};if(Object.defineProperty(te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(te,[])}catch(Q){var Y=Q}Reflect.construct(n,[],te)}else{try{te.call()}catch(Q){Y=Q}n.call(te.prototype)}}else{try{throw Error()}catch(Q){Y=Q}(te=n())&&typeof te.catch=="function"&&te.catch(function(){})}}catch(Q){if(Q&&Y&&typeof Q.stack=="string")return[Q.stack,Y.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=h.DetermineComponentFrameRoot(),A=y[0],R=y[1];if(A&&R){var L=A.split(`
`),G=R.split(`
`);for(g=h=0;h<L.length&&!L[h].includes("DetermineComponentFrameRoot");)h++;for(;g<G.length&&!G[g].includes("DetermineComponentFrameRoot");)g++;if(h===L.length||g===G.length)for(h=L.length-1,g=G.length-1;1<=h&&0<=g&&L[h]!==G[g];)g--;for(;1<=h&&0<=g;h--,g--)if(L[h]!==G[g]){if(h!==1||g!==1)do if(h--,g--,0>g||L[h]!==G[g]){var Z=`
`+L[h].replace(" at new "," at ");return n.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",n.displayName)),Z}while(1<=h&&0<=g);break}}}finally{kn=!1,Error.prepareStackTrace=c}return(c=n?n.displayName||n.name:"")?dt(c):""}function qc(n,r){switch(n.tag){case 26:case 27:case 5:return dt(n.type);case 16:return dt("Lazy");case 13:return n.child!==r&&r!==null?dt("Suspense Fallback"):dt("Suspense");case 19:return dt("SuspenseList");case 0:case 15:return en(n.type,!1);case 11:return en(n.type.render,!1);case 1:return en(n.type,!0);case 31:return dt("Activity");default:return""}}function up(n){try{var r="",c=null;do r+=qc(n,c),c=n,n=n.return;while(n);return r}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var $c=Object.prototype.hasOwnProperty,Gc=l.unstable_scheduleCallback,Vc=l.unstable_cancelCallback,a_=l.unstable_shouldYield,o_=l.unstable_requestPaint,ni=l.unstable_now,l_=l.unstable_getCurrentPriorityLevel,hp=l.unstable_ImmediatePriority,dp=l.unstable_UserBlockingPriority,Ro=l.unstable_NormalPriority,c_=l.unstable_LowPriority,fp=l.unstable_IdlePriority,u_=l.log,h_=l.unstable_setDisableYieldValue,Jr=null,si=null;function On(n){if(typeof u_=="function"&&h_(n),si&&typeof si.setStrictMode=="function")try{si.setStrictMode(Jr,n)}catch{}}var ri=Math.clz32?Math.clz32:p_,d_=Math.log,f_=Math.LN2;function p_(n){return n>>>=0,n===0?32:31-(d_(n)/f_|0)|0}var ko=256,Oo=262144,Do=4194304;function ls(n){var r=n&42;if(r!==0)return r;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Mo(n,r,c){var h=n.pendingLanes;if(h===0)return 0;var g=0,y=n.suspendedLanes,A=n.pingedLanes;n=n.warmLanes;var R=h&134217727;return R!==0?(h=R&~y,h!==0?g=ls(h):(A&=R,A!==0?g=ls(A):c||(c=R&~n,c!==0&&(g=ls(c))))):(R=h&~y,R!==0?g=ls(R):A!==0?g=ls(A):c||(c=h&~n,c!==0&&(g=ls(c)))),g===0?0:r!==0&&r!==g&&(r&y)===0&&(y=g&-g,c=r&-r,y>=c||y===32&&(c&4194048)!==0)?r:g}function Zr(n,r){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&r)===0}function g_(n,r){switch(n){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pp(){var n=Do;return Do<<=1,(Do&62914560)===0&&(Do=4194304),n}function Yc(n){for(var r=[],c=0;31>c;c++)r.push(n);return r}function ea(n,r){n.pendingLanes|=r,r!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function m_(n,r,c,h,g,y){var A=n.pendingLanes;n.pendingLanes=c,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=c,n.entangledLanes&=c,n.errorRecoveryDisabledLanes&=c,n.shellSuspendCounter=0;var R=n.entanglements,L=n.expirationTimes,G=n.hiddenUpdates;for(c=A&~c;0<c;){var Z=31-ri(c),te=1<<Z;R[Z]=0,L[Z]=-1;var Y=G[Z];if(Y!==null)for(G[Z]=null,Z=0;Z<Y.length;Z++){var Q=Y[Z];Q!==null&&(Q.lane&=-536870913)}c&=~te}h!==0&&gp(n,h,0),y!==0&&g===0&&n.tag!==0&&(n.suspendedLanes|=y&~(A&~r))}function gp(n,r,c){n.pendingLanes|=r,n.suspendedLanes&=~r;var h=31-ri(r);n.entangledLanes|=r,n.entanglements[h]=n.entanglements[h]|1073741824|c&261930}function mp(n,r){var c=n.entangledLanes|=r;for(n=n.entanglements;c;){var h=31-ri(c),g=1<<h;g&r|n[h]&r&&(n[h]|=r),c&=~g}}function yp(n,r){var c=r&-r;return c=(c&42)!==0?1:Wc(c),(c&(n.suspendedLanes|r))!==0?0:c}function Wc(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Xc(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function bp(){var n=J.p;return n!==0?n:(n=window.event,n===void 0?32:n0(n.type))}function vp(n,r){var c=J.p;try{return J.p=n,r()}finally{J.p=c}}var Dn=Math.random().toString(36).slice(2),kt="__reactFiber$"+Dn,Yt="__reactProps$"+Dn,zs="__reactContainer$"+Dn,Kc="__reactEvents$"+Dn,y_="__reactListeners$"+Dn,b_="__reactHandles$"+Dn,wp="__reactResources$"+Dn,ta="__reactMarker$"+Dn;function Qc(n){delete n[kt],delete n[Yt],delete n[Kc],delete n[y_],delete n[b_]}function Hs(n){var r=n[kt];if(r)return r;for(var c=n.parentNode;c;){if(r=c[zs]||c[kt]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(n=zy(n);n!==null;){if(c=n[kt])return c;n=zy(n)}return r}n=c,c=n.parentNode}return null}function qs(n){if(n=n[kt]||n[zs]){var r=n.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return n}return null}function ia(n){var r=n.tag;if(r===5||r===26||r===27||r===6)return n.stateNode;throw Error(i(33))}function $s(n){var r=n[wp];return r||(r=n[wp]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function xt(n){n[ta]=!0}var _p=new Set,Sp={};function cs(n,r){Gs(n,r),Gs(n+"Capture",r)}function Gs(n,r){for(Sp[n]=r,n=0;n<r.length;n++)_p.add(r[n])}var v_=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ap={},Ep={};function w_(n){return $c.call(Ep,n)?!0:$c.call(Ap,n)?!1:v_.test(n)?Ep[n]=!0:(Ap[n]=!0,!1)}function No(n,r,c){if(w_(r))if(c===null)n.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":n.removeAttribute(r);return;case"boolean":var h=r.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){n.removeAttribute(r);return}}n.setAttribute(r,""+c)}}function Lo(n,r,c){if(c===null)n.removeAttribute(r);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttribute(r,""+c)}}function tn(n,r,c,h){if(h===null)n.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(c);return}n.setAttributeNS(r,c,""+h)}}function yi(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function xp(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function __(n,r,c){var h=Object.getOwnPropertyDescriptor(n.constructor.prototype,r);if(!n.hasOwnProperty(r)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,y=h.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return g.call(this)},set:function(A){c=""+A,y.call(this,A)}}),Object.defineProperty(n,r,{enumerable:h.enumerable}),{getValue:function(){return c},setValue:function(A){c=""+A},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Jc(n){if(!n._valueTracker){var r=xp(n)?"checked":"value";n._valueTracker=__(n,r,""+n[r])}}function Tp(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var c=r.getValue(),h="";return n&&(h=xp(n)?n.checked?"true":"false":n.value),n=h,n!==c?(r.setValue(n),!0):!1}function Po(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var S_=/[\n"\\]/g;function bi(n){return n.replace(S_,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Zc(n,r,c,h,g,y,A,R){n.name="",A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?n.type=A:n.removeAttribute("type"),r!=null?A==="number"?(r===0&&n.value===""||n.value!=r)&&(n.value=""+yi(r)):n.value!==""+yi(r)&&(n.value=""+yi(r)):A!=="submit"&&A!=="reset"||n.removeAttribute("value"),r!=null?eu(n,A,yi(r)):c!=null?eu(n,A,yi(c)):h!=null&&n.removeAttribute("value"),g==null&&y!=null&&(n.defaultChecked=!!y),g!=null&&(n.checked=g&&typeof g!="function"&&typeof g!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?n.name=""+yi(R):n.removeAttribute("name")}function Cp(n,r,c,h,g,y,A,R){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(n.type=y),r!=null||c!=null){if(!(y!=="submit"&&y!=="reset"||r!=null)){Jc(n);return}c=c!=null?""+yi(c):"",r=r!=null?""+yi(r):c,R||r===n.value||(n.value=r),n.defaultValue=r}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,n.checked=R?n.checked:!!h,n.defaultChecked=!!h,A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(n.name=A),Jc(n)}function eu(n,r,c){r==="number"&&Po(n.ownerDocument)===n||n.defaultValue===""+c||(n.defaultValue=""+c)}function Vs(n,r,c,h){if(n=n.options,r){r={};for(var g=0;g<c.length;g++)r["$"+c[g]]=!0;for(c=0;c<n.length;c++)g=r.hasOwnProperty("$"+n[c].value),n[c].selected!==g&&(n[c].selected=g),g&&h&&(n[c].defaultSelected=!0)}else{for(c=""+yi(c),r=null,g=0;g<n.length;g++){if(n[g].value===c){n[g].selected=!0,h&&(n[g].defaultSelected=!0);return}r!==null||n[g].disabled||(r=n[g])}r!==null&&(r.selected=!0)}}function Rp(n,r,c){if(r!=null&&(r=""+yi(r),r!==n.value&&(n.value=r),c==null)){n.defaultValue!==r&&(n.defaultValue=r);return}n.defaultValue=c!=null?""+yi(c):""}function kp(n,r,c,h){if(r==null){if(h!=null){if(c!=null)throw Error(i(92));if(ue(h)){if(1<h.length)throw Error(i(93));h=h[0]}c=h}c==null&&(c=""),r=c}c=yi(r),n.defaultValue=c,h=n.textContent,h===c&&h!==""&&h!==null&&(n.value=h),Jc(n)}function Ys(n,r){if(r){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=r;return}}n.textContent=r}var A_=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Op(n,r,c){var h=r.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?h?n.setProperty(r,""):r==="float"?n.cssFloat="":n[r]="":h?n.setProperty(r,c):typeof c!="number"||c===0||A_.has(r)?r==="float"?n.cssFloat=c:n[r]=(""+c).trim():n[r]=c+"px"}function Dp(n,r,c){if(r!=null&&typeof r!="object")throw Error(i(62));if(n=n.style,c!=null){for(var h in c)!c.hasOwnProperty(h)||r!=null&&r.hasOwnProperty(h)||(h.indexOf("--")===0?n.setProperty(h,""):h==="float"?n.cssFloat="":n[h]="");for(var g in r)h=r[g],r.hasOwnProperty(g)&&c[g]!==h&&Op(n,g,h)}else for(var y in r)r.hasOwnProperty(y)&&Op(n,y,r[y])}function tu(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var E_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),x_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function jo(n){return x_.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function nn(){}var iu=null;function nu(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ws=null,Xs=null;function Mp(n){var r=qs(n);if(r&&(n=r.stateNode)){var c=n[Yt]||null;e:switch(n=r.stateNode,r.type){case"input":if(Zc(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),r=c.name,c.type==="radio"&&r!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+bi(""+r)+'"][type="radio"]'),r=0;r<c.length;r++){var h=c[r];if(h!==n&&h.form===n.form){var g=h[Yt]||null;if(!g)throw Error(i(90));Zc(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(r=0;r<c.length;r++)h=c[r],h.form===n.form&&Tp(h)}break e;case"textarea":Rp(n,c.value,c.defaultValue);break e;case"select":r=c.value,r!=null&&Vs(n,!!c.multiple,r,!1)}}}var su=!1;function Np(n,r,c){if(su)return n(r,c);su=!0;try{var h=n(r);return h}finally{if(su=!1,(Ws!==null||Xs!==null)&&(Al(),Ws&&(r=Ws,n=Xs,Xs=Ws=null,Mp(r),n)))for(r=0;r<n.length;r++)Mp(n[r])}}function na(n,r){var c=n.stateNode;if(c===null)return null;var h=c[Yt]||null;if(h===null)return null;c=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(n=n.type,h=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!h;break e;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error(i(231,r,typeof c));return c}var sn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ru=!1;if(sn)try{var sa={};Object.defineProperty(sa,"passive",{get:function(){ru=!0}}),window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch{ru=!1}var Mn=null,au=null,Io=null;function Lp(){if(Io)return Io;var n,r=au,c=r.length,h,g="value"in Mn?Mn.value:Mn.textContent,y=g.length;for(n=0;n<c&&r[n]===g[n];n++);var A=c-n;for(h=1;h<=A&&r[c-h]===g[y-h];h++);return Io=g.slice(n,1<h?1-h:void 0)}function Bo(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function Uo(){return!0}function Pp(){return!1}function Wt(n){function r(c,h,g,y,A){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=A,this.currentTarget=null;for(var R in n)n.hasOwnProperty(R)&&(c=n[R],this[R]=c?c(y):y[R]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Uo:Pp,this.isPropagationStopped=Pp,this}return m(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Uo)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Uo)},persist:function(){},isPersistent:Uo}),r}var us={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fo=Wt(us),ra=m({},us,{view:0,detail:0}),T_=Wt(ra),ou,lu,aa,zo=m({},ra,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==aa&&(aa&&n.type==="mousemove"?(ou=n.screenX-aa.screenX,lu=n.screenY-aa.screenY):lu=ou=0,aa=n),ou)},movementY:function(n){return"movementY"in n?n.movementY:lu}}),jp=Wt(zo),C_=m({},zo,{dataTransfer:0}),R_=Wt(C_),k_=m({},ra,{relatedTarget:0}),cu=Wt(k_),O_=m({},us,{animationName:0,elapsedTime:0,pseudoElement:0}),D_=Wt(O_),M_=m({},us,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),N_=Wt(M_),L_=m({},us,{data:0}),Ip=Wt(L_),P_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},j_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},I_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function B_(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=I_[n])?!!r[n]:!1}function uu(){return B_}var U_=m({},ra,{key:function(n){if(n.key){var r=P_[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=Bo(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?j_[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uu,charCode:function(n){return n.type==="keypress"?Bo(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Bo(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),F_=Wt(U_),z_=m({},zo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bp=Wt(z_),H_=m({},ra,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uu}),q_=Wt(H_),$_=m({},us,{propertyName:0,elapsedTime:0,pseudoElement:0}),G_=Wt($_),V_=m({},zo,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Y_=Wt(V_),W_=m({},us,{newState:0,oldState:0}),X_=Wt(W_),K_=[9,13,27,32],hu=sn&&"CompositionEvent"in window,oa=null;sn&&"documentMode"in document&&(oa=document.documentMode);var Q_=sn&&"TextEvent"in window&&!oa,Up=sn&&(!hu||oa&&8<oa&&11>=oa),Fp=" ",zp=!1;function Hp(n,r){switch(n){case"keyup":return K_.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ks=!1;function J_(n,r){switch(n){case"compositionend":return qp(r);case"keypress":return r.which!==32?null:(zp=!0,Fp);case"textInput":return n=r.data,n===Fp&&zp?null:n;default:return null}}function Z_(n,r){if(Ks)return n==="compositionend"||!hu&&Hp(n,r)?(n=Lp(),Io=au=Mn=null,Ks=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Up&&r.locale!=="ko"?null:r.data;default:return null}}var eS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $p(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!eS[n.type]:r==="textarea"}function Gp(n,r,c,h){Ws?Xs?Xs.push(h):Xs=[h]:Ws=h,r=Ol(r,"onChange"),0<r.length&&(c=new Fo("onChange","change",null,c,h),n.push({event:c,listeners:r}))}var la=null,ca=null;function tS(n){Cy(n,0)}function Ho(n){var r=ia(n);if(Tp(r))return n}function Vp(n,r){if(n==="change")return r}var Yp=!1;if(sn){var du;if(sn){var fu="oninput"in document;if(!fu){var Wp=document.createElement("div");Wp.setAttribute("oninput","return;"),fu=typeof Wp.oninput=="function"}du=fu}else du=!1;Yp=du&&(!document.documentMode||9<document.documentMode)}function Xp(){la&&(la.detachEvent("onpropertychange",Kp),ca=la=null)}function Kp(n){if(n.propertyName==="value"&&Ho(ca)){var r=[];Gp(r,ca,n,nu(n)),Np(tS,r)}}function iS(n,r,c){n==="focusin"?(Xp(),la=r,ca=c,la.attachEvent("onpropertychange",Kp)):n==="focusout"&&Xp()}function nS(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ho(ca)}function sS(n,r){if(n==="click")return Ho(r)}function rS(n,r){if(n==="input"||n==="change")return Ho(r)}function aS(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var ai=typeof Object.is=="function"?Object.is:aS;function ua(n,r){if(ai(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var c=Object.keys(n),h=Object.keys(r);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!$c.call(r,g)||!ai(n[g],r[g]))return!1}return!0}function Qp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Jp(n,r){var c=Qp(n);n=0;for(var h;c;){if(c.nodeType===3){if(h=n+c.textContent.length,n<=r&&h>=r)return{node:c,offset:r-n};n=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Qp(c)}}function Zp(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?Zp(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function eg(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var r=Po(n.document);r instanceof n.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)n=r.contentWindow;else break;r=Po(n.document)}return r}function pu(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}var oS=sn&&"documentMode"in document&&11>=document.documentMode,Qs=null,gu=null,ha=null,mu=!1;function tg(n,r,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;mu||Qs==null||Qs!==Po(h)||(h=Qs,"selectionStart"in h&&pu(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),ha&&ua(ha,h)||(ha=h,h=Ol(gu,"onSelect"),0<h.length&&(r=new Fo("onSelect","select",null,r,c),n.push({event:r,listeners:h}),r.target=Qs)))}function hs(n,r){var c={};return c[n.toLowerCase()]=r.toLowerCase(),c["Webkit"+n]="webkit"+r,c["Moz"+n]="moz"+r,c}var Js={animationend:hs("Animation","AnimationEnd"),animationiteration:hs("Animation","AnimationIteration"),animationstart:hs("Animation","AnimationStart"),transitionrun:hs("Transition","TransitionRun"),transitionstart:hs("Transition","TransitionStart"),transitioncancel:hs("Transition","TransitionCancel"),transitionend:hs("Transition","TransitionEnd")},yu={},ig={};sn&&(ig=document.createElement("div").style,"AnimationEvent"in window||(delete Js.animationend.animation,delete Js.animationiteration.animation,delete Js.animationstart.animation),"TransitionEvent"in window||delete Js.transitionend.transition);function ds(n){if(yu[n])return yu[n];if(!Js[n])return n;var r=Js[n],c;for(c in r)if(r.hasOwnProperty(c)&&c in ig)return yu[n]=r[c];return n}var ng=ds("animationend"),sg=ds("animationiteration"),rg=ds("animationstart"),lS=ds("transitionrun"),cS=ds("transitionstart"),uS=ds("transitioncancel"),ag=ds("transitionend"),og=new Map,bu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bu.push("scrollEnd");function Ni(n,r){og.set(n,r),cs(r,[n])}var qo=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},vi=[],Zs=0,vu=0;function $o(){for(var n=Zs,r=vu=Zs=0;r<n;){var c=vi[r];vi[r++]=null;var h=vi[r];vi[r++]=null;var g=vi[r];vi[r++]=null;var y=vi[r];if(vi[r++]=null,h!==null&&g!==null){var A=h.pending;A===null?g.next=g:(g.next=A.next,A.next=g),h.pending=g}y!==0&&lg(c,g,y)}}function Go(n,r,c,h){vi[Zs++]=n,vi[Zs++]=r,vi[Zs++]=c,vi[Zs++]=h,vu|=h,n.lanes|=h,n=n.alternate,n!==null&&(n.lanes|=h)}function wu(n,r,c,h){return Go(n,r,c,h),Vo(n)}function fs(n,r){return Go(n,null,null,r),Vo(n)}function lg(n,r,c){n.lanes|=c;var h=n.alternate;h!==null&&(h.lanes|=c);for(var g=!1,y=n.return;y!==null;)y.childLanes|=c,h=y.alternate,h!==null&&(h.childLanes|=c),y.tag===22&&(n=y.stateNode,n===null||n._visibility&1||(g=!0)),n=y,y=y.return;return n.tag===3?(y=n.stateNode,g&&r!==null&&(g=31-ri(c),n=y.hiddenUpdates,h=n[g],h===null?n[g]=[r]:h.push(r),r.lane=c|536870912),y):null}function Vo(n){if(50<Na)throw Na=0,kh=null,Error(i(185));for(var r=n.return;r!==null;)n=r,r=n.return;return n.tag===3?n.stateNode:null}var er={};function hS(n,r,c,h){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oi(n,r,c,h){return new hS(n,r,c,h)}function _u(n){return n=n.prototype,!(!n||!n.isReactComponent)}function rn(n,r){var c=n.alternate;return c===null?(c=oi(n.tag,r,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=r,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&65011712,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,r=n.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c.refCleanup=n.refCleanup,c}function cg(n,r){n.flags&=65011714;var c=n.alternate;return c===null?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=c.childLanes,n.lanes=c.lanes,n.child=c.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=c.memoizedProps,n.memoizedState=c.memoizedState,n.updateQueue=c.updateQueue,n.type=c.type,r=c.dependencies,n.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),n}function Yo(n,r,c,h,g,y){var A=0;if(h=n,typeof n=="function")_u(n)&&(A=1);else if(typeof n=="string")A=m1(n,c,se.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case H:return n=oi(31,c,r,g),n.elementType=H,n.lanes=y,n;case w:return ps(c.children,g,y,r);case E:A=8,g|=24;break;case x:return n=oi(12,c,r,g|2),n.elementType=x,n.lanes=y,n;case M:return n=oi(13,c,r,g),n.elementType=M,n.lanes=y,n;case N:return n=oi(19,c,r,g),n.elementType=N,n.lanes=y,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case T:A=10;break e;case C:A=9;break e;case D:A=11;break e;case k:A=14;break e;case z:A=16,h=null;break e}A=29,c=Error(i(130,n===null?"null":typeof n,"")),h=null}return r=oi(A,c,r,g),r.elementType=n,r.type=h,r.lanes=y,r}function ps(n,r,c,h){return n=oi(7,n,h,r),n.lanes=c,n}function Su(n,r,c){return n=oi(6,n,null,r),n.lanes=c,n}function ug(n){var r=oi(18,null,null,0);return r.stateNode=n,r}function Au(n,r,c){return r=oi(4,n.children!==null?n.children:[],n.key,r),r.lanes=c,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}var hg=new WeakMap;function wi(n,r){if(typeof n=="object"&&n!==null){var c=hg.get(n);return c!==void 0?c:(r={value:n,source:r,stack:up(r)},hg.set(n,r),r)}return{value:n,source:r,stack:up(r)}}var tr=[],ir=0,Wo=null,da=0,_i=[],Si=0,Nn=null,Fi=1,zi="";function an(n,r){tr[ir++]=da,tr[ir++]=Wo,Wo=n,da=r}function dg(n,r,c){_i[Si++]=Fi,_i[Si++]=zi,_i[Si++]=Nn,Nn=n;var h=Fi;n=zi;var g=32-ri(h)-1;h&=~(1<<g),c+=1;var y=32-ri(r)+g;if(30<y){var A=g-g%5;y=(h&(1<<A)-1).toString(32),h>>=A,g-=A,Fi=1<<32-ri(r)+g|c<<g|h,zi=y+n}else Fi=1<<y|c<<g|h,zi=n}function Eu(n){n.return!==null&&(an(n,1),dg(n,1,0))}function xu(n){for(;n===Wo;)Wo=tr[--ir],tr[ir]=null,da=tr[--ir],tr[ir]=null;for(;n===Nn;)Nn=_i[--Si],_i[Si]=null,zi=_i[--Si],_i[Si]=null,Fi=_i[--Si],_i[Si]=null}function fg(n,r){_i[Si++]=Fi,_i[Si++]=zi,_i[Si++]=Nn,Fi=r.id,zi=r.overflow,Nn=n}var Ot=null,Je=null,Pe=!1,Ln=null,Ai=!1,Tu=Error(i(519));function Pn(n){var r=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw fa(wi(r,n)),Tu}function pg(n){var r=n.stateNode,c=n.type,h=n.memoizedProps;switch(r[kt]=n,r[Yt]=h,c){case"dialog":Me("cancel",r),Me("close",r);break;case"iframe":case"object":case"embed":Me("load",r);break;case"video":case"audio":for(c=0;c<Pa.length;c++)Me(Pa[c],r);break;case"source":Me("error",r);break;case"img":case"image":case"link":Me("error",r),Me("load",r);break;case"details":Me("toggle",r);break;case"input":Me("invalid",r),Cp(r,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":Me("invalid",r);break;case"textarea":Me("invalid",r),kp(r,h.value,h.defaultValue,h.children)}c=h.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||r.textContent===""+c||h.suppressHydrationWarning===!0||Dy(r.textContent,c)?(h.popover!=null&&(Me("beforetoggle",r),Me("toggle",r)),h.onScroll!=null&&Me("scroll",r),h.onScrollEnd!=null&&Me("scrollend",r),h.onClick!=null&&(r.onclick=nn),r=!0):r=!1,r||Pn(n,!0)}function gg(n){for(Ot=n.return;Ot;)switch(Ot.tag){case 5:case 31:case 13:Ai=!1;return;case 27:case 3:Ai=!0;return;default:Ot=Ot.return}}function nr(n){if(n!==Ot)return!1;if(!Pe)return gg(n),Pe=!0,!1;var r=n.tag,c;if((c=r!==3&&r!==27)&&((c=r===5)&&(c=n.type,c=!(c!=="form"&&c!=="button")||$h(n.type,n.memoizedProps)),c=!c),c&&Je&&Pn(n),gg(n),r===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Je=Fy(n)}else if(r===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));Je=Fy(n)}else r===27?(r=Je,Xn(n.type)?(n=Xh,Xh=null,Je=n):Je=r):Je=Ot?xi(n.stateNode.nextSibling):null;return!0}function gs(){Je=Ot=null,Pe=!1}function Cu(){var n=Ln;return n!==null&&(Jt===null?Jt=n:Jt.push.apply(Jt,n),Ln=null),n}function fa(n){Ln===null?Ln=[n]:Ln.push(n)}var Ru=O(null),ms=null,on=null;function jn(n,r,c){q(Ru,r._currentValue),r._currentValue=c}function ln(n){n._currentValue=Ru.current,U(Ru)}function ku(n,r,c){for(;n!==null;){var h=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),n===c)break;n=n.return}}function Ou(n,r,c,h){var g=n.child;for(g!==null&&(g.return=n);g!==null;){var y=g.dependencies;if(y!==null){var A=g.child;y=y.firstContext;e:for(;y!==null;){var R=y;y=g;for(var L=0;L<r.length;L++)if(R.context===r[L]){y.lanes|=c,R=y.alternate,R!==null&&(R.lanes|=c),ku(y.return,c,n),h||(A=null);break e}y=R.next}}else if(g.tag===18){if(A=g.return,A===null)throw Error(i(341));A.lanes|=c,y=A.alternate,y!==null&&(y.lanes|=c),ku(A,c,n),A=null}else A=g.child;if(A!==null)A.return=g;else for(A=g;A!==null;){if(A===n){A=null;break}if(g=A.sibling,g!==null){g.return=A.return,A=g;break}A=A.return}g=A}}function sr(n,r,c,h){n=null;for(var g=r,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var A=g.alternate;if(A===null)throw Error(i(387));if(A=A.memoizedProps,A!==null){var R=g.type;ai(g.pendingProps.value,A.value)||(n!==null?n.push(R):n=[R])}}else if(g===W.current){if(A=g.alternate,A===null)throw Error(i(387));A.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(n!==null?n.push(Fa):n=[Fa])}g=g.return}n!==null&&Ou(r,n,c,h),r.flags|=262144}function Xo(n){for(n=n.firstContext;n!==null;){if(!ai(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ys(n){ms=n,on=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Dt(n){return mg(ms,n)}function Ko(n,r){return ms===null&&ys(n),mg(n,r)}function mg(n,r){var c=r._currentValue;if(r={context:r,memoizedValue:c,next:null},on===null){if(n===null)throw Error(i(308));on=r,n.dependencies={lanes:0,firstContext:r},n.flags|=524288}else on=on.next=r;return c}var dS=typeof AbortController<"u"?AbortController:function(){var n=[],r=this.signal={aborted:!1,addEventListener:function(c,h){n.push(h)}};this.abort=function(){r.aborted=!0,n.forEach(function(c){return c()})}},fS=l.unstable_scheduleCallback,pS=l.unstable_NormalPriority,mt={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Du(){return{controller:new dS,data:new Map,refCount:0}}function pa(n){n.refCount--,n.refCount===0&&fS(pS,function(){n.controller.abort()})}var ga=null,Mu=0,rr=0,ar=null;function gS(n,r){if(ga===null){var c=ga=[];Mu=0,rr=Ph(),ar={status:"pending",value:void 0,then:function(h){c.push(h)}}}return Mu++,r.then(yg,yg),r}function yg(){if(--Mu===0&&ga!==null){ar!==null&&(ar.status="fulfilled");var n=ga;ga=null,rr=0,ar=null;for(var r=0;r<n.length;r++)(0,n[r])()}}function mS(n,r){var c=[],h={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return n.then(function(){h.status="fulfilled",h.value=r;for(var g=0;g<c.length;g++)(0,c[g])(r)},function(g){for(h.status="rejected",h.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),h}var bg=j.S;j.S=function(n,r){ty=ni(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&gS(n,r),bg!==null&&bg(n,r)};var bs=O(null);function Nu(){var n=bs.current;return n!==null?n:Xe.pooledCache}function Qo(n,r){r===null?q(bs,bs.current):q(bs,r.pool)}function vg(){var n=Nu();return n===null?null:{parent:mt._currentValue,pool:n}}var or=Error(i(460)),Lu=Error(i(474)),Jo=Error(i(542)),Zo={then:function(){}};function wg(n){return n=n.status,n==="fulfilled"||n==="rejected"}function _g(n,r,c){switch(c=n[c],c===void 0?n.push(r):c!==r&&(r.then(nn,nn),r=c),r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,Ag(n),n;default:if(typeof r.status=="string")r.then(nn,nn);else{if(n=Xe,n!==null&&100<n.shellSuspendCounter)throw Error(i(482));n=r,n.status="pending",n.then(function(h){if(r.status==="pending"){var g=r;g.status="fulfilled",g.value=h}},function(h){if(r.status==="pending"){var g=r;g.status="rejected",g.reason=h}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw n=r.reason,Ag(n),n}throw ws=r,or}}function vs(n){try{var r=n._init;return r(n._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(ws=c,or):c}}var ws=null;function Sg(){if(ws===null)throw Error(i(459));var n=ws;return ws=null,n}function Ag(n){if(n===or||n===Jo)throw Error(i(483))}var lr=null,ma=0;function el(n){var r=ma;return ma+=1,lr===null&&(lr=[]),_g(lr,n,r)}function ya(n,r){r=r.props.ref,n.ref=r!==void 0?r:null}function tl(n,r){throw r.$$typeof===b?Error(i(525)):(n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)))}function Eg(n){function r(F,P){if(n){var $=F.deletions;$===null?(F.deletions=[P],F.flags|=16):$.push(P)}}function c(F,P){if(!n)return null;for(;P!==null;)r(F,P),P=P.sibling;return null}function h(F){for(var P=new Map;F!==null;)F.key!==null?P.set(F.key,F):P.set(F.index,F),F=F.sibling;return P}function g(F,P){return F=rn(F,P),F.index=0,F.sibling=null,F}function y(F,P,$){return F.index=$,n?($=F.alternate,$!==null?($=$.index,$<P?(F.flags|=67108866,P):$):(F.flags|=67108866,P)):(F.flags|=1048576,P)}function A(F){return n&&F.alternate===null&&(F.flags|=67108866),F}function R(F,P,$,ee){return P===null||P.tag!==6?(P=Su($,F.mode,ee),P.return=F,P):(P=g(P,$),P.return=F,P)}function L(F,P,$,ee){var ve=$.type;return ve===w?Z(F,P,$.props.children,ee,$.key):P!==null&&(P.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===z&&vs(ve)===P.type)?(P=g(P,$.props),ya(P,$),P.return=F,P):(P=Yo($.type,$.key,$.props,null,F.mode,ee),ya(P,$),P.return=F,P)}function G(F,P,$,ee){return P===null||P.tag!==4||P.stateNode.containerInfo!==$.containerInfo||P.stateNode.implementation!==$.implementation?(P=Au($,F.mode,ee),P.return=F,P):(P=g(P,$.children||[]),P.return=F,P)}function Z(F,P,$,ee,ve){return P===null||P.tag!==7?(P=ps($,F.mode,ee,ve),P.return=F,P):(P=g(P,$),P.return=F,P)}function te(F,P,$){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=Su(""+P,F.mode,$),P.return=F,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case v:return $=Yo(P.type,P.key,P.props,null,F.mode,$),ya($,P),$.return=F,$;case S:return P=Au(P,F.mode,$),P.return=F,P;case z:return P=vs(P),te(F,P,$)}if(ue(P)||ce(P))return P=ps(P,F.mode,$,null),P.return=F,P;if(typeof P.then=="function")return te(F,el(P),$);if(P.$$typeof===T)return te(F,Ko(F,P),$);tl(F,P)}return null}function Y(F,P,$,ee){var ve=P!==null?P.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return ve!==null?null:R(F,P,""+$,ee);if(typeof $=="object"&&$!==null){switch($.$$typeof){case v:return $.key===ve?L(F,P,$,ee):null;case S:return $.key===ve?G(F,P,$,ee):null;case z:return $=vs($),Y(F,P,$,ee)}if(ue($)||ce($))return ve!==null?null:Z(F,P,$,ee,null);if(typeof $.then=="function")return Y(F,P,el($),ee);if($.$$typeof===T)return Y(F,P,Ko(F,$),ee);tl(F,$)}return null}function Q(F,P,$,ee,ve){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return F=F.get($)||null,R(P,F,""+ee,ve);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case v:return F=F.get(ee.key===null?$:ee.key)||null,L(P,F,ee,ve);case S:return F=F.get(ee.key===null?$:ee.key)||null,G(P,F,ee,ve);case z:return ee=vs(ee),Q(F,P,$,ee,ve)}if(ue(ee)||ce(ee))return F=F.get($)||null,Z(P,F,ee,ve,null);if(typeof ee.then=="function")return Q(F,P,$,el(ee),ve);if(ee.$$typeof===T)return Q(F,P,$,Ko(P,ee),ve);tl(P,ee)}return null}function fe(F,P,$,ee){for(var ve=null,Be=null,me=P,ke=P=0,Le=null;me!==null&&ke<$.length;ke++){me.index>ke?(Le=me,me=null):Le=me.sibling;var Ue=Y(F,me,$[ke],ee);if(Ue===null){me===null&&(me=Le);break}n&&me&&Ue.alternate===null&&r(F,me),P=y(Ue,P,ke),Be===null?ve=Ue:Be.sibling=Ue,Be=Ue,me=Le}if(ke===$.length)return c(F,me),Pe&&an(F,ke),ve;if(me===null){for(;ke<$.length;ke++)me=te(F,$[ke],ee),me!==null&&(P=y(me,P,ke),Be===null?ve=me:Be.sibling=me,Be=me);return Pe&&an(F,ke),ve}for(me=h(me);ke<$.length;ke++)Le=Q(me,F,ke,$[ke],ee),Le!==null&&(n&&Le.alternate!==null&&me.delete(Le.key===null?ke:Le.key),P=y(Le,P,ke),Be===null?ve=Le:Be.sibling=Le,Be=Le);return n&&me.forEach(function(es){return r(F,es)}),Pe&&an(F,ke),ve}function _e(F,P,$,ee){if($==null)throw Error(i(151));for(var ve=null,Be=null,me=P,ke=P=0,Le=null,Ue=$.next();me!==null&&!Ue.done;ke++,Ue=$.next()){me.index>ke?(Le=me,me=null):Le=me.sibling;var es=Y(F,me,Ue.value,ee);if(es===null){me===null&&(me=Le);break}n&&me&&es.alternate===null&&r(F,me),P=y(es,P,ke),Be===null?ve=es:Be.sibling=es,Be=es,me=Le}if(Ue.done)return c(F,me),Pe&&an(F,ke),ve;if(me===null){for(;!Ue.done;ke++,Ue=$.next())Ue=te(F,Ue.value,ee),Ue!==null&&(P=y(Ue,P,ke),Be===null?ve=Ue:Be.sibling=Ue,Be=Ue);return Pe&&an(F,ke),ve}for(me=h(me);!Ue.done;ke++,Ue=$.next())Ue=Q(me,F,ke,Ue.value,ee),Ue!==null&&(n&&Ue.alternate!==null&&me.delete(Ue.key===null?ke:Ue.key),P=y(Ue,P,ke),Be===null?ve=Ue:Be.sibling=Ue,Be=Ue);return n&&me.forEach(function(C1){return r(F,C1)}),Pe&&an(F,ke),ve}function Ye(F,P,$,ee){if(typeof $=="object"&&$!==null&&$.type===w&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case v:e:{for(var ve=$.key;P!==null;){if(P.key===ve){if(ve=$.type,ve===w){if(P.tag===7){c(F,P.sibling),ee=g(P,$.props.children),ee.return=F,F=ee;break e}}else if(P.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===z&&vs(ve)===P.type){c(F,P.sibling),ee=g(P,$.props),ya(ee,$),ee.return=F,F=ee;break e}c(F,P);break}else r(F,P);P=P.sibling}$.type===w?(ee=ps($.props.children,F.mode,ee,$.key),ee.return=F,F=ee):(ee=Yo($.type,$.key,$.props,null,F.mode,ee),ya(ee,$),ee.return=F,F=ee)}return A(F);case S:e:{for(ve=$.key;P!==null;){if(P.key===ve)if(P.tag===4&&P.stateNode.containerInfo===$.containerInfo&&P.stateNode.implementation===$.implementation){c(F,P.sibling),ee=g(P,$.children||[]),ee.return=F,F=ee;break e}else{c(F,P);break}else r(F,P);P=P.sibling}ee=Au($,F.mode,ee),ee.return=F,F=ee}return A(F);case z:return $=vs($),Ye(F,P,$,ee)}if(ue($))return fe(F,P,$,ee);if(ce($)){if(ve=ce($),typeof ve!="function")throw Error(i(150));return $=ve.call($),_e(F,P,$,ee)}if(typeof $.then=="function")return Ye(F,P,el($),ee);if($.$$typeof===T)return Ye(F,P,Ko(F,$),ee);tl(F,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,P!==null&&P.tag===6?(c(F,P.sibling),ee=g(P,$),ee.return=F,F=ee):(c(F,P),ee=Su($,F.mode,ee),ee.return=F,F=ee),A(F)):c(F,P)}return function(F,P,$,ee){try{ma=0;var ve=Ye(F,P,$,ee);return lr=null,ve}catch(me){if(me===or||me===Jo)throw me;var Be=oi(29,me,null,F.mode);return Be.lanes=ee,Be.return=F,Be}finally{}}}var _s=Eg(!0),xg=Eg(!1),In=!1;function Pu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ju(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Bn(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Un(n,r,c){var h=n.updateQueue;if(h===null)return null;if(h=h.shared,(Fe&2)!==0){var g=h.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),h.pending=r,r=Vo(n),lg(n,null,c),r}return Go(n,h,r,c),Vo(n)}function ba(n,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194048)!==0)){var h=r.lanes;h&=n.pendingLanes,c|=h,r.lanes=c,mp(n,c)}}function Iu(n,r){var c=n.updateQueue,h=n.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var A={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};y===null?g=y=A:y=y.next=A,c=c.next}while(c!==null);y===null?g=y=r:y=y.next=r}else g=y=r;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,callbacks:h.callbacks},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=r:n.next=r,c.lastBaseUpdate=r}var Bu=!1;function va(){if(Bu){var n=ar;if(n!==null)throw n}}function wa(n,r,c,h){Bu=!1;var g=n.updateQueue;In=!1;var y=g.firstBaseUpdate,A=g.lastBaseUpdate,R=g.shared.pending;if(R!==null){g.shared.pending=null;var L=R,G=L.next;L.next=null,A===null?y=G:A.next=G,A=L;var Z=n.alternate;Z!==null&&(Z=Z.updateQueue,R=Z.lastBaseUpdate,R!==A&&(R===null?Z.firstBaseUpdate=G:R.next=G,Z.lastBaseUpdate=L))}if(y!==null){var te=g.baseState;A=0,Z=G=L=null,R=y;do{var Y=R.lane&-536870913,Q=Y!==R.lane;if(Q?(Ne&Y)===Y:(h&Y)===Y){Y!==0&&Y===rr&&(Bu=!0),Z!==null&&(Z=Z.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var fe=n,_e=R;Y=r;var Ye=c;switch(_e.tag){case 1:if(fe=_e.payload,typeof fe=="function"){te=fe.call(Ye,te,Y);break e}te=fe;break e;case 3:fe.flags=fe.flags&-65537|128;case 0:if(fe=_e.payload,Y=typeof fe=="function"?fe.call(Ye,te,Y):fe,Y==null)break e;te=m({},te,Y);break e;case 2:In=!0}}Y=R.callback,Y!==null&&(n.flags|=64,Q&&(n.flags|=8192),Q=g.callbacks,Q===null?g.callbacks=[Y]:Q.push(Y))}else Q={lane:Y,tag:R.tag,payload:R.payload,callback:R.callback,next:null},Z===null?(G=Z=Q,L=te):Z=Z.next=Q,A|=Y;if(R=R.next,R===null){if(R=g.shared.pending,R===null)break;Q=R,R=Q.next,Q.next=null,g.lastBaseUpdate=Q,g.shared.pending=null}}while(!0);Z===null&&(L=te),g.baseState=L,g.firstBaseUpdate=G,g.lastBaseUpdate=Z,y===null&&(g.shared.lanes=0),$n|=A,n.lanes=A,n.memoizedState=te}}function Tg(n,r){if(typeof n!="function")throw Error(i(191,n));n.call(r)}function Cg(n,r){var c=n.callbacks;if(c!==null)for(n.callbacks=null,n=0;n<c.length;n++)Tg(c[n],r)}var cr=O(null),il=O(0);function Rg(n,r){n=yn,q(il,n),q(cr,r),yn=n|r.baseLanes}function Uu(){q(il,yn),q(cr,cr.current)}function Fu(){yn=il.current,U(cr),U(il)}var li=O(null),Ei=null;function Fn(n){var r=n.alternate;q(ft,ft.current&1),q(li,n),Ei===null&&(r===null||cr.current!==null||r.memoizedState!==null)&&(Ei=n)}function zu(n){q(ft,ft.current),q(li,n),Ei===null&&(Ei=n)}function kg(n){n.tag===22?(q(ft,ft.current),q(li,n),Ei===null&&(Ei=n)):zn()}function zn(){q(ft,ft.current),q(li,li.current)}function ci(n){U(li),Ei===n&&(Ei=null),U(ft)}var ft=O(0);function nl(n){for(var r=n;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Yh(c)||Wh(c)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var cn=0,Ce=null,Ge=null,yt=null,sl=!1,ur=!1,Ss=!1,rl=0,_a=0,hr=null,yS=0;function lt(){throw Error(i(321))}function Hu(n,r){if(r===null)return!1;for(var c=0;c<r.length&&c<n.length;c++)if(!ai(n[c],r[c]))return!1;return!0}function qu(n,r,c,h,g,y){return cn=y,Ce=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,j.H=n===null||n.memoizedState===null?dm:sh,Ss=!1,y=c(h,g),Ss=!1,ur&&(y=Dg(r,c,h,g)),Og(n),y}function Og(n){j.H=Ea;var r=Ge!==null&&Ge.next!==null;if(cn=0,yt=Ge=Ce=null,sl=!1,_a=0,hr=null,r)throw Error(i(300));n===null||bt||(n=n.dependencies,n!==null&&Xo(n)&&(bt=!0))}function Dg(n,r,c,h){Ce=n;var g=0;do{if(ur&&(hr=null),_a=0,ur=!1,25<=g)throw Error(i(301));if(g+=1,yt=Ge=null,n.updateQueue!=null){var y=n.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}j.H=fm,y=r(c,h)}while(ur);return y}function bS(){var n=j.H,r=n.useState()[0];return r=typeof r.then=="function"?Sa(r):r,n=n.useState()[0],(Ge!==null?Ge.memoizedState:null)!==n&&(Ce.flags|=1024),r}function $u(){var n=rl!==0;return rl=0,n}function Gu(n,r,c){r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~c}function Vu(n){if(sl){for(n=n.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}sl=!1}cn=0,yt=Ge=Ce=null,ur=!1,_a=rl=0,hr=null}function Ht(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yt===null?Ce.memoizedState=yt=n:yt=yt.next=n,yt}function pt(){if(Ge===null){var n=Ce.alternate;n=n!==null?n.memoizedState:null}else n=Ge.next;var r=yt===null?Ce.memoizedState:yt.next;if(r!==null)yt=r,Ge=n;else{if(n===null)throw Ce.alternate===null?Error(i(467)):Error(i(310));Ge=n,n={memoizedState:Ge.memoizedState,baseState:Ge.baseState,baseQueue:Ge.baseQueue,queue:Ge.queue,next:null},yt===null?Ce.memoizedState=yt=n:yt=yt.next=n}return yt}function al(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Sa(n){var r=_a;return _a+=1,hr===null&&(hr=[]),n=_g(hr,n,r),r=Ce,(yt===null?r.memoizedState:yt.next)===null&&(r=r.alternate,j.H=r===null||r.memoizedState===null?dm:sh),n}function ol(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return Sa(n);if(n.$$typeof===T)return Dt(n)}throw Error(i(438,String(n)))}function Yu(n){var r=null,c=Ce.updateQueue;if(c!==null&&(r=c.memoCache),r==null){var h=Ce.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(r={data:h.data.map(function(g){return g.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),c===null&&(c=al(),Ce.updateQueue=c),c.memoCache=r,c=r.data[r.index],c===void 0)for(c=r.data[r.index]=Array(n),h=0;h<n;h++)c[h]=ne;return r.index++,c}function un(n,r){return typeof r=="function"?r(n):r}function ll(n){var r=pt();return Wu(r,Ge,n)}function Wu(n,r,c){var h=n.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=c;var g=n.baseQueue,y=h.pending;if(y!==null){if(g!==null){var A=g.next;g.next=y.next,y.next=A}r.baseQueue=g=y,h.pending=null}if(y=n.baseState,g===null)n.memoizedState=y;else{r=g.next;var R=A=null,L=null,G=r,Z=!1;do{var te=G.lane&-536870913;if(te!==G.lane?(Ne&te)===te:(cn&te)===te){var Y=G.revertLane;if(Y===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null}),te===rr&&(Z=!0);else if((cn&Y)===Y){G=G.next,Y===rr&&(Z=!0);continue}else te={lane:0,revertLane:G.revertLane,gesture:null,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},L===null?(R=L=te,A=y):L=L.next=te,Ce.lanes|=Y,$n|=Y;te=G.action,Ss&&c(y,te),y=G.hasEagerState?G.eagerState:c(y,te)}else Y={lane:te,revertLane:G.revertLane,gesture:G.gesture,action:G.action,hasEagerState:G.hasEagerState,eagerState:G.eagerState,next:null},L===null?(R=L=Y,A=y):L=L.next=Y,Ce.lanes|=te,$n|=te;G=G.next}while(G!==null&&G!==r);if(L===null?A=y:L.next=R,!ai(y,n.memoizedState)&&(bt=!0,Z&&(c=ar,c!==null)))throw c;n.memoizedState=y,n.baseState=A,n.baseQueue=L,h.lastRenderedState=y}return g===null&&(h.lanes=0),[n.memoizedState,h.dispatch]}function Xu(n){var r=pt(),c=r.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=n;var h=c.dispatch,g=c.pending,y=r.memoizedState;if(g!==null){c.pending=null;var A=g=g.next;do y=n(y,A.action),A=A.next;while(A!==g);ai(y,r.memoizedState)||(bt=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),c.lastRenderedState=y}return[y,h]}function Mg(n,r,c){var h=Ce,g=pt(),y=Pe;if(y){if(c===void 0)throw Error(i(407));c=c()}else c=r();var A=!ai((Ge||g).memoizedState,c);if(A&&(g.memoizedState=c,bt=!0),g=g.queue,Ju(Pg.bind(null,h,g,n),[n]),g.getSnapshot!==r||A||yt!==null&&yt.memoizedState.tag&1){if(h.flags|=2048,dr(9,{destroy:void 0},Lg.bind(null,h,g,c,r),null),Xe===null)throw Error(i(349));y||(cn&127)!==0||Ng(h,r,c)}return c}function Ng(n,r,c){n.flags|=16384,n={getSnapshot:r,value:c},r=Ce.updateQueue,r===null?(r=al(),Ce.updateQueue=r,r.stores=[n]):(c=r.stores,c===null?r.stores=[n]:c.push(n))}function Lg(n,r,c,h){r.value=c,r.getSnapshot=h,jg(r)&&Ig(n)}function Pg(n,r,c){return c(function(){jg(r)&&Ig(n)})}function jg(n){var r=n.getSnapshot;n=n.value;try{var c=r();return!ai(n,c)}catch{return!0}}function Ig(n){var r=fs(n,2);r!==null&&Zt(r,n,2)}function Ku(n){var r=Ht();if(typeof n=="function"){var c=n;if(n=c(),Ss){On(!0);try{c()}finally{On(!1)}}}return r.memoizedState=r.baseState=n,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:un,lastRenderedState:n},r}function Bg(n,r,c,h){return n.baseState=c,Wu(n,Ge,typeof h=="function"?h:un)}function vS(n,r,c,h,g){if(hl(n))throw Error(i(485));if(n=r.action,n!==null){var y={payload:g,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(A){y.listeners.push(A)}};j.T!==null?c(!0):y.isTransition=!1,h(y),c=r.pending,c===null?(y.next=r.pending=y,Ug(r,y)):(y.next=c.next,r.pending=c.next=y)}}function Ug(n,r){var c=r.action,h=r.payload,g=n.state;if(r.isTransition){var y=j.T,A={};j.T=A;try{var R=c(g,h),L=j.S;L!==null&&L(A,R),Fg(n,r,R)}catch(G){Qu(n,r,G)}finally{y!==null&&A.types!==null&&(y.types=A.types),j.T=y}}else try{y=c(g,h),Fg(n,r,y)}catch(G){Qu(n,r,G)}}function Fg(n,r,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(h){zg(n,r,h)},function(h){return Qu(n,r,h)}):zg(n,r,c)}function zg(n,r,c){r.status="fulfilled",r.value=c,Hg(r),n.state=c,r=n.pending,r!==null&&(c=r.next,c===r?n.pending=null:(c=c.next,r.next=c,Ug(n,c)))}function Qu(n,r,c){var h=n.pending;if(n.pending=null,h!==null){h=h.next;do r.status="rejected",r.reason=c,Hg(r),r=r.next;while(r!==h)}n.action=null}function Hg(n){n=n.listeners;for(var r=0;r<n.length;r++)(0,n[r])()}function qg(n,r){return r}function $g(n,r){if(Pe){var c=Xe.formState;if(c!==null){e:{var h=Ce;if(Pe){if(Je){t:{for(var g=Je,y=Ai;g.nodeType!==8;){if(!y){g=null;break t}if(g=xi(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){Je=xi(g.nextSibling),h=g.data==="F!";break e}}Pn(h)}h=!1}h&&(r=c[0])}}return c=Ht(),c.memoizedState=c.baseState=r,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qg,lastRenderedState:r},c.queue=h,c=cm.bind(null,Ce,h),h.dispatch=c,h=Ku(!1),y=nh.bind(null,Ce,!1,h.queue),h=Ht(),g={state:r,dispatch:null,action:n,pending:null},h.queue=g,c=vS.bind(null,Ce,g,y,c),g.dispatch=c,h.memoizedState=n,[r,c,!1]}function Gg(n){var r=pt();return Vg(r,Ge,n)}function Vg(n,r,c){if(r=Wu(n,r,qg)[0],n=ll(un)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var h=Sa(r)}catch(A){throw A===or?Jo:A}else h=r;r=pt();var g=r.queue,y=g.dispatch;return c!==r.memoizedState&&(Ce.flags|=2048,dr(9,{destroy:void 0},wS.bind(null,g,c),null)),[h,y,n]}function wS(n,r){n.action=r}function Yg(n){var r=pt(),c=Ge;if(c!==null)return Vg(r,c,n);pt(),r=r.memoizedState,c=pt();var h=c.queue.dispatch;return c.memoizedState=n,[r,h,!1]}function dr(n,r,c,h){return n={tag:n,create:c,deps:h,inst:r,next:null},r=Ce.updateQueue,r===null&&(r=al(),Ce.updateQueue=r),c=r.lastEffect,c===null?r.lastEffect=n.next=n:(h=c.next,c.next=n,n.next=h,r.lastEffect=n),n}function Wg(){return pt().memoizedState}function cl(n,r,c,h){var g=Ht();Ce.flags|=n,g.memoizedState=dr(1|r,{destroy:void 0},c,h===void 0?null:h)}function ul(n,r,c,h){var g=pt();h=h===void 0?null:h;var y=g.memoizedState.inst;Ge!==null&&h!==null&&Hu(h,Ge.memoizedState.deps)?g.memoizedState=dr(r,y,c,h):(Ce.flags|=n,g.memoizedState=dr(1|r,y,c,h))}function Xg(n,r){cl(8390656,8,n,r)}function Ju(n,r){ul(2048,8,n,r)}function _S(n){Ce.flags|=4;var r=Ce.updateQueue;if(r===null)r=al(),Ce.updateQueue=r,r.events=[n];else{var c=r.events;c===null?r.events=[n]:c.push(n)}}function Kg(n){var r=pt().memoizedState;return _S({ref:r,nextImpl:n}),function(){if((Fe&2)!==0)throw Error(i(440));return r.impl.apply(void 0,arguments)}}function Qg(n,r){return ul(4,2,n,r)}function Jg(n,r){return ul(4,4,n,r)}function Zg(n,r){if(typeof r=="function"){n=n();var c=r(n);return function(){typeof c=="function"?c():r(null)}}if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function em(n,r,c){c=c!=null?c.concat([n]):null,ul(4,4,Zg.bind(null,r,n),c)}function Zu(){}function tm(n,r){var c=pt();r=r===void 0?null:r;var h=c.memoizedState;return r!==null&&Hu(r,h[1])?h[0]:(c.memoizedState=[n,r],n)}function im(n,r){var c=pt();r=r===void 0?null:r;var h=c.memoizedState;if(r!==null&&Hu(r,h[1]))return h[0];if(h=n(),Ss){On(!0);try{n()}finally{On(!1)}}return c.memoizedState=[h,r],h}function eh(n,r,c){return c===void 0||(cn&1073741824)!==0&&(Ne&261930)===0?n.memoizedState=r:(n.memoizedState=c,n=ny(),Ce.lanes|=n,$n|=n,c)}function nm(n,r,c,h){return ai(c,r)?c:cr.current!==null?(n=eh(n,c,h),ai(n,r)||(bt=!0),n):(cn&42)===0||(cn&1073741824)!==0&&(Ne&261930)===0?(bt=!0,n.memoizedState=c):(n=ny(),Ce.lanes|=n,$n|=n,r)}function sm(n,r,c,h,g){var y=J.p;J.p=y!==0&&8>y?y:8;var A=j.T,R={};j.T=R,nh(n,!1,r,c);try{var L=g(),G=j.S;if(G!==null&&G(R,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var Z=mS(L,h);Aa(n,r,Z,di(n))}else Aa(n,r,h,di(n))}catch(te){Aa(n,r,{then:function(){},status:"rejected",reason:te},di())}finally{J.p=y,A!==null&&R.types!==null&&(A.types=R.types),j.T=A}}function SS(){}function th(n,r,c,h){if(n.tag!==5)throw Error(i(476));var g=rm(n).queue;sm(n,g,r,oe,c===null?SS:function(){return am(n),c(h)})}function rm(n){var r=n.memoizedState;if(r!==null)return r;r={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:un,lastRenderedState:oe},next:null};var c={};return r.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:un,lastRenderedState:c},next:null},n.memoizedState=r,n=n.alternate,n!==null&&(n.memoizedState=r),r}function am(n){var r=rm(n);r.next===null&&(r=n.alternate.memoizedState),Aa(n,r.next.queue,{},di())}function ih(){return Dt(Fa)}function om(){return pt().memoizedState}function lm(){return pt().memoizedState}function AS(n){for(var r=n.return;r!==null;){switch(r.tag){case 24:case 3:var c=di();n=Bn(c);var h=Un(r,n,c);h!==null&&(Zt(h,r,c),ba(h,r,c)),r={cache:Du()},n.payload=r;return}r=r.return}}function ES(n,r,c){var h=di();c={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},hl(n)?um(r,c):(c=wu(n,r,c,h),c!==null&&(Zt(c,n,h),hm(c,r,h)))}function cm(n,r,c){var h=di();Aa(n,r,c,h)}function Aa(n,r,c,h){var g={lane:h,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(hl(n))um(r,g);else{var y=n.alternate;if(n.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var A=r.lastRenderedState,R=y(A,c);if(g.hasEagerState=!0,g.eagerState=R,ai(R,A))return Go(n,r,g,0),Xe===null&&$o(),!1}catch{}finally{}if(c=wu(n,r,g,h),c!==null)return Zt(c,n,h),hm(c,r,h),!0}return!1}function nh(n,r,c,h){if(h={lane:2,revertLane:Ph(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},hl(n)){if(r)throw Error(i(479))}else r=wu(n,c,h,2),r!==null&&Zt(r,n,2)}function hl(n){var r=n.alternate;return n===Ce||r!==null&&r===Ce}function um(n,r){ur=sl=!0;var c=n.pending;c===null?r.next=r:(r.next=c.next,c.next=r),n.pending=r}function hm(n,r,c){if((c&4194048)!==0){var h=r.lanes;h&=n.pendingLanes,c|=h,r.lanes=c,mp(n,c)}}var Ea={readContext:Dt,use:ol,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useLayoutEffect:lt,useInsertionEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useSyncExternalStore:lt,useId:lt,useHostTransitionStatus:lt,useFormState:lt,useActionState:lt,useOptimistic:lt,useMemoCache:lt,useCacheRefresh:lt};Ea.useEffectEvent=lt;var dm={readContext:Dt,use:ol,useCallback:function(n,r){return Ht().memoizedState=[n,r===void 0?null:r],n},useContext:Dt,useEffect:Xg,useImperativeHandle:function(n,r,c){c=c!=null?c.concat([n]):null,cl(4194308,4,Zg.bind(null,r,n),c)},useLayoutEffect:function(n,r){return cl(4194308,4,n,r)},useInsertionEffect:function(n,r){cl(4,2,n,r)},useMemo:function(n,r){var c=Ht();r=r===void 0?null:r;var h=n();if(Ss){On(!0);try{n()}finally{On(!1)}}return c.memoizedState=[h,r],h},useReducer:function(n,r,c){var h=Ht();if(c!==void 0){var g=c(r);if(Ss){On(!0);try{c(r)}finally{On(!1)}}}else g=r;return h.memoizedState=h.baseState=g,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:g},h.queue=n,n=n.dispatch=ES.bind(null,Ce,n),[h.memoizedState,n]},useRef:function(n){var r=Ht();return n={current:n},r.memoizedState=n},useState:function(n){n=Ku(n);var r=n.queue,c=cm.bind(null,Ce,r);return r.dispatch=c,[n.memoizedState,c]},useDebugValue:Zu,useDeferredValue:function(n,r){var c=Ht();return eh(c,n,r)},useTransition:function(){var n=Ku(!1);return n=sm.bind(null,Ce,n.queue,!0,!1),Ht().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,r,c){var h=Ce,g=Ht();if(Pe){if(c===void 0)throw Error(i(407));c=c()}else{if(c=r(),Xe===null)throw Error(i(349));(Ne&127)!==0||Ng(h,r,c)}g.memoizedState=c;var y={value:c,getSnapshot:r};return g.queue=y,Xg(Pg.bind(null,h,y,n),[n]),h.flags|=2048,dr(9,{destroy:void 0},Lg.bind(null,h,y,c,r),null),c},useId:function(){var n=Ht(),r=Xe.identifierPrefix;if(Pe){var c=zi,h=Fi;c=(h&~(1<<32-ri(h)-1)).toString(32)+c,r="_"+r+"R_"+c,c=rl++,0<c&&(r+="H"+c.toString(32)),r+="_"}else c=yS++,r="_"+r+"r_"+c.toString(32)+"_";return n.memoizedState=r},useHostTransitionStatus:ih,useFormState:$g,useActionState:$g,useOptimistic:function(n){var r=Ht();r.memoizedState=r.baseState=n;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=c,r=nh.bind(null,Ce,!0,c),c.dispatch=r,[n,r]},useMemoCache:Yu,useCacheRefresh:function(){return Ht().memoizedState=AS.bind(null,Ce)},useEffectEvent:function(n){var r=Ht(),c={impl:n};return r.memoizedState=c,function(){if((Fe&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},sh={readContext:Dt,use:ol,useCallback:tm,useContext:Dt,useEffect:Ju,useImperativeHandle:em,useInsertionEffect:Qg,useLayoutEffect:Jg,useMemo:im,useReducer:ll,useRef:Wg,useState:function(){return ll(un)},useDebugValue:Zu,useDeferredValue:function(n,r){var c=pt();return nm(c,Ge.memoizedState,n,r)},useTransition:function(){var n=ll(un)[0],r=pt().memoizedState;return[typeof n=="boolean"?n:Sa(n),r]},useSyncExternalStore:Mg,useId:om,useHostTransitionStatus:ih,useFormState:Gg,useActionState:Gg,useOptimistic:function(n,r){var c=pt();return Bg(c,Ge,n,r)},useMemoCache:Yu,useCacheRefresh:lm};sh.useEffectEvent=Kg;var fm={readContext:Dt,use:ol,useCallback:tm,useContext:Dt,useEffect:Ju,useImperativeHandle:em,useInsertionEffect:Qg,useLayoutEffect:Jg,useMemo:im,useReducer:Xu,useRef:Wg,useState:function(){return Xu(un)},useDebugValue:Zu,useDeferredValue:function(n,r){var c=pt();return Ge===null?eh(c,n,r):nm(c,Ge.memoizedState,n,r)},useTransition:function(){var n=Xu(un)[0],r=pt().memoizedState;return[typeof n=="boolean"?n:Sa(n),r]},useSyncExternalStore:Mg,useId:om,useHostTransitionStatus:ih,useFormState:Yg,useActionState:Yg,useOptimistic:function(n,r){var c=pt();return Ge!==null?Bg(c,Ge,n,r):(c.baseState=n,[n,c.queue.dispatch])},useMemoCache:Yu,useCacheRefresh:lm};fm.useEffectEvent=Kg;function rh(n,r,c,h){r=n.memoizedState,c=c(h,r),c=c==null?r:m({},r,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var ah={enqueueSetState:function(n,r,c){n=n._reactInternals;var h=di(),g=Bn(h);g.payload=r,c!=null&&(g.callback=c),r=Un(n,g,h),r!==null&&(Zt(r,n,h),ba(r,n,h))},enqueueReplaceState:function(n,r,c){n=n._reactInternals;var h=di(),g=Bn(h);g.tag=1,g.payload=r,c!=null&&(g.callback=c),r=Un(n,g,h),r!==null&&(Zt(r,n,h),ba(r,n,h))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var c=di(),h=Bn(c);h.tag=2,r!=null&&(h.callback=r),r=Un(n,h,c),r!==null&&(Zt(r,n,c),ba(r,n,c))}};function pm(n,r,c,h,g,y,A){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(h,y,A):r.prototype&&r.prototype.isPureReactComponent?!ua(c,h)||!ua(g,y):!0}function gm(n,r,c,h){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,h),r.state!==n&&ah.enqueueReplaceState(r,r.state,null)}function As(n,r){var c=r;if("ref"in r){c={};for(var h in r)h!=="ref"&&(c[h]=r[h])}if(n=n.defaultProps){c===r&&(c=m({},c));for(var g in n)c[g]===void 0&&(c[g]=n[g])}return c}function mm(n){qo(n)}function ym(n){console.error(n)}function bm(n){qo(n)}function dl(n,r){try{var c=n.onUncaughtError;c(r.value,{componentStack:r.stack})}catch(h){setTimeout(function(){throw h})}}function vm(n,r,c){try{var h=n.onCaughtError;h(c.value,{componentStack:c.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function oh(n,r,c){return c=Bn(c),c.tag=3,c.payload={element:null},c.callback=function(){dl(n,r)},c}function wm(n){return n=Bn(n),n.tag=3,n}function _m(n,r,c,h){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var y=h.value;n.payload=function(){return g(y)},n.callback=function(){vm(r,c,h)}}var A=c.stateNode;A!==null&&typeof A.componentDidCatch=="function"&&(n.callback=function(){vm(r,c,h),typeof g!="function"&&(Gn===null?Gn=new Set([this]):Gn.add(this));var R=h.stack;this.componentDidCatch(h.value,{componentStack:R!==null?R:""})})}function xS(n,r,c,h,g){if(c.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(r=c.alternate,r!==null&&sr(r,c,g,!0),c=li.current,c!==null){switch(c.tag){case 31:case 13:return Ei===null?El():c.alternate===null&&ct===0&&(ct=3),c.flags&=-257,c.flags|=65536,c.lanes=g,h===Zo?c.flags|=16384:(r=c.updateQueue,r===null?c.updateQueue=new Set([h]):r.add(h),Mh(n,h,g)),!1;case 22:return c.flags|=65536,h===Zo?c.flags|=16384:(r=c.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([h])},c.updateQueue=r):(c=r.retryQueue,c===null?r.retryQueue=new Set([h]):c.add(h)),Mh(n,h,g)),!1}throw Error(i(435,c.tag))}return Mh(n,h,g),El(),!1}if(Pe)return r=li.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=g,h!==Tu&&(n=Error(i(422),{cause:h}),fa(wi(n,c)))):(h!==Tu&&(r=Error(i(423),{cause:h}),fa(wi(r,c))),n=n.current.alternate,n.flags|=65536,g&=-g,n.lanes|=g,h=wi(h,c),g=oh(n.stateNode,h,g),Iu(n,g),ct!==4&&(ct=2)),!1;var y=Error(i(520),{cause:h});if(y=wi(y,c),Ma===null?Ma=[y]:Ma.push(y),ct!==4&&(ct=2),r===null)return!0;h=wi(h,c),c=r;do{switch(c.tag){case 3:return c.flags|=65536,n=g&-g,c.lanes|=n,n=oh(c.stateNode,h,n),Iu(c,n),!1;case 1:if(r=c.type,y=c.stateNode,(c.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Gn===null||!Gn.has(y))))return c.flags|=65536,g&=-g,c.lanes|=g,g=wm(g),_m(g,n,c,h),Iu(c,g),!1}c=c.return}while(c!==null);return!1}var lh=Error(i(461)),bt=!1;function Mt(n,r,c,h){r.child=n===null?xg(r,null,c,h):_s(r,n.child,c,h)}function Sm(n,r,c,h,g){c=c.render;var y=r.ref;if("ref"in h){var A={};for(var R in h)R!=="ref"&&(A[R]=h[R])}else A=h;return ys(r),h=qu(n,r,c,A,y,g),R=$u(),n!==null&&!bt?(Gu(n,r,g),hn(n,r,g)):(Pe&&R&&Eu(r),r.flags|=1,Mt(n,r,h,g),r.child)}function Am(n,r,c,h,g){if(n===null){var y=c.type;return typeof y=="function"&&!_u(y)&&y.defaultProps===void 0&&c.compare===null?(r.tag=15,r.type=y,Em(n,r,y,h,g)):(n=Yo(c.type,null,h,r,r.mode,g),n.ref=r.ref,n.return=r,r.child=n)}if(y=n.child,!mh(n,g)){var A=y.memoizedProps;if(c=c.compare,c=c!==null?c:ua,c(A,h)&&n.ref===r.ref)return hn(n,r,g)}return r.flags|=1,n=rn(y,h),n.ref=r.ref,n.return=r,r.child=n}function Em(n,r,c,h,g){if(n!==null){var y=n.memoizedProps;if(ua(y,h)&&n.ref===r.ref)if(bt=!1,r.pendingProps=h=y,mh(n,g))(n.flags&131072)!==0&&(bt=!0);else return r.lanes=n.lanes,hn(n,r,g)}return ch(n,r,c,h,g)}function xm(n,r,c,h){var g=h.children,y=n!==null?n.memoizedState:null;if(n===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((r.flags&128)!==0){if(y=y!==null?y.baseLanes|c:c,n!==null){for(h=r.child=n.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~y}else h=0,r.child=null;return Tm(n,r,y,c,h)}if((c&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},n!==null&&Qo(r,y!==null?y.cachePool:null),y!==null?Rg(r,y):Uu(),kg(r);else return h=r.lanes=536870912,Tm(n,r,y!==null?y.baseLanes|c:c,c,h)}else y!==null?(Qo(r,y.cachePool),Rg(r,y),zn(),r.memoizedState=null):(n!==null&&Qo(r,null),Uu(),zn());return Mt(n,r,g,c),r.child}function xa(n,r){return n!==null&&n.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Tm(n,r,c,h,g){var y=Nu();return y=y===null?null:{parent:mt._currentValue,pool:y},r.memoizedState={baseLanes:c,cachePool:y},n!==null&&Qo(r,null),Uu(),kg(r),n!==null&&sr(n,r,h,!0),r.childLanes=g,null}function fl(n,r){return r=gl({mode:r.mode,children:r.children},n.mode),r.ref=n.ref,n.child=r,r.return=n,r}function Cm(n,r,c){return _s(r,n.child,null,c),n=fl(r,r.pendingProps),n.flags|=2,ci(r),r.memoizedState=null,n}function TS(n,r,c){var h=r.pendingProps,g=(r.flags&128)!==0;if(r.flags&=-129,n===null){if(Pe){if(h.mode==="hidden")return n=fl(r,h),r.lanes=536870912,xa(null,n);if(zu(r),(n=Je)?(n=Uy(n,Ai),n=n!==null&&n.data==="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:Nn!==null?{id:Fi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},c=ug(n),c.return=r,r.child=c,Ot=r,Je=null)):n=null,n===null)throw Pn(r);return r.lanes=536870912,null}return fl(r,h)}var y=n.memoizedState;if(y!==null){var A=y.dehydrated;if(zu(r),g)if(r.flags&256)r.flags&=-257,r=Cm(n,r,c);else if(r.memoizedState!==null)r.child=n.child,r.flags|=128,r=null;else throw Error(i(558));else if(bt||sr(n,r,c,!1),g=(c&n.childLanes)!==0,bt||g){if(h=Xe,h!==null&&(A=yp(h,c),A!==0&&A!==y.retryLane))throw y.retryLane=A,fs(n,A),Zt(h,n,A),lh;El(),r=Cm(n,r,c)}else n=y.treeContext,Je=xi(A.nextSibling),Ot=r,Pe=!0,Ln=null,Ai=!1,n!==null&&fg(r,n),r=fl(r,h),r.flags|=4096;return r}return n=rn(n.child,{mode:h.mode,children:h.children}),n.ref=r.ref,r.child=n,n.return=r,n}function pl(n,r){var c=r.ref;if(c===null)n!==null&&n.ref!==null&&(r.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(n===null||n.ref!==c)&&(r.flags|=4194816)}}function ch(n,r,c,h,g){return ys(r),c=qu(n,r,c,h,void 0,g),h=$u(),n!==null&&!bt?(Gu(n,r,g),hn(n,r,g)):(Pe&&h&&Eu(r),r.flags|=1,Mt(n,r,c,g),r.child)}function Rm(n,r,c,h,g,y){return ys(r),r.updateQueue=null,c=Dg(r,h,c,g),Og(n),h=$u(),n!==null&&!bt?(Gu(n,r,y),hn(n,r,y)):(Pe&&h&&Eu(r),r.flags|=1,Mt(n,r,c,y),r.child)}function km(n,r,c,h,g){if(ys(r),r.stateNode===null){var y=er,A=c.contextType;typeof A=="object"&&A!==null&&(y=Dt(A)),y=new c(h,y),r.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=ah,r.stateNode=y,y._reactInternals=r,y=r.stateNode,y.props=h,y.state=r.memoizedState,y.refs={},Pu(r),A=c.contextType,y.context=typeof A=="object"&&A!==null?Dt(A):er,y.state=r.memoizedState,A=c.getDerivedStateFromProps,typeof A=="function"&&(rh(r,c,A,h),y.state=r.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(A=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),A!==y.state&&ah.enqueueReplaceState(y,y.state,null),wa(r,h,y,g),va(),y.state=r.memoizedState),typeof y.componentDidMount=="function"&&(r.flags|=4194308),h=!0}else if(n===null){y=r.stateNode;var R=r.memoizedProps,L=As(c,R);y.props=L;var G=y.context,Z=c.contextType;A=er,typeof Z=="object"&&Z!==null&&(A=Dt(Z));var te=c.getDerivedStateFromProps;Z=typeof te=="function"||typeof y.getSnapshotBeforeUpdate=="function",R=r.pendingProps!==R,Z||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(R||G!==A)&&gm(r,y,h,A),In=!1;var Y=r.memoizedState;y.state=Y,wa(r,h,y,g),va(),G=r.memoizedState,R||Y!==G||In?(typeof te=="function"&&(rh(r,c,te,h),G=r.memoizedState),(L=In||pm(r,c,L,h,Y,G,A))?(Z||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(r.flags|=4194308)):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=G),y.props=h,y.state=G,y.context=A,h=L):(typeof y.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{y=r.stateNode,ju(n,r),A=r.memoizedProps,Z=As(c,A),y.props=Z,te=r.pendingProps,Y=y.context,G=c.contextType,L=er,typeof G=="object"&&G!==null&&(L=Dt(G)),R=c.getDerivedStateFromProps,(G=typeof R=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(A!==te||Y!==L)&&gm(r,y,h,L),In=!1,Y=r.memoizedState,y.state=Y,wa(r,h,y,g),va();var Q=r.memoizedState;A!==te||Y!==Q||In||n!==null&&n.dependencies!==null&&Xo(n.dependencies)?(typeof R=="function"&&(rh(r,c,R,h),Q=r.memoizedState),(Z=In||pm(r,c,Z,h,Y,Q,L)||n!==null&&n.dependencies!==null&&Xo(n.dependencies))?(G||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,Q,L),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,Q,L)),typeof y.componentDidUpdate=="function"&&(r.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof y.componentDidUpdate!="function"||A===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Q),y.props=h,y.state=Q,y.context=L,h=Z):(typeof y.componentDidUpdate!="function"||A===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||A===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),h=!1)}return y=h,pl(n,r),h=(r.flags&128)!==0,y||h?(y=r.stateNode,c=h&&typeof c.getDerivedStateFromError!="function"?null:y.render(),r.flags|=1,n!==null&&h?(r.child=_s(r,n.child,null,g),r.child=_s(r,null,c,g)):Mt(n,r,c,g),r.memoizedState=y.state,n=r.child):n=hn(n,r,g),n}function Om(n,r,c,h){return gs(),r.flags|=256,Mt(n,r,c,h),r.child}var uh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function hh(n){return{baseLanes:n,cachePool:vg()}}function dh(n,r,c){return n=n!==null?n.childLanes&~c:0,r&&(n|=hi),n}function Dm(n,r,c){var h=r.pendingProps,g=!1,y=(r.flags&128)!==0,A;if((A=y)||(A=n!==null&&n.memoizedState===null?!1:(ft.current&2)!==0),A&&(g=!0,r.flags&=-129),A=(r.flags&32)!==0,r.flags&=-33,n===null){if(Pe){if(g?Fn(r):zn(),(n=Je)?(n=Uy(n,Ai),n=n!==null&&n.data!=="&"?n:null,n!==null&&(r.memoizedState={dehydrated:n,treeContext:Nn!==null?{id:Fi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},c=ug(n),c.return=r,r.child=c,Ot=r,Je=null)):n=null,n===null)throw Pn(r);return Wh(n)?r.lanes=32:r.lanes=536870912,null}var R=h.children;return h=h.fallback,g?(zn(),g=r.mode,R=gl({mode:"hidden",children:R},g),h=ps(h,g,c,null),R.return=r,h.return=r,R.sibling=h,r.child=R,h=r.child,h.memoizedState=hh(c),h.childLanes=dh(n,A,c),r.memoizedState=uh,xa(null,h)):(Fn(r),fh(r,R))}var L=n.memoizedState;if(L!==null&&(R=L.dehydrated,R!==null)){if(y)r.flags&256?(Fn(r),r.flags&=-257,r=ph(n,r,c)):r.memoizedState!==null?(zn(),r.child=n.child,r.flags|=128,r=null):(zn(),R=h.fallback,g=r.mode,h=gl({mode:"visible",children:h.children},g),R=ps(R,g,c,null),R.flags|=2,h.return=r,R.return=r,h.sibling=R,r.child=h,_s(r,n.child,null,c),h=r.child,h.memoizedState=hh(c),h.childLanes=dh(n,A,c),r.memoizedState=uh,r=xa(null,h));else if(Fn(r),Wh(R)){if(A=R.nextSibling&&R.nextSibling.dataset,A)var G=A.dgst;A=G,h=Error(i(419)),h.stack="",h.digest=A,fa({value:h,source:null,stack:null}),r=ph(n,r,c)}else if(bt||sr(n,r,c,!1),A=(c&n.childLanes)!==0,bt||A){if(A=Xe,A!==null&&(h=yp(A,c),h!==0&&h!==L.retryLane))throw L.retryLane=h,fs(n,h),Zt(A,n,h),lh;Yh(R)||El(),r=ph(n,r,c)}else Yh(R)?(r.flags|=192,r.child=n.child,r=null):(n=L.treeContext,Je=xi(R.nextSibling),Ot=r,Pe=!0,Ln=null,Ai=!1,n!==null&&fg(r,n),r=fh(r,h.children),r.flags|=4096);return r}return g?(zn(),R=h.fallback,g=r.mode,L=n.child,G=L.sibling,h=rn(L,{mode:"hidden",children:h.children}),h.subtreeFlags=L.subtreeFlags&65011712,G!==null?R=rn(G,R):(R=ps(R,g,c,null),R.flags|=2),R.return=r,h.return=r,h.sibling=R,r.child=h,xa(null,h),h=r.child,R=n.child.memoizedState,R===null?R=hh(c):(g=R.cachePool,g!==null?(L=mt._currentValue,g=g.parent!==L?{parent:L,pool:L}:g):g=vg(),R={baseLanes:R.baseLanes|c,cachePool:g}),h.memoizedState=R,h.childLanes=dh(n,A,c),r.memoizedState=uh,xa(n.child,h)):(Fn(r),c=n.child,n=c.sibling,c=rn(c,{mode:"visible",children:h.children}),c.return=r,c.sibling=null,n!==null&&(A=r.deletions,A===null?(r.deletions=[n],r.flags|=16):A.push(n)),r.child=c,r.memoizedState=null,c)}function fh(n,r){return r=gl({mode:"visible",children:r},n.mode),r.return=n,n.child=r}function gl(n,r){return n=oi(22,n,null,r),n.lanes=0,n}function ph(n,r,c){return _s(r,n.child,null,c),n=fh(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function Mm(n,r,c){n.lanes|=r;var h=n.alternate;h!==null&&(h.lanes|=r),ku(n.return,r,c)}function gh(n,r,c,h,g,y){var A=n.memoizedState;A===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g,treeForkCount:y}:(A.isBackwards=r,A.rendering=null,A.renderingStartTime=0,A.last=h,A.tail=c,A.tailMode=g,A.treeForkCount=y)}function Nm(n,r,c){var h=r.pendingProps,g=h.revealOrder,y=h.tail;h=h.children;var A=ft.current,R=(A&2)!==0;if(R?(A=A&1|2,r.flags|=128):A&=1,q(ft,A),Mt(n,r,h,c),h=Pe?da:0,!R&&n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Mm(n,c,r);else if(n.tag===19)Mm(n,c,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(g){case"forwards":for(c=r.child,g=null;c!==null;)n=c.alternate,n!==null&&nl(n)===null&&(g=c),c=c.sibling;c=g,c===null?(g=r.child,r.child=null):(g=c.sibling,c.sibling=null),gh(r,!1,g,c,y,h);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=r.child,r.child=null;g!==null;){if(n=g.alternate,n!==null&&nl(n)===null){r.child=g;break}n=g.sibling,g.sibling=c,c=g,g=n}gh(r,!0,c,null,y,h);break;case"together":gh(r,!1,null,null,void 0,h);break;default:r.memoizedState=null}return r.child}function hn(n,r,c){if(n!==null&&(r.dependencies=n.dependencies),$n|=r.lanes,(c&r.childLanes)===0)if(n!==null){if(sr(n,r,c,!1),(c&r.childLanes)===0)return null}else return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,c=rn(n,n.pendingProps),r.child=c,c.return=r;n.sibling!==null;)n=n.sibling,c=c.sibling=rn(n,n.pendingProps),c.return=r;c.sibling=null}return r.child}function mh(n,r){return(n.lanes&r)!==0?!0:(n=n.dependencies,!!(n!==null&&Xo(n)))}function CS(n,r,c){switch(r.tag){case 3:ae(r,r.stateNode.containerInfo),jn(r,mt,n.memoizedState.cache),gs();break;case 27:case 5:de(r);break;case 4:ae(r,r.stateNode.containerInfo);break;case 10:jn(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,zu(r),null;break;case 13:var h=r.memoizedState;if(h!==null)return h.dehydrated!==null?(Fn(r),r.flags|=128,null):(c&r.child.childLanes)!==0?Dm(n,r,c):(Fn(r),n=hn(n,r,c),n!==null?n.sibling:null);Fn(r);break;case 19:var g=(n.flags&128)!==0;if(h=(c&r.childLanes)!==0,h||(sr(n,r,c,!1),h=(c&r.childLanes)!==0),g){if(h)return Nm(n,r,c);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),q(ft,ft.current),h)break;return null;case 22:return r.lanes=0,xm(n,r,c,r.pendingProps);case 24:jn(r,mt,n.memoizedState.cache)}return hn(n,r,c)}function Lm(n,r,c){if(n!==null)if(n.memoizedProps!==r.pendingProps)bt=!0;else{if(!mh(n,c)&&(r.flags&128)===0)return bt=!1,CS(n,r,c);bt=(n.flags&131072)!==0}else bt=!1,Pe&&(r.flags&1048576)!==0&&dg(r,da,r.index);switch(r.lanes=0,r.tag){case 16:e:{var h=r.pendingProps;if(n=vs(r.elementType),r.type=n,typeof n=="function")_u(n)?(h=As(n,h),r.tag=1,r=km(null,r,n,h,c)):(r.tag=0,r=ch(null,r,n,h,c));else{if(n!=null){var g=n.$$typeof;if(g===D){r.tag=11,r=Sm(null,r,n,h,c);break e}else if(g===k){r.tag=14,r=Am(null,r,n,h,c);break e}}throw r=le(n)||n,Error(i(306,r,""))}}return r;case 0:return ch(n,r,r.type,r.pendingProps,c);case 1:return h=r.type,g=As(h,r.pendingProps),km(n,r,h,g,c);case 3:e:{if(ae(r,r.stateNode.containerInfo),n===null)throw Error(i(387));h=r.pendingProps;var y=r.memoizedState;g=y.element,ju(n,r),wa(r,h,null,c);var A=r.memoizedState;if(h=A.cache,jn(r,mt,h),h!==y.cache&&Ou(r,[mt],c,!0),va(),h=A.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:A.cache},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){r=Om(n,r,h,c);break e}else if(h!==g){g=wi(Error(i(424)),r),fa(g),r=Om(n,r,h,c);break e}else{switch(n=r.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Je=xi(n.firstChild),Ot=r,Pe=!0,Ln=null,Ai=!0,c=xg(r,null,h,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(gs(),h===g){r=hn(n,r,c);break e}Mt(n,r,h,c)}r=r.child}return r;case 26:return pl(n,r),n===null?(c=Gy(r.type,null,r.pendingProps,null))?r.memoizedState=c:Pe||(c=r.type,n=r.pendingProps,h=Dl(I.current).createElement(c),h[kt]=r,h[Yt]=n,Nt(h,c,n),xt(h),r.stateNode=h):r.memoizedState=Gy(r.type,n.memoizedProps,r.pendingProps,n.memoizedState),null;case 27:return de(r),n===null&&Pe&&(h=r.stateNode=Hy(r.type,r.pendingProps,I.current),Ot=r,Ai=!0,g=Je,Xn(r.type)?(Xh=g,Je=xi(h.firstChild)):Je=g),Mt(n,r,r.pendingProps.children,c),pl(n,r),n===null&&(r.flags|=4194304),r.child;case 5:return n===null&&Pe&&((g=h=Je)&&(h=n1(h,r.type,r.pendingProps,Ai),h!==null?(r.stateNode=h,Ot=r,Je=xi(h.firstChild),Ai=!1,g=!0):g=!1),g||Pn(r)),de(r),g=r.type,y=r.pendingProps,A=n!==null?n.memoizedProps:null,h=y.children,$h(g,y)?h=null:A!==null&&$h(g,A)&&(r.flags|=32),r.memoizedState!==null&&(g=qu(n,r,bS,null,null,c),Fa._currentValue=g),pl(n,r),Mt(n,r,h,c),r.child;case 6:return n===null&&Pe&&((n=c=Je)&&(c=s1(c,r.pendingProps,Ai),c!==null?(r.stateNode=c,Ot=r,Je=null,n=!0):n=!1),n||Pn(r)),null;case 13:return Dm(n,r,c);case 4:return ae(r,r.stateNode.containerInfo),h=r.pendingProps,n===null?r.child=_s(r,null,h,c):Mt(n,r,h,c),r.child;case 11:return Sm(n,r,r.type,r.pendingProps,c);case 7:return Mt(n,r,r.pendingProps,c),r.child;case 8:return Mt(n,r,r.pendingProps.children,c),r.child;case 12:return Mt(n,r,r.pendingProps.children,c),r.child;case 10:return h=r.pendingProps,jn(r,r.type,h.value),Mt(n,r,h.children,c),r.child;case 9:return g=r.type._context,h=r.pendingProps.children,ys(r),g=Dt(g),h=h(g),r.flags|=1,Mt(n,r,h,c),r.child;case 14:return Am(n,r,r.type,r.pendingProps,c);case 15:return Em(n,r,r.type,r.pendingProps,c);case 19:return Nm(n,r,c);case 31:return TS(n,r,c);case 22:return xm(n,r,c,r.pendingProps);case 24:return ys(r),h=Dt(mt),n===null?(g=Nu(),g===null&&(g=Xe,y=Du(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=c),g=y),r.memoizedState={parent:h,cache:g},Pu(r),jn(r,mt,g)):((n.lanes&c)!==0&&(ju(n,r),wa(r,null,null,c),va()),g=n.memoizedState,y=r.memoizedState,g.parent!==h?(g={parent:h,cache:h},r.memoizedState=g,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=g),jn(r,mt,h)):(h=y.cache,jn(r,mt,h),h!==g.cache&&Ou(r,[mt],c,!0))),Mt(n,r,r.pendingProps.children,c),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function dn(n){n.flags|=4}function yh(n,r,c,h,g){if((r=(n.mode&32)!==0)&&(r=!1),r){if(n.flags|=16777216,(g&335544128)===g)if(n.stateNode.complete)n.flags|=8192;else if(oy())n.flags|=8192;else throw ws=Zo,Lu}else n.flags&=-16777217}function Pm(n,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Ky(r))if(oy())n.flags|=8192;else throw ws=Zo,Lu}function ml(n,r){r!==null&&(n.flags|=4),n.flags&16384&&(r=n.tag!==22?pp():536870912,n.lanes|=r,mr|=r)}function Ta(n,r){if(!Pe)switch(n.tailMode){case"hidden":r=n.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:h.sibling=null}}function Ze(n){var r=n.alternate!==null&&n.alternate.child===n.child,c=0,h=0;if(r)for(var g=n.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=n,g=g.sibling;else for(g=n.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=n,g=g.sibling;return n.subtreeFlags|=h,n.childLanes=c,r}function RS(n,r,c){var h=r.pendingProps;switch(xu(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ze(r),null;case 1:return Ze(r),null;case 3:return c=r.stateNode,h=null,n!==null&&(h=n.memoizedState.cache),r.memoizedState.cache!==h&&(r.flags|=2048),ln(mt),re(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(n===null||n.child===null)&&(nr(r)?dn(r):n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Cu())),Ze(r),null;case 26:var g=r.type,y=r.memoizedState;return n===null?(dn(r),y!==null?(Ze(r),Pm(r,y)):(Ze(r),yh(r,g,null,h,c))):y?y!==n.memoizedState?(dn(r),Ze(r),Pm(r,y)):(Ze(r),r.flags&=-16777217):(n=n.memoizedProps,n!==h&&dn(r),Ze(r),yh(r,g,n,h,c)),null;case 27:if(Se(r),c=I.current,g=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==h&&dn(r);else{if(!h){if(r.stateNode===null)throw Error(i(166));return Ze(r),null}n=se.current,nr(r)?pg(r):(n=Hy(g,h,c),r.stateNode=n,dn(r))}return Ze(r),null;case 5:if(Se(r),g=r.type,n!==null&&r.stateNode!=null)n.memoizedProps!==h&&dn(r);else{if(!h){if(r.stateNode===null)throw Error(i(166));return Ze(r),null}if(y=se.current,nr(r))pg(r);else{var A=Dl(I.current);switch(y){case 1:y=A.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:y=A.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":y=A.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":y=A.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":y=A.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof h.is=="string"?A.createElement("select",{is:h.is}):A.createElement("select"),h.multiple?y.multiple=!0:h.size&&(y.size=h.size);break;default:y=typeof h.is=="string"?A.createElement(g,{is:h.is}):A.createElement(g)}}y[kt]=r,y[Yt]=h;e:for(A=r.child;A!==null;){if(A.tag===5||A.tag===6)y.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===r)break e;for(;A.sibling===null;){if(A.return===null||A.return===r)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}r.stateNode=y;e:switch(Nt(y,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&dn(r)}}return Ze(r),yh(r,r.type,n===null?null:n.memoizedProps,r.pendingProps,c),null;case 6:if(n&&r.stateNode!=null)n.memoizedProps!==h&&dn(r);else{if(typeof h!="string"&&r.stateNode===null)throw Error(i(166));if(n=I.current,nr(r)){if(n=r.stateNode,c=r.memoizedProps,h=null,g=Ot,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}n[kt]=r,n=!!(n.nodeValue===c||h!==null&&h.suppressHydrationWarning===!0||Dy(n.nodeValue,c)),n||Pn(r,!0)}else n=Dl(n).createTextNode(h),n[kt]=r,r.stateNode=n}return Ze(r),null;case 31:if(c=r.memoizedState,n===null||n.memoizedState!==null){if(h=nr(r),c!==null){if(n===null){if(!h)throw Error(i(318));if(n=r.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(557));n[kt]=r}else gs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Ze(r),n=!1}else c=Cu(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=c),n=!0;if(!n)return r.flags&256?(ci(r),r):(ci(r),null);if((r.flags&128)!==0)throw Error(i(558))}return Ze(r),null;case 13:if(h=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(g=nr(r),h!==null&&h.dehydrated!==null){if(n===null){if(!g)throw Error(i(318));if(g=r.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[kt]=r}else gs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Ze(r),g=!1}else g=Cu(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=g),g=!0;if(!g)return r.flags&256?(ci(r),r):(ci(r),null)}return ci(r),(r.flags&128)!==0?(r.lanes=c,r):(c=h!==null,n=n!==null&&n.memoizedState!==null,c&&(h=r.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),y=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(y=h.memoizedState.cachePool.pool),y!==g&&(h.flags|=2048)),c!==n&&c&&(r.child.flags|=8192),ml(r,r.updateQueue),Ze(r),null);case 4:return re(),n===null&&Uh(r.stateNode.containerInfo),Ze(r),null;case 10:return ln(r.type),Ze(r),null;case 19:if(U(ft),h=r.memoizedState,h===null)return Ze(r),null;if(g=(r.flags&128)!==0,y=h.rendering,y===null)if(g)Ta(h,!1);else{if(ct!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(y=nl(n),y!==null){for(r.flags|=128,Ta(h,!1),n=y.updateQueue,r.updateQueue=n,ml(r,n),r.subtreeFlags=0,n=c,c=r.child;c!==null;)cg(c,n),c=c.sibling;return q(ft,ft.current&1|2),Pe&&an(r,h.treeForkCount),r.child}n=n.sibling}h.tail!==null&&ni()>_l&&(r.flags|=128,g=!0,Ta(h,!1),r.lanes=4194304)}else{if(!g)if(n=nl(y),n!==null){if(r.flags|=128,g=!0,n=n.updateQueue,r.updateQueue=n,ml(r,n),Ta(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!Pe)return Ze(r),null}else 2*ni()-h.renderingStartTime>_l&&c!==536870912&&(r.flags|=128,g=!0,Ta(h,!1),r.lanes=4194304);h.isBackwards?(y.sibling=r.child,r.child=y):(n=h.last,n!==null?n.sibling=y:r.child=y,h.last=y)}return h.tail!==null?(n=h.tail,h.rendering=n,h.tail=n.sibling,h.renderingStartTime=ni(),n.sibling=null,c=ft.current,q(ft,g?c&1|2:c&1),Pe&&an(r,h.treeForkCount),n):(Ze(r),null);case 22:case 23:return ci(r),Fu(),h=r.memoizedState!==null,n!==null?n.memoizedState!==null!==h&&(r.flags|=8192):h&&(r.flags|=8192),h?(c&536870912)!==0&&(r.flags&128)===0&&(Ze(r),r.subtreeFlags&6&&(r.flags|=8192)):Ze(r),c=r.updateQueue,c!==null&&ml(r,c.retryQueue),c=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),h=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(h=r.memoizedState.cachePool.pool),h!==c&&(r.flags|=2048),n!==null&&U(bs),null;case 24:return c=null,n!==null&&(c=n.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),ln(mt),Ze(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function kS(n,r){switch(xu(r),r.tag){case 1:return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return ln(mt),re(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 26:case 27:case 5:return Se(r),null;case 31:if(r.memoizedState!==null){if(ci(r),r.alternate===null)throw Error(i(340));gs()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 13:if(ci(r),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));gs()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return U(ft),null;case 4:return re(),null;case 10:return ln(r.type),null;case 22:case 23:return ci(r),Fu(),n!==null&&U(bs),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 24:return ln(mt),null;case 25:return null;default:return null}}function jm(n,r){switch(xu(r),r.tag){case 3:ln(mt),re();break;case 26:case 27:case 5:Se(r);break;case 4:re();break;case 31:r.memoizedState!==null&&ci(r);break;case 13:ci(r);break;case 19:U(ft);break;case 10:ln(r.type);break;case 22:case 23:ci(r),Fu(),n!==null&&U(bs);break;case 24:ln(mt)}}function Ca(n,r){try{var c=r.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var g=h.next;c=g;do{if((c.tag&n)===n){h=void 0;var y=c.create,A=c.inst;h=y(),A.destroy=h}c=c.next}while(c!==g)}}catch(R){$e(r,r.return,R)}}function Hn(n,r,c){try{var h=r.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var y=g.next;h=y;do{if((h.tag&n)===n){var A=h.inst,R=A.destroy;if(R!==void 0){A.destroy=void 0,g=r;var L=c,G=R;try{G()}catch(Z){$e(g,L,Z)}}}h=h.next}while(h!==y)}}catch(Z){$e(r,r.return,Z)}}function Im(n){var r=n.updateQueue;if(r!==null){var c=n.stateNode;try{Cg(r,c)}catch(h){$e(n,n.return,h)}}}function Bm(n,r,c){c.props=As(n.type,n.memoizedProps),c.state=n.memoizedState;try{c.componentWillUnmount()}catch(h){$e(n,r,h)}}function Ra(n,r){try{var c=n.ref;if(c!==null){switch(n.tag){case 26:case 27:case 5:var h=n.stateNode;break;case 30:h=n.stateNode;break;default:h=n.stateNode}typeof c=="function"?n.refCleanup=c(h):c.current=h}}catch(g){$e(n,r,g)}}function Hi(n,r){var c=n.ref,h=n.refCleanup;if(c!==null)if(typeof h=="function")try{h()}catch(g){$e(n,r,g)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){$e(n,r,g)}else c.current=null}function Um(n){var r=n.type,c=n.memoizedProps,h=n.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":c.autoFocus&&h.focus();break e;case"img":c.src?h.src=c.src:c.srcSet&&(h.srcset=c.srcSet)}}catch(g){$e(n,n.return,g)}}function bh(n,r,c){try{var h=n.stateNode;QS(h,n.type,c,r),h[Yt]=r}catch(g){$e(n,n.return,g)}}function Fm(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&Xn(n.type)||n.tag===4}function vh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Fm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&Xn(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function wh(n,r,c){var h=n.tag;if(h===5||h===6)n=n.stateNode,r?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(n,r):(r=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,r.appendChild(n),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=nn));else if(h!==4&&(h===27&&Xn(n.type)&&(c=n.stateNode,r=null),n=n.child,n!==null))for(wh(n,r,c),n=n.sibling;n!==null;)wh(n,r,c),n=n.sibling}function yl(n,r,c){var h=n.tag;if(h===5||h===6)n=n.stateNode,r?c.insertBefore(n,r):c.appendChild(n);else if(h!==4&&(h===27&&Xn(n.type)&&(c=n.stateNode),n=n.child,n!==null))for(yl(n,r,c),n=n.sibling;n!==null;)yl(n,r,c),n=n.sibling}function zm(n){var r=n.stateNode,c=n.memoizedProps;try{for(var h=n.type,g=r.attributes;g.length;)r.removeAttributeNode(g[0]);Nt(r,h,c),r[kt]=n,r[Yt]=c}catch(y){$e(n,n.return,y)}}var fn=!1,vt=!1,_h=!1,Hm=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function OS(n,r){if(n=n.containerInfo,Hh=Bl,n=eg(n),pu(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else e:{c=(c=n.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var A=0,R=-1,L=-1,G=0,Z=0,te=n,Y=null;t:for(;;){for(var Q;te!==c||g!==0&&te.nodeType!==3||(R=A+g),te!==y||h!==0&&te.nodeType!==3||(L=A+h),te.nodeType===3&&(A+=te.nodeValue.length),(Q=te.firstChild)!==null;)Y=te,te=Q;for(;;){if(te===n)break t;if(Y===c&&++G===g&&(R=A),Y===y&&++Z===h&&(L=A),(Q=te.nextSibling)!==null)break;te=Y,Y=te.parentNode}te=Q}c=R===-1||L===-1?null:{start:R,end:L}}else c=null}c=c||{start:0,end:0}}else c=null;for(qh={focusedElem:n,selectionRange:c},Bl=!1,Tt=r;Tt!==null;)if(r=Tt,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,Tt=n;else for(;Tt!==null;){switch(r=Tt,y=r.alternate,n=r.flags,r.tag){case 0:if((n&4)!==0&&(n=r.updateQueue,n=n!==null?n.events:null,n!==null))for(c=0;c<n.length;c++)g=n[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&y!==null){n=void 0,c=r,g=y.memoizedProps,y=y.memoizedState,h=c.stateNode;try{var fe=As(c.type,g);n=h.getSnapshotBeforeUpdate(fe,y),h.__reactInternalSnapshotBeforeUpdate=n}catch(_e){$e(c,c.return,_e)}}break;case 3:if((n&1024)!==0){if(n=r.stateNode.containerInfo,c=n.nodeType,c===9)Vh(n);else if(c===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Vh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(i(163))}if(n=r.sibling,n!==null){n.return=r.return,Tt=n;break}Tt=r.return}}function qm(n,r,c){var h=c.flags;switch(c.tag){case 0:case 11:case 15:gn(n,c),h&4&&Ca(5,c);break;case 1:if(gn(n,c),h&4)if(n=c.stateNode,r===null)try{n.componentDidMount()}catch(A){$e(c,c.return,A)}else{var g=As(c.type,r.memoizedProps);r=r.memoizedState;try{n.componentDidUpdate(g,r,n.__reactInternalSnapshotBeforeUpdate)}catch(A){$e(c,c.return,A)}}h&64&&Im(c),h&512&&Ra(c,c.return);break;case 3:if(gn(n,c),h&64&&(n=c.updateQueue,n!==null)){if(r=null,c.child!==null)switch(c.child.tag){case 27:case 5:r=c.child.stateNode;break;case 1:r=c.child.stateNode}try{Cg(n,r)}catch(A){$e(c,c.return,A)}}break;case 27:r===null&&h&4&&zm(c);case 26:case 5:gn(n,c),r===null&&h&4&&Um(c),h&512&&Ra(c,c.return);break;case 12:gn(n,c);break;case 31:gn(n,c),h&4&&Vm(n,c);break;case 13:gn(n,c),h&4&&Ym(n,c),h&64&&(n=c.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(c=US.bind(null,c),r1(n,c))));break;case 22:if(h=c.memoizedState!==null||fn,!h){r=r!==null&&r.memoizedState!==null||vt,g=fn;var y=vt;fn=h,(vt=r)&&!y?mn(n,c,(c.subtreeFlags&8772)!==0):gn(n,c),fn=g,vt=y}break;case 30:break;default:gn(n,c)}}function $m(n){var r=n.alternate;r!==null&&(n.alternate=null,$m(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&Qc(r)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var et=null,Xt=!1;function pn(n,r,c){for(c=c.child;c!==null;)Gm(n,r,c),c=c.sibling}function Gm(n,r,c){if(si&&typeof si.onCommitFiberUnmount=="function")try{si.onCommitFiberUnmount(Jr,c)}catch{}switch(c.tag){case 26:vt||Hi(c,r),pn(n,r,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:vt||Hi(c,r);var h=et,g=Xt;Xn(c.type)&&(et=c.stateNode,Xt=!1),pn(n,r,c),Ia(c.stateNode),et=h,Xt=g;break;case 5:vt||Hi(c,r);case 6:if(h=et,g=Xt,et=null,pn(n,r,c),et=h,Xt=g,et!==null)if(Xt)try{(et.nodeType===9?et.body:et.nodeName==="HTML"?et.ownerDocument.body:et).removeChild(c.stateNode)}catch(y){$e(c,r,y)}else try{et.removeChild(c.stateNode)}catch(y){$e(c,r,y)}break;case 18:et!==null&&(Xt?(n=et,Iy(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,c.stateNode),Er(n)):Iy(et,c.stateNode));break;case 4:h=et,g=Xt,et=c.stateNode.containerInfo,Xt=!0,pn(n,r,c),et=h,Xt=g;break;case 0:case 11:case 14:case 15:Hn(2,c,r),vt||Hn(4,c,r),pn(n,r,c);break;case 1:vt||(Hi(c,r),h=c.stateNode,typeof h.componentWillUnmount=="function"&&Bm(c,r,h)),pn(n,r,c);break;case 21:pn(n,r,c);break;case 22:vt=(h=vt)||c.memoizedState!==null,pn(n,r,c),vt=h;break;default:pn(n,r,c)}}function Vm(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{Er(n)}catch(c){$e(r,r.return,c)}}}function Ym(n,r){if(r.memoizedState===null&&(n=r.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{Er(n)}catch(c){$e(r,r.return,c)}}function DS(n){switch(n.tag){case 31:case 13:case 19:var r=n.stateNode;return r===null&&(r=n.stateNode=new Hm),r;case 22:return n=n.stateNode,r=n._retryCache,r===null&&(r=n._retryCache=new Hm),r;default:throw Error(i(435,n.tag))}}function bl(n,r){var c=DS(n);r.forEach(function(h){if(!c.has(h)){c.add(h);var g=FS.bind(null,n,h);h.then(g,g)}})}function Kt(n,r){var c=r.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h],y=n,A=r,R=A;e:for(;R!==null;){switch(R.tag){case 27:if(Xn(R.type)){et=R.stateNode,Xt=!1;break e}break;case 5:et=R.stateNode,Xt=!1;break e;case 3:case 4:et=R.stateNode.containerInfo,Xt=!0;break e}R=R.return}if(et===null)throw Error(i(160));Gm(y,A,g),et=null,Xt=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Wm(r,n),r=r.sibling}var Li=null;function Wm(n,r){var c=n.alternate,h=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Kt(r,n),Qt(n),h&4&&(Hn(3,n,n.return),Ca(3,n),Hn(5,n,n.return));break;case 1:Kt(r,n),Qt(n),h&512&&(vt||c===null||Hi(c,c.return)),h&64&&fn&&(n=n.updateQueue,n!==null&&(h=n.callbacks,h!==null&&(c=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=c===null?h:c.concat(h))));break;case 26:var g=Li;if(Kt(r,n),Qt(n),h&512&&(vt||c===null||Hi(c,c.return)),h&4){var y=c!==null?c.memoizedState:null;if(h=n.memoizedState,c===null)if(h===null)if(n.stateNode===null){e:{h=n.type,c=n.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":y=g.getElementsByTagName("title")[0],(!y||y[ta]||y[kt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(h),g.head.insertBefore(y,g.querySelector("head > title"))),Nt(y,h,c),y[kt]=n,xt(y),h=y;break e;case"link":var A=Wy("link","href",g).get(h+(c.href||""));if(A){for(var R=0;R<A.length;R++)if(y=A[R],y.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&y.getAttribute("rel")===(c.rel==null?null:c.rel)&&y.getAttribute("title")===(c.title==null?null:c.title)&&y.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){A.splice(R,1);break t}}y=g.createElement(h),Nt(y,h,c),g.head.appendChild(y);break;case"meta":if(A=Wy("meta","content",g).get(h+(c.content||""))){for(R=0;R<A.length;R++)if(y=A[R],y.getAttribute("content")===(c.content==null?null:""+c.content)&&y.getAttribute("name")===(c.name==null?null:c.name)&&y.getAttribute("property")===(c.property==null?null:c.property)&&y.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&y.getAttribute("charset")===(c.charSet==null?null:c.charSet)){A.splice(R,1);break t}}y=g.createElement(h),Nt(y,h,c),g.head.appendChild(y);break;default:throw Error(i(468,h))}y[kt]=n,xt(y),h=y}n.stateNode=h}else Xy(g,n.type,n.stateNode);else n.stateNode=Yy(g,h,n.memoizedProps);else y!==h?(y===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):y.count--,h===null?Xy(g,n.type,n.stateNode):Yy(g,h,n.memoizedProps)):h===null&&n.stateNode!==null&&bh(n,n.memoizedProps,c.memoizedProps)}break;case 27:Kt(r,n),Qt(n),h&512&&(vt||c===null||Hi(c,c.return)),c!==null&&h&4&&bh(n,n.memoizedProps,c.memoizedProps);break;case 5:if(Kt(r,n),Qt(n),h&512&&(vt||c===null||Hi(c,c.return)),n.flags&32){g=n.stateNode;try{Ys(g,"")}catch(fe){$e(n,n.return,fe)}}h&4&&n.stateNode!=null&&(g=n.memoizedProps,bh(n,g,c!==null?c.memoizedProps:g)),h&1024&&(_h=!0);break;case 6:if(Kt(r,n),Qt(n),h&4){if(n.stateNode===null)throw Error(i(162));h=n.memoizedProps,c=n.stateNode;try{c.nodeValue=h}catch(fe){$e(n,n.return,fe)}}break;case 3:if(Ll=null,g=Li,Li=Ml(r.containerInfo),Kt(r,n),Li=g,Qt(n),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Er(r.containerInfo)}catch(fe){$e(n,n.return,fe)}_h&&(_h=!1,Xm(n));break;case 4:h=Li,Li=Ml(n.stateNode.containerInfo),Kt(r,n),Qt(n),Li=h;break;case 12:Kt(r,n),Qt(n);break;case 31:Kt(r,n),Qt(n),h&4&&(h=n.updateQueue,h!==null&&(n.updateQueue=null,bl(n,h)));break;case 13:Kt(r,n),Qt(n),n.child.flags&8192&&n.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(wl=ni()),h&4&&(h=n.updateQueue,h!==null&&(n.updateQueue=null,bl(n,h)));break;case 22:g=n.memoizedState!==null;var L=c!==null&&c.memoizedState!==null,G=fn,Z=vt;if(fn=G||g,vt=Z||L,Kt(r,n),vt=Z,fn=G,Qt(n),h&8192)e:for(r=n.stateNode,r._visibility=g?r._visibility&-2:r._visibility|1,g&&(c===null||L||fn||vt||Es(n)),c=null,r=n;;){if(r.tag===5||r.tag===26){if(c===null){L=c=r;try{if(y=L.stateNode,g)A=y.style,typeof A.setProperty=="function"?A.setProperty("display","none","important"):A.display="none";else{R=L.stateNode;var te=L.memoizedProps.style,Y=te!=null&&te.hasOwnProperty("display")?te.display:null;R.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(fe){$e(L,L.return,fe)}}}else if(r.tag===6){if(c===null){L=r;try{L.stateNode.nodeValue=g?"":L.memoizedProps}catch(fe){$e(L,L.return,fe)}}}else if(r.tag===18){if(c===null){L=r;try{var Q=L.stateNode;g?By(Q,!0):By(L.stateNode,!1)}catch(fe){$e(L,L.return,fe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===n)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;c===r&&(c=null),r=r.return}c===r&&(c=null),r.sibling.return=r.return,r=r.sibling}h&4&&(h=n.updateQueue,h!==null&&(c=h.retryQueue,c!==null&&(h.retryQueue=null,bl(n,c))));break;case 19:Kt(r,n),Qt(n),h&4&&(h=n.updateQueue,h!==null&&(n.updateQueue=null,bl(n,h)));break;case 30:break;case 21:break;default:Kt(r,n),Qt(n)}}function Qt(n){var r=n.flags;if(r&2){try{for(var c,h=n.return;h!==null;){if(Fm(h)){c=h;break}h=h.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,y=vh(n);yl(n,y,g);break;case 5:var A=c.stateNode;c.flags&32&&(Ys(A,""),c.flags&=-33);var R=vh(n);yl(n,R,A);break;case 3:case 4:var L=c.stateNode.containerInfo,G=vh(n);wh(n,G,L);break;default:throw Error(i(161))}}catch(Z){$e(n,n.return,Z)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function Xm(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var r=n;Xm(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),n=n.sibling}}function gn(n,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)qm(n,r.alternate,r),r=r.sibling}function Es(n){for(n=n.child;n!==null;){var r=n;switch(r.tag){case 0:case 11:case 14:case 15:Hn(4,r,r.return),Es(r);break;case 1:Hi(r,r.return);var c=r.stateNode;typeof c.componentWillUnmount=="function"&&Bm(r,r.return,c),Es(r);break;case 27:Ia(r.stateNode);case 26:case 5:Hi(r,r.return),Es(r);break;case 22:r.memoizedState===null&&Es(r);break;case 30:Es(r);break;default:Es(r)}n=n.sibling}}function mn(n,r,c){for(c=c&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var h=r.alternate,g=n,y=r,A=y.flags;switch(y.tag){case 0:case 11:case 15:mn(g,y,c),Ca(4,y);break;case 1:if(mn(g,y,c),h=y,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(G){$e(h,h.return,G)}if(h=y,g=h.updateQueue,g!==null){var R=h.stateNode;try{var L=g.shared.hiddenCallbacks;if(L!==null)for(g.shared.hiddenCallbacks=null,g=0;g<L.length;g++)Tg(L[g],R)}catch(G){$e(h,h.return,G)}}c&&A&64&&Im(y),Ra(y,y.return);break;case 27:zm(y);case 26:case 5:mn(g,y,c),c&&h===null&&A&4&&Um(y),Ra(y,y.return);break;case 12:mn(g,y,c);break;case 31:mn(g,y,c),c&&A&4&&Vm(g,y);break;case 13:mn(g,y,c),c&&A&4&&Ym(g,y);break;case 22:y.memoizedState===null&&mn(g,y,c),Ra(y,y.return);break;case 30:break;default:mn(g,y,c)}r=r.sibling}}function Sh(n,r){var c=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),n=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(n=r.memoizedState.cachePool.pool),n!==c&&(n!=null&&n.refCount++,c!=null&&pa(c))}function Ah(n,r){n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&pa(n))}function Pi(n,r,c,h){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Km(n,r,c,h),r=r.sibling}function Km(n,r,c,h){var g=r.flags;switch(r.tag){case 0:case 11:case 15:Pi(n,r,c,h),g&2048&&Ca(9,r);break;case 1:Pi(n,r,c,h);break;case 3:Pi(n,r,c,h),g&2048&&(n=null,r.alternate!==null&&(n=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==n&&(r.refCount++,n!=null&&pa(n)));break;case 12:if(g&2048){Pi(n,r,c,h),n=r.stateNode;try{var y=r.memoizedProps,A=y.id,R=y.onPostCommit;typeof R=="function"&&R(A,r.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(L){$e(r,r.return,L)}}else Pi(n,r,c,h);break;case 31:Pi(n,r,c,h);break;case 13:Pi(n,r,c,h);break;case 23:break;case 22:y=r.stateNode,A=r.alternate,r.memoizedState!==null?y._visibility&2?Pi(n,r,c,h):ka(n,r):y._visibility&2?Pi(n,r,c,h):(y._visibility|=2,fr(n,r,c,h,(r.subtreeFlags&10256)!==0||!1)),g&2048&&Sh(A,r);break;case 24:Pi(n,r,c,h),g&2048&&Ah(r.alternate,r);break;default:Pi(n,r,c,h)}}function fr(n,r,c,h,g){for(g=g&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var y=n,A=r,R=c,L=h,G=A.flags;switch(A.tag){case 0:case 11:case 15:fr(y,A,R,L,g),Ca(8,A);break;case 23:break;case 22:var Z=A.stateNode;A.memoizedState!==null?Z._visibility&2?fr(y,A,R,L,g):ka(y,A):(Z._visibility|=2,fr(y,A,R,L,g)),g&&G&2048&&Sh(A.alternate,A);break;case 24:fr(y,A,R,L,g),g&&G&2048&&Ah(A.alternate,A);break;default:fr(y,A,R,L,g)}r=r.sibling}}function ka(n,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var c=n,h=r,g=h.flags;switch(h.tag){case 22:ka(c,h),g&2048&&Sh(h.alternate,h);break;case 24:ka(c,h),g&2048&&Ah(h.alternate,h);break;default:ka(c,h)}r=r.sibling}}var Oa=8192;function pr(n,r,c){if(n.subtreeFlags&Oa)for(n=n.child;n!==null;)Qm(n,r,c),n=n.sibling}function Qm(n,r,c){switch(n.tag){case 26:pr(n,r,c),n.flags&Oa&&n.memoizedState!==null&&y1(c,Li,n.memoizedState,n.memoizedProps);break;case 5:pr(n,r,c);break;case 3:case 4:var h=Li;Li=Ml(n.stateNode.containerInfo),pr(n,r,c),Li=h;break;case 22:n.memoizedState===null&&(h=n.alternate,h!==null&&h.memoizedState!==null?(h=Oa,Oa=16777216,pr(n,r,c),Oa=h):pr(n,r,c));break;default:pr(n,r,c)}}function Jm(n){var r=n.alternate;if(r!==null&&(n=r.child,n!==null)){r.child=null;do r=n.sibling,n.sibling=null,n=r;while(n!==null)}}function Da(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var h=r[c];Tt=h,ey(h,n)}Jm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Zm(n),n=n.sibling}function Zm(n){switch(n.tag){case 0:case 11:case 15:Da(n),n.flags&2048&&Hn(9,n,n.return);break;case 3:Da(n);break;case 12:Da(n);break;case 22:var r=n.stateNode;n.memoizedState!==null&&r._visibility&2&&(n.return===null||n.return.tag!==13)?(r._visibility&=-3,vl(n)):Da(n);break;default:Da(n)}}function vl(n){var r=n.deletions;if((n.flags&16)!==0){if(r!==null)for(var c=0;c<r.length;c++){var h=r[c];Tt=h,ey(h,n)}Jm(n)}for(n=n.child;n!==null;){switch(r=n,r.tag){case 0:case 11:case 15:Hn(8,r,r.return),vl(r);break;case 22:c=r.stateNode,c._visibility&2&&(c._visibility&=-3,vl(r));break;default:vl(r)}n=n.sibling}}function ey(n,r){for(;Tt!==null;){var c=Tt;switch(c.tag){case 0:case 11:case 15:Hn(8,c,r);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var h=c.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:pa(c.memoizedState.cache)}if(h=c.child,h!==null)h.return=c,Tt=h;else e:for(c=n;Tt!==null;){h=Tt;var g=h.sibling,y=h.return;if($m(h),h===c){Tt=null;break e}if(g!==null){g.return=y,Tt=g;break e}Tt=y}}}var MS={getCacheForType:function(n){var r=Dt(mt),c=r.data.get(n);return c===void 0&&(c=n(),r.data.set(n,c)),c},cacheSignal:function(){return Dt(mt).controller.signal}},NS=typeof WeakMap=="function"?WeakMap:Map,Fe=0,Xe=null,De=null,Ne=0,qe=0,ui=null,qn=!1,gr=!1,Eh=!1,yn=0,ct=0,$n=0,xs=0,xh=0,hi=0,mr=0,Ma=null,Jt=null,Th=!1,wl=0,ty=0,_l=1/0,Sl=null,Gn=null,At=0,Vn=null,yr=null,bn=0,Ch=0,Rh=null,iy=null,Na=0,kh=null;function di(){return(Fe&2)!==0&&Ne!==0?Ne&-Ne:j.T!==null?Ph():bp()}function ny(){if(hi===0)if((Ne&536870912)===0||Pe){var n=Oo;Oo<<=1,(Oo&3932160)===0&&(Oo=262144),hi=n}else hi=536870912;return n=li.current,n!==null&&(n.flags|=32),hi}function Zt(n,r,c){(n===Xe&&(qe===2||qe===9)||n.cancelPendingCommit!==null)&&(br(n,0),Yn(n,Ne,hi,!1)),ea(n,c),((Fe&2)===0||n!==Xe)&&(n===Xe&&((Fe&2)===0&&(xs|=c),ct===4&&Yn(n,Ne,hi,!1)),qi(n))}function sy(n,r,c){if((Fe&6)!==0)throw Error(i(327));var h=!c&&(r&127)===0&&(r&n.expiredLanes)===0||Zr(n,r),g=h?jS(n,r):Dh(n,r,!0),y=h;do{if(g===0){gr&&!h&&Yn(n,r,0,!1);break}else{if(c=n.current.alternate,y&&!LS(c)){g=Dh(n,r,!1),y=!1;continue}if(g===2){if(y=r,n.errorRecoveryDisabledLanes&y)var A=0;else A=n.pendingLanes&-536870913,A=A!==0?A:A&536870912?536870912:0;if(A!==0){r=A;e:{var R=n;g=Ma;var L=R.current.memoizedState.isDehydrated;if(L&&(br(R,A).flags|=256),A=Dh(R,A,!1),A!==2){if(Eh&&!L){R.errorRecoveryDisabledLanes|=y,xs|=y,g=4;break e}y=Jt,Jt=g,y!==null&&(Jt===null?Jt=y:Jt.push.apply(Jt,y))}g=A}if(y=!1,g!==2)continue}}if(g===1){br(n,0),Yn(n,r,0,!0);break}e:{switch(h=n,y=g,y){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:Yn(h,r,hi,!qn);break e;case 2:Jt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(g=wl+300-ni(),10<g)){if(Yn(h,r,hi,!qn),Mo(h,0,!0)!==0)break e;bn=r,h.timeoutHandle=Py(ry.bind(null,h,c,Jt,Sl,Th,r,hi,xs,mr,qn,y,"Throttled",-0,0),g);break e}ry(h,c,Jt,Sl,Th,r,hi,xs,mr,qn,y,null,-0,0)}}break}while(!0);qi(n)}function ry(n,r,c,h,g,y,A,R,L,G,Z,te,Y,Q){if(n.timeoutHandle=-1,te=r.subtreeFlags,te&8192||(te&16785408)===16785408){te={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:nn},Qm(r,y,te);var fe=(y&62914560)===y?wl-ni():(y&4194048)===y?ty-ni():0;if(fe=b1(te,fe),fe!==null){bn=y,n.cancelPendingCommit=fe(fy.bind(null,n,r,y,c,h,g,A,R,L,Z,te,null,Y,Q)),Yn(n,y,A,!G);return}}fy(n,r,y,c,h,g,A,R,L)}function LS(n){for(var r=n;;){var c=r.tag;if((c===0||c===11||c===15)&&r.flags&16384&&(c=r.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var h=0;h<c.length;h++){var g=c[h],y=g.getSnapshot;g=g.value;try{if(!ai(y(),g))return!1}catch{return!1}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Yn(n,r,c,h){r&=~xh,r&=~xs,n.suspendedLanes|=r,n.pingedLanes&=~r,h&&(n.warmLanes|=r),h=n.expirationTimes;for(var g=r;0<g;){var y=31-ri(g),A=1<<y;h[y]=-1,g&=~A}c!==0&&gp(n,c,r)}function Al(){return(Fe&6)===0?(La(0),!1):!0}function Oh(){if(De!==null){if(qe===0)var n=De.return;else n=De,on=ms=null,Vu(n),lr=null,ma=0,n=De;for(;n!==null;)jm(n.alternate,n),n=n.return;De=null}}function br(n,r){var c=n.timeoutHandle;c!==-1&&(n.timeoutHandle=-1,e1(c)),c=n.cancelPendingCommit,c!==null&&(n.cancelPendingCommit=null,c()),bn=0,Oh(),Xe=n,De=c=rn(n.current,null),Ne=r,qe=0,ui=null,qn=!1,gr=Zr(n,r),Eh=!1,mr=hi=xh=xs=$n=ct=0,Jt=Ma=null,Th=!1,(r&8)!==0&&(r|=r&32);var h=n.entangledLanes;if(h!==0)for(n=n.entanglements,h&=r;0<h;){var g=31-ri(h),y=1<<g;r|=n[g],h&=~y}return yn=r,$o(),c}function ay(n,r){Ce=null,j.H=Ea,r===or||r===Jo?(r=Sg(),qe=3):r===Lu?(r=Sg(),qe=4):qe=r===lh?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,ui=r,De===null&&(ct=1,dl(n,wi(r,n.current)))}function oy(){var n=li.current;return n===null?!0:(Ne&4194048)===Ne?Ei===null:(Ne&62914560)===Ne||(Ne&536870912)!==0?n===Ei:!1}function ly(){var n=j.H;return j.H=Ea,n===null?Ea:n}function cy(){var n=j.A;return j.A=MS,n}function El(){ct=4,qn||(Ne&4194048)!==Ne&&li.current!==null||(gr=!0),($n&134217727)===0&&(xs&134217727)===0||Xe===null||Yn(Xe,Ne,hi,!1)}function Dh(n,r,c){var h=Fe;Fe|=2;var g=ly(),y=cy();(Xe!==n||Ne!==r)&&(Sl=null,br(n,r)),r=!1;var A=ct;e:do try{if(qe!==0&&De!==null){var R=De,L=ui;switch(qe){case 8:Oh(),A=6;break e;case 3:case 2:case 9:case 6:li.current===null&&(r=!0);var G=qe;if(qe=0,ui=null,vr(n,R,L,G),c&&gr){A=0;break e}break;default:G=qe,qe=0,ui=null,vr(n,R,L,G)}}PS(),A=ct;break}catch(Z){ay(n,Z)}while(!0);return r&&n.shellSuspendCounter++,on=ms=null,Fe=h,j.H=g,j.A=y,De===null&&(Xe=null,Ne=0,$o()),A}function PS(){for(;De!==null;)uy(De)}function jS(n,r){var c=Fe;Fe|=2;var h=ly(),g=cy();Xe!==n||Ne!==r?(Sl=null,_l=ni()+500,br(n,r)):gr=Zr(n,r);e:do try{if(qe!==0&&De!==null){r=De;var y=ui;t:switch(qe){case 1:qe=0,ui=null,vr(n,r,y,1);break;case 2:case 9:if(wg(y)){qe=0,ui=null,hy(r);break}r=function(){qe!==2&&qe!==9||Xe!==n||(qe=7),qi(n)},y.then(r,r);break e;case 3:qe=7;break e;case 4:qe=5;break e;case 7:wg(y)?(qe=0,ui=null,hy(r)):(qe=0,ui=null,vr(n,r,y,7));break;case 5:var A=null;switch(De.tag){case 26:A=De.memoizedState;case 5:case 27:var R=De;if(A?Ky(A):R.stateNode.complete){qe=0,ui=null;var L=R.sibling;if(L!==null)De=L;else{var G=R.return;G!==null?(De=G,xl(G)):De=null}break t}}qe=0,ui=null,vr(n,r,y,5);break;case 6:qe=0,ui=null,vr(n,r,y,6);break;case 8:Oh(),ct=6;break e;default:throw Error(i(462))}}IS();break}catch(Z){ay(n,Z)}while(!0);return on=ms=null,j.H=h,j.A=g,Fe=c,De!==null?0:(Xe=null,Ne=0,$o(),ct)}function IS(){for(;De!==null&&!a_();)uy(De)}function uy(n){var r=Lm(n.alternate,n,yn);n.memoizedProps=n.pendingProps,r===null?xl(n):De=r}function hy(n){var r=n,c=r.alternate;switch(r.tag){case 15:case 0:r=Rm(c,r,r.pendingProps,r.type,void 0,Ne);break;case 11:r=Rm(c,r,r.pendingProps,r.type.render,r.ref,Ne);break;case 5:Vu(r);default:jm(c,r),r=De=cg(r,yn),r=Lm(c,r,yn)}n.memoizedProps=n.pendingProps,r===null?xl(n):De=r}function vr(n,r,c,h){on=ms=null,Vu(r),lr=null,ma=0;var g=r.return;try{if(xS(n,g,r,c,Ne)){ct=1,dl(n,wi(c,n.current)),De=null;return}}catch(y){if(g!==null)throw De=g,y;ct=1,dl(n,wi(c,n.current)),De=null;return}r.flags&32768?(Pe||h===1?n=!0:gr||(Ne&536870912)!==0?n=!1:(qn=n=!0,(h===2||h===9||h===3||h===6)&&(h=li.current,h!==null&&h.tag===13&&(h.flags|=16384))),dy(r,n)):xl(r)}function xl(n){var r=n;do{if((r.flags&32768)!==0){dy(r,qn);return}n=r.return;var c=RS(r.alternate,r,yn);if(c!==null){De=c;return}if(r=r.sibling,r!==null){De=r;return}De=r=n}while(r!==null);ct===0&&(ct=5)}function dy(n,r){do{var c=kS(n.alternate,n);if(c!==null){c.flags&=32767,De=c;return}if(c=n.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!r&&(n=n.sibling,n!==null)){De=n;return}De=n=c}while(n!==null);ct=6,De=null}function fy(n,r,c,h,g,y,A,R,L){n.cancelPendingCommit=null;do Tl();while(At!==0);if((Fe&6)!==0)throw Error(i(327));if(r!==null){if(r===n.current)throw Error(i(177));if(y=r.lanes|r.childLanes,y|=vu,m_(n,c,y,A,R,L),n===Xe&&(De=Xe=null,Ne=0),yr=r,Vn=n,bn=c,Ch=y,Rh=g,iy=h,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,zS(Ro,function(){return by(),null})):(n.callbackNode=null,n.callbackPriority=0),h=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||h){h=j.T,j.T=null,g=J.p,J.p=2,A=Fe,Fe|=4;try{OS(n,r,c)}finally{Fe=A,J.p=g,j.T=h}}At=1,py(),gy(),my()}}function py(){if(At===1){At=0;var n=Vn,r=yr,c=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||c){c=j.T,j.T=null;var h=J.p;J.p=2;var g=Fe;Fe|=4;try{Wm(r,n);var y=qh,A=eg(n.containerInfo),R=y.focusedElem,L=y.selectionRange;if(A!==R&&R&&R.ownerDocument&&Zp(R.ownerDocument.documentElement,R)){if(L!==null&&pu(R)){var G=L.start,Z=L.end;if(Z===void 0&&(Z=G),"selectionStart"in R)R.selectionStart=G,R.selectionEnd=Math.min(Z,R.value.length);else{var te=R.ownerDocument||document,Y=te&&te.defaultView||window;if(Y.getSelection){var Q=Y.getSelection(),fe=R.textContent.length,_e=Math.min(L.start,fe),Ye=L.end===void 0?_e:Math.min(L.end,fe);!Q.extend&&_e>Ye&&(A=Ye,Ye=_e,_e=A);var F=Jp(R,_e),P=Jp(R,Ye);if(F&&P&&(Q.rangeCount!==1||Q.anchorNode!==F.node||Q.anchorOffset!==F.offset||Q.focusNode!==P.node||Q.focusOffset!==P.offset)){var $=te.createRange();$.setStart(F.node,F.offset),Q.removeAllRanges(),_e>Ye?(Q.addRange($),Q.extend(P.node,P.offset)):($.setEnd(P.node,P.offset),Q.addRange($))}}}}for(te=[],Q=R;Q=Q.parentNode;)Q.nodeType===1&&te.push({element:Q,left:Q.scrollLeft,top:Q.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<te.length;R++){var ee=te[R];ee.element.scrollLeft=ee.left,ee.element.scrollTop=ee.top}}Bl=!!Hh,qh=Hh=null}finally{Fe=g,J.p=h,j.T=c}}n.current=r,At=2}}function gy(){if(At===2){At=0;var n=Vn,r=yr,c=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||c){c=j.T,j.T=null;var h=J.p;J.p=2;var g=Fe;Fe|=4;try{qm(n,r.alternate,r)}finally{Fe=g,J.p=h,j.T=c}}At=3}}function my(){if(At===4||At===3){At=0,o_();var n=Vn,r=yr,c=bn,h=iy;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?At=5:(At=0,yr=Vn=null,yy(n,n.pendingLanes));var g=n.pendingLanes;if(g===0&&(Gn=null),Xc(c),r=r.stateNode,si&&typeof si.onCommitFiberRoot=="function")try{si.onCommitFiberRoot(Jr,r,void 0,(r.current.flags&128)===128)}catch{}if(h!==null){r=j.T,g=J.p,J.p=2,j.T=null;try{for(var y=n.onRecoverableError,A=0;A<h.length;A++){var R=h[A];y(R.value,{componentStack:R.stack})}}finally{j.T=r,J.p=g}}(bn&3)!==0&&Tl(),qi(n),g=n.pendingLanes,(c&261930)!==0&&(g&42)!==0?n===kh?Na++:(Na=0,kh=n):Na=0,La(0)}}function yy(n,r){(n.pooledCacheLanes&=r)===0&&(r=n.pooledCache,r!=null&&(n.pooledCache=null,pa(r)))}function Tl(){return py(),gy(),my(),by()}function by(){if(At!==5)return!1;var n=Vn,r=Ch;Ch=0;var c=Xc(bn),h=j.T,g=J.p;try{J.p=32>c?32:c,j.T=null,c=Rh,Rh=null;var y=Vn,A=bn;if(At=0,yr=Vn=null,bn=0,(Fe&6)!==0)throw Error(i(331));var R=Fe;if(Fe|=4,Zm(y.current),Km(y,y.current,A,c),Fe=R,La(0,!1),si&&typeof si.onPostCommitFiberRoot=="function")try{si.onPostCommitFiberRoot(Jr,y)}catch{}return!0}finally{J.p=g,j.T=h,yy(n,r)}}function vy(n,r,c){r=wi(c,r),r=oh(n.stateNode,r,2),n=Un(n,r,2),n!==null&&(ea(n,2),qi(n))}function $e(n,r,c){if(n.tag===3)vy(n,n,c);else for(;r!==null;){if(r.tag===3){vy(r,n,c);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Gn===null||!Gn.has(h))){n=wi(c,n),c=wm(2),h=Un(r,c,2),h!==null&&(_m(c,h,r,n),ea(h,2),qi(h));break}}r=r.return}}function Mh(n,r,c){var h=n.pingCache;if(h===null){h=n.pingCache=new NS;var g=new Set;h.set(r,g)}else g=h.get(r),g===void 0&&(g=new Set,h.set(r,g));g.has(c)||(Eh=!0,g.add(c),n=BS.bind(null,n,r,c),r.then(n,n))}function BS(n,r,c){var h=n.pingCache;h!==null&&h.delete(r),n.pingedLanes|=n.suspendedLanes&c,n.warmLanes&=~c,Xe===n&&(Ne&c)===c&&(ct===4||ct===3&&(Ne&62914560)===Ne&&300>ni()-wl?(Fe&2)===0&&br(n,0):xh|=c,mr===Ne&&(mr=0)),qi(n)}function wy(n,r){r===0&&(r=pp()),n=fs(n,r),n!==null&&(ea(n,r),qi(n))}function US(n){var r=n.memoizedState,c=0;r!==null&&(c=r.retryLane),wy(n,c)}function FS(n,r){var c=0;switch(n.tag){case 31:case 13:var h=n.stateNode,g=n.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=n.stateNode;break;case 22:h=n.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(r),wy(n,c)}function zS(n,r){return Gc(n,r)}var Cl=null,wr=null,Nh=!1,Rl=!1,Lh=!1,Wn=0;function qi(n){n!==wr&&n.next===null&&(wr===null?Cl=wr=n:wr=wr.next=n),Rl=!0,Nh||(Nh=!0,qS())}function La(n,r){if(!Lh&&Rl){Lh=!0;do for(var c=!1,h=Cl;h!==null;){if(n!==0){var g=h.pendingLanes;if(g===0)var y=0;else{var A=h.suspendedLanes,R=h.pingedLanes;y=(1<<31-ri(42|n)+1)-1,y&=g&~(A&~R),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(c=!0,Ey(h,y))}else y=Ne,y=Mo(h,h===Xe?y:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(y&3)===0||Zr(h,y)||(c=!0,Ey(h,y));h=h.next}while(c);Lh=!1}}function HS(){_y()}function _y(){Rl=Nh=!1;var n=0;Wn!==0&&ZS()&&(n=Wn);for(var r=ni(),c=null,h=Cl;h!==null;){var g=h.next,y=Sy(h,r);y===0?(h.next=null,c===null?Cl=g:c.next=g,g===null&&(wr=c)):(c=h,(n!==0||(y&3)!==0)&&(Rl=!0)),h=g}At!==0&&At!==5||La(n),Wn!==0&&(Wn=0)}function Sy(n,r){for(var c=n.suspendedLanes,h=n.pingedLanes,g=n.expirationTimes,y=n.pendingLanes&-62914561;0<y;){var A=31-ri(y),R=1<<A,L=g[A];L===-1?((R&c)===0||(R&h)!==0)&&(g[A]=g_(R,r)):L<=r&&(n.expiredLanes|=R),y&=~R}if(r=Xe,c=Ne,c=Mo(n,n===r?c:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),h=n.callbackNode,c===0||n===r&&(qe===2||qe===9)||n.cancelPendingCommit!==null)return h!==null&&h!==null&&Vc(h),n.callbackNode=null,n.callbackPriority=0;if((c&3)===0||Zr(n,c)){if(r=c&-c,r===n.callbackPriority)return r;switch(h!==null&&Vc(h),Xc(c)){case 2:case 8:c=dp;break;case 32:c=Ro;break;case 268435456:c=fp;break;default:c=Ro}return h=Ay.bind(null,n),c=Gc(c,h),n.callbackPriority=r,n.callbackNode=c,r}return h!==null&&h!==null&&Vc(h),n.callbackPriority=2,n.callbackNode=null,2}function Ay(n,r){if(At!==0&&At!==5)return n.callbackNode=null,n.callbackPriority=0,null;var c=n.callbackNode;if(Tl()&&n.callbackNode!==c)return null;var h=Ne;return h=Mo(n,n===Xe?h:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),h===0?null:(sy(n,h,r),Sy(n,ni()),n.callbackNode!=null&&n.callbackNode===c?Ay.bind(null,n):null)}function Ey(n,r){if(Tl())return null;sy(n,r,!0)}function qS(){t1(function(){(Fe&6)!==0?Gc(hp,HS):_y()})}function Ph(){if(Wn===0){var n=rr;n===0&&(n=ko,ko<<=1,(ko&261888)===0&&(ko=256)),Wn=n}return Wn}function xy(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:jo(""+n)}function Ty(n,r){var c=r.ownerDocument.createElement("input");return c.name=r.name,c.value=r.value,n.id&&c.setAttribute("form",n.id),r.parentNode.insertBefore(c,r),n=new FormData(n),c.parentNode.removeChild(c),n}function $S(n,r,c,h,g){if(r==="submit"&&c&&c.stateNode===g){var y=xy((g[Yt]||null).action),A=h.submitter;A&&(r=(r=A[Yt]||null)?xy(r.formAction):A.getAttribute("formAction"),r!==null&&(y=r,A=null));var R=new Fo("action","action",null,h,g);n.push({event:R,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Wn!==0){var L=A?Ty(g,A):new FormData(g);th(c,{pending:!0,data:L,method:g.method,action:y},null,L)}}else typeof y=="function"&&(R.preventDefault(),L=A?Ty(g,A):new FormData(g),th(c,{pending:!0,data:L,method:g.method,action:y},y,L))},currentTarget:g}]})}}for(var jh=0;jh<bu.length;jh++){var Ih=bu[jh],GS=Ih.toLowerCase(),VS=Ih[0].toUpperCase()+Ih.slice(1);Ni(GS,"on"+VS)}Ni(ng,"onAnimationEnd"),Ni(sg,"onAnimationIteration"),Ni(rg,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(lS,"onTransitionRun"),Ni(cS,"onTransitionStart"),Ni(uS,"onTransitionCancel"),Ni(ag,"onTransitionEnd"),Gs("onMouseEnter",["mouseout","mouseover"]),Gs("onMouseLeave",["mouseout","mouseover"]),Gs("onPointerEnter",["pointerout","pointerover"]),Gs("onPointerLeave",["pointerout","pointerover"]),cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),cs("onBeforeInput",["compositionend","keypress","textInput","paste"]),cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Pa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Pa));function Cy(n,r){r=(r&4)!==0;for(var c=0;c<n.length;c++){var h=n[c],g=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var A=h.length-1;0<=A;A--){var R=h[A],L=R.instance,G=R.currentTarget;if(R=R.listener,L!==y&&g.isPropagationStopped())break e;y=R,g.currentTarget=G;try{y(g)}catch(Z){qo(Z)}g.currentTarget=null,y=L}else for(A=0;A<h.length;A++){if(R=h[A],L=R.instance,G=R.currentTarget,R=R.listener,L!==y&&g.isPropagationStopped())break e;y=R,g.currentTarget=G;try{y(g)}catch(Z){qo(Z)}g.currentTarget=null,y=L}}}}function Me(n,r){var c=r[Kc];c===void 0&&(c=r[Kc]=new Set);var h=n+"__bubble";c.has(h)||(Ry(r,n,2,!1),c.add(h))}function Bh(n,r,c){var h=0;r&&(h|=4),Ry(c,n,h,r)}var kl="_reactListening"+Math.random().toString(36).slice(2);function Uh(n){if(!n[kl]){n[kl]=!0,_p.forEach(function(c){c!=="selectionchange"&&(YS.has(c)||Bh(c,!1,n),Bh(c,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[kl]||(r[kl]=!0,Bh("selectionchange",!1,r))}}function Ry(n,r,c,h){switch(n0(r)){case 2:var g=_1;break;case 8:g=S1;break;default:g=ed}c=g.bind(null,r,c,n),g=void 0,!ru||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),h?g!==void 0?n.addEventListener(r,c,{capture:!0,passive:g}):n.addEventListener(r,c,!0):g!==void 0?n.addEventListener(r,c,{passive:g}):n.addEventListener(r,c,!1)}function Fh(n,r,c,h,g){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var A=h.tag;if(A===3||A===4){var R=h.stateNode.containerInfo;if(R===g)break;if(A===4)for(A=h.return;A!==null;){var L=A.tag;if((L===3||L===4)&&A.stateNode.containerInfo===g)return;A=A.return}for(;R!==null;){if(A=Hs(R),A===null)return;if(L=A.tag,L===5||L===6||L===26||L===27){h=y=A;continue e}R=R.parentNode}}h=h.return}Np(function(){var G=y,Z=nu(c),te=[];e:{var Y=og.get(n);if(Y!==void 0){var Q=Fo,fe=n;switch(n){case"keypress":if(Bo(c)===0)break e;case"keydown":case"keyup":Q=F_;break;case"focusin":fe="focus",Q=cu;break;case"focusout":fe="blur",Q=cu;break;case"beforeblur":case"afterblur":Q=cu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=R_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=q_;break;case ng:case sg:case rg:Q=D_;break;case ag:Q=G_;break;case"scroll":case"scrollend":Q=T_;break;case"wheel":Q=Y_;break;case"copy":case"cut":case"paste":Q=N_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=Bp;break;case"toggle":case"beforetoggle":Q=X_}var _e=(r&4)!==0,Ye=!_e&&(n==="scroll"||n==="scrollend"),F=_e?Y!==null?Y+"Capture":null:Y;_e=[];for(var P=G,$;P!==null;){var ee=P;if($=ee.stateNode,ee=ee.tag,ee!==5&&ee!==26&&ee!==27||$===null||F===null||(ee=na(P,F),ee!=null&&_e.push(ja(P,ee,$))),Ye)break;P=P.return}0<_e.length&&(Y=new Q(Y,fe,null,c,Z),te.push({event:Y,listeners:_e}))}}if((r&7)===0){e:{if(Y=n==="mouseover"||n==="pointerover",Q=n==="mouseout"||n==="pointerout",Y&&c!==iu&&(fe=c.relatedTarget||c.fromElement)&&(Hs(fe)||fe[zs]))break e;if((Q||Y)&&(Y=Z.window===Z?Z:(Y=Z.ownerDocument)?Y.defaultView||Y.parentWindow:window,Q?(fe=c.relatedTarget||c.toElement,Q=G,fe=fe?Hs(fe):null,fe!==null&&(Ye=a(fe),_e=fe.tag,fe!==Ye||_e!==5&&_e!==27&&_e!==6)&&(fe=null)):(Q=null,fe=G),Q!==fe)){if(_e=jp,ee="onMouseLeave",F="onMouseEnter",P="mouse",(n==="pointerout"||n==="pointerover")&&(_e=Bp,ee="onPointerLeave",F="onPointerEnter",P="pointer"),Ye=Q==null?Y:ia(Q),$=fe==null?Y:ia(fe),Y=new _e(ee,P+"leave",Q,c,Z),Y.target=Ye,Y.relatedTarget=$,ee=null,Hs(Z)===G&&(_e=new _e(F,P+"enter",fe,c,Z),_e.target=$,_e.relatedTarget=Ye,ee=_e),Ye=ee,Q&&fe)t:{for(_e=WS,F=Q,P=fe,$=0,ee=F;ee;ee=_e(ee))$++;ee=0;for(var ve=P;ve;ve=_e(ve))ee++;for(;0<$-ee;)F=_e(F),$--;for(;0<ee-$;)P=_e(P),ee--;for(;$--;){if(F===P||P!==null&&F===P.alternate){_e=F;break t}F=_e(F),P=_e(P)}_e=null}else _e=null;Q!==null&&ky(te,Y,Q,_e,!1),fe!==null&&Ye!==null&&ky(te,Ye,fe,_e,!0)}}e:{if(Y=G?ia(G):window,Q=Y.nodeName&&Y.nodeName.toLowerCase(),Q==="select"||Q==="input"&&Y.type==="file")var Be=Vp;else if($p(Y))if(Yp)Be=rS;else{Be=nS;var me=iS}else Q=Y.nodeName,!Q||Q.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?G&&tu(G.elementType)&&(Be=Vp):Be=sS;if(Be&&(Be=Be(n,G))){Gp(te,Be,c,Z);break e}me&&me(n,Y,G),n==="focusout"&&G&&Y.type==="number"&&G.memoizedProps.value!=null&&eu(Y,"number",Y.value)}switch(me=G?ia(G):window,n){case"focusin":($p(me)||me.contentEditable==="true")&&(Qs=me,gu=G,ha=null);break;case"focusout":ha=gu=Qs=null;break;case"mousedown":mu=!0;break;case"contextmenu":case"mouseup":case"dragend":mu=!1,tg(te,c,Z);break;case"selectionchange":if(oS)break;case"keydown":case"keyup":tg(te,c,Z)}var ke;if(hu)e:{switch(n){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else Ks?Hp(n,c)&&(Le="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(Le="onCompositionStart");Le&&(Up&&c.locale!=="ko"&&(Ks||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&Ks&&(ke=Lp()):(Mn=Z,au="value"in Mn?Mn.value:Mn.textContent,Ks=!0)),me=Ol(G,Le),0<me.length&&(Le=new Ip(Le,n,null,c,Z),te.push({event:Le,listeners:me}),ke?Le.data=ke:(ke=qp(c),ke!==null&&(Le.data=ke)))),(ke=Q_?J_(n,c):Z_(n,c))&&(Le=Ol(G,"onBeforeInput"),0<Le.length&&(me=new Ip("onBeforeInput","beforeinput",null,c,Z),te.push({event:me,listeners:Le}),me.data=ke)),$S(te,n,G,c,Z)}Cy(te,r)})}function ja(n,r,c){return{instance:n,listener:r,currentTarget:c}}function Ol(n,r){for(var c=r+"Capture",h=[];n!==null;){var g=n,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=na(n,c),g!=null&&h.unshift(ja(n,g,y)),g=na(n,r),g!=null&&h.push(ja(n,g,y))),n.tag===3)return h;n=n.return}return[]}function WS(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function ky(n,r,c,h,g){for(var y=r._reactName,A=[];c!==null&&c!==h;){var R=c,L=R.alternate,G=R.stateNode;if(R=R.tag,L!==null&&L===h)break;R!==5&&R!==26&&R!==27||G===null||(L=G,g?(G=na(c,y),G!=null&&A.unshift(ja(c,G,L))):g||(G=na(c,y),G!=null&&A.push(ja(c,G,L)))),c=c.return}A.length!==0&&n.push({event:r,listeners:A})}var XS=/\r\n?/g,KS=/\u0000|\uFFFD/g;function Oy(n){return(typeof n=="string"?n:""+n).replace(XS,`
`).replace(KS,"")}function Dy(n,r){return r=Oy(r),Oy(n)===r}function Ve(n,r,c,h,g,y){switch(c){case"children":typeof h=="string"?r==="body"||r==="textarea"&&h===""||Ys(n,h):(typeof h=="number"||typeof h=="bigint")&&r!=="body"&&Ys(n,""+h);break;case"className":Lo(n,"class",h);break;case"tabIndex":Lo(n,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Lo(n,c,h);break;case"style":Dp(n,h,y);break;case"data":if(r!=="object"){Lo(n,"data",h);break}case"src":case"href":if(h===""&&(r!=="a"||c!=="href")){n.removeAttribute(c);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){n.removeAttribute(c);break}h=jo(""+h),n.setAttribute(c,h);break;case"action":case"formAction":if(typeof h=="function"){n.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(c==="formAction"?(r!=="input"&&Ve(n,r,"name",g.name,g,null),Ve(n,r,"formEncType",g.formEncType,g,null),Ve(n,r,"formMethod",g.formMethod,g,null),Ve(n,r,"formTarget",g.formTarget,g,null)):(Ve(n,r,"encType",g.encType,g,null),Ve(n,r,"method",g.method,g,null),Ve(n,r,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){n.removeAttribute(c);break}h=jo(""+h),n.setAttribute(c,h);break;case"onClick":h!=null&&(n.onclick=nn);break;case"onScroll":h!=null&&Me("scroll",n);break;case"onScrollEnd":h!=null&&Me("scrollend",n);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));n.innerHTML=c}}break;case"multiple":n.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":n.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){n.removeAttribute("xlink:href");break}c=jo(""+h),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(c,""+h):n.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(c,""):n.removeAttribute(c);break;case"capture":case"download":h===!0?n.setAttribute(c,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?n.setAttribute(c,h):n.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?n.setAttribute(c,h):n.removeAttribute(c);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?n.removeAttribute(c):n.setAttribute(c,h);break;case"popover":Me("beforetoggle",n),Me("toggle",n),No(n,"popover",h);break;case"xlinkActuate":tn(n,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":tn(n,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":tn(n,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":tn(n,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":tn(n,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":tn(n,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":tn(n,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":tn(n,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":tn(n,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":No(n,"is",h);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=E_.get(c)||c,No(n,c,h))}}function zh(n,r,c,h,g,y){switch(c){case"style":Dp(n,h,y);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(g.children!=null)throw Error(i(60));n.innerHTML=c}}break;case"children":typeof h=="string"?Ys(n,h):(typeof h=="number"||typeof h=="bigint")&&Ys(n,""+h);break;case"onScroll":h!=null&&Me("scroll",n);break;case"onScrollEnd":h!=null&&Me("scrollend",n);break;case"onClick":h!=null&&(n.onclick=nn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Sp.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),r=c.slice(2,g?c.length-7:void 0),y=n[Yt]||null,y=y!=null?y[c]:null,typeof y=="function"&&n.removeEventListener(r,y,g),typeof h=="function")){typeof y!="function"&&y!==null&&(c in n?n[c]=null:n.hasAttribute(c)&&n.removeAttribute(c)),n.addEventListener(r,h,g);break e}c in n?n[c]=h:h===!0?n.setAttribute(c,""):No(n,c,h)}}}function Nt(n,r,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Me("error",n),Me("load",n);var h=!1,g=!1,y;for(y in c)if(c.hasOwnProperty(y)){var A=c[y];if(A!=null)switch(y){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Ve(n,r,y,A,c,null)}}g&&Ve(n,r,"srcSet",c.srcSet,c,null),h&&Ve(n,r,"src",c.src,c,null);return;case"input":Me("invalid",n);var R=y=A=g=null,L=null,G=null;for(h in c)if(c.hasOwnProperty(h)){var Z=c[h];if(Z!=null)switch(h){case"name":g=Z;break;case"type":A=Z;break;case"checked":L=Z;break;case"defaultChecked":G=Z;break;case"value":y=Z;break;case"defaultValue":R=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,r));break;default:Ve(n,r,h,Z,c,null)}}Cp(n,y,R,L,G,A,g,!1);return;case"select":Me("invalid",n),h=A=y=null;for(g in c)if(c.hasOwnProperty(g)&&(R=c[g],R!=null))switch(g){case"value":y=R;break;case"defaultValue":A=R;break;case"multiple":h=R;default:Ve(n,r,g,R,c,null)}r=y,c=A,n.multiple=!!h,r!=null?Vs(n,!!h,r,!1):c!=null&&Vs(n,!!h,c,!0);return;case"textarea":Me("invalid",n),y=g=h=null;for(A in c)if(c.hasOwnProperty(A)&&(R=c[A],R!=null))switch(A){case"value":h=R;break;case"defaultValue":g=R;break;case"children":y=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(i(91));break;default:Ve(n,r,A,R,c,null)}kp(n,h,g,y);return;case"option":for(L in c)if(c.hasOwnProperty(L)&&(h=c[L],h!=null))switch(L){case"selected":n.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Ve(n,r,L,h,c,null)}return;case"dialog":Me("beforetoggle",n),Me("toggle",n),Me("cancel",n),Me("close",n);break;case"iframe":case"object":Me("load",n);break;case"video":case"audio":for(h=0;h<Pa.length;h++)Me(Pa[h],n);break;case"image":Me("error",n),Me("load",n);break;case"details":Me("toggle",n);break;case"embed":case"source":case"link":Me("error",n),Me("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(G in c)if(c.hasOwnProperty(G)&&(h=c[G],h!=null))switch(G){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:Ve(n,r,G,h,c,null)}return;default:if(tu(r)){for(Z in c)c.hasOwnProperty(Z)&&(h=c[Z],h!==void 0&&zh(n,r,Z,h,c,void 0));return}}for(R in c)c.hasOwnProperty(R)&&(h=c[R],h!=null&&Ve(n,r,R,h,c,null))}function QS(n,r,c,h){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,A=null,R=null,L=null,G=null,Z=null;for(Q in c){var te=c[Q];if(c.hasOwnProperty(Q)&&te!=null)switch(Q){case"checked":break;case"value":break;case"defaultValue":L=te;default:h.hasOwnProperty(Q)||Ve(n,r,Q,null,h,te)}}for(var Y in h){var Q=h[Y];if(te=c[Y],h.hasOwnProperty(Y)&&(Q!=null||te!=null))switch(Y){case"type":y=Q;break;case"name":g=Q;break;case"checked":G=Q;break;case"defaultChecked":Z=Q;break;case"value":A=Q;break;case"defaultValue":R=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,r));break;default:Q!==te&&Ve(n,r,Y,Q,h,te)}}Zc(n,A,R,L,G,Z,y,g);return;case"select":Q=A=R=Y=null;for(y in c)if(L=c[y],c.hasOwnProperty(y)&&L!=null)switch(y){case"value":break;case"multiple":Q=L;default:h.hasOwnProperty(y)||Ve(n,r,y,null,h,L)}for(g in h)if(y=h[g],L=c[g],h.hasOwnProperty(g)&&(y!=null||L!=null))switch(g){case"value":Y=y;break;case"defaultValue":R=y;break;case"multiple":A=y;default:y!==L&&Ve(n,r,g,y,h,L)}r=R,c=A,h=Q,Y!=null?Vs(n,!!c,Y,!1):!!h!=!!c&&(r!=null?Vs(n,!!c,r,!0):Vs(n,!!c,c?[]:"",!1));return;case"textarea":Q=Y=null;for(R in c)if(g=c[R],c.hasOwnProperty(R)&&g!=null&&!h.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Ve(n,r,R,null,h,g)}for(A in h)if(g=h[A],y=c[A],h.hasOwnProperty(A)&&(g!=null||y!=null))switch(A){case"value":Y=g;break;case"defaultValue":Q=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==y&&Ve(n,r,A,g,h,y)}Rp(n,Y,Q);return;case"option":for(var fe in c)if(Y=c[fe],c.hasOwnProperty(fe)&&Y!=null&&!h.hasOwnProperty(fe))switch(fe){case"selected":n.selected=!1;break;default:Ve(n,r,fe,null,h,Y)}for(L in h)if(Y=h[L],Q=c[L],h.hasOwnProperty(L)&&Y!==Q&&(Y!=null||Q!=null))switch(L){case"selected":n.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:Ve(n,r,L,Y,h,Q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _e in c)Y=c[_e],c.hasOwnProperty(_e)&&Y!=null&&!h.hasOwnProperty(_e)&&Ve(n,r,_e,null,h,Y);for(G in h)if(Y=h[G],Q=c[G],h.hasOwnProperty(G)&&Y!==Q&&(Y!=null||Q!=null))switch(G){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,r));break;default:Ve(n,r,G,Y,h,Q)}return;default:if(tu(r)){for(var Ye in c)Y=c[Ye],c.hasOwnProperty(Ye)&&Y!==void 0&&!h.hasOwnProperty(Ye)&&zh(n,r,Ye,void 0,h,Y);for(Z in h)Y=h[Z],Q=c[Z],!h.hasOwnProperty(Z)||Y===Q||Y===void 0&&Q===void 0||zh(n,r,Z,Y,h,Q);return}}for(var F in c)Y=c[F],c.hasOwnProperty(F)&&Y!=null&&!h.hasOwnProperty(F)&&Ve(n,r,F,null,h,Y);for(te in h)Y=h[te],Q=c[te],!h.hasOwnProperty(te)||Y===Q||Y==null&&Q==null||Ve(n,r,te,Y,h,Q)}function My(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function JS(){if(typeof performance.getEntriesByType=="function"){for(var n=0,r=0,c=performance.getEntriesByType("resource"),h=0;h<c.length;h++){var g=c[h],y=g.transferSize,A=g.initiatorType,R=g.duration;if(y&&R&&My(A)){for(A=0,R=g.responseEnd,h+=1;h<c.length;h++){var L=c[h],G=L.startTime;if(G>R)break;var Z=L.transferSize,te=L.initiatorType;Z&&My(te)&&(L=L.responseEnd,A+=Z*(L<R?1:(R-G)/(L-G)))}if(--h,r+=8*(y+A)/(g.duration/1e3),n++,10<n)break}}if(0<n)return r/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var Hh=null,qh=null;function Dl(n){return n.nodeType===9?n:n.ownerDocument}function Ny(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ly(n,r){if(n===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&r==="foreignObject"?0:n}function $h(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Gh=null;function ZS(){var n=window.event;return n&&n.type==="popstate"?n===Gh?!1:(Gh=n,!0):(Gh=null,!1)}var Py=typeof setTimeout=="function"?setTimeout:void 0,e1=typeof clearTimeout=="function"?clearTimeout:void 0,jy=typeof Promise=="function"?Promise:void 0,t1=typeof queueMicrotask=="function"?queueMicrotask:typeof jy<"u"?function(n){return jy.resolve(null).then(n).catch(i1)}:Py;function i1(n){setTimeout(function(){throw n})}function Xn(n){return n==="head"}function Iy(n,r){var c=r,h=0;do{var g=c.nextSibling;if(n.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(h===0){n.removeChild(g),Er(r);return}h--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")h++;else if(c==="html")Ia(n.ownerDocument.documentElement);else if(c==="head"){c=n.ownerDocument.head,Ia(c);for(var y=c.firstChild;y;){var A=y.nextSibling,R=y.nodeName;y[ta]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&y.rel.toLowerCase()==="stylesheet"||c.removeChild(y),y=A}}else c==="body"&&Ia(n.ownerDocument.body);c=g}while(c);Er(r)}function By(n,r){var c=n;n=0;do{var h=c.nextSibling;if(c.nodeType===1?r?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(r?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),h&&h.nodeType===8)if(c=h.data,c==="/$"){if(n===0)break;n--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||n++;c=h}while(c)}function Vh(n){var r=n.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var c=r;switch(r=r.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Vh(c),Qc(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}n.removeChild(c)}}function n1(n,r,c,h){for(;n.nodeType===1;){var g=c;if(n.nodeName.toLowerCase()!==r.toLowerCase()){if(!h&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(h){if(!n[ta])switch(r){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(y=n.getAttribute("rel"),y==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(y!==g.rel||n.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||n.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||n.getAttribute("title")!==(g.title==null?null:g.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(y=n.getAttribute("src"),(y!==(g.src==null?null:g.src)||n.getAttribute("type")!==(g.type==null?null:g.type)||n.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(r==="input"&&n.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&n.getAttribute("name")===y)return n}else return n;if(n=xi(n.nextSibling),n===null)break}return null}function s1(n,r,c){if(r==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!c||(n=xi(n.nextSibling),n===null))return null;return n}function Uy(n,r){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=xi(n.nextSibling),n===null))return null;return n}function Yh(n){return n.data==="$?"||n.data==="$~"}function Wh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function r1(n,r){var c=n.ownerDocument;if(n.data==="$~")n._reactRetry=r;else if(n.data!=="$?"||c.readyState!=="loading")r();else{var h=function(){r(),c.removeEventListener("DOMContentLoaded",h)};c.addEventListener("DOMContentLoaded",h),n._reactRetry=h}}function xi(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return n}var Xh=null;function Fy(n){n=n.nextSibling;for(var r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"||c==="/&"){if(r===0)return xi(n.nextSibling);r--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||r++}n=n.nextSibling}return null}function zy(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(r===0)return n;r--}else c!=="/$"&&c!=="/&"||r++}n=n.previousSibling}return null}function Hy(n,r,c){switch(r=Dl(c),n){case"html":if(n=r.documentElement,!n)throw Error(i(452));return n;case"head":if(n=r.head,!n)throw Error(i(453));return n;case"body":if(n=r.body,!n)throw Error(i(454));return n;default:throw Error(i(451))}}function Ia(n){for(var r=n.attributes;r.length;)n.removeAttributeNode(r[0]);Qc(n)}var Ti=new Map,qy=new Set;function Ml(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var vn=J.d;J.d={f:a1,r:o1,D:l1,C:c1,L:u1,m:h1,X:f1,S:d1,M:p1};function a1(){var n=vn.f(),r=Al();return n||r}function o1(n){var r=qs(n);r!==null&&r.tag===5&&r.type==="form"?am(r):vn.r(n)}var _r=typeof document>"u"?null:document;function $y(n,r,c){var h=_r;if(h&&typeof r=="string"&&r){var g=bi(r);g='link[rel="'+n+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),qy.has(g)||(qy.add(g),n={rel:n,crossOrigin:c,href:r},h.querySelector(g)===null&&(r=h.createElement("link"),Nt(r,"link",n),xt(r),h.head.appendChild(r)))}}function l1(n){vn.D(n),$y("dns-prefetch",n,null)}function c1(n,r){vn.C(n,r),$y("preconnect",n,r)}function u1(n,r,c){vn.L(n,r,c);var h=_r;if(h&&n&&r){var g='link[rel="preload"][as="'+bi(r)+'"]';r==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+bi(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+bi(c.imageSizes)+'"]')):g+='[href="'+bi(n)+'"]';var y=g;switch(r){case"style":y=Sr(n);break;case"script":y=Ar(n)}Ti.has(y)||(n=m({rel:"preload",href:r==="image"&&c&&c.imageSrcSet?void 0:n,as:r},c),Ti.set(y,n),h.querySelector(g)!==null||r==="style"&&h.querySelector(Ba(y))||r==="script"&&h.querySelector(Ua(y))||(r=h.createElement("link"),Nt(r,"link",n),xt(r),h.head.appendChild(r)))}}function h1(n,r){vn.m(n,r);var c=_r;if(c&&n){var h=r&&typeof r.as=="string"?r.as:"script",g='link[rel="modulepreload"][as="'+bi(h)+'"][href="'+bi(n)+'"]',y=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Ar(n)}if(!Ti.has(y)&&(n=m({rel:"modulepreload",href:n},r),Ti.set(y,n),c.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Ua(y)))return}h=c.createElement("link"),Nt(h,"link",n),xt(h),c.head.appendChild(h)}}}function d1(n,r,c){vn.S(n,r,c);var h=_r;if(h&&n){var g=$s(h).hoistableStyles,y=Sr(n);r=r||"default";var A=g.get(y);if(!A){var R={loading:0,preload:null};if(A=h.querySelector(Ba(y)))R.loading=5;else{n=m({rel:"stylesheet",href:n,"data-precedence":r},c),(c=Ti.get(y))&&Kh(n,c);var L=A=h.createElement("link");xt(L),Nt(L,"link",n),L._p=new Promise(function(G,Z){L.onload=G,L.onerror=Z}),L.addEventListener("load",function(){R.loading|=1}),L.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Nl(A,r,h)}A={type:"stylesheet",instance:A,count:1,state:R},g.set(y,A)}}}function f1(n,r){vn.X(n,r);var c=_r;if(c&&n){var h=$s(c).hoistableScripts,g=Ar(n),y=h.get(g);y||(y=c.querySelector(Ua(g)),y||(n=m({src:n,async:!0},r),(r=Ti.get(g))&&Qh(n,r),y=c.createElement("script"),xt(y),Nt(y,"link",n),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function p1(n,r){vn.M(n,r);var c=_r;if(c&&n){var h=$s(c).hoistableScripts,g=Ar(n),y=h.get(g);y||(y=c.querySelector(Ua(g)),y||(n=m({src:n,async:!0,type:"module"},r),(r=Ti.get(g))&&Qh(n,r),y=c.createElement("script"),xt(y),Nt(y,"link",n),c.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},h.set(g,y))}}function Gy(n,r,c,h){var g=(g=I.current)?Ml(g):null;if(!g)throw Error(i(446));switch(n){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(r=Sr(c.href),c=$s(g).hoistableStyles,h=c.get(r),h||(h={type:"style",instance:null,count:0,state:null},c.set(r,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){n=Sr(c.href);var y=$s(g).hoistableStyles,A=y.get(n);if(A||(g=g.ownerDocument||g,A={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(n,A),(y=g.querySelector(Ba(n)))&&!y._p&&(A.instance=y,A.state.loading=5),Ti.has(n)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ti.set(n,c),y||g1(g,n,c,A.state))),r&&h===null)throw Error(i(528,""));return A}if(r&&h!==null)throw Error(i(529,""));return null;case"script":return r=c.async,c=c.src,typeof c=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Ar(c),c=$s(g).hoistableScripts,h=c.get(r),h||(h={type:"script",instance:null,count:0,state:null},c.set(r,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,n))}}function Sr(n){return'href="'+bi(n)+'"'}function Ba(n){return'link[rel="stylesheet"]['+n+"]"}function Vy(n){return m({},n,{"data-precedence":n.precedence,precedence:null})}function g1(n,r,c,h){n.querySelector('link[rel="preload"][as="style"]['+r+"]")?h.loading=1:(r=n.createElement("link"),h.preload=r,r.addEventListener("load",function(){return h.loading|=1}),r.addEventListener("error",function(){return h.loading|=2}),Nt(r,"link",c),xt(r),n.head.appendChild(r))}function Ar(n){return'[src="'+bi(n)+'"]'}function Ua(n){return"script[async]"+n}function Yy(n,r,c){if(r.count++,r.instance===null)switch(r.type){case"style":var h=n.querySelector('style[data-href~="'+bi(c.href)+'"]');if(h)return r.instance=h,xt(h),h;var g=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return h=(n.ownerDocument||n).createElement("style"),xt(h),Nt(h,"style",g),Nl(h,c.precedence,n),r.instance=h;case"stylesheet":g=Sr(c.href);var y=n.querySelector(Ba(g));if(y)return r.state.loading|=4,r.instance=y,xt(y),y;h=Vy(c),(g=Ti.get(g))&&Kh(h,g),y=(n.ownerDocument||n).createElement("link"),xt(y);var A=y;return A._p=new Promise(function(R,L){A.onload=R,A.onerror=L}),Nt(y,"link",h),r.state.loading|=4,Nl(y,c.precedence,n),r.instance=y;case"script":return y=Ar(c.src),(g=n.querySelector(Ua(y)))?(r.instance=g,xt(g),g):(h=c,(g=Ti.get(y))&&(h=m({},c),Qh(h,g)),n=n.ownerDocument||n,g=n.createElement("script"),xt(g),Nt(g,"link",h),n.head.appendChild(g),r.instance=g);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(h=r.instance,r.state.loading|=4,Nl(h,c.precedence,n));return r.instance}function Nl(n,r,c){for(var h=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,y=g,A=0;A<h.length;A++){var R=h[A];if(R.dataset.precedence===r)y=R;else if(y!==g)break}y?y.parentNode.insertBefore(n,y.nextSibling):(r=c.nodeType===9?c.head:c,r.insertBefore(n,r.firstChild))}function Kh(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.title==null&&(n.title=r.title)}function Qh(n,r){n.crossOrigin==null&&(n.crossOrigin=r.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=r.referrerPolicy),n.integrity==null&&(n.integrity=r.integrity)}var Ll=null;function Wy(n,r,c){if(Ll===null){var h=new Map,g=Ll=new Map;g.set(c,h)}else g=Ll,h=g.get(c),h||(h=new Map,g.set(c,h));if(h.has(n))return h;for(h.set(n,null),c=c.getElementsByTagName(n),g=0;g<c.length;g++){var y=c[g];if(!(y[ta]||y[kt]||n==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var A=y.getAttribute(r)||"";A=n+A;var R=h.get(A);R?R.push(y):h.set(A,[y])}}return h}function Xy(n,r,c){n=n.ownerDocument||n,n.head.insertBefore(c,r==="title"?n.querySelector("head > title"):null)}function m1(n,r,c){if(c===1||r.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return n=r.disabled,typeof r.precedence=="string"&&n==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Ky(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function y1(n,r,c,h){if(c.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=Sr(h.href),y=r.querySelector(Ba(g));if(y){r=y._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(n.count++,n=Pl.bind(n),r.then(n,n)),c.state.loading|=4,c.instance=y,xt(y);return}y=r.ownerDocument||r,h=Vy(h),(g=Ti.get(g))&&Kh(h,g),y=y.createElement("link"),xt(y);var A=y;A._p=new Promise(function(R,L){A.onload=R,A.onerror=L}),Nt(y,"link",h),c.instance=y}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(c,r),(r=c.state.preload)&&(c.state.loading&3)===0&&(n.count++,c=Pl.bind(n),r.addEventListener("load",c),r.addEventListener("error",c))}}var Jh=0;function b1(n,r){return n.stylesheets&&n.count===0&&Il(n,n.stylesheets),0<n.count||0<n.imgCount?function(c){var h=setTimeout(function(){if(n.stylesheets&&Il(n,n.stylesheets),n.unsuspend){var y=n.unsuspend;n.unsuspend=null,y()}},6e4+r);0<n.imgBytes&&Jh===0&&(Jh=62500*JS());var g=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Il(n,n.stylesheets),n.unsuspend)){var y=n.unsuspend;n.unsuspend=null,y()}},(n.imgBytes>Jh?50:800)+r);return n.unsuspend=c,function(){n.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function Pl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Il(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var jl=null;function Il(n,r){n.stylesheets=null,n.unsuspend!==null&&(n.count++,jl=new Map,r.forEach(v1,n),jl=null,Pl.call(n))}function v1(n,r){if(!(r.state.loading&4)){var c=jl.get(n);if(c)var h=c.get(null);else{c=new Map,jl.set(n,c);for(var g=n.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var A=g[y];(A.nodeName==="LINK"||A.getAttribute("media")!=="not all")&&(c.set(A.dataset.precedence,A),h=A)}h&&c.set(null,h)}g=r.instance,A=g.getAttribute("data-precedence"),y=c.get(A)||h,y===h&&c.set(null,g),c.set(A,g),this.count++,h=Pl.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),y?y.parentNode.insertBefore(g,y.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(g,n.firstChild)),r.state.loading|=4}}var Fa={$$typeof:T,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function w1(n,r,c,h,g,y,A,R,L){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Yc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yc(0),this.hiddenUpdates=Yc(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=A,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Qy(n,r,c,h,g,y,A,R,L,G,Z,te){return n=new w1(n,r,c,A,L,G,Z,te,R),r=1,y===!0&&(r|=24),y=oi(3,null,null,r),n.current=y,y.stateNode=n,r=Du(),r.refCount++,n.pooledCache=r,r.refCount++,y.memoizedState={element:h,isDehydrated:c,cache:r},Pu(y),n}function Jy(n){return n?(n=er,n):er}function Zy(n,r,c,h,g,y){g=Jy(g),h.context===null?h.context=g:h.pendingContext=g,h=Bn(r),h.payload={element:c},y=y===void 0?null:y,y!==null&&(h.callback=y),c=Un(n,h,r),c!==null&&(Zt(c,n,r),ba(c,n,r))}function e0(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<r?c:r}}function Zh(n,r){e0(n,r),(n=n.alternate)&&e0(n,r)}function t0(n){if(n.tag===13||n.tag===31){var r=fs(n,67108864);r!==null&&Zt(r,n,67108864),Zh(n,67108864)}}function i0(n){if(n.tag===13||n.tag===31){var r=di();r=Wc(r);var c=fs(n,r);c!==null&&Zt(c,n,r),Zh(n,r)}}var Bl=!0;function _1(n,r,c,h){var g=j.T;j.T=null;var y=J.p;try{J.p=2,ed(n,r,c,h)}finally{J.p=y,j.T=g}}function S1(n,r,c,h){var g=j.T;j.T=null;var y=J.p;try{J.p=8,ed(n,r,c,h)}finally{J.p=y,j.T=g}}function ed(n,r,c,h){if(Bl){var g=td(h);if(g===null)Fh(n,r,h,Ul,c),s0(n,h);else if(E1(g,n,r,c,h))h.stopPropagation();else if(s0(n,h),r&4&&-1<A1.indexOf(n)){for(;g!==null;){var y=qs(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var A=ls(y.pendingLanes);if(A!==0){var R=y;for(R.pendingLanes|=2,R.entangledLanes|=2;A;){var L=1<<31-ri(A);R.entanglements[1]|=L,A&=~L}qi(y),(Fe&6)===0&&(_l=ni()+500,La(0))}}break;case 31:case 13:R=fs(y,2),R!==null&&Zt(R,y,2),Al(),Zh(y,2)}if(y=td(h),y===null&&Fh(n,r,h,Ul,c),y===g)break;g=y}g!==null&&h.stopPropagation()}else Fh(n,r,h,null,c)}}function td(n){return n=nu(n),id(n)}var Ul=null;function id(n){if(Ul=null,n=Hs(n),n!==null){var r=a(n);if(r===null)n=null;else{var c=r.tag;if(c===13){if(n=o(r),n!==null)return n;n=null}else if(c===31){if(n=u(r),n!==null)return n;n=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Ul=n,null}function n0(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(l_()){case hp:return 2;case dp:return 8;case Ro:case c_:return 32;case fp:return 268435456;default:return 32}default:return 32}}var nd=!1,Kn=null,Qn=null,Jn=null,za=new Map,Ha=new Map,Zn=[],A1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function s0(n,r){switch(n){case"focusin":case"focusout":Kn=null;break;case"dragenter":case"dragleave":Qn=null;break;case"mouseover":case"mouseout":Jn=null;break;case"pointerover":case"pointerout":za.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ha.delete(r.pointerId)}}function qa(n,r,c,h,g,y){return n===null||n.nativeEvent!==y?(n={blockedOn:r,domEventName:c,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},r!==null&&(r=qs(r),r!==null&&t0(r)),n):(n.eventSystemFlags|=h,r=n.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),n)}function E1(n,r,c,h,g){switch(r){case"focusin":return Kn=qa(Kn,n,r,c,h,g),!0;case"dragenter":return Qn=qa(Qn,n,r,c,h,g),!0;case"mouseover":return Jn=qa(Jn,n,r,c,h,g),!0;case"pointerover":var y=g.pointerId;return za.set(y,qa(za.get(y)||null,n,r,c,h,g)),!0;case"gotpointercapture":return y=g.pointerId,Ha.set(y,qa(Ha.get(y)||null,n,r,c,h,g)),!0}return!1}function r0(n){var r=Hs(n.target);if(r!==null){var c=a(r);if(c!==null){if(r=c.tag,r===13){if(r=o(c),r!==null){n.blockedOn=r,vp(n.priority,function(){i0(c)});return}}else if(r===31){if(r=u(c),r!==null){n.blockedOn=r,vp(n.priority,function(){i0(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Fl(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var c=td(n.nativeEvent);if(c===null){c=n.nativeEvent;var h=new c.constructor(c.type,c);iu=h,c.target.dispatchEvent(h),iu=null}else return r=qs(c),r!==null&&t0(r),n.blockedOn=c,!1;r.shift()}return!0}function a0(n,r,c){Fl(n)&&c.delete(r)}function x1(){nd=!1,Kn!==null&&Fl(Kn)&&(Kn=null),Qn!==null&&Fl(Qn)&&(Qn=null),Jn!==null&&Fl(Jn)&&(Jn=null),za.forEach(a0),Ha.forEach(a0)}function zl(n,r){n.blockedOn===r&&(n.blockedOn=null,nd||(nd=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,x1)))}var Hl=null;function o0(n){Hl!==n&&(Hl=n,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){Hl===n&&(Hl=null);for(var r=0;r<n.length;r+=3){var c=n[r],h=n[r+1],g=n[r+2];if(typeof h!="function"){if(id(h||c)===null)continue;break}var y=qs(c);y!==null&&(n.splice(r,3),r-=3,th(y,{pending:!0,data:g,method:c.method,action:h},h,g))}}))}function Er(n){function r(L){return zl(L,n)}Kn!==null&&zl(Kn,n),Qn!==null&&zl(Qn,n),Jn!==null&&zl(Jn,n),za.forEach(r),Ha.forEach(r);for(var c=0;c<Zn.length;c++){var h=Zn[c];h.blockedOn===n&&(h.blockedOn=null)}for(;0<Zn.length&&(c=Zn[0],c.blockedOn===null);)r0(c),c.blockedOn===null&&Zn.shift();if(c=(n.ownerDocument||n).$$reactFormReplay,c!=null)for(h=0;h<c.length;h+=3){var g=c[h],y=c[h+1],A=g[Yt]||null;if(typeof y=="function")A||o0(c);else if(A){var R=null;if(y&&y.hasAttribute("formAction")){if(g=y,A=y[Yt]||null)R=A.formAction;else if(id(g)!==null)continue}else R=A.action;typeof R=="function"?c[h+1]=R:(c.splice(h,3),h-=3),o0(c)}}}function l0(){function n(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(A){return g=A})},focusReset:"manual",scroll:"manual"})}function r(){g!==null&&(g(),g=null),h||setTimeout(c,20)}function c(){if(!h&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(c,100),function(){h=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),g!==null&&(g(),g=null)}}}function sd(n){this._internalRoot=n}ql.prototype.render=sd.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));var c=r.current,h=di();Zy(c,h,n,r,null,null)},ql.prototype.unmount=sd.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Zy(n.current,2,null,n,null,null),Al(),r[zs]=null}};function ql(n){this._internalRoot=n}ql.prototype.unstable_scheduleHydration=function(n){if(n){var r=bp();n={blockedOn:null,target:n,priority:r};for(var c=0;c<Zn.length&&r!==0&&r<Zn[c].priority;c++);Zn.splice(c,0,n),c===0&&r0(n)}};var c0=e.version;if(c0!=="19.2.0")throw Error(i(527,c0,"19.2.0"));J.findDOMNode=function(n){var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=f(r),n=n!==null?p(n):null,n=n===null?null:n.stateNode,n};var T1={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:j,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $l=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$l.isDisabled&&$l.supportsFiber)try{Jr=$l.inject(T1),si=$l}catch{}}return Ga.createRoot=function(n,r){if(!s(n))throw Error(i(299));var c=!1,h="",g=mm,y=ym,A=bm;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(y=r.onCaughtError),r.onRecoverableError!==void 0&&(A=r.onRecoverableError)),r=Qy(n,1,!1,null,null,c,h,null,g,y,A,l0),n[zs]=r.current,Uh(n),new sd(r)},Ga.hydrateRoot=function(n,r,c){if(!s(n))throw Error(i(299));var h=!1,g="",y=mm,A=ym,R=bm,L=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(y=c.onUncaughtError),c.onCaughtError!==void 0&&(A=c.onCaughtError),c.onRecoverableError!==void 0&&(R=c.onRecoverableError),c.formState!==void 0&&(L=c.formState)),r=Qy(n,1,!0,r,c??null,h,g,L,y,A,R,l0),r.context=Jy(null),c=r.current,h=di(),h=Wc(h),g=Bn(h),g.callback=null,Un(c,g,h),c=h,r.current.lanes=c,ea(r,c),qi(r),n[zs]=r.current,Uh(n),new ql(r)},Ga.version="19.2.0",Ga}var _0;function B1(){if(_0)return ld.exports;_0=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),ld.exports=I1(),ld.exports}var U1=B1();var S0="popstate";function F1(l={}){function e(i,s){let{pathname:a,search:o,hash:u}=i.location;return Zd("",{pathname:a,search:o,hash:u},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){return typeof s=="string"?s:oo(s)}return H1(e,t,null,l)}function rt(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function Di(l,e){if(!l){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function z1(){return Math.random().toString(36).substring(2,10)}function A0(l,e){return{usr:l.state,key:l.key,idx:e}}function Zd(l,e,t=null,i){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof e=="string"?Wr(e):e,state:t,key:e&&e.key||i||z1()}}function oo({pathname:l="/",search:e="",hash:t=""}){return e&&e!=="?"&&(l+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(l+=t.charAt(0)==="#"?t:"#"+t),l}function Wr(l){let e={};if(l){let t=l.indexOf("#");t>=0&&(e.hash=l.substring(t),l=l.substring(0,t));let i=l.indexOf("?");i>=0&&(e.search=l.substring(i),l=l.substring(0,i)),l&&(e.pathname=l)}return e}function H1(l,e,t,i={}){let{window:s=document.defaultView,v5Compat:a=!1}=i,o=s.history,u="POP",d=null,f=p();f==null&&(f=0,o.replaceState({...o.state,idx:f},""));function p(){return(o.state||{idx:null}).idx}function m(){u="POP";let E=p(),x=E==null?null:E-f;f=E,d&&d({action:u,location:w.location,delta:x})}function b(E,x){u="PUSH";let C=Zd(w.location,E,x);f=p()+1;let T=A0(C,f),D=w.createHref(C);try{o.pushState(T,"",D)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(D)}a&&d&&d({action:u,location:w.location,delta:1})}function v(E,x){u="REPLACE";let C=Zd(w.location,E,x);f=p();let T=A0(C,f),D=w.createHref(C);o.replaceState(T,"",D),a&&d&&d({action:u,location:w.location,delta:0})}function S(E){return q1(E)}let w={get action(){return u},get location(){return l(s,o)},listen(E){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(S0,m),d=E,()=>{s.removeEventListener(S0,m),d=null}},createHref(E){return e(s,E)},createURL:S,encodeLocation(E){let x=S(E);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:b,replace:v,go(E){return o.go(E)}};return w}function q1(l,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),rt(t,"No window.location.(origin|href) available to create URL");let i=typeof l=="string"?l:oo(l);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function rv(l,e,t="/"){return $1(l,e,t,!1)}function $1(l,e,t,i){let s=typeof e=="string"?Wr(e):e,a=Cn(s.pathname||"/",t);if(a==null)return null;let o=av(l);G1(o);let u=null;for(let d=0;u==null&&d<o.length;++d){let f=iA(a);u=eA(o[d],f,i)}return u}function av(l,e=[],t=[],i="",s=!1){let a=(o,u,d=s,f)=>{let p={relativePath:f===void 0?o.path||"":f,caseSensitive:o.caseSensitive===!0,childrenIndex:u,route:o};if(p.relativePath.startsWith("/")){if(!p.relativePath.startsWith(i)&&d)return;rt(p.relativePath.startsWith(i),`Absolute route path "${p.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),p.relativePath=p.relativePath.slice(i.length)}let m=Tn([i,p.relativePath]),b=t.concat(p);o.children&&o.children.length>0&&(rt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${m}".`),av(o.children,e,b,m,d)),!(o.path==null&&!o.index)&&e.push({path:m,score:J1(m,o.index),routesMeta:b})};return l.forEach((o,u)=>{if(o.path===""||!o.path?.includes("?"))a(o,u);else for(let d of ov(o.path))a(o,u,!0,d)}),e}function ov(l){let e=l.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),a=t.replace(/\?$/,"");if(i.length===0)return s?[a,""]:[a];let o=ov(i.join("/")),u=[];return u.push(...o.map(d=>d===""?a:[a,d].join("/"))),s&&u.push(...o),u.map(d=>l.startsWith("/")&&d===""?"/":d)}function G1(l){l.sort((e,t)=>e.score!==t.score?t.score-e.score:Z1(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var V1=/^:[\w-]+$/,Y1=3,W1=2,X1=1,K1=10,Q1=-2,E0=l=>l==="*";function J1(l,e){let t=l.split("/"),i=t.length;return t.some(E0)&&(i+=Q1),e&&(i+=W1),t.filter(s=>!E0(s)).reduce((s,a)=>s+(V1.test(a)?Y1:a===""?X1:K1),i)}function Z1(l,e){return l.length===e.length&&l.slice(0,-1).every((i,s)=>i===e[s])?l[l.length-1]-e[e.length-1]:0}function eA(l,e,t=!1){let{routesMeta:i}=l,s={},a="/",o=[];for(let u=0;u<i.length;++u){let d=i[u],f=u===i.length-1,p=a==="/"?e:e.slice(a.length)||"/",m=bc({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},p),b=d.route;if(!m&&f&&t&&!i[i.length-1].route.index&&(m=bc({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},p)),!m)return null;Object.assign(s,m.params),o.push({params:s,pathname:Tn([a,m.pathname]),pathnameBase:oA(Tn([a,m.pathnameBase])),route:b}),m.pathnameBase!=="/"&&(a=Tn([a,m.pathnameBase]))}return o}function bc(l,e){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[t,i]=tA(l.path,l.caseSensitive,l.end),s=e.match(t);if(!s)return null;let a=s[0],o=a.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:i.reduce((f,{paramName:p,isOptional:m},b)=>{if(p==="*"){let S=u[b]||"";o=a.slice(0,a.length-S.length).replace(/(.)\/+$/,"$1")}const v=u[b];return m&&!v?f[p]=void 0:f[p]=(v||"").replace(/%2F/g,"/"),f},{}),pathname:a,pathnameBase:o,pattern:l}}function tA(l,e=!1,t=!0){Di(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let i=[],s="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,d)=>(i.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return l.endsWith("*")?(i.push({paramName:"*"}),s+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":l!==""&&l!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function iA(l){try{return l.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Di(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),l}}function Cn(l,e){if(e==="/")return l;if(!l.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=l.charAt(t);return i&&i!=="/"?null:l.slice(t)||"/"}var nA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sA=l=>nA.test(l);function rA(l,e="/"){let{pathname:t,search:i="",hash:s=""}=typeof l=="string"?Wr(l):l,a;if(t)if(sA(t))a=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),Di(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${t}`)}t.startsWith("/")?a=x0(t.substring(1),"/"):a=x0(t,e)}else a=e;return{pathname:a,search:lA(i),hash:cA(s)}}function x0(l,e){let t=e.replace(/\/+$/,"").split("/");return l.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function dd(l,e,t,i){return`Cannot include a '${l}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function aA(l){return l.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function lv(l){let e=aA(l);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function cv(l,e,t,i=!1){let s;typeof l=="string"?s=Wr(l):(s={...l},rt(!s.pathname||!s.pathname.includes("?"),dd("?","pathname","search",s)),rt(!s.pathname||!s.pathname.includes("#"),dd("#","pathname","hash",s)),rt(!s.search||!s.search.includes("#"),dd("#","search","hash",s)));let a=l===""||s.pathname==="",o=a?"/":s.pathname,u;if(o==null)u=t;else{let m=e.length-1;if(!i&&o.startsWith("..")){let b=o.split("/");for(;b[0]==="..";)b.shift(),m-=1;s.pathname=b.join("/")}u=m>=0?e[m]:"/"}let d=rA(s,u),f=o&&o!=="/"&&o.endsWith("/"),p=(a||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(f||p)&&(d.pathname+="/"),d}var Tn=l=>l.join("/").replace(/\/\/+/g,"/"),oA=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),lA=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,cA=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function uA(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var uv=["POST","PUT","PATCH","DELETE"];new Set(uv);var hA=["GET",...uv];new Set(hA);var Xr=B.createContext(null);Xr.displayName="DataRouter";var Oc=B.createContext(null);Oc.displayName="DataRouterState";B.createContext(!1);var hv=B.createContext({isTransitioning:!1});hv.displayName="ViewTransition";var dA=B.createContext(new Map);dA.displayName="Fetchers";var fA=B.createContext(null);fA.displayName="Await";var Qi=B.createContext(null);Qi.displayName="Navigation";var yo=B.createContext(null);yo.displayName="Location";var Rn=B.createContext({outlet:null,matches:[],isDataRoute:!1});Rn.displayName="Route";var Mf=B.createContext(null);Mf.displayName="RouteError";function pA(l,{relative:e}={}){rt(bo(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=B.useContext(Qi),{hash:s,pathname:a,search:o}=vo(l,{relative:e}),u=a;return t!=="/"&&(u=a==="/"?t:Tn([t,a])),i.createHref({pathname:u,search:o,hash:s})}function bo(){return B.useContext(yo)!=null}function Ji(){return rt(bo(),"useLocation() may be used only in the context of a <Router> component."),B.useContext(yo).location}var dv="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function fv(l){B.useContext(Qi).static||B.useLayoutEffect(l)}function Zi(){let{isDataRoute:l}=B.useContext(Rn);return l?CA():gA()}function gA(){rt(bo(),"useNavigate() may be used only in the context of a <Router> component.");let l=B.useContext(Xr),{basename:e,navigator:t}=B.useContext(Qi),{matches:i}=B.useContext(Rn),{pathname:s}=Ji(),a=JSON.stringify(lv(i)),o=B.useRef(!1);return fv(()=>{o.current=!0}),B.useCallback((d,f={})=>{if(Di(o.current,dv),!o.current)return;if(typeof d=="number"){t.go(d);return}let p=cv(d,JSON.parse(a),s,f.relative==="path");l==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:Tn([e,p.pathname])),(f.replace?t.replace:t.push)(p,f.state,f)},[e,t,a,s,l])}B.createContext(null);function vo(l,{relative:e}={}){let{matches:t}=B.useContext(Rn),{pathname:i}=Ji(),s=JSON.stringify(lv(t));return B.useMemo(()=>cv(l,JSON.parse(s),i,e==="path"),[l,s,i,e])}function mA(l,e){return pv(l,e)}function pv(l,e,t,i,s){rt(bo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=B.useContext(Qi),{matches:o}=B.useContext(Rn),u=o[o.length-1],d=u?u.params:{},f=u?u.pathname:"/",p=u?u.pathnameBase:"/",m=u&&u.route;{let C=m&&m.path||"";gv(f,!m||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let b=Ji(),v;if(e){let C=typeof e=="string"?Wr(e):e;rt(p==="/"||C.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${C.pathname}" was given in the \`location\` prop.`),v=C}else v=b;let S=v.pathname||"/",w=S;if(p!=="/"){let C=p.replace(/^\//,"").split("/");w="/"+S.replace(/^\//,"").split("/").slice(C.length).join("/")}let E=rv(l,{pathname:w});Di(m||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Di(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=_A(E&&E.map(C=>Object.assign({},C,{params:Object.assign({},d,C.params),pathname:Tn([p,a.encodeLocation?a.encodeLocation(C.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?p:Tn([p,a.encodeLocation?a.encodeLocation(C.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:C.pathnameBase])})),o,t,i,s);return e&&x?B.createElement(yo.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},x):x}function yA(){let l=TA(),e=uA(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),t=l instanceof Error?l.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},a={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",l),o=B.createElement(B.Fragment,null,B.createElement("p",null," Hey developer "),B.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",B.createElement("code",{style:a},"ErrorBoundary")," or"," ",B.createElement("code",{style:a},"errorElement")," prop on your route.")),B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},e),t?B.createElement("pre",{style:s},t):null,o)}var bA=B.createElement(yA,null),vA=class extends B.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,e){return e.location!==l.location||e.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:e.error,location:e.location,revalidation:l.revalidation||e.revalidation}}componentDidCatch(l,e){this.props.onError?this.props.onError(l,e):console.error("React Router caught the following error during render",l)}render(){return this.state.error!==void 0?B.createElement(Rn.Provider,{value:this.props.routeContext},B.createElement(Mf.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function wA({routeContext:l,match:e,children:t}){let i=B.useContext(Xr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),B.createElement(Rn.Provider,{value:l},t)}function _A(l,e=[],t=null,i=null,s=null){if(l==null){if(!t)return null;if(t.errors)l=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)l=t.matches;else return null}let a=l,o=t?.errors;if(o!=null){let p=a.findIndex(m=>m.route.id&&o?.[m.route.id]!==void 0);rt(p>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,p+1))}let u=!1,d=-1;if(t)for(let p=0;p<a.length;p++){let m=a[p];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(d=p),m.route.id){let{loaderData:b,errors:v}=t,S=m.route.loader&&!b.hasOwnProperty(m.route.id)&&(!v||v[m.route.id]===void 0);if(m.route.lazy||S){u=!0,d>=0?a=a.slice(0,d+1):a=[a[0]];break}}}let f=t&&i?(p,m)=>{i(p,{location:t.location,params:t.matches?.[0]?.params??{},errorInfo:m})}:void 0;return a.reduceRight((p,m,b)=>{let v,S=!1,w=null,E=null;t&&(v=o&&m.route.id?o[m.route.id]:void 0,w=m.route.errorElement||bA,u&&(d<0&&b===0?(gv("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,E=null):d===b&&(S=!0,E=m.route.hydrateFallbackElement||null)));let x=e.concat(a.slice(0,b+1)),C=()=>{let T;return v?T=w:S?T=E:m.route.Component?T=B.createElement(m.route.Component,null):m.route.element?T=m.route.element:T=p,B.createElement(wA,{match:m,routeContext:{outlet:p,matches:x,isDataRoute:t!=null},children:T})};return t&&(m.route.ErrorBoundary||m.route.errorElement||b===0)?B.createElement(vA,{location:t.location,revalidation:t.revalidation,component:w,error:v,children:C(),routeContext:{outlet:null,matches:x,isDataRoute:!0},onError:f}):C()},null)}function Nf(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function SA(l){let e=B.useContext(Xr);return rt(e,Nf(l)),e}function AA(l){let e=B.useContext(Oc);return rt(e,Nf(l)),e}function EA(l){let e=B.useContext(Rn);return rt(e,Nf(l)),e}function Lf(l){let e=EA(l),t=e.matches[e.matches.length-1];return rt(t.route.id,`${l} can only be used on routes that contain a unique "id"`),t.route.id}function xA(){return Lf("useRouteId")}function TA(){let l=B.useContext(Mf),e=AA("useRouteError"),t=Lf("useRouteError");return l!==void 0?l:e.errors?.[t]}function CA(){let{router:l}=SA("useNavigate"),e=Lf("useNavigate"),t=B.useRef(!1);return fv(()=>{t.current=!0}),B.useCallback(async(s,a={})=>{Di(t.current,dv),t.current&&(typeof s=="number"?l.navigate(s):await l.navigate(s,{fromRouteId:e,...a}))},[l,e])}var T0={};function gv(l,e,t){!e&&!T0[l]&&(T0[l]=!0,Di(!1,t))}B.memo(RA);function RA({routes:l,future:e,state:t,unstable_onError:i}){return pv(l,void 0,t,i,e)}function wn(l){rt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function kA({basename:l="/",children:e=null,location:t,navigationType:i="POP",navigator:s,static:a=!1}){rt(!bo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=l.replace(/^\/*/,"/"),u=B.useMemo(()=>({basename:o,navigator:s,static:a,future:{}}),[o,s,a]);typeof t=="string"&&(t=Wr(t));let{pathname:d="/",search:f="",hash:p="",state:m=null,key:b="default"}=t,v=B.useMemo(()=>{let S=Cn(d,o);return S==null?null:{location:{pathname:S,search:f,hash:p,state:m,key:b},navigationType:i}},[o,d,f,p,m,b,i]);return Di(v!=null,`<Router basename="${o}"> is not able to match the URL "${d}${f}${p}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:B.createElement(Qi.Provider,{value:u},B.createElement(yo.Provider,{children:e,value:v}))}function OA({children:l,location:e}){return mA(ef(l),e)}function ef(l,e=[]){let t=[];return B.Children.forEach(l,(i,s)=>{if(!B.isValidElement(i))return;let a=[...e,s];if(i.type===B.Fragment){t.push.apply(t,ef(i.props.children,a));return}rt(i.type===wn,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),rt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||a.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=ef(i.props.children,a)),t.push(o)}),t}var dc="get",fc="application/x-www-form-urlencoded";function Dc(l){return l!=null&&typeof l.tagName=="string"}function DA(l){return Dc(l)&&l.tagName.toLowerCase()==="button"}function MA(l){return Dc(l)&&l.tagName.toLowerCase()==="form"}function NA(l){return Dc(l)&&l.tagName.toLowerCase()==="input"}function LA(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function PA(l,e){return l.button===0&&(!e||e==="_self")&&!LA(l)}function tf(l=""){return new URLSearchParams(typeof l=="string"||Array.isArray(l)||l instanceof URLSearchParams?l:Object.keys(l).reduce((e,t)=>{let i=l[t];return e.concat(Array.isArray(i)?i.map(s=>[t,s]):[[t,i]])},[]))}function jA(l,e){let t=tf(l);return e&&e.forEach((i,s)=>{t.has(s)||e.getAll(s).forEach(a=>{t.append(s,a)})}),t}var Gl=null;function IA(){if(Gl===null)try{new FormData(document.createElement("form"),0),Gl=!1}catch{Gl=!0}return Gl}var BA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function fd(l){return l!=null&&!BA.has(l)?(Di(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${fc}"`),null):l}function UA(l,e){let t,i,s,a,o;if(MA(l)){let u=l.getAttribute("action");i=u?Cn(u,e):null,t=l.getAttribute("method")||dc,s=fd(l.getAttribute("enctype"))||fc,a=new FormData(l)}else if(DA(l)||NA(l)&&(l.type==="submit"||l.type==="image")){let u=l.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=l.getAttribute("formaction")||u.getAttribute("action");if(i=d?Cn(d,e):null,t=l.getAttribute("formmethod")||u.getAttribute("method")||dc,s=fd(l.getAttribute("formenctype"))||fd(u.getAttribute("enctype"))||fc,a=new FormData(u,l),!IA()){let{name:f,type:p,value:m}=l;if(p==="image"){let b=f?`${f}.`:"";a.append(`${b}x`,"0"),a.append(`${b}y`,"0")}else f&&a.append(f,m)}}else{if(Dc(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=dc,i=null,s=fc,o=l}return a&&s==="text/plain"&&(o=a,a=void 0),{action:i,method:t.toLowerCase(),encType:s,formData:a,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Pf(l,e){if(l===!1||l===null||typeof l>"u")throw new Error(e)}function FA(l,e,t){let i=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&Cn(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function zA(l,e){if(l.id in e)return e[l.id];try{let t=await import(l.module);return e[l.id]=t,t}catch(t){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function HA(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function qA(l,e,t){let i=await Promise.all(l.map(async s=>{let a=e.routes[s.route.id];if(a){let o=await zA(a,t);return o.links?o.links():[]}return[]}));return YA(i.flat(1).filter(HA).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function C0(l,e,t,i,s,a){let o=(d,f)=>t[f]?d.route.id!==t[f].route.id:!0,u=(d,f)=>t[f].pathname!==d.pathname||t[f].route.path?.endsWith("*")&&t[f].params["*"]!==d.params["*"];return a==="assets"?e.filter((d,f)=>o(d,f)||u(d,f)):a==="data"?e.filter((d,f)=>{let p=i.routes[d.route.id];if(!p||!p.hasLoader)return!1;if(o(d,f)||u(d,f))return!0;if(d.route.shouldRevalidate){let m=d.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(l,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function $A(l,e,{includeHydrateFallback:t}={}){return GA(l.map(i=>{let s=e.routes[i.route.id];if(!s)return[];let a=[s.module];return s.clientActionModule&&(a=a.concat(s.clientActionModule)),s.clientLoaderModule&&(a=a.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(a=a.concat(s.hydrateFallbackModule)),s.imports&&(a=a.concat(s.imports)),a}).flat(1))}function GA(l){return[...new Set(l)]}function VA(l){let e={},t=Object.keys(l).sort();for(let i of t)e[i]=l[i];return e}function YA(l,e){let t=new Set;return new Set(e),l.reduce((i,s)=>{let a=JSON.stringify(VA(s));return t.has(a)||(t.add(a),i.push({key:a,link:s})),i},[])}function mv(){let l=B.useContext(Xr);return Pf(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function WA(){let l=B.useContext(Oc);return Pf(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var jf=B.createContext(void 0);jf.displayName="FrameworkContext";function yv(){let l=B.useContext(jf);return Pf(l,"You must render this element inside a <HydratedRouter> element"),l}function XA(l,e){let t=B.useContext(jf),[i,s]=B.useState(!1),[a,o]=B.useState(!1),{onFocus:u,onBlur:d,onMouseEnter:f,onMouseLeave:p,onTouchStart:m}=e,b=B.useRef(null);B.useEffect(()=>{if(l==="render"&&o(!0),l==="viewport"){let w=x=>{x.forEach(C=>{o(C.isIntersecting)})},E=new IntersectionObserver(w,{threshold:.5});return b.current&&E.observe(b.current),()=>{E.disconnect()}}},[l]),B.useEffect(()=>{if(i){let w=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(w)}}},[i]);let v=()=>{s(!0)},S=()=>{s(!1),o(!1)};return t?l!=="intent"?[a,b,{}]:[a,b,{onFocus:Va(u,v),onBlur:Va(d,S),onMouseEnter:Va(f,v),onMouseLeave:Va(p,S),onTouchStart:Va(m,v)}]:[!1,b,{}]}function Va(l,e){return t=>{l&&l(t),t.defaultPrevented||e(t)}}function KA({page:l,...e}){let{router:t}=mv(),i=B.useMemo(()=>rv(t.routes,l,t.basename),[t.routes,l,t.basename]);return i?B.createElement(JA,{page:l,matches:i,...e}):null}function QA(l){let{manifest:e,routeModules:t}=yv(),[i,s]=B.useState([]);return B.useEffect(()=>{let a=!1;return qA(l,e,t).then(o=>{a||s(o)}),()=>{a=!0}},[l,e,t]),i}function JA({page:l,matches:e,...t}){let i=Ji(),{manifest:s,routeModules:a}=yv(),{basename:o}=mv(),{loaderData:u,matches:d}=WA(),f=B.useMemo(()=>C0(l,e,d,s,i,"data"),[l,e,d,s,i]),p=B.useMemo(()=>C0(l,e,d,s,i,"assets"),[l,e,d,s,i]),m=B.useMemo(()=>{if(l===i.pathname+i.search+i.hash)return[];let S=new Set,w=!1;if(e.forEach(x=>{let C=s.routes[x.route.id];!C||!C.hasLoader||(!f.some(T=>T.route.id===x.route.id)&&x.route.id in u&&a[x.route.id]?.shouldRevalidate||C.hasClientLoader?w=!0:S.add(x.route.id))}),S.size===0)return[];let E=FA(l,o,"data");return w&&S.size>0&&E.searchParams.set("_routes",e.filter(x=>S.has(x.route.id)).map(x=>x.route.id).join(",")),[E.pathname+E.search]},[o,u,i,s,f,e,l,a]),b=B.useMemo(()=>$A(p,s),[p,s]),v=QA(p);return B.createElement(B.Fragment,null,m.map(S=>B.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...t})),b.map(S=>B.createElement("link",{key:S,rel:"modulepreload",href:S,...t})),v.map(({key:S,link:w})=>B.createElement("link",{key:S,nonce:t.nonce,...w})))}function ZA(...l){return e=>{l.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var bv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{bv&&(window.__reactRouterVersion="7.9.6")}catch{}function eE({basename:l,children:e,window:t}){let i=B.useRef();i.current==null&&(i.current=F1({window:t,v5Compat:!0}));let s=i.current,[a,o]=B.useState({action:s.action,location:s.location}),u=B.useCallback(d=>{B.startTransition(()=>o(d))},[o]);return B.useLayoutEffect(()=>s.listen(u),[s,u]),B.createElement(kA,{basename:l,children:e,location:a.location,navigationType:a.action,navigator:s})}var vv=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,wv=B.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:s,reloadDocument:a,replace:o,state:u,target:d,to:f,preventScrollReset:p,viewTransition:m,...b},v){let{basename:S}=B.useContext(Qi),w=typeof f=="string"&&vv.test(f),E,x=!1;if(typeof f=="string"&&w&&(E=f,bv))try{let H=new URL(window.location.href),ne=f.startsWith("//")?new URL(H.protocol+f):new URL(f),ie=Cn(ne.pathname,S);ne.origin===H.origin&&ie!=null?f=ie+ne.search+ne.hash:x=!0}catch{Di(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let C=pA(f,{relative:s}),[T,D,M]=XA(i,b),N=sE(f,{replace:o,state:u,target:d,preventScrollReset:p,relative:s,viewTransition:m});function k(H){e&&e(H),H.defaultPrevented||N(H)}let z=B.createElement("a",{...b,...M,href:E||C,onClick:x||a?e:k,ref:ZA(v,D),target:d,"data-discover":!w&&t==="render"?"true":void 0});return T&&!w?B.createElement(B.Fragment,null,z,B.createElement(KA,{page:C})):z});wv.displayName="Link";var tE=B.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:s=!1,style:a,to:o,viewTransition:u,children:d,...f},p){let m=vo(o,{relative:f.relative}),b=Ji(),v=B.useContext(Oc),{navigator:S,basename:w}=B.useContext(Qi),E=v!=null&&uE(m)&&u===!0,x=S.encodeLocation?S.encodeLocation(m).pathname:m.pathname,C=b.pathname,T=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(C=C.toLowerCase(),T=T?T.toLowerCase():null,x=x.toLowerCase()),T&&w&&(T=Cn(T,w)||T);const D=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let M=C===x||!s&&C.startsWith(x)&&C.charAt(D)==="/",N=T!=null&&(T===x||!s&&T.startsWith(x)&&T.charAt(x.length)==="/"),k={isActive:M,isPending:N,isTransitioning:E},z=M?e:void 0,H;typeof i=="function"?H=i(k):H=[i,M?"active":null,N?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let ne=typeof a=="function"?a(k):a;return B.createElement(wv,{...f,"aria-current":z,className:H,ref:p,style:ne,to:o,viewTransition:u},typeof d=="function"?d(k):d)});tE.displayName="NavLink";var iE=B.forwardRef(({discover:l="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:s,state:a,method:o=dc,action:u,onSubmit:d,relative:f,preventScrollReset:p,viewTransition:m,...b},v)=>{let S=lE(),w=cE(u,{relative:f}),E=o.toLowerCase()==="get"?"get":"post",x=typeof u=="string"&&vv.test(u),C=T=>{if(d&&d(T),T.defaultPrevented)return;T.preventDefault();let D=T.nativeEvent.submitter,M=D?.getAttribute("formmethod")||o;S(D||T.currentTarget,{fetcherKey:e,method:M,navigate:t,replace:s,state:a,relative:f,preventScrollReset:p,viewTransition:m})};return B.createElement("form",{ref:v,method:E,action:w,onSubmit:i?d:C,...b,"data-discover":!x&&l==="render"?"true":void 0})});iE.displayName="Form";function nE(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _v(l){let e=B.useContext(Xr);return rt(e,nE(l)),e}function sE(l,{target:e,replace:t,state:i,preventScrollReset:s,relative:a,viewTransition:o}={}){let u=Zi(),d=Ji(),f=vo(l,{relative:a});return B.useCallback(p=>{if(PA(p,e)){p.preventDefault();let m=t!==void 0?t:oo(d)===oo(f);u(l,{replace:m,state:i,preventScrollReset:s,relative:a,viewTransition:o})}},[d,u,f,t,i,e,l,s,a,o])}function rE(l){Di(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=B.useRef(tf(l)),t=B.useRef(!1),i=Ji(),s=B.useMemo(()=>jA(i.search,t.current?null:e.current),[i.search]),a=Zi(),o=B.useCallback((u,d)=>{const f=tf(typeof u=="function"?u(new URLSearchParams(s)):u);t.current=!0,a("?"+f,d)},[a,s]);return[s,o]}var aE=0,oE=()=>`__${String(++aE)}__`;function lE(){let{router:l}=_v("useSubmit"),{basename:e}=B.useContext(Qi),t=xA();return B.useCallback(async(i,s={})=>{let{action:a,method:o,encType:u,formData:d,body:f}=UA(i,e);if(s.navigate===!1){let p=s.fetcherKey||oE();await l.fetch(p,t,s.action||a,{preventScrollReset:s.preventScrollReset,formData:d,body:f,formMethod:s.method||o,formEncType:s.encType||u,flushSync:s.flushSync})}else await l.navigate(s.action||a,{preventScrollReset:s.preventScrollReset,formData:d,body:f,formMethod:s.method||o,formEncType:s.encType||u,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[l,e,t])}function cE(l,{relative:e}={}){let{basename:t}=B.useContext(Qi),i=B.useContext(Rn);rt(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),a={...vo(l||".",{relative:e})},o=Ji();if(l==null){a.search=o.search;let u=new URLSearchParams(a.search),d=u.getAll("index");if(d.some(p=>p==="")){u.delete("index"),d.filter(m=>m).forEach(m=>u.append("index",m));let p=u.toString();a.search=p?`?${p}`:""}}return(!l||l===".")&&s.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Tn([t,a.pathname])),oo(a)}function uE(l,{relative:e}={}){let t=B.useContext(hv);rt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=_v("useViewTransitionState"),s=vo(l,{relative:e});if(!t.isTransitioning)return!1;let a=Cn(t.currentLocation.pathname,i)||t.currentLocation.pathname,o=Cn(t.nextLocation.pathname,i)||t.nextLocation.pathname;return bc(s.pathname,o)!=null||bc(s.pathname,a)!=null}function hE(){const l=Zi(),e=t=>{t.preventDefault(),alert("Submission sent"),t.target.reset()};return _.jsxs("div",{className:"contact-page",children:[_.jsx("button",{className:"back-button",onClick:()=>l("/"),children:" Back to Home"}),_.jsxs("div",{className:"contact-container",children:[_.jsx("h1",{className:"contact-title",children:"Get in Touch"}),_.jsx("p",{className:"contact-subtitle",children:"We'd love to hear from you"}),_.jsxs("div",{className:"contact-content",children:[_.jsxs("div",{className:"contact-info",children:[_.jsx("h2",{children:"Contact Information"}),_.jsxs("div",{className:"info-item",children:[_.jsx("div",{className:"info-label",children:"Phone"}),_.jsx("a",{href:"tel:5103626544",className:"info-value",children:"(510) 362-6544"})]}),_.jsxs("div",{className:"info-item",children:[_.jsx("div",{className:"info-label",children:"Email"}),_.jsx("a",{href:"mailto:ammacare@gmail.com",className:"info-value",children:"ammacare@gmail.com"})]})]}),_.jsxs("form",{className:"contact-form",onSubmit:e,children:[_.jsx("h2",{children:"Send us a message"}),_.jsx("input",{type:"text",placeholder:"Name",className:"contact-input",required:!0}),_.jsx("input",{type:"email",placeholder:"Email",className:"contact-input",required:!0}),_.jsx("input",{type:"text",placeholder:"Subject",className:"contact-input",required:!0}),_.jsx("textarea",{placeholder:"Message",rows:"5",className:"contact-textarea",required:!0}),_.jsx("button",{type:"submit",className:"contact-submit",children:"Submit"})]})]})]})]})}function dE(l={}){const{nonce:e,onScriptLoadSuccess:t,onScriptLoadError:i}=l,[s,a]=B.useState(!1),o=B.useRef(t);o.current=t;const u=B.useRef(i);return u.current=i,B.useEffect(()=>{const d=document.createElement("script");return d.src="https://accounts.google.com/gsi/client",d.async=!0,d.defer=!0,d.nonce=e,d.onload=()=>{var f;a(!0),(f=o.current)===null||f===void 0||f.call(o)},d.onerror=()=>{var f;a(!1),(f=u.current)===null||f===void 0||f.call(u)},document.body.appendChild(d),()=>{document.body.removeChild(d)}},[e]),s}const Sv=B.createContext(null);function fE({clientId:l,nonce:e,onScriptLoadSuccess:t,onScriptLoadError:i,children:s}){const a=dE({nonce:e,onScriptLoadSuccess:t,onScriptLoadError:i}),o=B.useMemo(()=>({clientId:l,scriptLoadedSuccessfully:a}),[l,a]);return xn.createElement(Sv.Provider,{value:o},s)}function pE(){const l=B.useContext(Sv);if(!l)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return l}function gE(l){var e;return(e=l?.clientId)!==null&&e!==void 0?e:l?.client_id}const mE={large:40,medium:32,small:20};function R0({onSuccess:l,onError:e,useOneTap:t,promptMomentNotification:i,type:s="standard",theme:a="outline",size:o="large",text:u,shape:d,logo_alignment:f,width:p,locale:m,click_listener:b,containerProps:v,...S}){const w=B.useRef(null),{clientId:E,scriptLoadedSuccessfully:x}=pE(),C=B.useRef(l);C.current=l;const T=B.useRef(e);T.current=e;const D=B.useRef(i);return D.current=i,B.useEffect(()=>{var M,N,k,z,H,ne,ie,ce,ge;if(x)return(k=(N=(M=window?.google)===null||M===void 0?void 0:M.accounts)===null||N===void 0?void 0:N.id)===null||k===void 0||k.initialize({client_id:E,callback:le=>{var ue;if(!le?.credential)return(ue=T.current)===null||ue===void 0?void 0:ue.call(T);const{credential:j,select_by:J}=le;C.current({credential:j,clientId:gE(le),select_by:J})},...S}),(ne=(H=(z=window?.google)===null||z===void 0?void 0:z.accounts)===null||H===void 0?void 0:H.id)===null||ne===void 0||ne.renderButton(w.current,{type:s,theme:a,size:o,text:u,shape:d,logo_alignment:f,width:p,locale:m,click_listener:b}),t&&((ge=(ce=(ie=window?.google)===null||ie===void 0?void 0:ie.accounts)===null||ce===void 0?void 0:ce.id)===null||ge===void 0||ge.prompt(D.current)),()=>{var le,ue,j;t&&((j=(ue=(le=window?.google)===null||le===void 0?void 0:le.accounts)===null||ue===void 0?void 0:ue.id)===null||j===void 0||j.cancel())}},[E,x,t,s,a,o,u,d,f,p,m]),xn.createElement("div",{...v,ref:w,style:{height:mE[o],...v?.style}})}class Za extends Error{}Za.prototype.name="InvalidTokenError";function yE(l){return decodeURIComponent(atob(l).replace(/(.)/g,(e,t)=>{let i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function bE(l){let e=l.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return yE(e)}catch{return atob(e)}}function k0(l,e){if(typeof l!="string")throw new Za("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,i=l.split(".")[t];if(typeof i!="string")throw new Za(`Invalid token specified: missing part #${t+1}`);let s;try{s=bE(i)}catch(a){throw new Za(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(s)}catch(a){throw new Za(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}var nf=function(l,e){return nf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},nf(l,e)};function Av(l,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");nf(l,e);function t(){this.constructor=l}l.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vc=function(){return vc=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++){t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},vc.apply(this,arguments)};function Kr(l,e){var t={};for(var i in l)Object.prototype.hasOwnProperty.call(l,i)&&e.indexOf(i)<0&&(t[i]=l[i]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(l);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(l,i[s])&&(t[i[s]]=l[i[s]]);return t}function Ev(l,e,t,i){var s=arguments.length,a=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(l,e,t,i);else for(var u=l.length-1;u>=0;u--)(o=l[u])&&(a=(s<3?o(a):s>3?o(e,t,a):o(e,t))||a);return s>3&&a&&Object.defineProperty(e,t,a),a}function xv(l,e){return function(t,i){e(t,i,l)}}function Tv(l,e,t,i,s,a){function o(x){if(x!==void 0&&typeof x!="function")throw new TypeError("Function expected");return x}for(var u=i.kind,d=u==="getter"?"get":u==="setter"?"set":"value",f=!e&&l?i.static?l:l.prototype:null,p=e||(f?Object.getOwnPropertyDescriptor(f,i.name):{}),m,b=!1,v=t.length-1;v>=0;v--){var S={};for(var w in i)S[w]=w==="access"?{}:i[w];for(var w in i.access)S.access[w]=i.access[w];S.addInitializer=function(x){if(b)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(x||null))};var E=(0,t[v])(u==="accessor"?{get:p.get,set:p.set}:p[d],S);if(u==="accessor"){if(E===void 0)continue;if(E===null||typeof E!="object")throw new TypeError("Object expected");(m=o(E.get))&&(p.get=m),(m=o(E.set))&&(p.set=m),(m=o(E.init))&&s.unshift(m)}else(m=o(E))&&(u==="field"?s.unshift(m):p[d]=m)}f&&Object.defineProperty(f,i.name,p),b=!0}function Cv(l,e,t){for(var i=arguments.length>2,s=0;s<e.length;s++)t=i?e[s].call(l,t):e[s].call(l);return i?t:void 0}function Rv(l){return typeof l=="symbol"?l:"".concat(l)}function kv(l,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(l,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function Ov(l,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,e)}function ye(l,e,t,i){function s(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function u(p){try{f(i.next(p))}catch(m){o(m)}}function d(p){try{f(i.throw(p))}catch(m){o(m)}}function f(p){p.done?a(p.value):s(p.value).then(u,d)}f((i=i.apply(l,e||[])).next())})}function Dv(l,e){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,s,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(f){return function(p){return d([f,p])}}function d(f){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,f[0]&&(t=0)),t;)try{if(i=1,s&&(a=f[0]&2?s.return:f[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,f[1])).done)return a;switch(s=0,a&&(f=[f[0]&2,a.value]),f[0]){case 0:case 1:a=f;break;case 4:return t.label++,{value:f[1],done:!1};case 5:t.label++,s=f[1],f=[0];continue;case 7:f=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(f[0]===6||f[0]===2)){t=0;continue}if(f[0]===3&&(!a||f[1]>a[0]&&f[1]<a[3])){t.label=f[1];break}if(f[0]===6&&t.label<a[1]){t.label=a[1],a=f;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(f);break}a[2]&&t.ops.pop(),t.trys.pop();continue}f=e.call(l,t)}catch(p){f=[6,p],s=0}finally{i=a=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}var Mc=Object.create?(function(l,e,t,i){i===void 0&&(i=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(l,i,s)}):(function(l,e,t,i){i===void 0&&(i=t),l[i]=e[t]});function Mv(l,e){for(var t in l)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Mc(e,l,t)}function wc(l){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&l[e],i=0;if(t)return t.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&i>=l.length&&(l=void 0),{value:l&&l[i++],done:!l}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function If(l,e){var t=typeof Symbol=="function"&&l[Symbol.iterator];if(!t)return l;var i=t.call(l),s,a=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)a.push(s.value)}catch(u){o={error:u}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return a}function Nv(){for(var l=[],e=0;e<arguments.length;e++)l=l.concat(If(arguments[e]));return l}function Lv(){for(var l=0,e=0,t=arguments.length;e<t;e++)l+=arguments[e].length;for(var i=Array(l),s=0,e=0;e<t;e++)for(var a=arguments[e],o=0,u=a.length;o<u;o++,s++)i[s]=a[o];return i}function Pv(l,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,a;i<s;i++)(a||!(i in e))&&(a||(a=Array.prototype.slice.call(e,0,i)),a[i]=e[i]);return l.concat(a||Array.prototype.slice.call(e))}function Vr(l){return this instanceof Vr?(this.v=l,this):new Vr(l)}function jv(l,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(l,e||[]),s,a=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(v){return function(S){return Promise.resolve(S).then(v,m)}}function u(v,S){i[v]&&(s[v]=function(w){return new Promise(function(E,x){a.push([v,w,E,x])>1||d(v,w)})},S&&(s[v]=S(s[v])))}function d(v,S){try{f(i[v](S))}catch(w){b(a[0][3],w)}}function f(v){v.value instanceof Vr?Promise.resolve(v.value.v).then(p,m):b(a[0][2],v)}function p(v){d("next",v)}function m(v){d("throw",v)}function b(v,S){v(S),a.shift(),a.length&&d(a[0][0],a[0][1])}}function Iv(l){var e,t;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,a){e[s]=l[s]?function(o){return(t=!t)?{value:Vr(l[s](o)),done:!1}:a?a(o):o}:a}}function Bv(l){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=l[Symbol.asyncIterator],t;return e?e.call(l):(l=typeof wc=="function"?wc(l):l[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(a){t[a]=l[a]&&function(o){return new Promise(function(u,d){o=l[a](o),s(u,d,o.done,o.value)})}}function s(a,o,u,d){Promise.resolve(d).then(function(f){a({value:f,done:u})},o)}}function Uv(l,e){return Object.defineProperty?Object.defineProperty(l,"raw",{value:e}):l.raw=e,l}var vE=Object.create?(function(l,e){Object.defineProperty(l,"default",{enumerable:!0,value:e})}):function(l,e){l.default=e},sf=function(l){return sf=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},sf(l)};function Fv(l){if(l&&l.__esModule)return l;var e={};if(l!=null)for(var t=sf(l),i=0;i<t.length;i++)t[i]!=="default"&&Mc(e,l,t[i]);return vE(e,l),e}function zv(l){return l&&l.__esModule?l:{default:l}}function Hv(l,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?l!==e||!i:!e.has(l))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(l):i?i.value:e.get(l)}function qv(l,e,t,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?l!==e||!s:!e.has(l))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(l,t):s?s.value=t:e.set(l,t),t}function $v(l,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof l=="function"?e===l:l.has(e)}function Gv(l,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");i=e[Symbol.asyncDispose]}if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose],t&&(s=i)}if(typeof i!="function")throw new TypeError("Object not disposable.");s&&(i=function(){try{s.call(this)}catch(a){return Promise.reject(a)}}),l.stack.push({value:e,dispose:i,async:t})}else t&&l.stack.push({async:!0});return e}var wE=typeof SuppressedError=="function"?SuppressedError:function(l,e,t){var i=new Error(t);return i.name="SuppressedError",i.error=l,i.suppressed=e,i};function Vv(l){function e(a){l.error=l.hasError?new wE(a,l.error,"An error was suppressed during disposal."):a,l.hasError=!0}var t,i=0;function s(){for(;t=l.stack.pop();)try{if(!t.async&&i===1)return i=0,l.stack.push(t),Promise.resolve().then(s);if(t.dispose){var a=t.dispose.call(t.value);if(t.async)return i|=2,Promise.resolve(a).then(s,function(o){return e(o),s()})}else i|=1}catch(o){e(o)}if(i===1)return l.hasError?Promise.reject(l.error):Promise.resolve();if(l.hasError)throw l.error}return s()}function Yv(l,e){return typeof l=="string"&&/^\.\.?\//.test(l)?l.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,i,s,a,o){return i?e?".jsx":".js":s&&(!a||!o)?t:s+a+"."+o.toLowerCase()+"js"}):l}const _E={__extends:Av,__assign:vc,__rest:Kr,__decorate:Ev,__param:xv,__esDecorate:Tv,__runInitializers:Cv,__propKey:Rv,__setFunctionName:kv,__metadata:Ov,__awaiter:ye,__generator:Dv,__createBinding:Mc,__exportStar:Mv,__values:wc,__read:If,__spread:Nv,__spreadArrays:Lv,__spreadArray:Pv,__await:Vr,__asyncGenerator:jv,__asyncDelegator:Iv,__asyncValues:Bv,__makeTemplateObject:Uv,__importStar:Fv,__importDefault:zv,__classPrivateFieldGet:Hv,__classPrivateFieldSet:qv,__classPrivateFieldIn:$v,__addDisposableResource:Gv,__disposeResources:Vv,__rewriteRelativeImportExtension:Yv},SE=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Gv,get __assign(){return vc},__asyncDelegator:Iv,__asyncGenerator:jv,__asyncValues:Bv,__await:Vr,__awaiter:ye,__classPrivateFieldGet:Hv,__classPrivateFieldIn:$v,__classPrivateFieldSet:qv,__createBinding:Mc,__decorate:Ev,__disposeResources:Vv,__esDecorate:Tv,__exportStar:Mv,__extends:Av,__generator:Dv,__importDefault:zv,__importStar:Fv,__makeTemplateObject:Uv,__metadata:Ov,__param:xv,__propKey:Rv,__read:If,__rest:Kr,__rewriteRelativeImportExtension:Yv,__runInitializers:Cv,__setFunctionName:kv,__spread:Nv,__spreadArray:Pv,__spreadArrays:Lv,__values:wc,default:_E},Symbol.toStringTag,{value:"Module"})),AE=l=>l?(...e)=>l(...e):(...e)=>fetch(...e);class Bf extends Error{constructor(e,t="FunctionsError",i){super(e),this.name=t,this.context=i}}class EE extends Bf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class O0 extends Bf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class D0 extends Bf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var rf;(function(l){l.Any="any",l.ApNortheast1="ap-northeast-1",l.ApNortheast2="ap-northeast-2",l.ApSouth1="ap-south-1",l.ApSoutheast1="ap-southeast-1",l.ApSoutheast2="ap-southeast-2",l.CaCentral1="ca-central-1",l.EuCentral1="eu-central-1",l.EuWest1="eu-west-1",l.EuWest2="eu-west-2",l.EuWest3="eu-west-3",l.SaEast1="sa-east-1",l.UsEast1="us-east-1",l.UsWest1="us-west-1",l.UsWest2="us-west-2"})(rf||(rf={}));class xE{constructor(e,{headers:t={},customFetch:i,region:s=rf.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=AE(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return ye(this,arguments,void 0,function*(t,i={}){var s;let a,o;try{const{headers:u,method:d,body:f,signal:p,timeout:m}=i;let b={},{region:v}=i;v||(v=this.region);const S=new URL(`${this.url}/${t}`);v&&v!=="any"&&(b["x-region"]=v,S.searchParams.set("forceFunctionRegion",v));let w;f&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&f instanceof Blob||f instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",w=f):typeof f=="string"?(b["Content-Type"]="text/plain",w=f):typeof FormData<"u"&&f instanceof FormData?w=f:(b["Content-Type"]="application/json",w=JSON.stringify(f)):w=f;let E=p;m&&(o=new AbortController,a=setTimeout(()=>o.abort(),m),p?(E=o.signal,p.addEventListener("abort",()=>o.abort())):E=o.signal);const x=yield this.fetch(S.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),u),body:w,signal:E}).catch(M=>{throw new EE(M)}),C=x.headers.get("x-relay-error");if(C&&C==="true")throw new O0(x);if(!x.ok)throw new D0(x);let T=((s=x.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),D;return T==="application/json"?D=yield x.json():T==="application/octet-stream"||T==="application/pdf"?D=yield x.blob():T==="text/event-stream"?D=x:T==="multipart/form-data"?D=yield x.formData():D=yield x.text(),{data:D,error:null,response:x}}catch(u){return{data:null,error:u,response:u instanceof D0||u instanceof O0?u.context:void 0}}finally{a&&clearTimeout(a)}})}}var Ft={};const Qr=k1(SE);var Vl={},Yl={},Wl={},Xl={},Kl={},Ql={},M0;function Wv(){if(M0)return Ql;M0=1,Object.defineProperty(Ql,"__esModule",{value:!0});class l extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Ql.default=l,Ql}var N0;function Xv(){if(N0)return Kl;N0=1,Object.defineProperty(Kl,"__esModule",{value:!0});const e=Qr.__importDefault(Wv());class t{constructor(s){var a,o;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(a=s.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=s.signal,this.isMaybeSingle=(o=s.isMaybeSingle)!==null&&o!==void 0?o:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,a){return this.headers=new Headers(this.headers),this.headers.set(s,a),this}then(s,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let u=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var f,p,m,b;let v=null,S=null,w=null,E=d.status,x=d.statusText;if(d.ok){if(this.method!=="HEAD"){const M=await d.text();M===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((f=this.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?S=M:S=JSON.parse(M))}const T=(p=this.headers.get("Prefer"))===null||p===void 0?void 0:p.match(/count=(exact|planned|estimated)/),D=(m=d.headers.get("content-range"))===null||m===void 0?void 0:m.split("/");T&&D&&D.length>1&&(w=parseInt(D[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(S)&&(S.length>1?(v={code:"PGRST116",details:`Results contain ${S.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},S=null,w=null,E=406,x="Not Acceptable"):S.length===1?S=S[0]:S=null)}else{const T=await d.text();try{v=JSON.parse(T),Array.isArray(v)&&d.status===404&&(S=[],v=null,E=200,x="OK")}catch{d.status===404&&T===""?(E=204,x="No Content"):v={message:T}}if(v&&this.isMaybeSingle&&(!((b=v?.details)===null||b===void 0)&&b.includes("0 rows"))&&(v=null,E=200,x="OK"),v&&this.shouldThrowOnError)throw new e.default(v)}return{error:v,data:S,count:w,status:E,statusText:x}});return this.shouldThrowOnError||(u=u.catch(d=>{var f,p,m;return{error:{message:`${(f=d?.name)!==null&&f!==void 0?f:"FetchError"}: ${d?.message}`,details:`${(p=d?.stack)!==null&&p!==void 0?p:""}`,hint:"",code:`${(m=d?.code)!==null&&m!==void 0?m:""}`},data:null,count:null,status:0,statusText:""}})),u.then(s,a)}returns(){return this}overrideTypes(){return this}}return Kl.default=t,Kl}var L0;function Kv(){if(L0)return Xl;L0=1,Object.defineProperty(Xl,"__esModule",{value:!0});const e=Qr.__importDefault(Xv());class t extends e.default{select(s){let a=!1;const o=(s??"*").split("").map(u=>/\s/.test(u)&&!a?"":(u==='"'&&(a=!a),u)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:a=!0,nullsFirst:o,foreignTable:u,referencedTable:d=u}={}){const f=d?`${d}.order`:"order",p=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${p?`${p},`:""}${s}.${a?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:a,referencedTable:o=a}={}){const u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(u,`${s}`),this}range(s,a,{foreignTable:o,referencedTable:u=o}={}){const d=typeof u>"u"?"offset":`${u}.offset`,f=typeof u>"u"?"limit":`${u}.limit`;return this.url.searchParams.set(d,`${s}`),this.url.searchParams.set(f,`${a-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:a=!1,settings:o=!1,buffers:u=!1,wal:d=!1,format:f="text"}={}){var p;const m=[s?"analyze":null,a?"verbose":null,o?"settings":null,u?"buffers":null,d?"wal":null].filter(Boolean).join("|"),b=(p=this.headers.get("Accept"))!==null&&p!==void 0?p:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${b}"; options=${m};`),f==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Xl.default=t,Xl}var P0;function Uf(){if(P0)return Wl;P0=1,Object.defineProperty(Wl,"__esModule",{value:!0});const e=Qr.__importDefault(Kv()),t=new RegExp("[,()]");class i extends e.default{eq(a,o){return this.url.searchParams.append(a,`eq.${o}`),this}neq(a,o){return this.url.searchParams.append(a,`neq.${o}`),this}gt(a,o){return this.url.searchParams.append(a,`gt.${o}`),this}gte(a,o){return this.url.searchParams.append(a,`gte.${o}`),this}lt(a,o){return this.url.searchParams.append(a,`lt.${o}`),this}lte(a,o){return this.url.searchParams.append(a,`lte.${o}`),this}like(a,o){return this.url.searchParams.append(a,`like.${o}`),this}likeAllOf(a,o){return this.url.searchParams.append(a,`like(all).{${o.join(",")}}`),this}likeAnyOf(a,o){return this.url.searchParams.append(a,`like(any).{${o.join(",")}}`),this}ilike(a,o){return this.url.searchParams.append(a,`ilike.${o}`),this}ilikeAllOf(a,o){return this.url.searchParams.append(a,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(a,o){return this.url.searchParams.append(a,`ilike(any).{${o.join(",")}}`),this}is(a,o){return this.url.searchParams.append(a,`is.${o}`),this}in(a,o){const u=Array.from(new Set(o)).map(d=>typeof d=="string"&&t.test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(a,`in.(${u})`),this}contains(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cs.{${o.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(o)}`),this}containedBy(a,o){return typeof o=="string"?this.url.searchParams.append(a,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(a,`cd.{${o.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(o)}`),this}rangeGt(a,o){return this.url.searchParams.append(a,`sr.${o}`),this}rangeGte(a,o){return this.url.searchParams.append(a,`nxl.${o}`),this}rangeLt(a,o){return this.url.searchParams.append(a,`sl.${o}`),this}rangeLte(a,o){return this.url.searchParams.append(a,`nxr.${o}`),this}rangeAdjacent(a,o){return this.url.searchParams.append(a,`adj.${o}`),this}overlaps(a,o){return typeof o=="string"?this.url.searchParams.append(a,`ov.${o}`):this.url.searchParams.append(a,`ov.{${o.join(",")}}`),this}textSearch(a,o,{config:u,type:d}={}){let f="";d==="plain"?f="pl":d==="phrase"?f="ph":d==="websearch"&&(f="w");const p=u===void 0?"":`(${u})`;return this.url.searchParams.append(a,`${f}fts${p}.${o}`),this}match(a){return Object.entries(a).forEach(([o,u])=>{this.url.searchParams.append(o,`eq.${u}`)}),this}not(a,o,u){return this.url.searchParams.append(a,`not.${o}.${u}`),this}or(a,{foreignTable:o,referencedTable:u=o}={}){const d=u?`${u}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,o,u){return this.url.searchParams.append(a,`${o}.${u}`),this}}return Wl.default=i,Wl}var j0;function Qv(){if(j0)return Yl;j0=1,Object.defineProperty(Yl,"__esModule",{value:!0});const e=Qr.__importDefault(Uf());class t{constructor(s,{headers:a={},schema:o,fetch:u}){this.url=s,this.headers=new Headers(a),this.schema=o,this.fetch=u}select(s,a){const{head:o=!1,count:u}=a??{},d=o?"HEAD":"GET";let f=!1;const p=(s??"*").split("").map(m=>/\s/.test(m)&&!f?"":(m==='"'&&(f=!f),m)).join("");return this.url.searchParams.set("select",p),u&&this.headers.append("Prefer",`count=${u}`),new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const f=s.reduce((p,m)=>p.concat(Object.keys(m)),[]);if(f.length>0){const p=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}upsert(s,{onConflict:a,ignoreDuplicates:o=!1,count:u,defaultToNull:d=!0}={}){var f;const p="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),a!==void 0&&this.url.searchParams.set("on_conflict",a),u&&this.headers.append("Prefer",`count=${u}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const m=s.reduce((b,v)=>b.concat(Object.keys(v)),[]);if(m.length>0){const b=[...new Set(m)].map(v=>`"${v}"`);this.url.searchParams.set("columns",b.join(","))}}return new e.default({method:p,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}update(s,{count:a}={}){var o;const u="PATCH";return a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:s}={}){var a;const o="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}}return Yl.default=t,Yl}var I0;function TE(){if(I0)return Vl;I0=1,Object.defineProperty(Vl,"__esModule",{value:!0});const l=Qr,e=l.__importDefault(Qv()),t=l.__importDefault(Uf());class i{constructor(a,{headers:o={},schema:u,fetch:d}={}){this.url=a,this.headers=new Headers(o),this.schemaName=u,this.fetch=d}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new i(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:u=!1,get:d=!1,count:f}={}){var p;let m;const b=new URL(`${this.url}/rpc/${a}`);let v;u||d?(m=u?"HEAD":"GET",Object.entries(o).filter(([w,E])=>E!==void 0).map(([w,E])=>[w,Array.isArray(E)?`{${E.join(",")}}`:`${E}`]).forEach(([w,E])=>{b.searchParams.append(w,E)})):(m="POST",v=o);const S=new Headers(this.headers);return f&&S.set("Prefer",`count=${f}`),new t.default({method:m,url:b,headers:S,schema:this.schemaName,body:v,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}}return Vl.default=i,Vl}var B0;function CE(){if(B0)return Ft;B0=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PostgrestError=Ft.PostgrestBuilder=Ft.PostgrestTransformBuilder=Ft.PostgrestFilterBuilder=Ft.PostgrestQueryBuilder=Ft.PostgrestClient=void 0;const l=Qr,e=l.__importDefault(TE());Ft.PostgrestClient=e.default;const t=l.__importDefault(Qv());Ft.PostgrestQueryBuilder=t.default;const i=l.__importDefault(Uf());Ft.PostgrestFilterBuilder=i.default;const s=l.__importDefault(Kv());Ft.PostgrestTransformBuilder=s.default;const a=l.__importDefault(Xv());Ft.PostgrestBuilder=a.default;const o=l.__importDefault(Wv());return Ft.PostgrestError=o.default,Ft.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:i.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:a.default,PostgrestError:o.default},Ft}var Jv=CE();const Zv=Of(Jv),RE=R1({__proto__:null,default:Zv},[Jv]),{PostgrestClient:kE,PostgrestQueryBuilder:KR,PostgrestFilterBuilder:QR,PostgrestTransformBuilder:JR,PostgrestBuilder:ZR,PostgrestError:ek}=Zv||RE;class OE{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const i=t.node,s=parseInt(i.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const i=this.getWebSocketConstructor();return new i(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const DE="2.81.1",ME=`realtime-js/${DE}`,ew="1.0.0",NE="2.0.0",U0=ew,af=1e4,LE=1e3,PE=100;var ks;(function(l){l[l.connecting=0]="connecting",l[l.open=1]="open",l[l.closing=2]="closing",l[l.closed=3]="closed"})(ks||(ks={}));var Et;(function(l){l.closed="closed",l.errored="errored",l.joined="joined",l.joining="joining",l.leaving="leaving"})(Et||(Et={}));var Oi;(function(l){l.close="phx_close",l.error="phx_error",l.join="phx_join",l.reply="phx_reply",l.leave="phx_leave",l.access_token="access_token"})(Oi||(Oi={}));var of;(function(l){l.websocket="websocket"})(of||(of={}));var Os;(function(l){l.Connecting="connecting",l.Open="open",l.Closing="closing",l.Closed="closed"})(Os||(Os={}));class jE{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(e,t){if(this._isArrayBuffer(e.payload))return t(this._binaryEncodePush(e));if(e.event===this.BROADCAST&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let i=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(i))}_binaryEncodePush(e){const{join_ref:t,ref:i,event:s,topic:a,payload:o}=e,u=this.META_LENGTH+t.length+i.length+a.length+s.length,d=new ArrayBuffer(this.HEADER_LENGTH+u);let f=new DataView(d),p=0;f.setUint8(p++,this.KINDS.push),f.setUint8(p++,t.length),f.setUint8(p++,i.length),f.setUint8(p++,a.length),f.setUint8(p++,s.length),Array.from(t,b=>f.setUint8(p++,b.charCodeAt(0))),Array.from(i,b=>f.setUint8(p++,b.charCodeAt(0))),Array.from(a,b=>f.setUint8(p++,b.charCodeAt(0))),Array.from(s,b=>f.setUint8(p++,b.charCodeAt(0)));var m=new Uint8Array(d.byteLength+o.byteLength);return m.set(new Uint8Array(d),0),m.set(new Uint8Array(o),d.byteLength),m.buffer}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,i;const{join_ref:s,ref:a,topic:o}=e,u=e.payload.event,d=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:new ArrayBuffer(0),f=this.USER_BROADCAST_PUSH_META_LENGTH+s.length+a.length+o.length+u.length,p=new ArrayBuffer(this.HEADER_LENGTH+f);let m=new DataView(p),b=0;m.setUint8(b++,this.KINDS.userBroadcastPush),m.setUint8(b++,s.length),m.setUint8(b++,a.length),m.setUint8(b++,o.length),m.setUint8(b++,u.length),m.setUint8(b++,this.BINARY_ENCODING),Array.from(s,S=>m.setUint8(b++,S.charCodeAt(0))),Array.from(a,S=>m.setUint8(b++,S.charCodeAt(0))),Array.from(o,S=>m.setUint8(b++,S.charCodeAt(0))),Array.from(u,S=>m.setUint8(b++,S.charCodeAt(0)));var v=new Uint8Array(p.byteLength+d.byteLength);return v.set(new Uint8Array(p),0),v.set(new Uint8Array(d),p.byteLength),v.buffer}_encodeJsonUserBroadcastPush(e){var t,i;const{join_ref:s,ref:a,topic:o}=e,u=e.payload.event,d=(i=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&i!==void 0?i:{},p=new TextEncoder().encode(JSON.stringify(d)).buffer,m=this.USER_BROADCAST_PUSH_META_LENGTH+s.length+a.length+o.length+u.length,b=new ArrayBuffer(this.HEADER_LENGTH+m);let v=new DataView(b),S=0;v.setUint8(S++,this.KINDS.userBroadcastPush),v.setUint8(S++,s.length),v.setUint8(S++,a.length),v.setUint8(S++,o.length),v.setUint8(S++,u.length),v.setUint8(S++,this.JSON_ENCODING),Array.from(s,E=>v.setUint8(S++,E.charCodeAt(0))),Array.from(a,E=>v.setUint8(S++,E.charCodeAt(0))),Array.from(o,E=>v.setUint8(S++,E.charCodeAt(0))),Array.from(u,E=>v.setUint8(S++,E.charCodeAt(0)));var w=new Uint8Array(b.byteLength+p.byteLength);return w.set(new Uint8Array(b),0),w.set(new Uint8Array(p),b.byteLength),w.buffer}decode(e,t){if(this._isArrayBuffer(e)){let i=this._binaryDecode(e);return t(i)}if(typeof e=="string"){const i=JSON.parse(e),[s,a,o,u,d]=i;return t({join_ref:s,ref:a,topic:o,event:u,payload:d})}return t({})}_binaryDecode(e){const t=new DataView(e),i=t.getUint8(0),s=new TextDecoder;switch(i){case this.KINDS.push:return this._decodePush(e,t,s);case this.KINDS.reply:return this._decodeReply(e,t,s);case this.KINDS.broadcast:return this._decodeBroadcast(e,t,s);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodePush(e,t,i){const s=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3);let u=this.HEADER_LENGTH+this.META_LENGTH-1;const d=i.decode(e.slice(u,u+s));u=u+s;const f=i.decode(e.slice(u,u+a));u=u+a;const p=i.decode(e.slice(u,u+o));u=u+o;const m=JSON.parse(i.decode(e.slice(u,e.byteLength)));return{join_ref:d,ref:null,topic:f,event:p,payload:m}}_decodeReply(e,t,i){const s=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3),u=t.getUint8(4);let d=this.HEADER_LENGTH+this.META_LENGTH;const f=i.decode(e.slice(d,d+s));d=d+s;const p=i.decode(e.slice(d,d+a));d=d+a;const m=i.decode(e.slice(d,d+o));d=d+o;const b=i.decode(e.slice(d,d+u));d=d+u;const v=JSON.parse(i.decode(e.slice(d,e.byteLength))),S={status:b,response:v};return{join_ref:f,ref:p,topic:m,event:Oi.reply,payload:S}}_decodeBroadcast(e,t,i){const s=t.getUint8(1),a=t.getUint8(2);let o=this.HEADER_LENGTH+2;const u=i.decode(e.slice(o,o+s));o=o+s;const d=i.decode(e.slice(o,o+a));o=o+a;const f=JSON.parse(i.decode(e.slice(o,e.byteLength)));return{join_ref:null,ref:null,topic:u,event:d,payload:f}}_decodeUserBroadcast(e,t,i){const s=t.getUint8(1),a=t.getUint8(2),o=t.getUint8(3),u=t.getUint8(4);let d=this.HEADER_LENGTH+4;const f=i.decode(e.slice(d,d+s));d=d+s;const p=i.decode(e.slice(d,d+a));d=d+a;const m=i.decode(e.slice(d,d+o));d=d+o;const b=e.slice(d,e.byteLength),v=u===this.JSON_ENCODING?JSON.parse(i.decode(b)):b,S={type:this.BROADCAST,event:p,payload:v};return o>0&&(S.meta=JSON.parse(m)),{join_ref:null,ref:null,topic:f,event:this.BROADCAST,payload:S}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}}class tw{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Qe;(function(l){l.abstime="abstime",l.bool="bool",l.date="date",l.daterange="daterange",l.float4="float4",l.float8="float8",l.int2="int2",l.int4="int4",l.int4range="int4range",l.int8="int8",l.int8range="int8range",l.json="json",l.jsonb="jsonb",l.money="money",l.numeric="numeric",l.oid="oid",l.reltime="reltime",l.text="text",l.time="time",l.timestamp="timestamp",l.timestamptz="timestamptz",l.timetz="timetz",l.tsrange="tsrange",l.tstzrange="tstzrange"})(Qe||(Qe={}));const F0=(l,e,t={})=>{var i;const s=(i=t.skipTypes)!==null&&i!==void 0?i:[];return e?Object.keys(e).reduce((a,o)=>(a[o]=IE(o,l,e,s),a),{}):{}},IE=(l,e,t,i)=>{const s=e.find(u=>u.name===l),a=s?.type,o=t[l];return a&&!i.includes(a)?iw(a,o):lf(o)},iw=(l,e)=>{if(l.charAt(0)==="_"){const t=l.slice(1,l.length);return zE(e,t)}switch(l){case Qe.bool:return BE(e);case Qe.float4:case Qe.float8:case Qe.int2:case Qe.int4:case Qe.int8:case Qe.numeric:case Qe.oid:return UE(e);case Qe.json:case Qe.jsonb:return FE(e);case Qe.timestamp:return HE(e);case Qe.abstime:case Qe.date:case Qe.daterange:case Qe.int4range:case Qe.int8range:case Qe.money:case Qe.reltime:case Qe.text:case Qe.time:case Qe.timestamptz:case Qe.timetz:case Qe.tsrange:case Qe.tstzrange:return lf(e);default:return lf(e)}},lf=l=>l,BE=l=>{switch(l){case"t":return!0;case"f":return!1;default:return l}},UE=l=>{if(typeof l=="string"){const e=parseFloat(l);if(!Number.isNaN(e))return e}return l},FE=l=>{if(typeof l=="string")try{return JSON.parse(l)}catch(e){return console.log(`JSON parse error: ${e}`),l}return l},zE=(l,e)=>{if(typeof l!="string")return l;const t=l.length-1,i=l[t];if(l[0]==="{"&&i==="}"){let a;const o=l.slice(1,t);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(u=>iw(e,u))}return l},HE=l=>typeof l=="string"?l.replace(" ","T"):l,nw=l=>{const e=new URL(l);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class pd{constructor(e,t,i={},s=af){this.channel=e,this.event=t,this.payload=i,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var i;return this._hasReceived(e)&&t((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var z0;(function(l){l.SYNC="sync",l.JOIN="join",l.LEAVE="leave"})(z0||(z0={}));class so{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},s=>{const{onJoin:a,onLeave:o,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=so.syncState(this.state,s,a,o),this.pendingDiffs.forEach(d=>{this.state=so.syncDiff(this.state,d,a,o)}),this.pendingDiffs=[],u()}),this.channel._on(i.diff,{},s=>{const{onJoin:a,onLeave:o,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=so.syncDiff(this.state,s,a,o),u())}),this.onJoin((s,a,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:a,newPresences:o})}),this.onLeave((s,a,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,i,s){const a=this.cloneDeep(e),o=this.transformState(t),u={},d={};return this.map(a,(f,p)=>{o[f]||(d[f]=p)}),this.map(o,(f,p)=>{const m=a[f];if(m){const b=p.map(E=>E.presence_ref),v=m.map(E=>E.presence_ref),S=p.filter(E=>v.indexOf(E.presence_ref)<0),w=m.filter(E=>b.indexOf(E.presence_ref)<0);S.length>0&&(u[f]=S),w.length>0&&(d[f]=w)}else u[f]=p}),this.syncDiff(a,{joins:u,leaves:d},i,s)}static syncDiff(e,t,i,s){const{joins:a,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return i||(i=()=>{}),s||(s=()=>{}),this.map(a,(u,d)=>{var f;const p=(f=e[u])!==null&&f!==void 0?f:[];if(e[u]=this.cloneDeep(d),p.length>0){const m=e[u].map(v=>v.presence_ref),b=p.filter(v=>m.indexOf(v.presence_ref)<0);e[u].unshift(...b)}i(u,p,d)}),this.map(o,(u,d)=>{let f=e[u];if(!f)return;const p=d.map(m=>m.presence_ref);f=f.filter(m=>p.indexOf(m.presence_ref)<0),e[u]=f,s(u,f,d),f.length===0&&delete e[u]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(i=>t(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,i)=>{const s=e[i];return"metas"in s?t[i]=s.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):t[i]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var H0;(function(l){l.ALL="*",l.INSERT="INSERT",l.UPDATE="UPDATE",l.DELETE="DELETE"})(H0||(H0={}));var ro;(function(l){l.BROADCAST="broadcast",l.PRESENCE="presence",l.POSTGRES_CHANGES="postgres_changes",l.SYSTEM="system"})(ro||(ro={}));var Sn;(function(l){l.SUBSCRIBED="SUBSCRIBED",l.TIMED_OUT="TIMED_OUT",l.CLOSED="CLOSED",l.CHANNEL_ERROR="CHANNEL_ERROR"})(Sn||(Sn={}));class Ff{constructor(e,t={config:{}},i){var s,a;if(this.topic=e,this.params=t,this.socket=i,this.bindings={},this.state=Et.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new pd(this,Oi.join,this.params,this.timeout),this.rejoinTimer=new tw(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Et.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Et.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Et.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Oi.reply,{},(o,u)=>{this._trigger(this._replyEventName(u),o)}),this.presence=new so(this),this.broadcastEndpointURL=nw(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((a=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||a===void 0)&&a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var i,s,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Et.closed){const{config:{broadcast:o,presence:u,private:d}}=this.params,f=(s=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(v=>v.filter))!==null&&s!==void 0?s:[],p=!!this.bindings[ro.PRESENCE]&&this.bindings[ro.PRESENCE].length>0||((a=this.params.config.presence)===null||a===void 0?void 0:a.enabled)===!0,m={},b={broadcast:o,presence:Object.assign(Object.assign({},u),{enabled:p}),postgres_changes:f,private:d};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(v=>e?.(Sn.CHANNEL_ERROR,v)),this._onClose(()=>e?.(Sn.CLOSED)),this.updateJoinPayload(Object.assign({config:b},m)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:v})=>{var S;if(this.socket.setAuth(),v===void 0){e?.(Sn.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,E=(S=w?.length)!==null&&S!==void 0?S:0,x=[];for(let C=0;C<E;C++){const T=w[C],{filter:{event:D,schema:M,table:N,filter:k}}=T,z=v&&v[C];if(z&&z.event===D&&z.schema===M&&z.table===N&&z.filter===k)x.push(Object.assign(Object.assign({},T),{id:z.id}));else{this.unsubscribe(),this.state=Et.errored,e?.(Sn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(Sn.SUBSCRIBED);return}}).receive("error",v=>{this.state=Et.errored,e?.(Sn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e?.(Sn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,i){return this.state===Et.joined&&e===ro.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,i)}async httpSend(e,t,i={}){var s;const a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(t==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=i.timeout)!==null&&s!==void 0?s:this.timeout);if(u.status===202)return{success:!0};let d=u.statusText;try{const f=await u.json();d=f.error||f.message||d}catch{}return Promise.reject(new Error(d))}async send(e,t={}){var i,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:a,payload:o}=e,d={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(i=t.timeout)!==null&&i!==void 0?i:this.timeout);return await((s=f.body)===null||s===void 0?void 0:s.cancel()),f.ok?"ok":"error"}catch(f){return f.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,u,d;const f=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(u=(o=this.params)===null||o===void 0?void 0:o.config)===null||u===void 0?void 0:u.broadcast)===null||d===void 0)&&d.ack)&&a("ok"),f.receive("ok",()=>a("ok")),f.receive("error",()=>a("error")),f.receive("timeout",()=>a("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Et.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Oi.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(s=>{i=new pd(this,Oi.leave,{},e),i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Et.closed,this.bindings={}}async _fetchWithTimeout(e,t,i){const s=new AbortController,a=setTimeout(()=>s.abort(),i),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(a),o}_push(e,t,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new pd(this,e,t,i);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>PE){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,i){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,i){var s,a;const o=e.toLocaleLowerCase(),{close:u,error:d,leave:f,join:p}=Oi;if(i&&[u,d,f,p].indexOf(o)>=0&&i!==this._joinRef())return;let b=this._onMessage(o,t,i);if(t&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(v=>{var S,w,E;return((S=v.filter)===null||S===void 0?void 0:S.event)==="*"||((E=(w=v.filter)===null||w===void 0?void 0:w.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===o}).map(v=>v.callback(b,i)):(a=this.bindings[o])===null||a===void 0||a.filter(v=>{var S,w,E,x,C,T;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in v){const D=v.id,M=(S=v.filter)===null||S===void 0?void 0:S.event;return D&&((w=t.ids)===null||w===void 0?void 0:w.includes(D))&&(M==="*"||M?.toLocaleLowerCase()===((E=t.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const D=(C=(x=v?.filter)===null||x===void 0?void 0:x.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return D==="*"||D===((T=t?.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===o}).map(v=>{if(typeof b=="object"&&"ids"in b){const S=b.data,{schema:w,table:E,commit_timestamp:x,type:C,errors:T}=S;b=Object.assign(Object.assign({},{schema:w,table:E,commit_timestamp:x,eventType:C,new:{},old:{},errors:T}),this._getPayloadRecords(S))}v.callback(b,i)})}_isClosed(){return this.state===Et.closed}_isJoined(){return this.state===Et.joined}_isJoining(){return this.state===Et.joining}_isLeaving(){return this.state===Et.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,i){const s=e.toLocaleLowerCase(),a={type:s,filter:t,callback:i};return this.bindings[s]?this.bindings[s].push(a):this.bindings[s]=[a],this}_off(e,t){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(s=>{var a;return!(((a=s.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===i&&Ff.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(e[i]!==t[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Oi.close,{},e)}_onError(e){this._on(Oi.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Et.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=F0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=F0(e.columns,e.old_record)),t}}const gd=()=>{},Jl={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},qE=[1e3,2e3,5e3,1e4],$E=1e4,GE=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class VE{constructor(e,t){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=af,this.transport=null,this.heartbeatIntervalMs=Jl.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=gd,this.ref=0,this.reconnectTimer=null,this.vsn=U0,this.logger=gd,this.conn=null,this.sendBuffer=[],this.serializer=new jE,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...a)=>s(...a):(...a)=>fetch(...a),!(!((i=t?.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${of.websocket}`,this.httpEndpoint=nw(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=OE.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,i){this.logger(e,t,i)}connectionState(){switch(this.conn&&this.conn.readyState){case ks.connecting:return Os.Connecting;case ks.open:return Os.Open;case ks.closing:return Os.Closing;default:return Os.Closed}}isConnected(){return this.connectionState()===Os.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const i=`realtime:${e}`,s=this.getChannels().find(a=>a.topic===i);if(s)return s;{const a=new Ff(`realtime:${e}`,t,this);return this.channels.push(a),a}}push(e){const{topic:t,event:i,payload:s,ref:a}=e,o=()=>{this.encode(e,u=>{var d;(d=this.conn)===null||d===void 0||d.send(u)})};this.log("push",`${t} ${i} (${a})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(LE,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Jl.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(f){this.log("error","error in heartbeat callback",f)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:s,payload:a,ref:o}=t,u=o?`(${o})`:"",d=a.status||"";this.log("receive",`${d} ${i} ${s} ${u}`.trim(),a),this.channels.filter(f=>f._isMember(i)).forEach(f=>f._trigger(s,a,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===ks.open||this.conn.readyState===ks.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Oi.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const i=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${i}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const i=new Blob([GE],{type:"application/javascript"});t=URL.createObjectURL(i)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const s={access_token:t,version:ME};t&&i.updateJoinPayload(s),i.joinedOnce&&i._isJoined()&&i._push(Oi.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new tw(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Jl.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,i,s,a,o,u,d,f,p,m,b,v;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(i=e?.timeout)!==null&&i!==void 0?i:af,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:Jl.HEARTBEAT_INTERVAL,this.worker=(a=e?.worker)!==null&&a!==void 0?a:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(u=e?.heartbeatCallback)!==null&&u!==void 0?u:gd,this.vsn=(d=e?.vsn)!==null&&d!==void 0?d:U0,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(f=e?.reconnectAfterMs)!==null&&f!==void 0?f:(S=>qE[S-1]||$E),this.vsn){case ew:this.encode=(p=e?.encode)!==null&&p!==void 0?p:((S,w)=>w(JSON.stringify(S))),this.decode=(m=e?.decode)!==null&&m!==void 0?m:((S,w)=>w(JSON.parse(S)));break;case NE:this.encode=(b=e?.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class zf extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function st(l){return typeof l=="object"&&l!==null&&"__isStorageError"in l}class YE extends zf{constructor(e,t,i){super(e),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class cf extends zf{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const Hf=l=>l?(...e)=>l(...e):(...e)=>fetch(...e),WE=()=>Response,uf=l=>{if(Array.isArray(l))return l.map(t=>uf(t));if(typeof l=="function"||l!==Object(l))return l;const e={};return Object.entries(l).forEach(([t,i])=>{const s=t.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));e[s]=uf(i)}),e},XE=l=>{if(typeof l!="object"||l===null)return!1;const e=Object.getPrototypeOf(l);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},md=l=>{var e;return l.msg||l.message||l.error_description||(typeof l.error=="string"?l.error:(e=l.error)===null||e===void 0?void 0:e.message)||JSON.stringify(l)},KE=(l,e,t)=>ye(void 0,void 0,void 0,function*(){const i=yield WE();l instanceof i&&!t?.noResolveJson?l.json().then(s=>{const a=l.status||500,o=s?.statusCode||a+"";e(new YE(md(s),a,o))}).catch(s=>{e(new cf(md(s),s))}):e(new cf(md(l),l))}),QE=(l,e,t,i)=>{const s={method:l,headers:e?.headers||{}};return l==="GET"||!i?s:(XE(i)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(i)):s.body=i,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function wo(l,e,t,i,s,a){return ye(this,void 0,void 0,function*(){return new Promise((o,u)=>{l(t,QE(e,i,s,a)).then(d=>{if(!d.ok)throw d;return i?.noResolveJson?d:d.json()}).then(d=>o(d)).catch(d=>KE(d,u,i))})})}function lo(l,e,t,i){return ye(this,void 0,void 0,function*(){return wo(l,"GET",e,t,i)})}function Bi(l,e,t,i,s){return ye(this,void 0,void 0,function*(){return wo(l,"POST",e,i,s,t)})}function hf(l,e,t,i,s){return ye(this,void 0,void 0,function*(){return wo(l,"PUT",e,i,s,t)})}function JE(l,e,t,i){return ye(this,void 0,void 0,function*(){return wo(l,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),i)})}function qf(l,e,t,i,s){return ye(this,void 0,void 0,function*(){return wo(l,"DELETE",e,i,s,t)})}class ZE{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return ye(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(st(e))return{data:null,error:e};throw e}})}}var sw;class ex{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[sw]="BlobDownloadBuilder",this.promise=null}asStream(){return new ZE(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return ye(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(st(e))return{data:null,error:e};throw e}})}}sw=Symbol.toStringTag;const tx={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},q0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ix{constructor(e,t={},i,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=i,this.fetch=Hf(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,i,s){return ye(this,void 0,void 0,function*(){try{let a;const o=Object.assign(Object.assign({},q0),s);let u=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const d=o.metadata;typeof Blob<"u"&&i instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),d&&a.append("metadata",this.encodeMetadata(d)),a.append("",i)):typeof FormData<"u"&&i instanceof FormData?(a=i,a.has("cacheControl")||a.append("cacheControl",o.cacheControl),d&&!a.has("metadata")&&a.append("metadata",this.encodeMetadata(d))):(a=i,u["cache-control"]=`max-age=${o.cacheControl}`,u["content-type"]=o.contentType,d&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(d))),(typeof ReadableStream<"u"&&a instanceof ReadableStream||a&&typeof a=="object"&&"pipe"in a&&typeof a.pipe=="function")&&!o.duplex&&(o.duplex="half")),s?.headers&&(u=Object.assign(Object.assign({},u),s.headers));const f=this._removeEmptyFolders(t),p=this._getFinalPath(f),m=yield(e=="PUT"?hf:Bi)(this.fetch,`${this.url}/object/${p}`,a,Object.assign({headers:u},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:f,id:m.Id,fullPath:m.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(st(a))return{data:null,error:a};throw a}})}upload(e,t,i){return ye(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,i)})}uploadToSignedUrl(e,t,i,s){return ye(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),o=this._getFinalPath(a),u=new URL(this.url+`/object/upload/sign/${o}`);u.searchParams.set("token",t);try{let d;const f=Object.assign({upsert:q0.upsert},s),p=Object.assign(Object.assign({},this.headers),{"x-upsert":String(f.upsert)});typeof Blob<"u"&&i instanceof Blob?(d=new FormData,d.append("cacheControl",f.cacheControl),d.append("",i)):typeof FormData<"u"&&i instanceof FormData?(d=i,d.append("cacheControl",f.cacheControl)):(d=i,p["cache-control"]=`max-age=${f.cacheControl}`,p["content-type"]=f.contentType);const m=yield hf(this.fetch,u.toString(),d,{headers:p});return{data:{path:a,fullPath:m.Key},error:null}}catch(d){if(this.shouldThrowOnError)throw d;if(st(d))return{data:null,error:d};throw d}})}createSignedUploadUrl(e,t){return ye(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const a=yield Bi(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:s}),o=new URL(this.url+a.url),u=o.searchParams.get("token");if(!u)throw new zf("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:u},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(st(i))return{data:null,error:i};throw i}})}update(e,t,i){return ye(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,i)})}move(e,t,i){return ye(this,void 0,void 0,function*(){try{return{data:yield Bi(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}copy(e,t,i){return ye(this,void 0,void 0,function*(){try{return{data:{path:(yield Bi(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,i){return ye(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),a=yield Bi(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:this.headers});const o=i?.download?`&download=${i.download===!0?"":i.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${o}`)},{data:a,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,i){return ye(this,void 0,void 0,function*(){try{const s=yield Bi(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${a}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}download(e,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(e),d=()=>lo(this.fetch,`${this.url}/${s}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new ex(d,this.shouldThrowOnError)}info(e){return ye(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const i=yield lo(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:uf(i),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(st(i))return{data:null,error:i};throw i}})}exists(e){return ye(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield JE(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(st(i)&&i instanceof cf){const s=i.originalError;if([400,404].includes(s?.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,t){const i=this._getFinalPath(e),s=[],a=t?.download?`download=${t.download===!0?"":t.download}`:"";a!==""&&s.push(a);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&s.push(d);let f=s.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${i}${f}`)}}}remove(e){return ye(this,void 0,void 0,function*(){try{return{data:yield qf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}list(e,t,i){return ye(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},tx),t),{prefix:e||""});return{data:yield Bi(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},i),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}listV2(e,t){return ye(this,void 0,void 0,function*(){try{const i=Object.assign({},e);return{data:yield Bi(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},t),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(st(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const rw="2.81.1",aw={"X-Client-Info":`storage-js/${rw}`};class nx{constructor(e,t={},i,s){this.shouldThrowOnError=!1;const a=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},aw),t),this.fetch=Hf(i)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return ye(this,void 0,void 0,function*(){try{const t=this.listBucketOptionsToQueryString(e);return{data:yield lo(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}getBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield lo(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}createBucket(e){return ye(this,arguments,void 0,function*(t,i={public:!1}){try{return{data:yield Bi(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(st(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ye(this,void 0,void 0,function*(){try{return{data:yield hf(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(st(i))return{data:null,error:i};throw i}})}emptyBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield Bi(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield qf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class sx{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},aw),t),this.fetch=Hf(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield Bi(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}listBuckets(e){return ye(this,void 0,void 0,function*(){try{const t=new URLSearchParams;e?.limit!==void 0&&t.set("limit",e.limit.toString()),e?.offset!==void 0&&t.set("offset",e.offset.toString()),e?.sortColumn&&t.set("sortColumn",e.sortColumn),e?.sortOrder&&t.set("sortOrder",e.sortOrder),e?.search&&t.set("search",e.search);const i=t.toString(),s=i?`${this.url}/bucket?${i}`:`${this.url}/bucket`;return{data:yield lo(this.fetch,s,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield qf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(st(t))return{data:null,error:t};throw t}})}}const $f={"X-Client-Info":`storage-js/${rw}`,"Content-Type":"application/json"};class ow extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function gi(l){return typeof l=="object"&&l!==null&&"__isStorageVectorsError"in l}class yd extends ow{constructor(e,t,i){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class rx extends ow{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}var $0;(function(l){l.InternalError="InternalError",l.S3VectorConflictException="S3VectorConflictException",l.S3VectorNotFoundException="S3VectorNotFoundException",l.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",l.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",l.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})($0||($0={}));const Gf=l=>l?(...e)=>l(...e):(...e)=>fetch(...e),ax=l=>{if(typeof l!="object"||l===null)return!1;const e=Object.getPrototypeOf(l);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},G0=l=>l.msg||l.message||l.error_description||l.error||JSON.stringify(l),ox=(l,e,t)=>ye(void 0,void 0,void 0,function*(){if(l&&typeof l=="object"&&"status"in l&&"ok"in l&&typeof l.status=="number"&&!t?.noResolveJson){const s=l.status||500,a=l;if(typeof a.json=="function")a.json().then(o=>{const u=o?.statusCode||o?.code||s+"";e(new yd(G0(o),s,u))}).catch(()=>{const o=s+"",u=a.statusText||`HTTP ${s} error`;e(new yd(u,s,o))});else{const o=s+"",u=a.statusText||`HTTP ${s} error`;e(new yd(u,s,o))}}else e(new rx(G0(l),l))}),lx=(l,e,t,i)=>{const s={method:l,headers:e?.headers||{}};return i?(ax(i)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(i)):s.body=i,Object.assign(Object.assign({},s),t)):s};function cx(l,e,t,i,s,a){return ye(this,void 0,void 0,function*(){return new Promise((o,u)=>{l(t,lx(e,i,s,a)).then(d=>{if(!d.ok)throw d;if(i?.noResolveJson)return d;const f=d.headers.get("content-type");return!f||!f.includes("application/json")?{}:d.json()}).then(d=>o(d)).catch(d=>ox(d,u,i))})})}function mi(l,e,t,i,s){return ye(this,void 0,void 0,function*(){return cx(l,"POST",e,i,s,t)})}class ux{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),t),this.fetch=Gf(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return ye(this,void 0,void 0,function*(){try{return{data:(yield mi(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}getIndex(e,t){return ye(this,void 0,void 0,function*(){try{return{data:yield mi(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(gi(i))return{data:null,error:i};throw i}})}listIndexes(e){return ye(this,void 0,void 0,function*(){try{return{data:yield mi(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}deleteIndex(e,t){return ye(this,void 0,void 0,function*(){try{return{data:(yield mi(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(gi(i))return{data:null,error:i};throw i}})}}class hx{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),t),this.fetch=Gf(i)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return ye(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield mi(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}getVectors(e){return ye(this,void 0,void 0,function*(){try{return{data:yield mi(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}listVectors(e){return ye(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield mi(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}queryVectors(e){return ye(this,void 0,void 0,function*(){try{return{data:yield mi(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}deleteVectors(e){return ye(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield mi(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}}class dx{constructor(e,t={},i){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},$f),t),this.fetch=Gf(i)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:(yield mi(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}getBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:yield mi(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}listBuckets(){return ye(this,arguments,void 0,function*(e={}){try{return{data:yield mi(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ye(this,void 0,void 0,function*(){try{return{data:(yield mi(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(gi(t))return{data:null,error:t};throw t}})}}class fx extends dx{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new px(this.url,this.headers,e,this.fetch)}}class px extends ux{constructor(e,t,i,s){super(e,t,s),this.vectorBucketName=i}createIndex(e){const t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return ye(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return ye(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return ye(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return ye(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new gx(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class gx extends hx{constructor(e,t,i,s,a){super(e,t,a),this.vectorBucketName=i,this.indexName=s}putVectors(e){const t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return ye(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return ye(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return ye(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return ye(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return ye(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class mx extends nx{constructor(e,t={},i,s){super(e,t,i,s)}from(e){return new ix(this.url,this.headers,e,this.fetch)}get vectors(){return new fx(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new sx(this.url+"/iceberg",this.headers,this.fetch)}}const yx="2.81.1";let eo="";typeof Deno<"u"?eo="deno":typeof document<"u"?eo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?eo="react-native":eo="node";const bx={"X-Client-Info":`supabase-js-${eo}/${yx}`},vx={headers:bx},wx={schema:"public"},_x={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Sx={},Ax=l=>l?(...e)=>l(...e):(...e)=>fetch(...e),Ex=()=>Headers,xx=(l,e,t)=>{const i=Ax(t),s=Ex();return async(a,o)=>{var u;const d=(u=await e())!==null&&u!==void 0?u:l;let f=new s(o?.headers);return f.has("apikey")||f.set("apikey",l),f.has("Authorization")||f.set("Authorization",`Bearer ${d}`),i(a,Object.assign(Object.assign({},o),{headers:f}))}};function Tx(l){return l.endsWith("/")?l:l+"/"}function Cx(l,e){var t,i;const{db:s,auth:a,realtime:o,global:u}=l,{db:d,auth:f,realtime:p,global:m}=e,b={db:Object.assign(Object.assign({},d),s),auth:Object.assign(Object.assign({},f),a),realtime:Object.assign(Object.assign({},p),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),u),{headers:Object.assign(Object.assign({},(t=m?.headers)!==null&&t!==void 0?t:{}),(i=u?.headers)!==null&&i!==void 0?i:{})}),accessToken:async()=>""};return l.accessToken?b.accessToken=l.accessToken:delete b.accessToken,b}function Rx(l){const e=l?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Tx(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const lw="2.81.1",Dr=30*1e3,df=3,bd=df*Dr,kx="http://localhost:9999",Ox="supabase.auth.token",Dx={"X-Client-Info":`gotrue-js/${lw}`},ff="X-Supabase-Api-Version",cw={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Mx=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Nx=600*1e3;class co extends Error{constructor(e,t,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=i}}function be(l){return typeof l=="object"&&l!==null&&"__isAuthError"in l}class Lx extends co{constructor(e,t,i){super(e,t,i),this.name="AuthApiError",this.status=t,this.code=i}}function Px(l){return be(l)&&l.name==="AuthApiError"}class Ds extends co{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class os extends co{constructor(e,t,i,s){super(e,i,s),this.name=t,this.status=i}}class ji extends os{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function jx(l){return be(l)&&l.name==="AuthSessionMissingError"}class xr extends os{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Zl extends os{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ec extends os{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ix(l){return be(l)&&l.name==="AuthImplicitGrantRedirectError"}class V0 extends os{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class pf extends os{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function vd(l){return be(l)&&l.name==="AuthRetryableFetchError"}class Y0 extends os{constructor(e,t,i){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=i}}class gf extends os{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),W0=` 	
\r=`.split(""),Bx=(()=>{const l=new Array(128);for(let e=0;e<l.length;e+=1)l[e]=-1;for(let e=0;e<W0.length;e+=1)l[W0[e].charCodeAt(0)]=-2;for(let e=0;e<_c.length;e+=1)l[_c[e].charCodeAt(0)]=e;return l})();function X0(l,e,t){if(l!==null)for(e.queue=e.queue<<8|l,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(_c[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;t(_c[i]),e.queuedBits-=6}}function uw(l,e,t){const i=Bx[l];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(l)}"`)}}function K0(l){const e=[],t=o=>{e.push(String.fromCodePoint(o))},i={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},a=o=>{zx(o,i,t)};for(let o=0;o<l.length;o+=1)uw(l.charCodeAt(o),s,a);return e.join("")}function Ux(l,e){if(l<=127){e(l);return}else if(l<=2047){e(192|l>>6),e(128|l&63);return}else if(l<=65535){e(224|l>>12),e(128|l>>6&63),e(128|l&63);return}else if(l<=1114111){e(240|l>>18),e(128|l>>12&63),e(128|l>>6&63),e(128|l&63);return}throw new Error(`Unrecognized Unicode codepoint: ${l.toString(16)}`)}function Fx(l,e){for(let t=0;t<l.length;t+=1){let i=l.charCodeAt(t);if(i>55295&&i<=56319){const s=(i-55296)*1024&65535;i=(l.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Ux(i,e)}}function zx(l,e,t){if(e.utf8seq===0){if(l<=127){t(l);return}for(let i=1;i<6;i+=1)if((l>>7-i&1)===0){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=l&31;else if(e.utf8seq===3)e.codepoint=l&15;else if(e.utf8seq===4)e.codepoint=l&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(l<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|l&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Fr(l){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};for(let s=0;s<l.length;s+=1)uw(l.charCodeAt(s),t,i);return new Uint8Array(e)}function Hx(l){const e=[];return Fx(l,t=>e.push(t)),new Uint8Array(e)}function Ms(l){const e=[],t={queue:0,queuedBits:0},i=s=>{e.push(s)};return l.forEach(s=>X0(s,t,i)),X0(null,t,i),e.join("")}function qx(l){return Math.round(Date.now()/1e3)+l}function $x(){return Symbol("auth-callback")}const Pt=()=>typeof window<"u"&&typeof document<"u",Ts={tested:!1,writable:!1},hw=()=>{if(!Pt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ts.tested)return Ts.writable;const l=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(l,l),globalThis.localStorage.removeItem(l),Ts.tested=!0,Ts.writable=!0}catch{Ts.tested=!0,Ts.writable=!1}return Ts.writable};function Gx(l){const e={},t=new URL(l);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,a)=>{e[a]=s})}catch{}return t.searchParams.forEach((i,s)=>{e[s]=i}),e}const dw=l=>l?(...e)=>l(...e):(...e)=>fetch(...e),Vx=l=>typeof l=="object"&&l!==null&&"status"in l&&"ok"in l&&"json"in l&&typeof l.json=="function",Mr=async(l,e,t)=>{await l.setItem(e,JSON.stringify(t))},Cs=async(l,e)=>{const t=await l.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ts=async(l,e)=>{await l.removeItem(e)};class Nc{constructor(){this.promise=new Nc.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Nc.promiseConstructor=Promise;function wd(l){const e=l.split(".");if(e.length!==3)throw new gf("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!Mx.test(e[i]))throw new gf("JWT not in base64url format");return{header:JSON.parse(K0(e[0])),payload:JSON.parse(K0(e[1])),signature:Fr(e[2]),raw:{header:e[0],payload:e[1]}}}async function Yx(l){return await new Promise(e=>{setTimeout(()=>e(null),l)})}function Wx(l,e){return new Promise((i,s)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await l(a);if(!e(a,null,o)){i(o);return}}catch(o){if(!e(a,o)){s(o);return}}})()})}function Xx(l){return("0"+l.toString(16)).substr(-2)}function Kx(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=t.length;let s="";for(let a=0;a<56;a++)s+=t.charAt(Math.floor(Math.random()*i));return s}return crypto.getRandomValues(e),Array.from(e,Xx).join("")}async function Qx(l){const t=new TextEncoder().encode(l),i=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(i);return Array.from(s).map(a=>String.fromCharCode(a)).join("")}async function Jx(l){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),l;const t=await Qx(l);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Tr(l,e,t=!1){const i=Kx();let s=i;t&&(s+="/PASSWORD_RECOVERY"),await Mr(l,`${e}-code-verifier`,s);const a=await Jx(i);return[a,i===a?"plain":"s256"]}const Zx=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function eT(l){const e=l.headers.get(ff);if(!e||!e.match(Zx))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function tT(l){if(!l)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(l<=e)throw new Error("JWT has expired")}function iT(l){switch(l){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const nT=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Cr(l){if(!nT.test(l))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function _d(){const l={};return new Proxy(l,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const i=t.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function sT(l,e){return new Proxy(l,{get:(t,i,s)=>{if(i==="__isInsecureUserWarningProxy")return!0;if(typeof i=="symbol"){const a=i.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)"||a==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,i,s)}return!e.value&&typeof i=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,i,s)}})}function Q0(l){return JSON.parse(JSON.stringify(l))}const Rs=l=>l.msg||l.message||l.error_description||l.error||JSON.stringify(l),rT=[502,503,504];async function J0(l){var e;if(!Vx(l))throw new pf(Rs(l),0);if(rT.includes(l.status))throw new pf(Rs(l),l.status);let t;try{t=await l.json()}catch(a){throw new Ds(Rs(a),a)}let i;const s=eT(l);if(s&&s.getTime()>=cw["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?i=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(i=t.error_code),i){if(i==="weak_password")throw new Y0(Rs(t),l.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new ji}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new Y0(Rs(t),l.status,t.weak_password.reasons);throw new Lx(Rs(t),l.status||500,i)}const aT=(l,e,t,i)=>{const s={method:l,headers:e?.headers||{}};return l==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(i),Object.assign(Object.assign({},s),t))};async function Ae(l,e,t,i){var s;const a=Object.assign({},i?.headers);a[ff]||(a[ff]=cw["2024-01-01"].name),i?.jwt&&(a.Authorization=`Bearer ${i.jwt}`);const o=(s=i?.query)!==null&&s!==void 0?s:{};i?.redirectTo&&(o.redirect_to=i.redirectTo);const u=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",d=await oT(l,e,t+u,{headers:a,noResolveJson:i?.noResolveJson},{},i?.body);return i?.xform?i?.xform(d):{data:Object.assign({},d),error:null}}async function oT(l,e,t,i,s,a){const o=aT(e,i,s,a);let u;try{u=await l(t,Object.assign({},o))}catch(d){throw console.error(d),new pf(Rs(d),0)}if(u.ok||await J0(u),i?.noResolveJson)return u;try{return await u.json()}catch(d){await J0(d)}}function Ii(l){var e;let t=null;uT(l)&&(t=Object.assign({},l),l.expires_at||(t.expires_at=qx(l.expires_in)));const i=(e=l.user)!==null&&e!==void 0?e:l;return{data:{session:t,user:i},error:null}}function Z0(l){const e=Ii(l);return!e.error&&l.weak_password&&typeof l.weak_password=="object"&&Array.isArray(l.weak_password.reasons)&&l.weak_password.reasons.length&&l.weak_password.message&&typeof l.weak_password.message=="string"&&l.weak_password.reasons.reduce((t,i)=>t&&typeof i=="string",!0)&&(e.data.weak_password=l.weak_password),e}function is(l){var e;return{data:{user:(e=l.user)!==null&&e!==void 0?e:l},error:null}}function lT(l){return{data:l,error:null}}function cT(l){const{action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:a}=l,o=Kr(l,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:t,hashed_token:i,redirect_to:s,verification_type:a},d=Object.assign({},o);return{data:{properties:u,user:d},error:null}}function eb(l){return l}function uT(l){return l.access_token&&l.refresh_token&&l.expires_in}const Sd=["global","local","others"];class hT{constructor({url:e="",headers:t={},fetch:i}){this.url=e,this.headers=t,this.fetch=dw(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Sd[0]){if(Sd.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Sd.join(", ")}`);try{return await Ae(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(be(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,t={}){try{return await Ae(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:is})}catch(i){if(be(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:t}=e,i=Kr(e,["options"]),s=Object.assign(Object.assign({},i),t);return"newEmail"in i&&(s.new_email=i?.newEmail,delete s.newEmail),await Ae(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:cT,redirectTo:t?.redirectTo})}catch(t){if(be(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:is})}catch(t){if(be(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,i,s,a,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await Ae(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(a=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""},xform:eb});if(p.error)throw p.error;const m=await p.json(),b=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(S=>{const w=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(S.split(";")[1].split("=")[1]);f[`${E}Page`]=w}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(be(f))return{data:{users:[]},error:f};throw f}}async getUserById(e){Cr(e);try{return await Ae(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:is})}catch(t){if(be(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Cr(e);try{return await Ae(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:is})}catch(i){if(be(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,t=!1){Cr(e);try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:is})}catch(i){if(be(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){Cr(e.userId);try{const{data:t,error:i}=await Ae(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:i}}catch(t){if(be(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Cr(e.userId),Cr(e.id);try{return{data:await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,i,s,a,o,u,d;try{const f={nextPage:null,lastPage:0,total:0},p=await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&i!==void 0?i:"",per_page:(a=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""},xform:eb});if(p.error)throw p.error;const m=await p.json(),b=(o=p.headers.get("x-total-count"))!==null&&o!==void 0?o:0,v=(d=(u=p.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&d!==void 0?d:[];return v.length>0&&(v.forEach(S=>{const w=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(S.split(";")[1].split("=")[1]);f[`${E}Page`]=w}),f.total=parseInt(b)),{data:Object.assign(Object.assign({},m),f),error:null}}catch(f){if(be(f))return{data:{clients:[]},error:f};throw f}}async _createOAuthClient(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Ae(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Ae(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(be(i))return{data:null,error:i};throw i}}async _deleteOAuthClient(e){try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(be(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Ae(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(be(t))return{data:null,error:t};throw t}}}function tb(l={}){return{getItem:e=>l[e]||null,setItem:(e,t)=>{l[e]=t},removeItem:e=>{delete l[e]}}}const Rr={debug:!!(globalThis&&hw()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fw extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class dT extends fw{}async function fT(l,e,t){Rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",l,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),Rr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",l)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(l,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async s=>{if(s){Rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",l,s.name);try{return await t()}finally{Rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",l,s.name)}}else{if(e===0)throw Rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",l),new dT(`Acquiring an exclusive Navigator LockManager lock "${l}" immediately failed`);if(Rr.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function pT(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function pw(l){if(!/^0x[a-fA-F0-9]{40}$/.test(l))throw new Error(`@supabase/auth-js: Address "${l}" is invalid.`);return l.toLowerCase()}function gT(l){return parseInt(l,16)}function mT(l){const e=new TextEncoder().encode(l);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function yT(l){var e;const{chainId:t,domain:i,expirationTime:s,issuedAt:a=new Date,nonce:o,notBefore:u,requestId:d,resources:f,scheme:p,uri:m,version:b}=l;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=l.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${l.statement}`)}const v=pw(l.address),S=p?`${p}://${i}`:i,w=l.statement?`${l.statement}
`:"",E=`${S} wants you to sign in with your Ethereum account:
${v}

${w}`;let x=`URI: ${m}
Version: ${b}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${a.toISOString()}`;if(s&&(x+=`
Expiration Time: ${s.toISOString()}`),u&&(x+=`
Not Before: ${u.toISOString()}`),d&&(x+=`
Request ID: ${d}`),f){let C=`
Resources:`;for(const T of f){if(!T||typeof T!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${T}`);C+=`
- ${T}`}x+=C}return`${E}
${x}`}class St extends Error{constructor({message:e,code:t,cause:i,name:s}){var a;super(e,{cause:i}),this.__isWebAuthnError=!0,this.name=(a=s??(i instanceof Error?i.name:void 0))!==null&&a!==void 0?a:"Unknown Error",this.code=t}}class Sc extends St{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function bT({error:l,options:e}){var t,i,s;const{publicKey:a}=e;if(!a)throw Error("options was missing required publicKey property");if(l.name==="AbortError"){if(e.signal instanceof AbortSignal)return new St({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:l})}else if(l.name==="ConstraintError"){if(((t=a.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new St({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:l});if(e.mediation==="conditional"&&((i=a.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new St({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:l});if(((s=a.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new St({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:l})}else{if(l.name==="InvalidStateError")return new St({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:l});if(l.name==="NotAllowedError")return new St({message:l.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l});if(l.name==="NotSupportedError")return a.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new St({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:l}):new St({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:l});if(l.name==="SecurityError"){const o=window.location.hostname;if(gw(o)){if(a.rp.id!==o)return new St({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:l})}else return new St({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:l})}else if(l.name==="TypeError"){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new St({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:l})}else if(l.name==="UnknownError")return new St({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:l})}return new St({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l})}function vT({error:l,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(l.name==="AbortError"){if(e.signal instanceof AbortSignal)return new St({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:l})}else{if(l.name==="NotAllowedError")return new St({message:l.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l});if(l.name==="SecurityError"){const i=window.location.hostname;if(gw(i)){if(t.rpId!==i)return new St({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:l})}else return new St({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:l})}else if(l.name==="UnknownError")return new St({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:l})}return new St({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:l})}class wT{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const _T=new wT;function ST(l){if(!l)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(l);const{challenge:e,user:t,excludeCredentials:i}=l,s=Kr(l,["challenge","user","excludeCredentials"]),a=Fr(e).buffer,o=Object.assign(Object.assign({},t),{id:Fr(t.id).buffer}),u=Object.assign(Object.assign({},s),{challenge:a,user:o});if(i&&i.length>0){u.excludeCredentials=new Array(i.length);for(let d=0;d<i.length;d++){const f=i[d];u.excludeCredentials[d]=Object.assign(Object.assign({},f),{id:Fr(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function AT(l){if(!l)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(l);const{challenge:e,allowCredentials:t}=l,i=Kr(l,["challenge","allowCredentials"]),s=Fr(e).buffer,a=Object.assign(Object.assign({},i),{challenge:s});if(t&&t.length>0){a.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const u=t[o];a.allowCredentials[o]=Object.assign(Object.assign({},u),{id:Fr(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function ET(l){var e;if("toJSON"in l&&typeof l.toJSON=="function")return l.toJSON();const t=l;return{id:l.id,rawId:l.id,response:{attestationObject:Ms(new Uint8Array(l.response.attestationObject)),clientDataJSON:Ms(new Uint8Array(l.response.clientDataJSON))},type:"public-key",clientExtensionResults:l.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function xT(l){var e;if("toJSON"in l&&typeof l.toJSON=="function")return l.toJSON();const t=l,i=l.getClientExtensionResults(),s=l.response;return{id:l.id,rawId:l.id,response:{authenticatorData:Ms(new Uint8Array(s.authenticatorData)),clientDataJSON:Ms(new Uint8Array(s.clientDataJSON)),signature:Ms(new Uint8Array(s.signature)),userHandle:s.userHandle?Ms(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:i,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function gw(l){return l==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(l)}function ib(){var l,e;return!!(Pt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((l=navigator?.credentials)===null||l===void 0?void 0:l.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function TT(l){try{const e=await navigator.credentials.create(l);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Sc("Browser returned unexpected credential type",e)}:{data:null,error:new Sc("Empty credential response",e)}}catch(e){return{data:null,error:bT({error:e,options:l})}}}async function CT(l){try{const e=await navigator.credentials.get(l);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Sc("Browser returned unexpected credential type",e)}:{data:null,error:new Sc("Empty credential response",e)}}catch(e){return{data:null,error:vT({error:e,options:l})}}}const RT={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},kT={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ac(...l){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),i={};for(const s of l)if(s)for(const a in s){const o=s[a];if(o!==void 0)if(Array.isArray(o))i[a]=o;else if(t(o))i[a]=o;else if(e(o)){const u=i[a];e(u)?i[a]=Ac(u,o):i[a]=Ac(o)}else i[a]=o}return i}function OT(l,e){return Ac(RT,l,e||{})}function DT(l,e){return Ac(kT,l,e||{})}class MT{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:i,signal:s},a){try{const{data:o,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:u};const d=s??_T.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:f}=o.webauthn.credential_options.publicKey;f.name||(f.name=`${f.id}:${i}`),f.displayName||(f.displayName=f.name)}switch(o.webauthn.type){case"create":{const f=OT(o.webauthn.credential_options.publicKey,a?.create),{data:p,error:m}=await TT({publicKey:f,signal:d});return p?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:m}}case"request":{const f=DT(o.webauthn.credential_options.publicKey,a?.request),{data:p,error:m}=await CT(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:f,signal:d}));return p?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:p}},error:null}:{data:null,error:m}}}}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ds("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:i}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:i})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},a){if(!t)return{data:null,error:new co("rpId is required for WebAuthn authentication")};try{if(!ib())return{data:null,error:new Ds("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:i},signal:s},{request:a});if(!o)return{data:null,error:u};const{webauthn:d}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:i,credential_response:d.credential_response}})}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ds("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:i=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},a){if(!t)return{data:null,error:new co("rpId is required for WebAuthn registration")};try{if(!ib())return{data:null,error:new Ds("Browser does not support WebAuthn",null)};const{data:o,error:u}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(p=>{var m;return(m=p.data)===null||m===void 0?void 0:m.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p?.id}):void 0),{data:null,error:u};const{data:d,error:f}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:i},signal:s},{create:a});return d?this._verify({factorId:o.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:i,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:f}}catch(o){return be(o)?{data:null,error:o}:{data:null,error:new Ds("Unexpected error in register",o)}}}}pT();const NT={url:kx,storageKey:Ox,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Dx,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function nb(l,e,t){return await t()}const kr={};class uo{get jwks(){var e,t;return(t=(e=kr[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){kr[this.storageKey]=Object.assign(Object.assign({},kr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=kr[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){kr[this.storageKey]=Object.assign(Object.assign({},kr[this.storageKey]),{cachedAt:e})}constructor(e){var t,i,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},NT),e);if(this.storageKey=a.storageKey,this.instanceID=(t=uo.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,uo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.instanceID>0&&Pt()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new hT({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=dw(a.fetch),this.lock=a.lock||nb,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,a.lock?this.lock=a.lock:Pt()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=fT:this.lock=nb,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new MT(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:hw()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tb(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=tb(this.memoryStorage)),Pt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${lw}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},i="none";if(Pt()&&(t=Gx(window.location.href),this._isImplicitGrantCallback(t)?i="implicit":await this._isPKCECallback(t)&&(i="pkce")),Pt()&&this.detectSessionInUrl&&i!=="none"){const{data:s,error:a}=await this._getSessionFromURL(t,i);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),Ix(a)){const d=(e=a.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:o,redirectType:u}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",u),await this._saveSession(o),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return be(t)?this._returnResult({error:t}):this._returnResult({error:new Ds("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,i,s;try{const a=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:Ii}),{data:o,error:u}=a;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(a){if(be(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(e){var t,i,s;try{let a;if("email"in e){const{email:p,password:m,options:b}=e;let v=null,S=null;this.flowType==="pkce"&&([v,S]=await Tr(this.storage,this.storageKey)),a=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b?.emailRedirectTo,body:{email:p,password:m,data:(t=b?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:b?.captchaToken},code_challenge:v,code_challenge_method:S},xform:Ii})}else if("phone"in e){const{phone:p,password:m,options:b}=e;a=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:m,data:(i=b?.data)!==null&&i!==void 0?i:{},channel:(s=b?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:b?.captchaToken}},xform:Ii})}else throw new Zl("You must provide either an email or phone number and a password");const{data:o,error:u}=a;if(u||!o)return this._returnResult({data:{user:null,session:null},error:u});const d=o.session,f=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(a){if(be(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(e){try{let t;if("email"in e){const{email:a,password:o,options:u}=e;t=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Z0})}else if("phone"in e){const{phone:a,password:o,options:u}=e;t=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Z0})}else throw new Zl("You must provide either an email or phone number and a password");const{data:i,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!i||!i.session||!i.user){const a=new xr;return this._returnResult({data:{user:null,session:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:s})}catch(t){if(be(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,i,s,a;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(a=e.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,i,s,a,o,u,d,f,p,m,b;let v,S;if("message"in e)v=e.message,S=e.signature;else{const{chain:w,wallet:E,statement:x,options:C}=e;let T;if(Pt())if(typeof E=="object")T=E;else{const H=window;if("ethereum"in H&&typeof H.ethereum=="object"&&"request"in H.ethereum&&typeof H.ethereum.request=="function")T=H.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!C?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=E}const D=new URL((t=C?.url)!==null&&t!==void 0?t:window.location.href),M=await T.request({method:"eth_requestAccounts"}).then(H=>H).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const N=pw(M[0]);let k=(i=C?.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!k){const H=await T.request({method:"eth_chainId"});k=gT(H)}const z={domain:D.host,address:N,statement:x,uri:D.href,version:"1",chainId:k,nonce:(s=C?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(a=C?.signInWithEthereum)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(u=C?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(d=C?.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(f=C?.signInWithEthereum)===null||f===void 0?void 0:f.requestId,resources:(p=C?.signInWithEthereum)===null||p===void 0?void 0:p.resources};v=yT(z),S=await T.request({method:"personal_sign",params:[mT(v),N]})}try{const{data:w,error:E}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:S},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Ii});if(E)throw E;if(!w||!w.session||!w.user){const x=new xr;return this._returnResult({data:{user:null,session:null},error:x})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:E})}catch(w){if(be(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(e){var t,i,s,a,o,u,d,f,p,m,b,v;let S,w;if("message"in e)S=e.message,w=e.signature;else{const{chain:E,wallet:x,statement:C,options:T}=e;let D;if(Pt())if(typeof x=="object")D=x;else{const N=window;if("solana"in N&&typeof N.solana=="object"&&("signIn"in N.solana&&typeof N.solana.signIn=="function"||"signMessage"in N.solana&&typeof N.solana.signMessage=="function"))D=N.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!T?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=x}const M=new URL((t=T?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in D&&D.signIn){const N=await D.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},T?.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),C?{statement:C}:null));let k;if(Array.isArray(N)&&N[0]&&typeof N[0]=="object")k=N[0];else if(N&&typeof N=="object"&&"signedMessage"in N&&"signature"in N)k=N;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in k&&"signature"in k&&(typeof k.signedMessage=="string"||k.signedMessage instanceof Uint8Array)&&k.signature instanceof Uint8Array)S=typeof k.signedMessage=="string"?k.signedMessage:new TextDecoder().decode(k.signedMessage),w=k.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in D)||typeof D.signMessage!="function"||!("publicKey"in D)||typeof D!="object"||!D.publicKey||!("toBase58"in D.publicKey)||typeof D.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${M.host} wants you to sign in with your Solana account:`,D.publicKey.toBase58(),...C?["",C,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(s=(i=T?.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((a=T?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${T.signInWithSolana.notBefore}`]:[],...!((o=T?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${T.signInWithSolana.expirationTime}`]:[],...!((u=T?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${T.signInWithSolana.chainId}`]:[],...!((d=T?.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${T.signInWithSolana.nonce}`]:[],...!((f=T?.signInWithSolana)===null||f===void 0)&&f.requestId?[`Request ID: ${T.signInWithSolana.requestId}`]:[],...!((m=(p=T?.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||m===void 0)&&m.length?["Resources",...T.signInWithSolana.resources.map(k=>`- ${k}`)]:[]].join(`
`);const N=await D.signMessage(new TextEncoder().encode(S),"utf8");if(!N||!(N instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=N}}try{const{data:E,error:x}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:Ms(w)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Ii});if(x)throw x;if(!E||!E.session||!E.user){const C=new xr;return this._returnResult({data:{user:null,session:null},error:C})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:x})}catch(E){if(be(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async _exchangeCodeForSession(e){const t=await Cs(this.storage,`${this.storageKey}-code-verifier`),[i,s]=(t??"").split("/");try{const{data:a,error:o}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:Ii});if(await ts(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!a||!a.session||!a.user){const u=new xr;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign(Object.assign({},a),{redirectType:s??null}),error:o})}catch(a){if(be(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(e){try{const{options:t,provider:i,token:s,access_token:a,nonce:o}=e,u=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:s,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:Ii}),{data:d,error:f}=u;if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!d||!d.session||!d.user){const p=new xr;return this._returnResult({data:{user:null,session:null},error:p})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:f})}catch(t){if(be(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,i,s,a,o;try{if("email"in e){const{email:u,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Tr(this.storage,this.storageKey));const{error:m}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(t=d?.data)!==null&&t!==void 0?t:{},create_user:(i=d?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:p},redirectTo:d?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:m})}if("phone"in e){const{phone:u,options:d}=e,{data:f,error:p}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(s=d?.data)!==null&&s!==void 0?s:{},create_user:(a=d?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},channel:(o=d?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:f?.message_id},error:p})}throw new Zl("You must provide either an email or phone number.")}catch(u){if(be(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var t,i;try{let s,a;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,a=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:o,error:u}=await Ae(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:s,xform:Ii});if(u)throw u;if(!o)throw new Error("An error occurred on token verification.");const d=o.session,f=o.user;return d?.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:f,session:d},error:null})}catch(s){if(be(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var t,i,s,a,o;try{let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Tr(this.storage,this.storageKey));const f=await Ae(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&i!==void 0?i:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:d}),headers:this.headers,xform:lT});return!((a=f.data)===null||a===void 0)&&a.url&&Pt()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(f.data.url),this._returnResult(f)}catch(u){if(be(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:i}=e;if(i)throw i;if(!t)throw new ji;const{error:s}=await Ae(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(be(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:i,type:s,options:a}=e,{error:o}=await Ae(this.fetch,"POST",t,{headers:this.headers,body:{email:i,type:s,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:i,type:s,options:a}=e,{data:o,error:u}=await Ae(this.fetch,"POST",t,{headers:this.headers,body:{phone:i,type:s,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:u})}throw new Zl("You must provide either an email or phone number and a type")}catch(t){if(be(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await i,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=t();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Cs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<bd:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const o=await Cs(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=_d()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=sT(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{session:null},error:a}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:is}):await this._useSession(async t=>{var i,s,a;const{data:o,error:u}=t;if(u)throw u;return!(!((i=o.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ji}:await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&a!==void 0?a:void 0,xform:is})})}catch(t){if(be(t))return jx(t)&&(await this._removeSession(),await ts(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async i=>{const{data:s,error:a}=i;if(a)throw a;if(!s.session)throw new ji;const o=s.session;let u=null,d=null;this.flowType==="pkce"&&e.email!=null&&([u,d]=await Tr(this.storage,this.storageKey));const{data:f,error:p}=await Ae(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:d}),jwt:o.access_token,xform:is});if(p)throw p;return o.user=f.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(i){if(be(i))return this._returnResult({data:{user:null},error:i});throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ji;const t=Date.now()/1e3;let i=t,s=!0,a=null;const{payload:o}=wd(e.access_token);if(o.exp&&(i=o.exp,s=i<=t),s){const{data:u,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!u)return{data:{user:null,session:null},error:null};a=u}else{const{data:u,error:d}=await this._getUser(e.access_token);if(d)throw d;a={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:i-t,expires_at:i},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(t){if(be(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var i;if(!e){const{data:o,error:u}=t;if(u)throw u;e=(i=o.session)!==null&&i!==void 0?i:void 0}if(!e?.refresh_token)throw new ji;const{data:s,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(be(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Pt())throw new ec("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ec(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new V0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ec("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new V0("No code detected.");const{data:C,error:T}=await this._exchangeCodeForSession(e.code);if(T)throw T;const D=new URL(window.location.href);return D.searchParams.delete("code"),window.history.replaceState(window.history.state,"",D.toString()),{data:{session:C.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:s,access_token:a,refresh_token:o,expires_in:u,expires_at:d,token_type:f}=e;if(!a||!u||!o||!f)throw new ec("No session defined in URL");const p=Math.round(Date.now()/1e3),m=parseInt(u);let b=p+m;d&&(b=parseInt(d));const v=b-p;v*1e3<=Dr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${m}s`);const S=b-m;p-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,b,p):p-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,b,p);const{data:w,error:E}=await this._getUser(a);if(E)throw E;const x={provider_token:i,provider_refresh_token:s,access_token:a,expires_in:m,expires_at:b,refresh_token:o,token_type:f,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(i){if(be(i))return this._returnResult({data:{session:null,redirectType:null},error:i});throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Cs(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var i;const{data:s,error:a}=t;if(a)return this._returnResult({error:a});const o=(i=s.session)===null||i===void 0?void 0:i.access_token;if(o){const{error:u}=await this.admin.signOut(o,e);if(u&&!(Px(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await ts(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=$x(),i={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async t=>{var i,s;try{const{data:{session:a},error:o}=t;if(o)throw o;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",e,"session",a)}catch(a){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}})}async resetPasswordForEmail(e,t={}){let i=null,s=null;this.flowType==="pkce"&&([i,s]=await Tr(this.storage,this.storageKey,!0));try{return await Ae(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(be(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var e;try{const{data:t,error:i}=await this.getUser();if(i)throw i;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:i,error:s}=await this._useSession(async a=>{var o,u,d,f,p;const{data:m,error:b}=a;if(b)throw b;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await Ae(this.fetch,"GET",v,{headers:this.headers,jwt:(p=(f=m.session)===null||f===void 0?void 0:f.access_token)!==null&&p!==void 0?p:void 0})});if(s)throw s;return Pt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(i?.url),this._returnResult({data:{provider:e.provider,url:i?.url},error:null})}catch(i){if(be(i))return this._returnResult({data:{provider:e.provider,url:null},error:i});throw i}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var i;try{const{error:s,data:{session:a}}=t;if(s)throw s;const{options:o,provider:u,token:d,access_token:f,nonce:p}=e,m=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(i=a?.access_token)!==null&&i!==void 0?i:void 0,body:{provider:u,id_token:d,access_token:f,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Ii}),{data:b,error:v}=m;return v?this._returnResult({data:{user:null,session:null},error:v}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new xr}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:v}))}catch(s){if(be(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var i,s;const{data:a,error:o}=t;if(o)throw o;return await Ae(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await Wx(async s=>(s>0&&await Yx(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Ae(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ii})),(s,a)=>{const o=200*Math.pow(2,s);return a&&vd(a)&&Date.now()+o-i<Dr})}catch(i){if(this._debug(t,"error",i),be(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),Pt()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const s=await Cs(this.storage,this.storageKey);if(s&&this.userStorage){let o=await Cs(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Mr(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o?.user)!==null&&e!==void 0?e:_d()}else if(s&&!s.user&&!s.user){const o=await Cs(this.storage,this.storageKey+"-user");o&&o?.user?(s.user=o.user,await ts(this.storage,this.storageKey+"-user"),await Mr(this.storage,this.storageKey,s)):s.user=_d()}if(this._debug(i,"session from storage",s),!this._isValidSession(s)){this._debug(i,"session is not valid"),s!==null&&await this._removeSession();return}const a=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<bd;if(this._debug(i,`session has${a?"":" not"} expired with margin of ${bd}s`),a){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),vd(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:u}=await this._getUser(s.access_token);!u&&o?.user?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(i,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(i,"error",s),console.error(s);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var t,i;if(!e)throw new ji;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Nc;const{data:a,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!a.session)throw new ji;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const u={data:a.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(a){if(this._debug(s,"error",a),be(a)){const o={data:null,error:a};return vd(a)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(a),a}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,i=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:t});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,t)}catch(d){a.push(d)}});if(await Promise.all(o),a.length>0){for(let u=0;u<a.length;u+=1)console.error(a[u]);throw a[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),i=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&t.user&&await Mr(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const a=Q0(s);await Mr(this.storage,this.storageKey,a)}else{const s=Q0(t);await Mr(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await ts(this.storage,this.storageKey),await ts(this.storage,this.storageKey+"-code-verifier"),await ts(this.storage,this.storageKey+"-user"),this.userStorage&&await ts(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Pt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Dr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:i}}=t;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((i.expires_at*1e3-e)/Dr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Dr}ms, refresh threshold is ${df} ticks`),s<=df&&await this._callRefreshToken(i.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fw)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Pt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,i){const s=[`provider=${encodeURIComponent(t)}`];if(i?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i?.scopes&&s.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[a,o]=await Tr(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(u.toString())}if(i?.queryParams){const a=new URLSearchParams(i.queryParams);s.push(a.toString())}return i?.skipBrowserRedirect&&s.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var i;const{data:s,error:a}=t;return a?this._returnResult({data:null,error:a}):await Ae(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token})})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var i,s;const{data:a,error:o}=t;if(o)return this._returnResult({data:null,error:o});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:f}=await Ae(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(i=a?.session)===null||i===void 0?void 0:i.access_token});return f?this._returnResult({data:null,error:f}):(e.factorType==="totp"&&d.type==="totp"&&(!((s=d?.totp)===null||s===void 0)&&s.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?ET(e.webauthn.credential_response):xT(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:d}=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:d}))})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var i;const{data:s,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=await Ae(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(i=s?.session)===null||i===void 0?void 0:i.access_token});if(o.error)return o;const{data:u}=o;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:ST(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:AT(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:i}=await this._challenge({factorId:e.factorId});return i?this._returnResult({data:null,error:i}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const s={all:[],phone:[],totp:[],webauthn:[]};for(const a of(e=t?.factors)!==null&&e!==void 0?e:[])s.all.push(a),a.status==="verified"&&s[a.factor_type].push(a);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:i},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=wd(i.access_token);let o=null;a.aal&&(o=a.aal);let u=o;((t=(e=i.user.factors)===null||e===void 0?void 0:e.filter(p=>p.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(u="aal2");const f=a.amr||[];return{data:{currentLevel:o,nextLevel:u,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:i},error:s}=t;return s?this._returnResult({data:null,error:s}):i?await Ae(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:i.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new ji})})}catch(t){if(be(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:s},error:a}=i;if(a)return this._returnResult({data:null,error:a});if(!s)return this._returnResult({data:null,error:new ji});const o=await Ae(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&Pt()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(be(i))return this._returnResult({data:null,error:i});throw i}}async _denyAuthorization(e,t){try{return await this._useSession(async i=>{const{data:{session:s},error:a}=i;if(a)return this._returnResult({data:null,error:a});if(!s)return this._returnResult({data:null,error:new ji});const o=await Ae(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return o.data&&o.data.redirect_url&&Pt()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(i){if(be(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(e,t={keys:[]}){let i=t.keys.find(u=>u.kid===e);if(i)return i;const s=Date.now();if(i=this.jwks.keys.find(u=>u.kid===e),i&&this.jwks_cached_at+Nx>s)return i;const{data:a,error:o}=await Ae(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=s,i=a.keys.find(u=>u.kid===e),!i)?null:i}async getClaims(e,t={}){try{let i=e;if(!i){const{data:v,error:S}=await this.getSession();if(S||!v.session)return this._returnResult({data:null,error:S});i=v.session.access_token}const{header:s,payload:a,signature:o,raw:{header:u,payload:d}}=wd(i);t?.allowExpired||tT(a.exp);const f=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!f){const{error:v}=await this.getUser(i);if(v)throw v;return{data:{claims:a,header:s,signature:o},error:null}}const p=iT(s.alg),m=await crypto.subtle.importKey("jwk",f,p,!0,["verify"]);if(!await crypto.subtle.verify(p,m,o,Hx(`${u}.${d}`)))throw new gf("Invalid JWT signature");return{data:{claims:a,header:s,signature:o},error:null}}catch(i){if(be(i))return this._returnResult({data:null,error:i});throw i}}}uo.nextInstanceID={};const LT=uo;class PT extends LT{constructor(e){super(e)}}class jT{constructor(e,t,i){var s,a,o;this.supabaseUrl=e,this.supabaseKey=t;const u=Rx(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:wx,realtime:Sx,auth:Object.assign(Object.assign({},_x),{storageKey:d}),global:vx},p=Cx(i??{},f);this.storageKey=(s=p.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(a=p.global.headers)!==null&&a!==void 0?a:{},p.accessToken?(this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(m,b)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=p.auth)!==null&&o!==void 0?o:{},this.headers,p.global.fetch),this.fetch=xx(t,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.accessToken&&this.accessToken().then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new kE(new URL("rest/v1",u).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new mx(this.storageUrl.href,this.headers,this.fetch,i?.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new xE(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,i)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();const{data:i}=await this.auth.getSession();return(t=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:s,userStorage:a,storageKey:o,flowType:u,lock:d,debug:f,throwOnError:p},m,b){const v={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new PT({url:this.authUrl.href,headers:Object.assign(Object.assign({},v),m),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:i,storage:s,userStorage:a,flowType:u,lock:d,debug:f,throwOnError:p,fetch:b,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new VE(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,i)=>{this._handleTokenChanged(t,"CLIENT",i?.access_token)})}_handleTokenChanged(e,t,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const IT=(l,e,t)=>new jT(l,e,t);function BT(){if(typeof window<"u"||typeof process>"u")return!1;const l=process.version;if(l==null)return!1;const e=l.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}BT()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const UT="https://chlfrkennmepvlqfsfzy.supabase.co",FT="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNobGZya2Vubm1lcHZscWZzZnp5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODcxMzYsImV4cCI6MjA3ODU2MzEzNn0.z0E4pfRm6gl3gMxsdDgoXFnokSD9UyxdQi9zzBCBO4Y",Oe=IT(UT,FT),zT=()=>`session_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,HT=async(l,e,t,i=null)=>{console.log(" Creating session for:",{email:l,name:e,userType:t,profilePicture:i});const s=zT(),a=new Date;a.setHours(a.getHours()+24);let o={session_id:s,user_email:l,user_name:e,user_type:t,profile_picture:i,expires_at:a.toISOString()},{error:u}=await Oe.from("user_sessions").insert([o]);if(u&&u.message?.includes("profile_picture")){console.log(" profile_picture column not found, retrying without it...");const{session_id:d,user_email:f,user_name:p,user_type:m,expires_at:b}=o,{error:v}=await Oe.from("user_sessions").insert([{session_id:d,user_email:f,user_name:p,user_type:m,expires_at:b}]);if(v)return console.error(" Error creating session (retry):",v),null}else if(u)return console.error(" Error creating session:",u),null;return sessionStorage.setItem("amma_session_id",s),console.log(" Session stored in sessionStorage:",s),s},Lc=async()=>{const l=sessionStorage.getItem("amma_session_id");if(console.log(" Getting session, ID from storage:",l),!l)return console.log(" No session ID in sessionStorage"),null;const{data:e,error:t}=await Oe.from("user_sessions").select("*").eq("session_id",l).single();return t||!e?(console.log(" No active session found in Supabase:",t),sessionStorage.removeItem("amma_session_id"),null):new Date(e.expires_at)<new Date?(console.log(" Session expired"),await qT(l),null):(console.log(" Valid session found:",{email:e.user_email,name:e.user_name,type:e.user_type}),{email:e.user_email,name:e.user_name,userType:e.user_type,profilePicture:e.profile_picture})},qT=async l=>{l||(l=sessionStorage.getItem("amma_session_id")),l&&(await Oe.from("user_sessions").delete().eq("session_id",l),sessionStorage.removeItem("amma_session_id"))},Vf=async()=>{const l=await Lc();l&&await Oe.from("user_sessions").delete().eq("user_email",l.email),sessionStorage.removeItem("amma_session_id")};function $T(){const l=Zi(),[e,t]=B.useState(!0),[i,s]=B.useState(""),[a,o]=B.useState(""),[u,d]=B.useState(""),[f,p]=B.useState(!1),m=async()=>{if(!a||!i){alert("Please enter your name and email");return}p(!0);try{const{error:v}=await Oe.from("demo_requests").insert([{name:i,email:a,organization:u,requested_at:new Date().toISOString()}]);v?(console.error("Error submitting demo request:",v),alert("Error submitting demo request. Please try again.")):(alert(" Demo request submitted! We'll be in touch soon."),t(!1))}catch(v){console.error("Error:",v),alert("Error submitting demo request.")}finally{p(!1)}},b=async(v,S,w,E=null)=>{try{console.log(" Creating user:",{email:v,name:S,userType:w,profilePicture:E});const x=S.split(" "),C=x[0]||S,T=x.slice(1).join(" ")||x[0],{data:D,error:M}=await Oe.from("users").select("*").eq("email",v).single();if(M&&M.code!=="PGRST116"&&console.error("Error checking user:",M),D){if(console.log(" User already exists"),E)try{const{error:k}=await Oe.from("users").update({profile_picture:E}).eq("email",v);k&&!k.message?.includes("profile_picture")?console.error(" Error updating profile picture:",k):k||console.log(" Profile picture updated")}catch{console.log(" Could not update profile picture (column may not exist)")}if(w==="patient"&&!D.patient_key){console.log(" Existing patient missing patient_key, generating one...");const k=Math.floor(1e8+Math.random()*9e8).toString(),{error:z}=await Oe.from("users").update({patient_key:k}).eq("email",v);z?console.error(" Error updating patient_key:",z):console.log(" Patient key generated and saved:",k)}}else{console.log(" Creating new user...");let k=null;w==="patient"&&(k=Math.floor(1e8+Math.random()*9e8).toString(),console.log(" Generated patient key:",k));let z={email:v,first_name:C,last_name:T,user_type:w,patient_key:k,profile_picture:E},{error:H}=await Oe.from("users").insert([z]);if(H&&H.message?.includes("profile_picture")){console.log(" profile_picture column not found, creating user without it...");const{email:ne,first_name:ie,last_name:ce,user_type:ge,patient_key:le}=z,{error:ue}=await Oe.from("users").insert([{email:ne,first_name:ie,last_name:ce,user_type:ge,patient_key:le}]);if(ue)return console.error(" Error creating user (retry):",ue),alert("Error creating account: "+ue.message),!1}else if(H)return console.error(" Error creating user:",H),alert("Error creating account: "+H.message),!1;console.log(" User created",E?"with profile picture":"")}console.log(" Creating session...");const N=await HT(v,S,w,E);return N?(console.log(" Session created:",N),!0):(console.error(" Session creation failed"),alert("Error creating session. Please try again."),!1)}catch(x){return console.error(" Login error:",x),alert("Login failed: "+x.message),!1}};return _.jsxs("div",{className:"login-page",children:[e&&_.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"1rem"},children:_.jsxs("div",{style:{background:"linear-gradient(135deg, #ffffff 0%, #f9fafb 100%)",borderRadius:"24px",padding:"3rem 2.5rem",maxWidth:"520px",width:"100%",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.3)",border:"1px solid rgba(124, 58, 237, 0.2)",position:"relative",animation:"modalSlideIn 0.4s ease-out"},children:[_.jsx("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",width:"calc(100% - 2px)",height:"6px",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",borderRadius:"24px 24px 0 0"}}),_.jsx("div",{style:{width:"80px",height:"80px",margin:"0 auto 1.5rem",borderRadius:"50%",background:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(124, 58, 237, 0.3)",border:"3px solid rgba(124, 58, 237, 0.2)"},children:_.jsx("img",{src:"/images/Black Elephant Flat Illustrative Company Logo.png",alt:"Amma Logo",style:{width:"60px",height:"60px",objectFit:"contain"}})}),_.jsx("h2",{style:{fontSize:"2rem",fontWeight:"800",textAlign:"center",marginBottom:"1rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Beta Access Only"}),_.jsxs("p",{style:{fontSize:"1.125rem",color:"#64748b",textAlign:"center",lineHeight:"1.7",marginBottom:"2rem"},children:["We're currently in private beta with select healthcare providers.",_.jsx("br",{}),_.jsx("strong",{style:{color:"#1f2937"},children:"Launching publicly soon!"})]}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginBottom:"2rem",padding:"1.5rem",background:"rgba(124, 58, 237, 0.05)",borderRadius:"12px",border:"1px solid rgba(124, 58, 237, 0.1)"},children:[_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#7c3aed"},children:"100+"}),_.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},children:"Clinicians"})]}),_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#7c3aed"},children:"5000+"}),_.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},children:"Videos"})]}),_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"800",color:"#7c3aed"},children:"50%"}),_.jsx("div",{style:{fontSize:"0.75rem",color:"#9ca3af",marginTop:"0.25rem"},children:"Decrease in appointment lengths"})]})]}),_.jsxs("div",{style:{marginBottom:"1.5rem"},children:[_.jsx("input",{type:"text",placeholder:"Your Name *",value:i,onChange:v=>s(v.target.value),style:{width:"100%",padding:"0.875rem",marginBottom:"0.75rem",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"0.95rem",fontFamily:"inherit",transition:"all 0.2s"},onFocus:v=>v.target.style.borderColor="#7c3aed",onBlur:v=>v.target.style.borderColor="#e5e7eb"}),_.jsx("input",{type:"email",placeholder:"Email Address *",value:a,onChange:v=>o(v.target.value),style:{width:"100%",padding:"0.875rem",marginBottom:"0.75rem",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"0.95rem",fontFamily:"inherit",transition:"all 0.2s"},onFocus:v=>v.target.style.borderColor="#7c3aed",onBlur:v=>v.target.style.borderColor="#e5e7eb"}),_.jsx("input",{type:"text",placeholder:"Organization / Practice (optional)",value:u,onChange:v=>d(v.target.value),style:{width:"100%",padding:"0.875rem",border:"2px solid #e5e7eb",borderRadius:"10px",fontSize:"0.95rem",fontFamily:"inherit",transition:"all 0.2s"},onFocus:v=>v.target.style.borderColor="#7c3aed",onBlur:v=>v.target.style.borderColor="#e5e7eb"})]}),_.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[_.jsx("button",{onClick:m,disabled:f,style:{padding:"1rem 2rem",background:f?"#9ca3af":"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",border:"none",borderRadius:"12px",color:"white",fontSize:"1rem",fontWeight:"600",cursor:f?"not-allowed":"pointer",boxShadow:"0 4px 16px rgba(124, 58, 237, 0.3)",transition:"all 0.3s"},onMouseEnter:v=>!f&&(v.target.style.transform="translateY(-2px)"),onMouseLeave:v=>!f&&(v.target.style.transform="translateY(0)"),children:f?"Submitting...":" Request Demo Access"}),_.jsx("button",{onClick:()=>t(!1),style:{padding:"1rem 2rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"12px",color:"#64748b",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s"},onMouseEnter:v=>{v.target.style.borderColor="#7c3aed",v.target.style.color="#7c3aed"},onMouseLeave:v=>{v.target.style.borderColor="#e5e7eb",v.target.style.color="#64748b"},children:"Continue to Login"})]}),_.jsx("p",{style:{fontSize:"0.875rem",color:"#9ca3af",textAlign:"center",marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid #f0f0f0"},children:"Interested in early access? Request a demo to learn more."})]})}),_.jsx("style",{children:`
        @keyframes modalSlideIn {
          from {
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
      `}),_.jsx("button",{className:"back-button",onClick:()=>l("/"),children:" Back to Home"}),_.jsxs("div",{className:"login-container",children:[_.jsx("h1",{className:"login-title",children:"Welcome to Amma"}),_.jsx("p",{className:"login-subtitle",children:"Sign in or create an account to get started"}),_.jsxs("div",{className:"login-options",children:[_.jsxs("div",{className:"login-section",children:[_.jsx("h2",{children:"I'm a Patient"}),_.jsx("p",{style:{marginBottom:"15px",color:"#666",fontSize:"14px"},children:"Access your personalized health information"}),_.jsx("div",{style:{display:"flex",justifyContent:"center"},children:_.jsx(R0,{onSuccess:async v=>{const S=k0(v.credential);console.log(" Patient login successful:",{email:S.email,name:S.name,picture:S.picture}),await b(S.email,S.name,"patient",S.picture)&&l("/patient")},onError:()=>{console.error(" Google login failed"),alert("Login failed. Please try again.")}})})]}),_.jsx("div",{className:"divider",children:_.jsx("span",{children:"OR"})}),_.jsxs("div",{className:"login-section",children:[_.jsx("h2",{children:"I'm a Doctor"}),_.jsx("p",{style:{marginBottom:"15px",color:"#666",fontSize:"14px"},children:"Manage your practice and patients"}),_.jsx("div",{style:{display:"flex",justifyContent:"center"},children:_.jsx(R0,{onSuccess:async v=>{const S=k0(v.credential);console.log(" Doctor login successful:",{email:S.email,name:S.name,picture:S.picture}),await b(S.email,S.name,"doctor",S.picture)&&l("/doctor")},onError:()=>{console.error(" Google login failed"),alert("Login failed. Please try again.")}})})]})]})]})]})}function GT(){const l=Zi(),e=Ji(),t=e.state?.name||"User",i=e.state?.email||"",[s,a]=B.useState(""),[o,u]=B.useState(!0);B.useEffect(()=>{if(console.log(" User Data:",{userName:t,userEmail:i}),!i){alert(" No email found! Please log in again."),l("/login");return}d()},[]);const d=async()=>{try{const{data:m,error:b}=await Oe.from("user_notes").select("*").eq("email",i).single();if(b){console.warn("Supabase error - using localStorage fallback:",b.message);const v=localStorage.getItem(`notes_${i}`);v&&a(v)}else m&&a(m.notes||"")}catch{console.log("Loading from localStorage");const b=localStorage.getItem(`notes_${i}`);b&&a(b)}u(!1)},f=async()=>{console.log("Saving for:",i);const{data:m,error:b}=await Oe.from("user_notes").upsert({email:i,name:t,notes:s});b?(console.error("Supabase save error:",b),localStorage.setItem(`notes_${i}`,s),alert(` Saved locally (Supabase blocked)

Fix Supabase RLS to save to cloud!
See YOU_MUST_DO_THIS.md`)):(console.log("Saved to Supabase!"),localStorage.setItem(`notes_${i}`,s),alert("Notes saved to cloud! "))},p=()=>{l("/login")};return o?_.jsx("div",{className:"profile-page",children:_.jsx("div",{className:"profile-container",children:"Loading..."})}):_.jsx("div",{className:"profile-page",children:_.jsxs("div",{className:"profile-container",children:[_.jsxs("h1",{className:"profile-welcome",children:["Welcome, ",t,"! "]}),_.jsx("p",{className:"profile-subtitle",children:"You're now logged in to Amma"}),_.jsxs("div",{style:{margin:"30px 0"},children:[_.jsx("h3",{style:{marginBottom:"10px"},children:"Your Notes:"}),_.jsx("textarea",{value:s,onChange:m=>a(m.target.value),placeholder:"Type your notes here...",style:{width:"100%",minHeight:"200px",padding:"15px",fontSize:"16px",borderRadius:"12px",border:"2px solid #ddd",fontFamily:"inherit"}}),_.jsx("button",{onClick:f,style:{marginTop:"10px",padding:"12px 30px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},children:"Save Notes"})]}),_.jsxs("div",{className:"profile-actions",children:[_.jsx("button",{className:"btn-primary",onClick:()=>l("/"),children:"Go to Home"}),_.jsx("button",{className:"btn-secondary",onClick:p,children:"Logout"})]})]})})}function VT(l){if(!l)return!1;const e=l.toString().trim();return/^\d{9}$/.test(e)}function mw(l){if(!l)return"";const e=l.toString().trim();return e.length!==9?e:`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6,9)}`}function YT(l){return l?l.toString().replace(/\D/g,""):""}async function WT(l){try{return await navigator.clipboard.writeText(l),!0}catch{const t=document.createElement("textarea");t.value=l,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.select();try{return document.execCommand("copy"),document.body.removeChild(t),!0}catch{return document.body.removeChild(t),!1}}}var yw={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},sb=xn.createContext&&xn.createContext(yw),XT=["attr","size","title"];function KT(l,e){if(l==null)return{};var t=QT(l,e),i,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(l);for(s=0;s<a.length;s++)i=a[s],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(l,i)&&(t[i]=l[i])}return t}function QT(l,e){if(l==null)return{};var t={};for(var i in l)if(Object.prototype.hasOwnProperty.call(l,i)){if(e.indexOf(i)>=0)continue;t[i]=l[i]}return t}function Ec(){return Ec=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(l[i]=t[i])}return l},Ec.apply(this,arguments)}function rb(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),t.push.apply(t,i)}return t}function xc(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rb(Object(t),!0).forEach(function(i){JT(l,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):rb(Object(t)).forEach(function(i){Object.defineProperty(l,i,Object.getOwnPropertyDescriptor(t,i))})}return l}function JT(l,e,t){return e=ZT(e),e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function ZT(l){var e=eC(l,"string");return typeof e=="symbol"?e:e+""}function eC(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var i=t.call(l,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function bw(l){return l&&l.map((e,t)=>xn.createElement(e.tag,xc({key:t},e.attr),bw(e.child)))}function zt(l){return e=>xn.createElement(tC,Ec({attr:xc({},l.attr)},e),bw(l.child))}function tC(l){var e=t=>{var{attr:i,size:s,title:a}=l,o=KT(l,XT),u=s||t.size||"1em",d;return t.className&&(d=t.className),l.className&&(d=(d?d+" ":"")+l.className),xn.createElement("svg",Ec({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,o,{className:d,style:xc(xc({color:l.color||t.color},t.style),l.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),a&&xn.createElement("title",null,a),l.children)};return sb!==void 0?xn.createElement(sb.Consumer,null,t=>e(t)):e(yw)}function vw(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"22 12 18 12 15 21 9 3 6 12 2 12"},child:[]}]})(l)}function ab(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"},child:[]},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"},child:[]},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"},child:[]},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"},child:[]}]})(l)}function iC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"},child:[]}]})(l)}function nC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"polyline",attr:{points:"12 6 12 12 16 14"},child:[]}]})(l)}function sC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"},child:[]},{tag:"path",attr:{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"},child:[]}]})(l)}function ob(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"},child:[]},{tag:"polyline",attr:{points:"14 2 14 8 20 8"},child:[]},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"},child:[]},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"},child:[]},{tag:"polyline",attr:{points:"10 9 9 9 8 9"},child:[]}]})(l)}function rC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"},child:[]},{tag:"path",attr:{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"},child:[]},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"},child:[]}]})(l)}function ww(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(l)}function lb(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"},child:[]}]})(l)}function cb(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"},child:[]},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"},child:[]}]})(l)}function aC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"line",attr:{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},child:[]}]})(l)}function oC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"22",y1:"2",x2:"11",y2:"13"},child:[]},{tag:"polygon",attr:{points:"22 2 15 22 11 13 2 9 22 2"},child:[]}]})(l)}function pc(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"12",cy:"7",r:"4"},child:[]}]})(l)}function lC(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"},child:[]},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"},child:[]},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"},child:[]},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"},child:[]}]})(l)}function tc(l){return zt({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"},child:[]},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"},child:[]}]})(l)}function cC(l){return zt({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm6 11h-3v3h-2v-3H8v-2h3v-3h2v3h3v2z"},child:[]}]})(l)}function uC(){const l=Zi(),[e,t]=B.useState("Patient"),[i,s]=B.useState(""),[a,o]=B.useState(""),[u,d]=B.useState(""),[f,p]=B.useState(!1),[m,b]=B.useState(""),[v,S]=B.useState(!0),[w,E]=B.useState("diagnosis"),[x,C]=B.useState([]),[T,D]=B.useState(""),[M,N]=B.useState(!1),[k,z]=B.useState(null),[H,ne]=B.useState([]),[ie,ce]=B.useState([]);B.useEffect(()=>{ge()},[]);const ge=async()=>{console.log(" PatientProfile: Checking session...");try{const I=await Lc();if(console.log(" Session data:",I),!I||I.userType!=="patient"){console.log(" No valid patient session"),alert(" No active session found! Please log in."),l("/login");return}console.log(" Valid patient session found"),t(I.name),s(I.email),o(I.profilePicture||""),await le(I.email),await ue(I.email),await j(I.email),await J(I.email),oe()}catch(I){console.error(" Error checking session:",I),alert("Error loading profile: "+I.message),l("/login")}},le=async I=>{try{const{data:W,error:ae}=await Oe.from("users").select("patient_key, first_name, last_name").eq("email",I).eq("user_type","patient").single();if(ae)throw ae;if(W&&(W.patient_key&&d(W.patient_key),W.first_name||W.last_name)){const re=`${W.first_name||""} ${W.last_name||""}`.trim();re&&t(re)}}catch(W){console.log("Error loading patient data:",W)}},ue=async I=>{try{const{data:W,error:ae}=await Oe.from("patient_files").select("*").eq("patient_email",I).eq("file_type","video").order("created_at",{ascending:!1});ae?console.error("Error loading files:",ae):W&&W.length>0&&b(W[0].file_url)}catch(W){console.log("Error loading files:",W)}S(!1)},j=async I=>{try{const{data:W,error:ae}=await Oe.from("epic_patient_data").select("*").eq("patient_email",I).order("created_at",{ascending:!1}).limit(1).single();ae&&ae.code!=="PGRST116"&&console.error("Error loading Epic data:",ae),z(W)}catch(W){console.log("Error loading patient medical data:",W)}},J=async I=>{try{const{data:W,error:ae}=await Oe.from("patient_files").select("extracted_text, file_name").eq("patient_email",I).eq("file_type","file").order("created_at",{ascending:!1});ae?console.error("Error loading uploaded files:",ae):ne(W||[])}catch(W){console.log("Error loading uploaded files:",W)}},oe=()=>{const W=[1,3,5,7,10,14,17,21,24,30].map(ae=>({day:ae,title:`Day ${ae} Recovery Checkpoint`,description:K(ae),videoUrl:"/images/20251121_0810_01kakjqdsse5jb6f3mdz9p3j0t.mp4",locked:ae>X()}));ce(W)},K=I=>({1:"Initial assessment and care instructions",3:"Early recovery progress check",5:"Wound healing and medication review",7:"First week milestone - mobility assessment",10:"Pain management and physical therapy",14:"Two-week checkup and activity guidance",17:"Mid-recovery wellness check",21:"Three-week progress and independence",24:"Advanced recovery exercises",30:"Final milestone and long-term care plan"})[I]||"Recovery progress checkpoint",X=()=>7,O=async()=>{await WT(u)&&(p(!0),setTimeout(()=>p(!1),2e3))},U=async()=>{await Vf(),l("/")},q=async()=>{if(!T.trim())return;const I=T.trim();D(""),C(W=>[...W,{role:"user",content:I}]),N(!0),setTimeout(async()=>{const W=V(I,k,H),ae=[...x,{role:"user",content:I},{role:"assistant",content:W,timestamp:new Date().toISOString()}];C(ae),N(!1)},1e3)},se=async I=>{const W="/images/20251121_0810_01kakjqdsse5jb6f3mdz9p3j0t.mp4",ae={role:"assistant",content:"Here is a personalized video explanation based on our discussion:",videoUrl:W,timestamp:new Date().toISOString()};C(re=>[...re,ae]),b(W);try{await Oe.from("patient_files").insert([{doctor_email:"system@amma.health",patient_email:i,file_type:"video",file_url:W,file_name:`ai_generated_video_${new Date().getTime()}.mp4`}])}catch(re){console.error("Error saving video:",re)}},V=(I,W,ae)=>{const re=I.toLowerCase(),de=W||ae&&ae.length>0;return re.includes("diagnosis")||re.includes("condition")?W?.diagnoses?`Based on your medical records, your condition includes: ${W.diagnoses}. This means your body is experiencing specific health challenges that we're actively managing with your treatment plan.`:"Your diagnosis information will be available here once your doctor uploads your medical records or syncs with Epic.":re.includes("medication")||re.includes("medicine")?W?.medications?`You are currently prescribed: ${W.medications}. It's important to take these as directed. Would you like a video explaining how these medications work?`:"Your medication information will appear here once your doctor adds it to your records.":re.includes("recovery")||re.includes("healing")?"Recovery is a journey that takes time. Focus on rest, proper nutrition, following your medication schedule, and attending all follow-up appointments. Check the Recovery Plan tab for your personalized 30-day recovery roadmap.":re.includes("pain")?"Pain management is crucial for recovery. If you're experiencing pain beyond what your prescribed medications can manage, contact your doctor immediately. In the meantime, rest, ice/heat therapy (as instructed), and elevation can help.":de?"I'm here to help you understand your health better. You can ask me about your diagnosis, medications, recovery process, or any symptoms you're experiencing. Would you like me to create a video explanation for any specific topic?":"Hello! I'm your AI health assistant. Once your doctor uploads your medical information or syncs with Epic, I'll be able to answer detailed questions about your condition, medications, and recovery plan. Feel free to ask me anything!"};return v?_.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:_.jsxs("div",{style:{textAlign:"center",color:"white"},children:[_.jsx(vw,{size:48,style:{animation:"spin 2s linear infinite"}}),_.jsx("p",{style:{marginTop:"1rem",fontSize:"1.1rem"},children:"Loading your health dashboard..."})]})}):_.jsxs("div",{style:{minHeight:"100vh",background:"#f8f9fa"},children:[_.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[_.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"1.5rem 2rem",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[_.jsx("img",{src:"/images/Black Elephant Flat Illustrative Company Logo.png",alt:"Amma Logo",style:{height:"50px",width:"50px",objectFit:"contain",filter:"brightness(0) invert(1)"}}),_.jsxs("div",{children:[_.jsx("h1",{style:{margin:0,fontSize:"1.5rem",fontWeight:"700",color:"white",letterSpacing:"-0.02em"},children:"Patient Portal"}),_.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.9)",marginTop:"0.25rem"},children:["Welcome back, ",e]})]})]}),_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[u&&_.jsxs("div",{onClick:O,style:{background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",borderRadius:"12px",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",transition:"all 0.2s",border:"1px solid rgba(255, 255, 255, 0.2)",":hover":{background:"rgba(255, 255, 255, 0.25)"}},onMouseEnter:I=>{I.currentTarget.style.background="rgba(255, 255, 255, 0.25)",I.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:I=>{I.currentTarget.style.background="rgba(255, 255, 255, 0.15)",I.currentTarget.style.transform="translateY(0)"},children:[_.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[_.jsx("span",{style:{fontSize:"0.65rem",color:"rgba(255, 255, 255, 0.8)",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Patient ID"}),_.jsx("span",{style:{fontSize:"0.95rem",color:"white",fontWeight:"700",fontFamily:"monospace",letterSpacing:"0.05em"},children:mw(u)})]}),f?_.jsx(iC,{size:18,color:"white"}):_.jsx(sC,{size:16,color:"rgba(255, 255, 255, 0.9)"})]}),_.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},children:a?_.jsx("img",{src:a,alt:e,style:{width:"100%",height:"100%",objectFit:"cover"}}):_.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:_.jsx(pc,{size:24,color:"white"})})}),_.jsxs("button",{onClick:U,style:{padding:"0.625rem 1.25rem",background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"10px",color:"white",fontWeight:"600",fontSize:"0.9rem",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:I=>{I.currentTarget.style.background="rgba(255, 255, 255, 0.25)",I.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:I=>{I.currentTarget.style.background="rgba(255, 255, 255, 0.15)",I.currentTarget.style.transform="translateY(0)"},children:[_.jsx(ww,{size:16}),"Logout"]})]})]}),_.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"0 2rem",display:"flex",gap:"0.5rem",borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:[{id:"diagnosis",label:"Diagnosis Video",icon:tc},{id:"chat",label:"AI Health Assistant",icon:lb},{id:"recovery",label:"30-Day Recovery Plan",icon:ab}].map(I=>{const W=I.icon;return _.jsxs("button",{onClick:()=>E(I.id),style:{padding:"1rem 1.5rem",background:w===I.id?"rgba(255, 255, 255, 0.15)":"transparent",border:"none",borderBottom:w===I.id?"3px solid white":"3px solid transparent",color:"white",fontWeight:w===I.id?"600":"500",fontSize:"0.95rem",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem",opacity:w===I.id?1:.8},onMouseEnter:ae=>{w!==I.id&&(ae.currentTarget.style.background="rgba(255, 255, 255, 0.1)",ae.currentTarget.style.opacity="1")},onMouseLeave:ae=>{w!==I.id&&(ae.currentTarget.style.background="transparent",ae.currentTarget.style.opacity="0.8")},children:[_.jsx(W,{size:18}),I.label]},I.id)})})]}),_.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"2.5rem 2rem"},children:[w==="diagnosis"&&_.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"2.5rem",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",border:"1px solid #e5e7eb"},children:[_.jsxs("div",{style:{marginBottom:"2rem"},children:[_.jsxs("h2",{style:{fontSize:"1.75rem",fontWeight:"700",color:"#1f2937",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[_.jsx(tc,{size:28,color:"#667eea"}),"Your Personalized Diagnosis Video"]}),_.jsx("p",{style:{fontSize:"1rem",color:"#6b7280",margin:0},children:"Watch this video to understand your diagnosis and treatment plan"})]}),m?_.jsx("div",{style:{borderRadius:"12px",overflow:"hidden",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.1)",background:"#000"},children:_.jsx("video",{controls:!0,style:{width:"100%",maxHeight:"600px",display:"block"},src:m,children:"Your browser does not support the video tag."})}):_.jsxs("div",{style:{textAlign:"center",padding:"5rem 2rem",background:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",borderRadius:"12px",border:"2px dashed #d1d5db"},children:[_.jsx(cC,{size:64,color:"#9ca3af"}),_.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#4b5563",margin:"1.5rem 0 0.75rem"},children:"No Video Available Yet"}),_.jsx("p",{style:{fontSize:"1rem",color:"#6b7280",maxWidth:"500px",margin:"0 auto"},children:"Your doctor will generate a personalized video explanation of your diagnosis. Check back soon or contact your healthcare provider."})]})]}),w==="chat"&&_.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"2.5rem",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",border:"1px solid #e5e7eb"},children:[_.jsxs("div",{style:{marginBottom:"2rem"},children:[_.jsxs("h2",{style:{fontSize:"1.75rem",fontWeight:"700",color:"#1f2937",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[_.jsx(lb,{size:28,color:"#667eea"}),"AI Health Assistant"]}),_.jsx("p",{style:{fontSize:"1rem",color:"#6b7280",margin:0},children:"Ask questions about your condition, medications, and recovery plan"})]}),_.jsx("div",{style:{minHeight:"400px",maxHeight:"500px",overflowY:"auto",marginBottom:"1.5rem",padding:"1.5rem",background:"#f9fafb",borderRadius:"12px",border:"1px solid #e5e7eb"},children:x.length===0?_.jsxs("div",{style:{textAlign:"center",paddingTop:"3rem"},children:[_.jsx(rC,{size:48,color:"#9ca3af"}),_.jsx("p",{style:{color:"#6b7280",marginTop:"1rem",fontSize:"1.05rem"},children:"Start a conversation by asking a question below"}),_.jsx("div",{style:{marginTop:"1.5rem",display:"flex",flexDirection:"column",gap:"0.75rem",maxWidth:"500px",margin:"1.5rem auto 0"},children:["What is my diagnosis?","Tell me about my medications","How long will recovery take?"].map((I,W)=>_.jsx("button",{onClick:()=>D(I),style:{padding:"0.75rem 1rem",background:"white",border:"1px solid #e5e7eb",borderRadius:"8px",color:"#4b5563",fontSize:"0.95rem",cursor:"pointer",transition:"all 0.2s",textAlign:"left"},onMouseEnter:ae=>{ae.currentTarget.style.borderColor="#667eea",ae.currentTarget.style.background="#f9fafb"},onMouseLeave:ae=>{ae.currentTarget.style.borderColor="#e5e7eb",ae.currentTarget.style.background="white"},children:I},W))})]}):_.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[x.map((I,W)=>_.jsxs("div",{children:[_.jsx("div",{style:{display:"flex",justifyContent:I.role==="user"?"flex-end":"flex-start"},children:_.jsx("div",{style:{maxWidth:"75%",padding:"1rem 1.25rem",borderRadius:I.role==="user"?"16px 16px 4px 16px":"16px 16px 16px 4px",background:I.role==="user"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white",color:I.role==="user"?"white":"#1f2937",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",border:I.role==="user"?"none":"1px solid #e5e7eb",fontSize:"0.95rem",lineHeight:"1.6"},children:I.content})}),I.videoUrl&&_.jsx("div",{style:{marginTop:"1rem",borderRadius:"12px",overflow:"hidden",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.1)",maxWidth:"75%"},children:_.jsx("video",{controls:!0,style:{width:"100%",display:"block"},src:I.videoUrl,children:"Your browser does not support the video tag."})}),I.role==="assistant"&&!I.videoUrl&&_.jsx("div",{style:{marginTop:"0.5rem"},children:_.jsxs("button",{onClick:()=>se(),style:{padding:"0.5rem 1rem",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"8px",color:"white",fontSize:"0.85rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:ae=>{ae.currentTarget.style.transform="translateY(-2px)",ae.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},onMouseLeave:ae=>{ae.currentTarget.style.transform="translateY(0)",ae.currentTarget.style.boxShadow="none"},children:[_.jsx(tc,{size:16}),"Generate Video Explanation"]})})]},W)),M&&_.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",color:"#6b7280"},children:[_.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#667eea",animation:"pulse 1.5s ease-in-out infinite"}}),_.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#667eea",animation:"pulse 1.5s ease-in-out 0.2s infinite"}}),_.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#667eea",animation:"pulse 1.5s ease-in-out 0.4s infinite"}}),_.jsx("span",{style:{marginLeft:"0.5rem",fontSize:"0.9rem"},children:"AI is thinking..."})]})]})}),_.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-end"},children:[_.jsx("div",{style:{flex:1},children:_.jsx("textarea",{value:T,onChange:I=>D(I.target.value),onKeyPress:I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),q())},placeholder:"Ask a question about your health...",style:{width:"100%",padding:"1rem 1.25rem",borderRadius:"12px",border:"2px solid #e5e7eb",fontSize:"0.95rem",fontFamily:"inherit",resize:"none",minHeight:"60px",transition:"all 0.2s"},onFocus:I=>I.currentTarget.style.borderColor="#667eea",onBlur:I=>I.currentTarget.style.borderColor="#e5e7eb"})}),_.jsxs("button",{onClick:q,disabled:!T.trim()||M,style:{padding:"1rem 1.5rem",background:T.trim()&&!M?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"#e5e7eb",border:"none",borderRadius:"12px",color:"white",fontWeight:"600",fontSize:"0.95rem",cursor:T.trim()&&!M?"pointer":"not-allowed",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem",minHeight:"60px"},onMouseEnter:I=>{T.trim()&&!M&&(I.currentTarget.style.transform="translateY(-2px)",I.currentTarget.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)")},onMouseLeave:I=>{T.trim()&&!M&&(I.currentTarget.style.transform="translateY(0)",I.currentTarget.style.boxShadow="none")},children:[_.jsx(oC,{size:18}),"Send"]})]})]}),w==="recovery"&&_.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"2.5rem",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",border:"1px solid #e5e7eb"},children:[_.jsxs("div",{style:{marginBottom:"2rem"},children:[_.jsxs("h2",{style:{fontSize:"1.75rem",fontWeight:"700",color:"#1f2937",marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.75rem"},children:[_.jsx(ab,{size:28,color:"#667eea"}),"30-Day Recovery Plan"]}),_.jsx("p",{style:{fontSize:"1rem",color:"#6b7280",margin:0},children:"Your personalized recovery milestones and educational videos"})]}),_.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"1.5rem"},children:ie.map((I,W)=>{const ae=X(),re=I.day<=ae,de=I.day===ae;return _.jsxs("div",{style:{background:re?de?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"white":"#f9fafb",borderRadius:"12px",padding:"1.5rem",border:re?"2px solid":"2px dashed #d1d5db",borderColor:de?"transparent":re?"#e5e7eb":"#d1d5db",boxShadow:re?"0 4px 12px rgba(0, 0, 0, 0.08)":"none",opacity:re?1:.6,cursor:re?"pointer":"not-allowed",transition:"all 0.2s",color:de?"white":"#1f2937"},onMouseEnter:Se=>{re&&!de&&(Se.currentTarget.style.transform="translateY(-4px)",Se.currentTarget.style.boxShadow="0 8px 20px rgba(0, 0, 0, 0.12)")},onMouseLeave:Se=>{re&&!de&&(Se.currentTarget.style.transform="translateY(0)",Se.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.08)")},children:[_.jsxs("div",{style:{fontSize:"2rem",fontWeight:"800",marginBottom:"0.75rem",color:de?"white":"#667eea"},children:["Day ",I.day]}),_.jsx("h3",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"0.5rem",color:de?"white":"#1f2937"},children:I.title}),_.jsx("p",{style:{fontSize:"0.9rem",color:de?"rgba(255, 255, 255, 0.9)":"#6b7280",lineHeight:"1.5",marginBottom:"1rem"},children:I.description}),re?_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",fontWeight:"600",color:de?"white":"#667eea"},children:[_.jsx(tc,{size:16}),de?"Watch Now":"Available"]}):_.jsxs("div",{style:{fontSize:"0.85rem",color:"#9ca3af",fontWeight:"600"},children:[" Unlocks Day ",I.day]})]},W)})}),_.jsxs("div",{style:{marginTop:"2.5rem",padding:"1.5rem",background:"#f9fafb",borderRadius:"12px"},children:[_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.75rem"},children:[_.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"600",color:"#1f2937"},children:"Recovery Progress"}),_.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"600",color:"#667eea"},children:["Day ",X()," of 30"]})]}),_.jsx("div",{style:{width:"100%",height:"12px",background:"#e5e7eb",borderRadius:"6px",overflow:"hidden"},children:_.jsx("div",{style:{width:`${X()/30*100}%`,height:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",transition:"width 0.3s ease"}})})]})]})]}),_.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 0.4; }
          50% { opacity: 1; }
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}async function ub(l,e=void 0){if(!e)return console.warn(" No encryption key found. Using fallback (NOT SECURE for production)"),"UNENCRYPTED:"+btoa(l);try{const t=Uint8Array.from(atob(e),d=>d.charCodeAt(0)),i=await crypto.subtle.importKey("raw",t,{name:"AES-GCM",length:256},!1,["encrypt"]),s=crypto.getRandomValues(new Uint8Array(12)),a=new TextEncoder,o=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},i,a.encode(l)),u=new Uint8Array(s.length+o.byteLength);return u.set(s,0),u.set(new Uint8Array(o),s.length),btoa(String.fromCharCode(...u))}catch(t){throw console.error(" Encryption failed:",t),new Error("Encryption failed: "+t.message)}}function hC(l){const{patient:e,conditions:t,medications:i,documents:s,observations:a}=l;let o="";return e&&(o+=`PATIENT INFORMATION
`,o+=`Name: ${e.name}
`,o+=`Age: ${e.age} years old
`,o+=`Gender: ${e.gender}
`,o+=`MRN: ${e.mrn}

`),t&&t.length>0&&(o+=`DIAGNOSES
`,t.filter(d=>d.clinicalStatus==="active"||!d.clinicalStatus).forEach((d,f)=>{o+=`${f+1}. ${d.display}`,d.onsetDate&&(o+=` (since ${Ad(d.onsetDate)})`),d.note&&(o+=`
   Note: ${d.note}`),o+=`
`}),o+=`
`),i&&i.length>0&&(o+=`CURRENT MEDICATIONS
`,i.filter(d=>d.status==="active"||d.status==="unknown").forEach((d,f)=>{o+=`${f+1}. ${d.name}`,d.dosage&&(o+=` - ${d.dosage}`),d.frequency&&(o+=` (${d.frequency})`),d.instructions&&(o+=`
   Instructions: ${d.instructions}`),o+=`
`}),o+=`
`),s&&s.length>0&&(o+=`RECENT CLINICAL NOTES
`,s.slice(0,3).forEach((u,d)=>{o+=`${d+1}. ${u.type} - ${Ad(u.date)}
`,u.description&&(o+=`   ${u.description}
`)}),o+=`
`),a&&a.length>0&&(o+=`RECENT LAB RESULTS
`,a.filter(d=>d.category==="laboratory").slice(0,5).forEach((d,f)=>{o+=`${f+1}. ${d.display}: ${d.value}`,d.unit&&(o+=` ${d.unit}`),d.interpretation&&(o+=` (${d.interpretation})`),o+=` - ${Ad(d.date)}
`})),o.trim()}function Ad(l){return l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown"}const ic={clientId:"64b06556-5871-4703-a7c4-095821d64e36",redirectUri:"http://localhost:5182/epic-callback",tokenUrl:"https://api.plasma.health/oauth2/token",fhirApiBase:"https://api.plasma.health/fhir/r4"};function dC(l){return console.log(" Demo Mode: Skipping OAuth, creating demo connection"),fC(l),null}async function fC(l){try{const e=new Date(Date.now()+31536e6),{error:t}=await Oe.from("epic_tokens").upsert({doctor_email:l,access_token:"demo-token-"+Date.now(),refresh_token:"demo-refresh-"+Date.now(),expires_at:e.toISOString(),epic_base_url:"https://demo.plasma.health"},{onConflict:"doctor_email"});t?console.error("Error creating demo connection:",t):(console.log(" Demo connection created"),await Pc({doctor_email:l,action:"demo_connection_created",epic_resource_accessed:"Demo Mode Connection"}))}catch(e){console.error("Error in createDemoConnection:",e)}}async function pC(l,e){console.log(" Handling Epic OAuth callback...");const t=sessionStorage.getItem("epic_oauth_state");if(e!==t)throw new Error("Invalid OAuth state - possible CSRF attack");const i=sessionStorage.getItem("epic_oauth_doctor_email");if(!i)throw new Error("No doctor email found in session");const s=await fetch(ic.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:l,redirect_uri:ic.redirectUri,client_id:ic.clientId})});if(!s.ok){const p=await s.text();throw console.error(" Token exchange failed:",p),new Error("Failed to exchange authorization code: "+p)}const a=await s.json();console.log(" Tokens received from Epic");const o=new Date(Date.now()+a.expires_in*1e3),u=await ub(a.access_token),d=a.refresh_token?await ub(a.refresh_token):null,{error:f}=await Oe.from("epic_tokens").upsert({doctor_email:i,access_token:u,refresh_token:d,expires_at:o.toISOString(),epic_base_url:ic.fhirApiBase},{onConflict:"doctor_email"});if(f)throw console.error(" Failed to store tokens:",f),new Error("Failed to store Epic tokens: "+f.message);return await Pc({doctor_email:i,action:"epic_oauth_connected",epic_resource_accessed:"OAuth Token"}),sessionStorage.removeItem("epic_oauth_state"),sessionStorage.removeItem("epic_oauth_doctor_email"),console.log(" Epic tokens stored securely"),{success:!0,doctorEmail:i}}function Nr(){return[{id:"demo-patient-1",name:"Anish Polakala",firstName:"Anish",lastName:"Polakala",gender:"male",birthDate:"1992-08-15",age:new Date().getFullYear()-1992,mrn:"MRN001234",phone:"555-0100",email:"anish.polakala@example.com",address:"123 Commonwealth Ave, Boston, MA 02116"},{id:"demo-patient-2",name:"Keisha Washington",firstName:"Keisha",lastName:"Washington",gender:"female",birthDate:"1985-03-22",age:new Date().getFullYear()-1985,mrn:"MRN005678",phone:"555-0101",email:"keisha.washington@example.com",address:"456 Blue Hill Ave, Boston, MA 02121"},{id:"demo-patient-3",name:"Mei Lin Zhang",firstName:"Mei Lin",lastName:"Zhang",gender:"female",birthDate:"1990-11-08",age:new Date().getFullYear()-1990,mrn:"MRN009876",phone:"555-0102",email:"meilin.zhang@example.com",address:"789 Beach St, Boston, MA 02111"},{id:"demo-patient-4",name:"Jamal Thompson",firstName:"Jamal",lastName:"Thompson",gender:"male",birthDate:"1978-06-14",age:new Date().getFullYear()-1978,mrn:"MRN004321",phone:"555-0103",email:"jamal.thompson@example.com",address:"321 Warren St, Boston, MA 02119"},{id:"demo-patient-5",name:"Priya Sharma",firstName:"Priya",lastName:"Sharma",gender:"female",birthDate:"1988-12-19",age:new Date().getFullYear()-1988,mrn:"MRN007654",phone:"555-0104",email:"priya.sharma@example.com",address:"567 Cambridge St, Boston, MA 02114"}]}async function gC(l,e){{console.log(" Demo Mode: Returning mock patients");const t=Nr();if(e&&e.trim()){const i=e.toLowerCase();return t.filter(a=>a.name.toLowerCase().includes(i)||a.mrn.toLowerCase().includes(i)||a.email.toLowerCase().includes(i))}return t}}function mC(l){const e={"demo-patient-1":{patient:Nr()[0],conditions:[{id:"cond-1",display:"Glioblastoma Multiforme, Right Frontal Lobe (C71.1)",clinicalStatus:"active",onsetDate:"2024-08-15",category:"Neoplasm/Oncology",severity:"Grade IV (WHO), High-grade malignant glioma"},{id:"cond-2",display:"Cerebral Edema Secondary to Intracranial Mass (G93.6)",clinicalStatus:"active",onsetDate:"2024-08-15",category:"Neurological",severity:"Moderate, controlled with steroids"},{id:"cond-3",display:"Seizure Disorder Secondary to Brain Tumor (G40.909)",clinicalStatus:"active",onsetDate:"2024-08-20",category:"Neurological",severity:"Controlled on anticonvulsants"}],medications:[{id:"med-1",name:"Temozolomide",status:"active",dosage:"150mg/m (280mg)",frequency:"Once daily for 5 consecutive days every 28 days",route:"Oral",prescribedDate:"2024-10-01",instructions:"Chemotherapy agent. Take on empty stomach at bedtime. Concurrent with radiation therapy. Monitor CBC weekly. Anti-nausea medications prescribed as needed."},{id:"med-2",name:"Dexamethasone",status:"active",dosage:"4mg",frequency:"Twice daily (morning & evening)",route:"Oral",prescribedDate:"2024-08-20",instructions:"Corticosteroid to reduce cerebral edema. Take with food to prevent GI upset. Do not abruptly discontinue. Monitor blood glucose. Taper as directed by oncology team."},{id:"med-3",name:"Levetiracetam (Keppra)",status:"active",dosage:"1000mg",frequency:"Twice daily",route:"Oral",prescribedDate:"2024-08-22",instructions:"Anticonvulsant for seizure prophylaxis. May cause drowsiness - avoid driving until response known. Report mood changes, behavioral changes, or suicidal thoughts immediately."},{id:"med-4",name:"Ondansetron (Zofran)",status:"active",dosage:"8mg",frequency:"Every 8 hours as needed for nausea",route:"Oral",prescribedDate:"2024-10-01",instructions:"Anti-nausea medication. Can be taken 30 minutes before meals if anticipating nausea from chemotherapy."}],documents:[{id:"doc-1",type:"Oncology Progress Note",date:"2024-11-18",author:"Dr. Michael Rivera, MD - Neuro-Oncology",description:"Post-operative follow-up. Patient tolerating chemoradiation protocol. Reviewing MRI findings."},{id:"doc-2",type:"MRI Brain with Contrast",date:"2024-11-12",author:"Dr. Patricia Lee, MD - Neuroradiology",description:"Post-surgical baseline MRI showing expected post-operative changes. Residual enhancement in right frontal lobe. No new masses identified."},{id:"doc-3",type:"Pathology Report",date:"2024-08-18",author:"Dr. James Wu, MD - Neuropathology",description:"Surgical specimen analysis confirms Glioblastoma Multiforme (WHO Grade IV). IDH-wildtype. MGMT promoter methylation status: Methylated (favorable prognostic indicator)."}],observations:[{id:"obs-1",display:"Karnofsky Performance Status",value:"80",unit:"score (0-100)",date:"2024-11-18",status:"final",interpretation:"Good functional status - able to carry on normal activity with effort"},{id:"obs-2",display:"White Blood Cell Count",value:"4.2",unit:"K/uL",date:"2024-11-16",status:"final",interpretation:"Within normal range - adequate for chemotherapy continuation"},{id:"obs-3",display:"Absolute Neutrophil Count (ANC)",value:"2.8",unit:"K/uL",date:"2024-11-16",status:"final",interpretation:"Adequate - no evidence of neutropenia"},{id:"obs-4",display:"Platelet Count",value:"195",unit:"K/uL",date:"2024-11-16",status:"final",interpretation:"Normal - no bleeding risk"}],clinical_notes:`PATIENT: Anish Polakala (MRN: MRN001234)
DATE OF VISIT: November 18, 2024
PROVIDER: Dr. Michael Rivera, MD - Neuro-Oncology
VISIT TYPE: Post-Operative Follow-Up - Glioblastoma Multiforme Management

CHIEF COMPLAINT:
Post-operative follow-up for newly diagnosed Glioblastoma Multiforme, right frontal lobe. Currently receiving concurrent chemoradiation therapy.

HISTORY OF PRESENT ILLNESS:
32-year-old male with recent diagnosis of Glioblastoma Multiforme (WHO Grade IV) of the right frontal lobe. Patient initially presented to emergency department on August 10, 2024 with new-onset seizure activity and progressive headaches over 2-week period. CT head revealed 4.2cm heterogeneous mass in right frontal lobe with significant surrounding edema and mild midline shift. MRI with contrast confirmed enhancing mass with central necrosis, concerning for high-grade glioma.

Patient underwent right frontal craniotomy with maximal safe resection on August 16, 2024 performed by Dr. Katherine Nguyen (Neurosurgery). Pathology confirmed Glioblastoma Multiforme, IDH-wildtype, with MGMT promoter methylation (favorable prognostic marker). Post-operative course complicated by transient left-sided weakness (resolved with PT) and one breakthrough seizure on post-op day 3.

Patient initiated Stupp Protocol on October 1, 2024: concurrent radiation therapy (60 Gy in 30 fractions) with daily temozolomide 75mg/m, followed by adjuvant temozolomide 150-200mg/m days 1-5 of 28-day cycles. Currently in Cycle 1, Day 18 of adjuvant phase. Radiation therapy completed November 10, 2024.

CURRENT MEDICATIONS:
1. Temozolomide 280mg (150mg/m) PO daily  5 days every 28 days - chemotherapy
2. Dexamethasone 4mg PO BID - cerebral edema control
3. Levetiracetam (Keppra) 1000mg PO BID - seizure prophylaxis
4. Ondansetron 8mg PO Q8H PRN nausea
5. Pantoprazole 40mg PO daily - GI protection while on steroids

ALLERGIES: No Known Drug Allergies (NKDA)

REVIEW OF SYSTEMS:
Constitutional: Reports fatigue (expected from treatment), no fever. Weight stable at 165 lbs.
Neurological: No recurrent seizure activity since August. Mild persistent headaches controlled with acetaminophen. No new focal neurological deficits. Intact motor function bilaterally. Denies vision changes, ataxia, or vertigo.
Gastrointestinal: Mild nausea days 1-3 of chemotherapy cycle, well-controlled with ondansetron. Appetite fair. No vomiting or diarrhea.
Psychiatric: Mood stable but understandably anxious about diagnosis. Engaged with social work and support groups. No depression screening concerns.
Dermatologic: Mild facial puffiness from steroid use. Radiation dermatitis resolved.

PHYSICAL EXAMINATION:
Vitals: BP 118/76, HR 68, RR 14, Temp 98.4F, Weight 165 lbs, O2 Sat 98% on room air
General: Alert, oriented x3, appears stated age, mild cushingoid features from steroid therapy
HEENT: Normocephalic. Well-healed right frontal craniotomy scar. No erythema or drainage at surgical site.
Neurological Examination:
  - Mental Status: Alert, fully oriented, appropriate affect, fluent speech
  - Cranial Nerves II-XII: Intact bilaterally
  - Motor: 5/5 strength all extremities, no pronator drift
  - Sensory: Intact to light touch and pinprick throughout
  - Reflexes: 2+ and symmetric, downgoing Babinski bilaterally
  - Coordination: Finger-to-nose intact, no dysmetria
  - Gait: Normal, steady, no ataxia
Cardiovascular: Regular rate and rhythm, no murmurs
Respiratory: Clear to auscultation bilaterally
Abdomen: Soft, non-tender, non-distended
Extremities: No cyanosis, clubbing, or edema

RECENT IMAGING - MRI Brain with Contrast (11/12/2024):
FINDINGS:
- Status post right frontal craniotomy with expected post-operative changes
- Minimal residual enhancement along resection cavity margins (stable from prior)
- Decreased surrounding FLAIR signal compared to immediate post-operative study
- No new enhancing lesions or masses identified
- No hydrocephalus or significant mass effect
- Ventricles and sulci normal in size and configuration
IMPRESSION: Expected post-surgical changes without evidence of tumor progression. Decreased vasogenic edema compared to prior study.

LABORATORY RESULTS (11/16/2024):
Complete Blood Count:
- WBC: 4.2 K/uL (reference: 4.5-11.0) - mild leukopenia acceptable
- Hemoglobin: 13.2 g/dL (reference: 13.5-17.5)
- Platelets: 195 K/uL (reference: 150-400)
- ANC: 2.8 K/uL (adequate for chemotherapy continuation)

Comprehensive Metabolic Panel:
- Sodium: 139 mEq/L, Potassium: 4.1 mEq/L, Chloride: 102 mEq/L
- BUN: 14 mg/dL, Creatinine: 0.9 mg/dL
- Glucose: 126 mg/dL (elevated due to steroid therapy - monitoring)
- ALT: 32 U/L, AST: 28 U/L - normal liver function
- Total Bilirubin: 0.6 mg/dL

ASSESSMENT AND PLAN:

PRIMARY DIAGNOSIS: GLIOBLASTOMA MULTIFORME (WHO GRADE IV), RIGHT FRONTAL LOBE
Status: Post-operative, currently receiving adjuvant chemotherapy (Cycle 1 of planned 6 cycles)

1. ONCOLOGIC MANAGEMENT
    Patient tolerating Stupp Protocol reasonably well
    Baseline post-radiation MRI shows stable disease, no progression
    Continue temozolomide 280mg days 1-5 of 28-day cycle
    MGMT methylation positive - favorable for temozolomide response
    Karnofsky Performance Status: 80 (good functional status)
    Plan: Continue current chemotherapy protocol for total of 6 cycles
    Next MRI brain with contrast in 8 weeks (late January 2025)
    Consider clinical trial enrollment if disease progression

2. CEREBRAL EDEMA - CONTROLLED
    Dexamethasone 4mg BID effectively controlling symptoms
    Begin steroid taper next week: reduce to 3mg BID  1 week, then 2mg BID
    Monitor for steroid-related complications (hyperglycemia, immunosuppression)
    Continue PPI for GI protection

3. SEIZURE DISORDER SECONDARY TO BRAIN TUMOR - CONTROLLED
    No seizure activity since initial presentation
    Continue levetiracetam 1000mg BID
    Maintain seizure precautions
    State driving restrictions apply per neurology recommendations
    Therapeutic drug monitoring not indicated at this time

4. SUPPORTIVE CARE
    Nausea well-controlled with ondansetron
    Encourage adequate hydration and nutrition
    Fatigue expected from treatment - recommend energy conservation strategies
    Continue physical therapy for conditioning
    Social work engaged, support group recommended

5. MONITORING
    CBC with differential weekly during chemotherapy weeks
    CMP monthly to monitor glucose (steroid-induced hyperglycemia)
    Pneumocystis jirovecii prophylaxis with TMP-SMX to be initiated given prolonged steroid use

PATIENT EDUCATION:
- Discussed MRI findings: stable post-operative changes, no evidence of tumor growth
- Reviewed expected chemotherapy side effects and when to call
- Emphasized importance of medication compliance, especially anti-seizure medication
- Driving restrictions discussed per state law (seizure within 6 months)
- Emergency contact information provided for fever, severe headache, new neurological symptoms, or uncontrolled nausea/vomiting
- Patient and family demonstrate good understanding of treatment plan
- Resources provided: American Brain Tumor Association, support groups

PROGNOSIS DISCUSSION:
Long discussion with patient and family regarding prognosis and treatment goals. Median survival for GBM with standard therapy is 15-18 months, but MGMT methylation status provides favorable prognostic indicator. Patient expresses realistic understanding and strong determination to pursue aggressive treatment. Emphasis on quality of life throughout treatment course. Palliative care consultation offered for symptom management - patient declines at this time but aware of availability.

FOLLOW-UP:
- Return to Neuro-Oncology clinic in 2 weeks (Cycle 2, Day 1 of chemotherapy)
- CBC with diff prior to next chemotherapy cycle
- MRI brain with contrast in 8 weeks
- Call immediately for fever > 100.4F, severe headache, seizure, new weakness, or concerning symptoms
- Continue current medication regimen with planned steroid taper

ELECTRONICALLY SIGNED:
Dr. Michael Rivera, MD, FACP
Board Certified Medical Oncology & Neuro-Oncology
Massachusetts General Hospital Cancer Center
November 18, 2024 16:45 EST`},"demo-patient-2":{patient:Nr()[1],conditions:[{id:"cond-4",display:"Mild Persistent Asthma (J45.30)",clinicalStatus:"active",onsetDate:"2010-03-15",category:"Respiratory",severity:"Mild-Moderate"},{id:"cond-5",display:"Seasonal Allergic Rhinitis (J30.2)",clinicalStatus:"active",onsetDate:"2010-03-15",category:"Allergic/Immunologic",severity:"Mild"}],medications:[{id:"med-4",name:"Albuterol Sulfate HFA Inhaler",status:"active",dosage:"90mcg (2 puffs)",frequency:"Every 4-6 hours as needed",route:"Oral Inhalation",prescribedDate:"2024-06-20",instructions:"Rescue inhaler for acute bronchospasm. Use 15 minutes before exercise. Seek emergency care if using more than 2x/week."},{id:"med-5",name:"Fluticasone Propionate HFA",status:"active",dosage:"110mcg (2 puffs)",frequency:"Twice daily (morning & evening)",route:"Oral Inhalation",prescribedDate:"2024-06-20",instructions:"Controller medication - use daily even when feeling well. Rinse mouth after use to prevent thrush."},{id:"med-6",name:"Montelukast Sodium",status:"active",dosage:"10mg",frequency:"Once daily at bedtime",route:"Oral",prescribedDate:"2024-08-15",instructions:"Leukotriene receptor antagonist for asthma control. Report mood changes."}],documents:[{id:"doc-4",type:"Pulmonology Follow-Up",date:"2024-11-10",author:"Dr. Michael Rodriguez, MD",description:"Asthma control assessment and spirometry results review."},{id:"doc-5",type:"Spirometry Report",date:"2024-11-10",author:"Pulmonary Function Lab",description:"PFTs show mild obstruction, responsive to bronchodilator."},{id:"doc-6",type:"Asthma Action Plan",date:"2024-11-10",author:"Dr. Michael Rodriguez, MD",description:"Updated action plan with green/yellow/red zone instructions."}],observations:[{id:"obs-5",display:"FEV1 (Forced Expiratory Volume)",value:"82",unit:"% predicted",date:"2024-11-10",status:"final",interpretation:"Mild obstruction, improved post-bronchodilator"},{id:"obs-6",display:"Peak Flow",value:"420",unit:"L/min",date:"2024-11-10",status:"final",interpretation:"Personal best: 450 L/min - In green zone"},{id:"obs-7",display:"Oxygen Saturation",value:"98",unit:"%",date:"2024-11-10",status:"final",interpretation:"Normal"}],clinical_notes:`PATIENT: Jane Doe (MRN: MRN005678)
DATE OF VISIT: November 10, 2024
PROVIDER: Dr. Michael Rodriguez, MD - Pulmonology
VISIT TYPE: Asthma Control Assessment & Spirometry

CHIEF COMPLAINT:
Follow-up for asthma management and seasonal allergy symptoms.

HISTORY OF PRESENT ILLNESS:
35-year-old female with mild persistent asthma (diagnosed 2010) presents for scheduled follow-up. Patient reports good overall asthma control on current regimen. Uses rescue inhaler approximately 1-2 times per week, primarily with exercise or during high pollen days. No nighttime awakenings in past month. No emergency department visits or oral steroid courses in past year. Patient compliant with controller medications. Reports seasonal rhinitis symptoms improving with addition of montelukast.

CURRENT MEDICATIONS:
1. Fluticasone Propionate 110mcg - 2 puffs BID (controller)
2. Albuterol Sulfate 90mcg - 2 puffs Q4-6H PRN (rescue)
3. Montelukast 10mg PO daily at bedtime

ALLERGIES: Penicillin (rash)

ASTHMA CONTROL QUESTIONNAIRE (ACQ) SCORE: 0.8 (Well controlled: < 1.5)

REVIEW OF SYSTEMS:
Respiratory: Occasional mild dyspnea with exertion. No chest tightness at rest.
ENT: Seasonal rhinorrhea and sneezing, improved with montelukast.
All other systems reviewed and negative.

PHYSICAL EXAMINATION:
Vitals: BP 118/76, HR 68, RR 14, SpO2 98% on room air, Temp 98.2F
General: Alert, comfortable, speaking in full sentences
HEENT: Nasal mucosa slightly pale and boggy, consistent with allergic rhinitis
Neck: No lymphadenopathy, no stridor
Cardiovascular: Regular rate and rhythm, no murmurs
Respiratory: Good air entry bilaterally, no wheezes, crackles, or rhonchi
  - No accessory muscle use
  - No prolonged expiratory phase
Skin: No eczema or urticaria

SPIROMETRY RESULTS (11/10/2024):
Pre-bronchodilator:
- FEV1: 2.45 L (82% predicted)
- FVC: 3.18 L (91% predicted)
- FEV1/FVC ratio: 77%

Post-bronchodilator (after 4 puffs albuterol):
- FEV1: 2.78 L (93% predicted) - 13% improvement
- FVC: 3.25 L (93% predicted)
- Interpretation: Mild obstructive pattern with significant bronchodilator response

PEAK FLOW MONITORING:
- Current: 420 L/min
- Personal Best: 450 L/min
- Green Zone: > 360 L/min (80% of personal best)
- Yellow Zone: 270-360 L/min (50-80%)
- Red Zone: < 270 L/min (< 50%)

ASSESSMENT AND PLAN:

1. MILD PERSISTENT ASTHMA - WELL CONTROLLED
    ACQ score 0.8 indicates good control
    Spirometry shows mild obstruction with bronchodilator response
    Continue current three-medication regimen
    Fluticasone 110mcg BID - continue as controller
    Albuterol PRN - using appropriately (< 2x/week)
    Montelukast 10mg QHS - continue for dual benefit (asthma + allergies)
    Patient demonstrates excellent inhaler technique
    Updated Asthma Action Plan provided and reviewed

2. SEASONAL ALLERGIC RHINITIS - CONTROLLED
    Symptoms improved with montelukast
    May add intranasal corticosteroid if symptoms worsen during peak allergy season
    Recommend environmental controls (keep windows closed during high pollen counts)

PATIENT EDUCATION:
- Reviewed proper inhaler technique with spacer
- Emphasized importance of daily controller medication (fluticasone) even when asymptomatic
- Discussed environmental triggers: pollen, dust, cold air, exercise
- When to escalate care: use of rescue inhaler > 2x/week, nighttime symptoms, decreased peak flow
- GREEN zone: current medications
- YELLOW zone: increase fluticasone to 220mcg BID, more frequent albuterol
- RED zone: seek immediate medical attention

FOLLOW-UP:
- Return in 6 months or sooner if control worsens
- Call office if rescue inhaler use increases to > 2x/week
- Continue home peak flow monitoring weekly
- Annual flu vaccine recommended (scheduled for next month)

ELECTRONICALLY SIGNED:
Dr. Michael Rodriguez, MD
Board Certified Pulmonary Medicine
November 10, 2024 11:15 PST`},"demo-patient-3":{patient:Nr()[2],conditions:[{id:"cond-8",display:"Generalized Anxiety Disorder (F41.1)",clinicalStatus:"active",onsetDate:"2020-07-05",category:"Mental Health",severity:"Moderate, improving"},{id:"cond-9",display:"Insomnia Disorder (G47.00)",clinicalStatus:"active",onsetDate:"2020-08-12",category:"Sleep Disorder",severity:"Mild"}],medications:[{id:"med-7",name:"Sertraline HCl",status:"active",dosage:"75mg",frequency:"Once daily in morning",route:"Oral",prescribedDate:"2023-09-01",instructions:"SSRI for anxiety. Take with food. May cause initial nausea - usually resolves. Report increased anxiety or mood changes."},{id:"med-8",name:"Hydroxyzine Pamoate",status:"active",dosage:"25mg",frequency:"At bedtime as needed",route:"Oral",prescribedDate:"2024-02-10",instructions:"For sleep and anxiety. May cause drowsiness - do not drive after taking. Maximum 3x per week."}],documents:[{id:"doc-7",type:"Psychiatric Follow-Up",date:"2024-10-20",author:"Dr. Lisa Patel, MD",description:"Patient reports 50% reduction in anxiety symptoms with current regimen."},{id:"doc-8",type:"Therapy Progress Note",date:"2024-10-15",author:"Amanda Chen, LCSW",description:"CBT session #12. Patient demonstrating improved coping strategies."}],observations:[{id:"obs-8",display:"GAD-7 Score (Anxiety Assessment)",value:"8",unit:"score",date:"2024-10-20",status:"final",interpretation:"Mild anxiety (score 5-9). Previously 15 (moderate). Significant improvement."},{id:"obs-9",display:"PHQ-9 Score (Depression Screening)",value:"4",unit:"score",date:"2024-10-20",status:"final",interpretation:"Minimal depression symptoms (score < 5). No concerning findings."}],clinical_notes:`PATIENT: Emily Johnson (MRN: MRN009876)
DATE OF VISIT: October 20, 2024
PROVIDER: Dr. Lisa Patel, MD - Psychiatry
VISIT TYPE: Psychiatric Follow-Up - Anxiety Management

CHIEF COMPLAINT: "I'm feeling much better but still have some anxiety."

HISTORY OF PRESENT ILLNESS:
28-year-old female with Generalized Anxiety Disorder and insomnia presents for follow-up. Patient started on sertraline 50mg 13 months ago, dose increased to 75mg 6 months ago with good response. Reports approximately 50% reduction in anxiety symptoms compared to initial presentation. Sleep has improved with combination of medication and sleep hygiene. Currently engaged in weekly cognitive behavioral therapy with LCSW. Patient reports fewer panic attacks (now 0-1 per month, previously 3-4 per week). Able to work full-time without significant impairment. Occasional breakthrough anxiety managed with hydroxyzine PRN.

CURRENT PSYCHIATRIC MEDICATIONS:
1. Sertraline 75mg PO daily in AM - SSRI for anxiety
2. Hydroxyzine 25mg PO QHS PRN insomnia/anxiety (using 2-3x/week)

PSYCHIATRIC REVIEW:
Mood: "Generally good, some ups and downs"
Affect: Bright, appropriate
Sleep: 6-7 hours per night, improved sleep latency
Appetite: Normal, no recent weight changes
Energy: Good during day
Concentration: Improved, able to focus at work
Anxiety: Reduced frequency and intensity
Panic attacks: 0-1 per month (down from 3-4 per week)
Suicidal ideation: Denies active/passive SI, no self-harm behaviors
Homicidal ideation: Denies

STANDARDIZED ASSESSMENTS:
GAD-7 Score: 8/21 (Mild anxiety)
- Previous score (4/2024): 15/21 (Moderate anxiety)
PHQ-9 Score: 4/27 (Minimal depression)
- Previous score (4/2024): 7/27 (Mild depression)

SUBSTANCE USE:
Alcohol: Social use, 1-2 drinks per week
Tobacco: Never smoker
Recreational drugs: Denies
Caffeine: 1-2 cups coffee daily

THERAPY ENGAGEMENT:
Currently in CBT with Amanda Chen, LCSW - weekly sessions
Progress: Good. Learning and applying coping strategies effectively
Homework compliance: Excellent

ASSESSMENT AND PLAN:

1. GENERALIZED ANXIETY DISORDER - SIGNIFICANTLY IMPROVED
    GAD-7 score decreased from 15 to 8 (47% improvement)
    Panic attacks markedly reduced
    Functional improvement in work and social settings
    Continue sertraline 75mg daily
    Patient tolerating medication well, no side effects reported
    Continue weekly CBT - consider transitioning to biweekly in 2-3 months if stability maintained

2. INSOMNIA - IMPROVED
    Sleep hygiene practices implemented successfully
    Hydroxyzine PRN effective when needed
    Continue current regimen
    Reinforce sleep hygiene: consistent schedule, screen time limits, relaxation techniques

PATIENT EDUCATION:
- Discussed importance of medication continuity even when feeling better
- Reviewed warning signs of relapse: increased worry, panic attacks, avoidance behaviors
- Encouraged continued therapy engagement
- Stress management: regular exercise, mindfulness practice
- Patient verbalizes understanding and agreement with plan

SAFETY ASSESSMENT:
Low risk: No SI/HI, good support system, engaged in treatment

FOLLOW-UP:
- Return in 3 months
- Continue weekly therapy
- Call if symptoms worsen or side effects develop
- Encouraged to use crisis resources if needed (988 Suicide & Crisis Lifeline)

ELECTRONICALLY SIGNED:
Dr. Lisa Patel, MD
Board Certified Psychiatry
October 20, 2024 15:45 PST`},"demo-patient-4":{patient:Nr()[3],conditions:[{id:"cond-10",display:"Osteoarthritis of Bilateral Knees (M17.0)",clinicalStatus:"active",onsetDate:"2019-11-12",category:"Musculoskeletal",severity:"Moderate"},{id:"cond-11",display:"Obesity (E66.9)",clinicalStatus:"active",onsetDate:"2015-01-10",category:"Metabolic",severity:"Class I (BMI 32.4)"}],medications:[{id:"med-9",name:"Ibuprofen",status:"active",dosage:"400mg",frequency:"Three times daily with food",route:"Oral",prescribedDate:"2023-03-10",instructions:"NSAID for pain/inflammation. Take with food to reduce GI upset. Monitor for GI bleeding. Do not exceed 1200mg/day."},{id:"med-10",name:"Glucosamine-Chondroitin",status:"active",dosage:"1500mg-1200mg",frequency:"Once daily",route:"Oral",prescribedDate:"2024-01-15",instructions:"Joint supplement. May take 2-3 months for effect. OTC supplement."}],documents:[{id:"doc-9",type:"Physical Therapy Progress Note",date:"2024-11-05",author:"PT James Miller, DPT",description:"Patient completing strengthening exercises. Improved quadriceps strength bilaterally."},{id:"doc-10",type:"X-Ray Report - Bilateral Knees",date:"2024-09-20",author:"Dr. Robert Kim, MD Radiology",description:"Moderate joint space narrowing. Mild osteophyte formation. Consistent with osteoarthritis."}],observations:[{id:"obs-10",display:"Pain Scale (0-10)",value:"4",unit:"out of 10",date:"2024-11-05",status:"final",interpretation:"Moderate pain, improved from baseline (was 7/10)"},{id:"obs-11",display:"BMI",value:"32.4",unit:"kg/m",date:"2024-11-05",status:"final",interpretation:"Class I Obesity - Weight loss recommended"}],clinical_notes:`PATIENT: Robert Martinez (MRN: MRN011223)
DATE OF VISIT: November 5, 2024
PROVIDER: Dr. Amanda Foster, MD - Orthopedics
VISIT TYPE: Follow-Up - Osteoarthritis Management

CHIEF COMPLAINT: Bilateral knee pain, improving with physical therapy.

HISTORY OF PRESENT ILLNESS:
58-year-old male with bilateral knee osteoarthritis (diagnosed 2019) presents for follow-up. Patient has been compliant with physical therapy (2x/week for 8 weeks). Reports pain improved from 7/10 to 4/10 with combination of PT, NSAIDs, and activity modification. Still experiences stiffness after prolonged sitting and with stairs. Working on weight loss (down 8 lbs in 3 months). No mechanical symptoms (locking, catching). No swelling or erythema.

MEDICATIONS: Ibuprofen 400mg TID, Glucosamine-Chondroitin supplement

PHYSICAL EXAMINATION:
Bilateral Knees:
- Inspection: No effusion, erythema, or deformity
- Palpation: Mild tenderness over medial joint lines bilaterally
- Range of Motion: Flexion 0-125 (full), Extension 0 (full)
- Ligaments: ACL/PCL/MCL/LCL stable
- Meniscal Signs: Negative McMurray test
- Crepitus: Present with ROM, more pronounced left > right
- Gait: Antalgic gait, favoring left leg

X-RAY FINDINGS (9/20/2024):
Bilateral knees: Moderate joint space narrowing medial compartments. Mild osteophyte formation. Kellgren-Lawrence Grade 2-3.

ASSESSMENT: Bilateral knee osteoarthritis, moderate severity, improving with conservative management.

PLAN:
1. Continue ibuprofen 400mg TID with food
2. Continue PT - focusing on quadriceps strengthening, balance training
3. Weight loss goal: Additional 15-20 lbs over next 6 months
4. Consider intra-articular corticosteroid injection if pain plateaus
5. Knee braces for support during activity
6. Follow up 3 months - may consider hyaluronic acid injections if conservative management insufficient

ELECTRONICALLY SIGNED: Dr. Amanda Foster, MD - Orthopedics, November 5, 2024`},"demo-patient-5":{patient:Nr()[4],conditions:[{id:"cond-12",display:"Coronary Artery Disease - Status Post MI (I25.2)",clinicalStatus:"active",onsetDate:"2021-08-30",category:"Cardiovascular",severity:"Stable, post-intervention"},{id:"cond-13",display:"Hyperlipidemia (E78.5)",clinicalStatus:"active",onsetDate:"2020-01-10",category:"Metabolic",severity:"Controlled"},{id:"cond-14",display:"Hypertension (I10)",clinicalStatus:"active",onsetDate:"2019-06-20",category:"Cardiovascular",severity:"Controlled"}],medications:[{id:"med-11",name:"Atorvastatin Calcium",status:"active",dosage:"80mg",frequency:"Once daily at bedtime",route:"Oral",prescribedDate:"2021-09-05",instructions:"High-intensity statin post-MI. Target LDL < 70. Report muscle pain immediately."},{id:"med-12",name:"Aspirin (Enteric Coated)",status:"active",dosage:"81mg",frequency:"Once daily with food",route:"Oral",prescribedDate:"2021-09-05",instructions:"Antiplatelet therapy post-MI. Take daily to prevent clotting. Report unusual bleeding."},{id:"med-13",name:"Metoprolol Succinate ER",status:"active",dosage:"50mg",frequency:"Once daily in morning",route:"Oral",prescribedDate:"2021-09-05",instructions:"Beta blocker for heart rate/BP control. Do not stop abruptly. Monitor heart rate."},{id:"med-14",name:"Lisinopril",status:"active",dosage:"20mg",frequency:"Once daily in morning",route:"Oral",prescribedDate:"2021-09-05",instructions:"ACE inhibitor for cardiac protection post-MI. Monitor kidney function and potassium."}],documents:[{id:"doc-11",type:"Cardiology Follow-Up",date:"2024-10-25",author:"Dr. Thomas Wilson, MD",description:"Post-MI surveillance. Patient stable on optimal medical therapy."},{id:"doc-12",type:"Echocardiogram Report",date:"2024-10-15",author:"Cardiology Imaging",description:"LVEF 52%. Mild hypokinesis anterior wall. No significant valvular disease."},{id:"doc-13",type:"Stress Test Report",date:"2024-10-20",author:"Nuclear Cardiology",description:"Exercise tolerance 9.2 METS. No inducible ischemia. Negative for angina."}],observations:[{id:"obs-12",display:"LDL Cholesterol",value:"65",unit:"mg/dL",date:"2024-10-15",status:"final",interpretation:"At goal (< 70 mg/dL post-MI). Excellent control."},{id:"obs-13",display:"Troponin I",value:"< 0.01",unit:"ng/mL",date:"2024-10-15",status:"final",interpretation:"Negative. No evidence of acute cardiac injury."},{id:"obs-14",display:"Blood Pressure",value:"122/78",unit:"mmHg",date:"2024-10-25",status:"final",interpretation:"Optimal control"},{id:"obs-15",display:"Ejection Fraction (LVEF)",value:"52",unit:"%",date:"2024-10-15",status:"final",interpretation:"Normal (> 50%). Preserved systolic function."}],clinical_notes:`PATIENT: David Thompson (MRN: MRN013344)
DATE OF VISIT: October 25, 2024
PROVIDER: Dr. Thomas Wilson, MD - Cardiology
VISIT TYPE: Post-MI Follow-Up & Cardiac Risk Management

CHIEF COMPLAINT: Routine cardiology follow-up, feeling well.

HISTORY OF PRESENT ILLNESS:
62-year-old male with history of ST-elevation myocardial infarction (STEMI) in August 2021, status post PCI with drug-eluting stent to LAD. Patient presents for routine surveillance. Currently asymptomatic. No chest pain, shortness of breath, palpitations, or orthopnea. Exercise tolerance good - walks 2 miles daily without angina. Compliant with all cardiac medications. Recent stress test negative for ischemia. Echocardiogram shows preserved EF 52%. Successfully quit smoking post-MI (3+ years tobacco-free).

CARDIAC MEDICATIONS:
1. Atorvastatin 80mg PO QHS - high-intensity statin
2. Aspirin 81mg PO daily - antiplatelet therapy
3. Metoprolol Succinate 50mg PO daily - beta blocker
4. Lisinopril 20mg PO daily - ACE inhibitor

PAST MEDICAL HISTORY:
- CAD: STEMI 8/2021, PCI with DES to LAD
- Hypertension (controlled)
- Hyperlipidemia (controlled)
- Former smoker (quit 8/2021)

CARDIOVASCULAR REVIEW:
Chest pain: Denies
Shortness of breath: Denies
Palpitations: Denies
Syncope/Presyncope: Denies
Edema: Denies
Orthopnea/PND: Denies
Exercise tolerance: Excellent - 2 miles daily, no symptoms

RECENT TESTING:
Echocardiogram (10/15/2024):
- LVEF: 52% (normal)
- Regional wall motion: Mild hypokinesis anterior wall (consistent with old MI)
- Valves: No significant disease
- Pericardium: Normal

Exercise Stress Test with Nuclear Imaging (10/20/2024):
- Duration: 9.2 METS (good functional capacity)
- Peak HR: 132 bpm (83% maximum predicted)
- BP response: Appropriate
- No chest pain or significant ST changes
- Perfusion: No reversible defects, small fixed defect anterior (scar)
- Interpretation: NEGATIVE for inducible ischemia

Laboratory Results (10/15/2024):
- Lipid Panel:
  * Total Cholesterol: 142 mg/dL
  * LDL: 65 mg/dL (GOAL: < 70) 
  * HDL: 48 mg/dL
  * Triglycerides: 105 mg/dL
- Troponin I: < 0.01 ng/mL (negative)
- BNP: 45 pg/mL (normal)
- Creatinine: 0.9 mg/dL (normal renal function)
- Potassium: 4.1 mEq/L (normal)

PHYSICAL EXAMINATION:
Vitals: BP 122/78, HR 58 (on beta blocker), RR 14, SpO2 99%
General: Well-appearing, no distress
Cardiovascular: Regular rate and rhythm, no murmurs/rubs/gallops
  - No JVD
  - PMI non-displaced
  - Carotids: 2+ without bruits
  - Peripheral pulses: 2+ throughout, no edema
Lungs: Clear to auscultation bilaterally

ASSESSMENT:
1. CORONARY ARTERY DISEASE - STABLE, POST-MI
    3+ years post-STEMI with excellent recovery
    Negative stress test - no evidence of recurrent ischemia
    LVEF preserved at 52%
    No anginal symptoms
    Excellent functional capacity
   
2. HYPERLIPIDEMIA - OPTIMALLY CONTROLLED
    LDL 65 mg/dL on atorvastatin 80mg (at goal < 70)
    Continue high-intensity statin therapy indefinitely
   
3. HYPERTENSION - WELL CONTROLLED
    BP 122/78 on dual therapy
    Target < 130/80 achieved
   
4. CARDIOVASCULAR RISK REDUCTION - EXCELLENT COMPLIANCE
    Tobacco cessation maintained (3+ years)
    Daily aerobic exercise
    Medication adherence 100%
    Diet modifications implemented

PLAN:
1. Continue all current cardiac medications - no changes needed
2. Continue secondary prevention measures
3. Annual stress testing - next due October 2025
4. Annual echocardiogram - next due October 2025
5. Labs every 6 months (lipids, CMP)
6. Flu vaccine today - administered
7. Pneumococcal vaccine up to date

PATIENT EDUCATION:
- Reinforce medication importance - "medications for life"
- Continue daily exercise regimen
- Heart-healthy diet: low saturated fat, high fiber
- Warning signs of MI: chest pain, SOB, diaphoresis  Call 911
- Patient verbalizes excellent understanding

FOLLOW-UP: 6 months for routine visit. Call sooner if symptoms develop.

ELECTRONICALLY SIGNED:
Dr. Thomas Wilson, MD
Board Certified Cardiology
October 25, 2024 16:20 PST`}};return e[l]||e["demo-patient-1"]}async function yC(l,e){{console.log(" Demo Mode: Returning mock patient data");const t=mC(e);return await bC(l,e,t),await Pc({doctor_email:l,epic_patient_id:e,action:"demo_patient_data_fetched",epic_resource_accessed:"Demo Patient Data"}),t}}async function bC(l,e,t){const{patient:i,conditions:s,medications:a,documents:o,observations:u}=t,{error:d}=await Oe.from("epic_patient_data").upsert({doctor_email:l,epic_patient_id:e,epic_mrn:i.mrn,patient_name:i.name,patient_dob:i.birthDate,clinical_notes:wC(o),diagnoses:JSON.stringify(s),medications:JSON.stringify(a),last_synced:new Date().toISOString()},{onConflict:"doctor_email,epic_patient_id"});if(d)throw console.error(" Failed to store Epic data:",d),new Error("Failed to store patient data: "+d.message)}async function _w(l){const{data:e,error:t}=await Oe.from("epic_tokens").select("id").eq("doctor_email",l).single();return!t&&!!e}async function vC(l){const{error:e}=await Oe.from("epic_tokens").delete().eq("doctor_email",l);if(e)throw new Error("Failed to disconnect from Epic: "+e.message);await Pc({doctor_email:l,action:"epic_disconnected",epic_resource_accessed:"OAuth Token"}),console.log(" Disconnected from Epic")}function wC(l){return!l||l.length===0?"":l.slice(0,5).map(e=>`${e.type} (${e.date}): ${e.description||"No description"}`).join(`
`)}async function Pc(l){try{await Oe.from("epic_audit_log").insert({doctor_email:l.doctor_email,patient_email:l.patient_email||null,epic_patient_id:l.epic_patient_id||null,action:l.action,epic_resource_accessed:l.epic_resource_accessed||null,ip_address:null,user_agent:navigator.userAgent})}catch(e){console.error(" Failed to log audit event:",e)}}function _C({doctorEmail:l}){const[e,t]=B.useState(!1),[i,s]=B.useState(!0),[a,o]=B.useState(!1);B.useEffect(()=>{u()},[l]);const u=async()=>{try{const p=await _w(l);t(p)}catch(p){console.error("Error checking Epic connection:",p)}s(!1)},d=async()=>{try{const p=dC(l);p===null?(alert(" Demo mode enabled! You can now search for demo patients."),setTimeout(()=>window.location.reload(),1e3)):window.location.href=p}catch(p){console.error("Error initiating Epic auth:",p),alert("Failed to connect to Epic: "+p.message)}},f=async()=>{if(confirm("Are you sure you want to disconnect from Epic? You will need to reconnect to access patient data.")){o(!0);try{await vC(l),t(!1),alert("Successfully disconnected from Epic")}catch(p){console.error("Error disconnecting from Epic:",p),alert("Failed to disconnect: "+p.message)}o(!1)}};return i?_.jsx("div",{style:{padding:"1rem",background:"#f9fafb",borderRadius:"12px",border:"1px solid #e0e0e0",textAlign:"center"},children:_.jsx("p",{style:{color:"#666",margin:0},children:"Checking Epic connection..."})}):_.jsxs("div",{style:{padding:"1.5rem",background:e?"linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%)":"linear-gradient(135deg, rgba(232, 121, 249, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%)",borderRadius:"12px",border:e?"1px solid rgba(16, 185, 129, 0.3)":"1px solid rgba(232, 121, 249, 0.3)",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flex:1},children:[_.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"50%",background:e?"#10b981":"#E879F9",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"white",fontWeight:"700",flexShrink:0},children:e?"":"E"}),_.jsxs("div",{style:{flex:1},children:[_.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"700",color:"#1a1a1a",marginBottom:"0.25rem"},children:"Plasma FHIR Integration"}),_.jsx("p",{style:{fontSize:"0.95rem",color:e?"#059669":"#666",margin:0},children:e?" Connected - Access patient data from Epic & other EHR systems":"Not connected - Connect to pull patient data from Epic automatically"})]})]}),_.jsx("div",{children:e?_.jsx("button",{onClick:f,disabled:a,style:{padding:"0.75rem 1.5rem",background:"white",border:"2px solid #e0e0e0",borderRadius:"8px",color:"#666",fontSize:"0.95rem",fontWeight:"600",cursor:a?"not-allowed":"pointer",transition:"all 0.3s ease",fontFamily:"inherit",opacity:a?.6:1},onMouseOver:p=>{a||(p.target.style.borderColor="#ef4444",p.target.style.color="#ef4444")},onMouseOut:p=>{a||(p.target.style.borderColor="#e0e0e0",p.target.style.color="#666")},children:a?"Disconnecting...":"Disconnect"}):_.jsx("button",{onClick:d,style:{padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",border:"none",borderRadius:"8px",color:"white",fontSize:"0.95rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(232, 121, 249, 0.3)",fontFamily:"inherit"},onMouseOver:p=>{p.target.style.transform="translateY(-2px)",p.target.style.boxShadow="0 6px 20px rgba(232, 121, 249, 0.4)"},onMouseOut:p=>{p.target.style.transform="translateY(0)",p.target.style.boxShadow="0 4px 12px rgba(232, 121, 249, 0.3)"},children:" Connect to Plasma FHIR"})})]})}function SC(){const l=Zi(),[e,t]=B.useState("Doctor"),[i,s]=B.useState(""),[a,o]=B.useState(""),[u,d]=B.useState([]),[f,p]=B.useState(!0),[m,b]=B.useState(!1),[v,S]=B.useState(""),[w,E]=B.useState("");B.useEffect(()=>{x()},[]);const x=async()=>{console.log(" DoctorProfile: Checking session...");try{const k=await Lc();if(console.log(" Session data:",k),!k||k.userType!=="doctor"){console.log(" No valid doctor session"),alert(" No active session found! Please log in."),l("/login");return}console.log(" Valid doctor session found"),s(k.email),o(k.profilePicture||""),await C(k.email,k.name),T(k.email)}catch(k){console.error(" Error checking session:",k),alert("Error loading profile: "+k.message),l("/login")}},C=async(k,z)=>{try{const{data:H,error:ne}=await Oe.from("users").select("first_name, last_name").eq("email",k).eq("user_type","doctor").single();if(ne)throw ne;if(H&&(H.first_name||H.last_name)){const ie=`${H.first_name||""} ${H.last_name||""}`.trim();t(ie||z)}else t(z)}catch(H){console.log("Error loading doctor name:",H),t(z)}},T=async k=>{console.log(" Loading patients for doctor:",k);try{const{data:z,error:H}=await Oe.from("doctor_patients").select("patient_email, patient_key").eq("doctor_email",k);if(H){console.error("Error loading patient links:",H),p(!1);return}if(console.log(" Patient links found:",z),!z||z.length===0){console.log("No patients found for this doctor"),d([]),p(!1);return}const ne=z.map(le=>le.patient_email);let ie=null,ce=null;try{const le=await Oe.from("users").select("email, first_name, last_name, profile_picture").in("email",ne).eq("user_type","patient");ie=le.data,ce=le.error}catch{console.log(" Trying to fetch patients without profile_picture column...");const ue=await Oe.from("users").select("email, first_name, last_name").in("email",ne).eq("user_type","patient");ie=ue.data,ce=ue.error}ce&&console.error("Error loading patient data:",ce);const ge=z.map(le=>{const ue=ie?.find(X=>X.email===le.patient_email),j=ue?.first_name||le.patient_email.split("@")[0],J=ue?.last_name||"",oe=`${j} ${J}`.trim(),K=ue?.profile_picture||null;return console.log(`Patient ${le.patient_email} profile picture:`,K),{email:le.patient_email,name:oe||le.patient_email,patientKey:le.patient_key,profilePicture:K}});console.log(" Loaded patients with profile pictures:",ge),d(ge)}catch(z){console.error("Error in loadPatients:",z)}p(!1)},D=async()=>{if(!v.trim()){alert("Please enter a patient ID");return}const k=YT(v);if(!VT(k)){alert(" Invalid Patient ID format. Please check and try again.");return}try{const{data:z,error:H}=await Oe.from("users").select("email, first_name, last_name, patient_key, profile_picture").eq("patient_key",k).eq("user_type","patient").single();if(H||!z){alert(" No patient found with this ID. Please check the ID and try again.");return}const{data:ne}=await Oe.from("doctor_patients").select("*").eq("doctor_email",i).eq("patient_email",z.email).single();if(ne){alert(" This patient is already in your roster!"),b(!1),S("");return}const{error:ie}=await Oe.from("doctor_patients").insert([{doctor_email:i,patient_email:z.email,patient_key:k}]);if(ie){console.error("Error linking patient:",ie),alert(" Error adding patient: "+ie.message);return}alert(" Patient added successfully!"),b(!1),S(""),T(i)}catch(z){console.error("Error adding patient:",z),alert(" Error adding patient: "+z.message)}},M=async()=>{await Vf(),l("/")},N=u.filter(k=>k.name.toLowerCase().includes(w.toLowerCase())||k.email.toLowerCase().includes(w.toLowerCase())||k.patientKey&&k.patientKey.includes(w));return f?_.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #A855F7 0%, #E879F9 50%, #F472B6 100%)"},children:_.jsxs("div",{style:{textAlign:"center",color:"white"},children:[_.jsx(vw,{size:48,style:{animation:"spin 2s linear infinite"}}),_.jsx("p",{style:{marginTop:"1rem",fontSize:"1.1rem"},children:"Loading dashboard..."})]})}):_.jsxs("div",{style:{minHeight:"100vh",background:"#ffffff"},children:[_.jsx("div",{style:{background:"linear-gradient(135deg, #7c3aed 0%, #9333ea 100%)",boxShadow:"0 2px 8px rgba(124, 58, 237, 0.15)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:_.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"1.5rem 2rem",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[_.jsx("img",{src:"/images/Black Elephant Flat Illustrative Company Logo.png",alt:"Amma Logo",style:{height:"50px",width:"50px",objectFit:"contain",filter:"brightness(0) invert(1)"}}),_.jsxs("div",{children:[_.jsx("h1",{style:{margin:0,fontSize:"1.5rem",fontWeight:"700",color:"white",letterSpacing:"-0.02em"},children:"Clinical Dashboard"}),_.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"rgba(255, 255, 255, 0.9)",marginTop:"0.25rem"},children:["Welcome back, Dr. ",e]})]})]}),_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[_.jsx(_C,{doctorEmail:i}),_.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"50%",overflow:"hidden",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)"},children:a?_.jsx("img",{src:a,alt:e,style:{width:"100%",height:"100%",objectFit:"cover"}}):_.jsx("div",{style:{width:"100%",height:"100%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:_.jsx(pc,{size:24,color:"white"})})}),_.jsxs("button",{onClick:M,style:{padding:"0.625rem 1.25rem",background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"10px",color:"white",fontWeight:"600",fontSize:"0.9rem",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem"},onMouseEnter:k=>{k.currentTarget.style.background="rgba(255, 255, 255, 0.25)",k.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:k=>{k.currentTarget.style.background="rgba(255, 255, 255, 0.15)",k.currentTarget.style.transform="translateY(0)"},children:[_.jsx(ww,{size:16}),"Logout"]})]})]})}),_.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"2.5rem 2rem"},children:[_.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"2rem",marginBottom:"2rem",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",border:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[_.jsxs("div",{children:[_.jsx("h2",{style:{fontSize:"1.75rem",fontWeight:"700",color:"#1f2937",margin:"0 0 0.5rem 0"},children:"Patient Roster"}),_.jsx("p",{style:{fontSize:"1rem",color:"#64748b",margin:0},children:"Manage your patients and access their medical records"})]}),_.jsxs("button",{onClick:()=>b(!0),style:{padding:"0.875rem 1.5rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",border:"none",borderRadius:"10px",color:"white",fontWeight:"600",fontSize:"0.95rem",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"0.5rem",boxShadow:"0 2px 8px rgba(124, 58, 237, 0.25)"},onMouseEnter:k=>{k.currentTarget.style.transform="translateY(-2px)",k.currentTarget.style.boxShadow="0 4px 12px rgba(124, 58, 237, 0.35)"},onMouseLeave:k=>{k.currentTarget.style.transform="translateY(0)",k.currentTarget.style.boxShadow="0 2px 8px rgba(124, 58, 237, 0.25)"},children:[_.jsx(cb,{size:18}),"Add New Patient"]})]}),u.length>0&&_.jsx("div",{style:{marginBottom:"2rem"},children:_.jsxs("div",{style:{position:"relative",maxWidth:"500px"},children:[_.jsx(aC,{size:18,style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),_.jsx("input",{type:"text",placeholder:"Search patients by name, email, or ID...",value:w,onChange:k=>E(k.target.value),style:{width:"100%",padding:"0.875rem 1rem 0.875rem 3rem",borderRadius:"10px",border:"2px solid #e5e7eb",background:"white",fontSize:"0.95rem",fontFamily:"inherit",transition:"all 0.2s"},onFocus:k=>{k.currentTarget.style.borderColor="#7c3aed",k.currentTarget.style.boxShadow="0 0 0 3px rgba(124, 58, 237, 0.1)"},onBlur:k=>{k.currentTarget.style.borderColor="#e5e7eb",k.currentTarget.style.boxShadow="none"}})]})}),_.jsx("div",{style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.6) 100%)",backdropFilter:"blur(10px)",borderRadius:"20px",padding:"2.5rem",boxShadow:"0 8px 32px rgba(37, 99, 235, 0.1)",border:"1px solid rgba(255, 255, 255, 0.8)"},children:N.length===0?_.jsxs("div",{style:{textAlign:"center",padding:"5rem 2rem",background:"linear-gradient(135deg, rgba(250, 232, 255, 0.5) 0%, rgba(245, 243, 255, 0.5) 100%)",borderRadius:"16px",border:"2px dashed rgba(168, 85, 247, 0.3)"},children:[_.jsx(lC,{size:64,color:"#A855F7",style:{opacity:.6}}),_.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#A855F7",marginTop:"1.5rem",marginBottom:"0.75rem"},children:w?"No Patients Found":"No Patients Yet"}),_.jsx("p",{style:{fontSize:"1.05rem",color:"#64748b",lineHeight:"1.6",maxWidth:"500px",margin:"0 auto 1.5rem"},children:w?`No patients match "${w}". Try a different search term.`:'Start building your patient roster by clicking "Add New Patient" to sync with a patient using their Patient ID'}),!w&&_.jsx("div",{style:{padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, rgba(232, 121, 249, 0.15) 0%, rgba(168, 85, 247, 0.15) 100%)",borderRadius:"10px",display:"inline-block",fontSize:"0.9rem",fontWeight:"600",color:"#A855F7",border:"1px solid rgba(168, 85, 247, 0.3)"},children:" Patients share their 9-digit ID with you"})]}):_.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:"1.5rem"},children:N.map((k,z)=>_.jsxs("div",{style:{background:"linear-gradient(135deg, #ffffff 0%, #fdf4ff 100%)",borderRadius:"16px",padding:"2rem",border:"2px solid #fae8ff",transition:"all 0.3s",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.06)",position:"relative",overflow:"hidden"},onMouseEnter:H=>{H.currentTarget.style.transform="translateY(-8px)",H.currentTarget.style.boxShadow="0 12px 28px rgba(232, 121, 249, 0.2)",H.currentTarget.style.borderColor="#E879F9",H.currentTarget.style.background="linear-gradient(135deg, #ffffff 0%, #fae8ff 100%)"},onMouseLeave:H=>{H.currentTarget.style.transform="translateY(0)",H.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.06)",H.currentTarget.style.borderColor="#fae8ff",H.currentTarget.style.background="linear-gradient(135deg, #ffffff 0%, #fdf4ff 100%)"},onClick:()=>l("/patient-files",{state:{patientEmail:k.email,patientName:k.name}}),children:[_.jsx("div",{style:{position:"absolute",top:"1rem",right:"1rem",background:"linear-gradient(135deg, #fae8ff 0%, #f3e8ff 100%)",padding:"0.375rem 0.75rem",borderRadius:"6px",fontSize:"0.75rem",fontWeight:"700",color:"#A855F7",fontFamily:"monospace",letterSpacing:"0.05em"},children:k.patientKey?mw(k.patientKey):"No ID"}),_.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1.25rem"},children:[_.jsx("div",{style:{width:"100px",height:"100px",borderRadius:"50%",overflow:"hidden",border:"4px solid #E879F9",boxShadow:"0 8px 20px rgba(232, 121, 249, 0.25)",background:"white"},children:k.profilePicture?_.jsx("img",{src:k.profilePicture,alt:k.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):_.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #fae8ff 0%, #f3e8ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:_.jsx(pc,{size:48,color:"#A855F7"})})}),_.jsxs("div",{style:{textAlign:"center",width:"100%"},children:[_.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#1f2937",margin:"0 0 0.5rem 0",wordBreak:"break-word"},children:k.name}),_.jsxs("p",{style:{fontSize:"0.9rem",color:"#6b7280",margin:"0 0 1.5rem 0",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[_.jsx(pc,{size:14}),k.email]}),_.jsx("div",{style:{display:"flex",gap:"0.75rem",width:"100%"},children:_.jsxs("button",{style:{flex:1,padding:"0.75rem",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",color:"white",border:"none",borderRadius:"10px",fontSize:"0.9rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(232, 121, 249, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},onClick:H=>{H.stopPropagation(),l("/patient-files",{state:{patientEmail:k.email,patientName:k.name}})},onMouseEnter:H=>{H.currentTarget.style.transform="scale(1.05)",H.currentTarget.style.boxShadow="0 6px 16px rgba(232, 121, 249, 0.4)"},onMouseLeave:H=>{H.currentTarget.style.transform="scale(1)",H.currentTarget.style.boxShadow="0 4px 12px rgba(232, 121, 249, 0.3)"},children:[_.jsx(ob,{size:16}),"View Records"]})}),_.jsxs("div",{style:{marginTop:"1.25rem",padding:"1rem",background:"linear-gradient(135deg, #fdf4ff 0%, #faf5ff 100%)",borderRadius:"10px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx(ob,{size:18,color:"#A855F7",style:{marginBottom:"0.25rem"}}),_.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"Files"}),_.jsx("div",{style:{fontSize:"1rem",fontWeight:"700",color:"#1f2937"},children:""})]}),_.jsxs("div",{style:{textAlign:"center"},children:[_.jsx(nC,{size:18,color:"#A855F7",style:{marginBottom:"0.25rem"}}),_.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:"Last Visit"}),_.jsx("div",{style:{fontSize:"1rem",fontWeight:"700",color:"#1f2937"},children:""})]})]})]})]})]},z))})})]}),m&&_.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(168, 85, 247, 0.4)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"1rem",animation:"fadeIn 0.2s ease-out"},children:_.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(253, 244, 255, 0.95) 100%)",backdropFilter:"blur(20px)",borderRadius:"24px",padding:"2.5rem",maxWidth:"500px",width:"100%",boxShadow:"0 24px 60px rgba(232, 121, 249, 0.25)",border:"1px solid rgba(255, 255, 255, 0.8)",animation:"slideUp 0.3s ease-out"},children:[_.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[_.jsx("div",{style:{width:"70px",height:"70px",margin:"0 auto 1.25rem",borderRadius:"50%",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(232, 121, 249, 0.3)"},children:_.jsx(cb,{size:32,color:"white"})}),_.jsx("h3",{style:{fontSize:"1.75rem",fontWeight:"700",color:"#A855F7",margin:"0 0 0.5rem 0"},children:"Add New Patient"}),_.jsx("p",{style:{fontSize:"1rem",color:"#64748b",margin:0},children:"Enter the patient's 9-digit ID to add them to your roster"})]}),_.jsxs("div",{style:{marginBottom:"2rem"},children:[_.jsx("label",{style:{display:"block",fontSize:"0.9rem",fontWeight:"600",color:"#374151",marginBottom:"0.5rem"},children:"Patient ID"}),_.jsx("input",{type:"text",value:v,onChange:k=>S(k.target.value),placeholder:"123-456-789",style:{width:"100%",padding:"1rem 1.25rem",borderRadius:"12px",border:"2px solid #e5e7eb",fontSize:"1.1rem",fontFamily:"monospace",fontWeight:"600",letterSpacing:"0.1em",textAlign:"center",transition:"all 0.2s"},onFocus:k=>{k.currentTarget.style.borderColor="#2563eb",k.currentTarget.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)"},onBlur:k=>{k.currentTarget.style.borderColor="#e5e7eb",k.currentTarget.style.boxShadow="none"},onKeyPress:k=>{k.key==="Enter"&&D()}}),_.jsx("p",{style:{fontSize:"0.85rem",color:"#6b7280",marginTop:"0.5rem",textAlign:"center"},children:"Patients can find their ID in the top-right corner of their dashboard"})]}),_.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[_.jsx("button",{onClick:()=>{b(!1),S("")},style:{flex:1,padding:"1rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"12px",color:"#6b7280",fontWeight:"600",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:k=>{k.currentTarget.style.borderColor="#d1d5db",k.currentTarget.style.background="#f9fafb"},onMouseLeave:k=>{k.currentTarget.style.borderColor="#e5e7eb",k.currentTarget.style.background="white"},children:"Cancel"}),_.jsx("button",{onClick:D,style:{flex:1,padding:"1rem",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",border:"none",borderRadius:"12px",color:"white",fontWeight:"600",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(232, 121, 249, 0.3)"},onMouseEnter:k=>{k.currentTarget.style.transform="translateY(-2px)",k.currentTarget.style.boxShadow="0 6px 16px rgba(232, 121, 249, 0.4)"},onMouseLeave:k=>{k.currentTarget.style.transform="translateY(0)",k.currentTarget.style.boxShadow="0 4px 12px rgba(232, 121, 249, 0.3)"},children:"Add Patient"})]})]})}),_.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}var Ed={exports:{}},hb;function AC(){return hb||(hb=1,(function(l){var e=(function(t){var i=Object.prototype,s=i.hasOwnProperty,a=Object.defineProperty||function(K,X,O){K[X]=O.value},o,u=typeof Symbol=="function"?Symbol:{},d=u.iterator||"@@iterator",f=u.asyncIterator||"@@asyncIterator",p=u.toStringTag||"@@toStringTag";function m(K,X,O){return Object.defineProperty(K,X,{value:O,enumerable:!0,configurable:!0,writable:!0}),K[X]}try{m({},"")}catch{m=function(X,O,U){return X[O]=U}}function b(K,X,O,U){var q=X&&X.prototype instanceof T?X:T,se=Object.create(q.prototype),V=new j(U||[]);return a(se,"_invoke",{value:ce(K,O,V)}),se}t.wrap=b;function v(K,X,O){try{return{type:"normal",arg:K.call(X,O)}}catch(U){return{type:"throw",arg:U}}}var S="suspendedStart",w="suspendedYield",E="executing",x="completed",C={};function T(){}function D(){}function M(){}var N={};m(N,d,function(){return this});var k=Object.getPrototypeOf,z=k&&k(k(J([])));z&&z!==i&&s.call(z,d)&&(N=z);var H=M.prototype=T.prototype=Object.create(N);D.prototype=M,a(H,"constructor",{value:M,configurable:!0}),a(M,"constructor",{value:D,configurable:!0}),D.displayName=m(M,p,"GeneratorFunction");function ne(K){["next","throw","return"].forEach(function(X){m(K,X,function(O){return this._invoke(X,O)})})}t.isGeneratorFunction=function(K){var X=typeof K=="function"&&K.constructor;return X?X===D||(X.displayName||X.name)==="GeneratorFunction":!1},t.mark=function(K){return Object.setPrototypeOf?Object.setPrototypeOf(K,M):(K.__proto__=M,m(K,p,"GeneratorFunction")),K.prototype=Object.create(H),K},t.awrap=function(K){return{__await:K}};function ie(K,X){function O(se,V,I,W){var ae=v(K[se],K,V);if(ae.type==="throw")W(ae.arg);else{var re=ae.arg,de=re.value;return de&&typeof de=="object"&&s.call(de,"__await")?X.resolve(de.__await).then(function(Se){O("next",Se,I,W)},function(Se){O("throw",Se,I,W)}):X.resolve(de).then(function(Se){re.value=Se,I(re)},function(Se){return O("throw",Se,I,W)})}}var U;function q(se,V){function I(){return new X(function(W,ae){O(se,V,W,ae)})}return U=U?U.then(I,I):I()}a(this,"_invoke",{value:q})}ne(ie.prototype),m(ie.prototype,f,function(){return this}),t.AsyncIterator=ie,t.async=function(K,X,O,U,q){q===void 0&&(q=Promise);var se=new ie(b(K,X,O,U),q);return t.isGeneratorFunction(X)?se:se.next().then(function(V){return V.done?V.value:se.next()})};function ce(K,X,O){var U=S;return function(se,V){if(U===E)throw new Error("Generator is already running");if(U===x){if(se==="throw")throw V;return oe()}for(O.method=se,O.arg=V;;){var I=O.delegate;if(I){var W=ge(I,O);if(W){if(W===C)continue;return W}}if(O.method==="next")O.sent=O._sent=O.arg;else if(O.method==="throw"){if(U===S)throw U=x,O.arg;O.dispatchException(O.arg)}else O.method==="return"&&O.abrupt("return",O.arg);U=E;var ae=v(K,X,O);if(ae.type==="normal"){if(U=O.done?x:w,ae.arg===C)continue;return{value:ae.arg,done:O.done}}else ae.type==="throw"&&(U=x,O.method="throw",O.arg=ae.arg)}}}function ge(K,X){var O=X.method,U=K.iterator[O];if(U===o)return X.delegate=null,O==="throw"&&K.iterator.return&&(X.method="return",X.arg=o,ge(K,X),X.method==="throw")||O!=="return"&&(X.method="throw",X.arg=new TypeError("The iterator does not provide a '"+O+"' method")),C;var q=v(U,K.iterator,X.arg);if(q.type==="throw")return X.method="throw",X.arg=q.arg,X.delegate=null,C;var se=q.arg;if(!se)return X.method="throw",X.arg=new TypeError("iterator result is not an object"),X.delegate=null,C;if(se.done)X[K.resultName]=se.value,X.next=K.nextLoc,X.method!=="return"&&(X.method="next",X.arg=o);else return se;return X.delegate=null,C}ne(H),m(H,p,"Generator"),m(H,d,function(){return this}),m(H,"toString",function(){return"[object Generator]"});function le(K){var X={tryLoc:K[0]};1 in K&&(X.catchLoc=K[1]),2 in K&&(X.finallyLoc=K[2],X.afterLoc=K[3]),this.tryEntries.push(X)}function ue(K){var X=K.completion||{};X.type="normal",delete X.arg,K.completion=X}function j(K){this.tryEntries=[{tryLoc:"root"}],K.forEach(le,this),this.reset(!0)}t.keys=function(K){var X=Object(K),O=[];for(var U in X)O.push(U);return O.reverse(),function q(){for(;O.length;){var se=O.pop();if(se in X)return q.value=se,q.done=!1,q}return q.done=!0,q}};function J(K){if(K){var X=K[d];if(X)return X.call(K);if(typeof K.next=="function")return K;if(!isNaN(K.length)){var O=-1,U=function q(){for(;++O<K.length;)if(s.call(K,O))return q.value=K[O],q.done=!1,q;return q.value=o,q.done=!0,q};return U.next=U}}return{next:oe}}t.values=J;function oe(){return{value:o,done:!0}}return j.prototype={constructor:j,reset:function(K){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(ue),!K)for(var X in this)X.charAt(0)==="t"&&s.call(this,X)&&!isNaN(+X.slice(1))&&(this[X]=o)},stop:function(){this.done=!0;var K=this.tryEntries[0],X=K.completion;if(X.type==="throw")throw X.arg;return this.rval},dispatchException:function(K){if(this.done)throw K;var X=this;function O(W,ae){return se.type="throw",se.arg=K,X.next=W,ae&&(X.method="next",X.arg=o),!!ae}for(var U=this.tryEntries.length-1;U>=0;--U){var q=this.tryEntries[U],se=q.completion;if(q.tryLoc==="root")return O("end");if(q.tryLoc<=this.prev){var V=s.call(q,"catchLoc"),I=s.call(q,"finallyLoc");if(V&&I){if(this.prev<q.catchLoc)return O(q.catchLoc,!0);if(this.prev<q.finallyLoc)return O(q.finallyLoc)}else if(V){if(this.prev<q.catchLoc)return O(q.catchLoc,!0)}else if(I){if(this.prev<q.finallyLoc)return O(q.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(K,X){for(var O=this.tryEntries.length-1;O>=0;--O){var U=this.tryEntries[O];if(U.tryLoc<=this.prev&&s.call(U,"finallyLoc")&&this.prev<U.finallyLoc){var q=U;break}}q&&(K==="break"||K==="continue")&&q.tryLoc<=X&&X<=q.finallyLoc&&(q=null);var se=q?q.completion:{};return se.type=K,se.arg=X,q?(this.method="next",this.next=q.finallyLoc,C):this.complete(se)},complete:function(K,X){if(K.type==="throw")throw K.arg;return K.type==="break"||K.type==="continue"?this.next=K.arg:K.type==="return"?(this.rval=this.arg=K.arg,this.method="return",this.next="end"):K.type==="normal"&&X&&(this.next=X),C},finish:function(K){for(var X=this.tryEntries.length-1;X>=0;--X){var O=this.tryEntries[X];if(O.finallyLoc===K)return this.complete(O.completion,O.afterLoc),ue(O),C}},catch:function(K){for(var X=this.tryEntries.length-1;X>=0;--X){var O=this.tryEntries[X];if(O.tryLoc===K){var U=O.completion;if(U.type==="throw"){var q=U.arg;ue(O)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(K,X,O){return this.delegate={iterator:J(K),resultName:X,nextLoc:O},this.method==="next"&&(this.arg=o),C}},t})(l.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(Ed)),Ed.exports}var xd,db;function Yf(){return db||(db=1,xd=(l,e)=>`${l}-${e}-${Math.random().toString(16).slice(3,8)}`),xd}var Td,fb;function Sw(){if(fb)return Td;fb=1;const l=Yf();let e=0;return Td=({id:t,action:i,payload:s={}})=>{let a=t;return typeof a>"u"&&(a=l("Job",e),e+=1),{id:a,action:i,payload:s}},Td}var Ya={},pb;function Wf(){if(pb)return Ya;pb=1;let l=!1;return Ya.logging=l,Ya.setLogging=e=>{l=e},Ya.log=(...e)=>l?console.log.apply(this,e):null,Ya}var Cd,gb;function EC(){if(gb)return Cd;gb=1;const l=Sw(),{log:e}=Wf(),t=Yf();let i=0;return Cd=()=>{const s=t("Scheduler",i),a={},o={};let u=[];i+=1;const d=()=>u.length,f=()=>Object.keys(a).length,p=()=>{if(u.length!==0){const w=Object.keys(a);for(let E=0;E<w.length;E+=1)if(typeof o[w[E]]>"u"){u[0](a[w[E]]);break}}},m=(w,E)=>new Promise((x,C)=>{const T=l({action:w,payload:E});u.push(async D=>{u.shift(),o[D.id]=T;try{x(await D[w].apply(this,[...E,T.id]))}catch(M){C(M)}finally{delete o[D.id],p()}}),e(`[${s}]: Add ${T.id} to JobQueue`),e(`[${s}]: JobQueue length=${u.length}`),p()});return{addWorker:w=>(a[w.id]=w,e(`[${s}]: Add ${w.id}`),e(`[${s}]: Number of workers=${f()}`),p(),w.id),addJob:async(w,...E)=>{if(f()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return m(w,E)},terminate:async()=>{Object.keys(a).forEach(async w=>{await a[w].terminate()}),u=[]},getQueueLen:d,getNumWorkers:f}},Cd}function xC(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rd,mb;function TC(){return mb||(mb=1,Rd=l=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof xC=="function"&&(e.type="node"),typeof l>"u"?e:e[l]}),Rd}var kd,yb;function CC(){if(yb)return kd;yb=1;const e=TC()("type")==="browser"?t=>new URL(t,window.location.href).href:t=>t;return kd=t=>{const i={...t};return["corePath","workerPath","langPath"].forEach(s=>{t[s]&&(i[s]=e(i[s]))}),i},kd}var Od,bb;function Aw(){return bb||(bb=1,Od={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),Od}const RC="6.0.1",kC={version:RC};var Dd,vb;function OC(){return vb||(vb=1,Dd={workerBlobURL:!0,logger:()=>{}}),Dd}var Md,wb;function DC(){if(wb)return Md;wb=1;const l=kC.version;return Md={...OC(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${l}/dist/worker.min.js`},Md}var Nd,_b;function MC(){return _b||(_b=1,Nd=({workerPath:l,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const i=new Blob([`importScripts("${l}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(i))}else t=new Worker(l);return t}),Nd}var Ld,Sb;function NC(){return Sb||(Sb=1,Ld=l=>{l.terminate()}),Ld}var Pd,Ab;function LC(){return Ab||(Ab=1,Pd=(l,e)=>{l.onmessage=({data:t})=>{e(t)}}),Pd}var jd,Eb;function PC(){return Eb||(Eb=1,jd=async(l,e)=>{l.postMessage(e)}),jd}var Id,xb;function jC(){if(xb)return Id;xb=1;const l=t=>new Promise((i,s)=>{const a=new FileReader;a.onload=()=>{i(a.result)},a.onerror=({target:{error:{code:o}}})=>{s(Error(`File could not be read! Code=${o}`))},a.readAsArrayBuffer(t)}),e=async t=>{let i=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?i=atob(t.split(",")[1]).split("").map(s=>s.charCodeAt(0)):i=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(i=await e(t.src)),t.tagName==="VIDEO"&&(i=await e(t.poster)),t.tagName==="CANVAS"&&await new Promise(s=>{t.toBlob(async a=>{i=await l(a),s()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const s=await t.convertToBlob();i=await l(s)}else(t instanceof File||t instanceof Blob)&&(i=await l(t));return new Uint8Array(i)};return Id=e,Id}var Bd,Tb;function IC(){if(Tb)return Bd;Tb=1;const l=DC(),e=MC(),t=NC(),i=LC(),s=PC(),a=jC();return Bd={defaultOptions:l,spawnWorker:e,terminateWorker:t,onMessage:i,send:s,loadImage:a},Bd}var Ud,Cb;function Ew(){if(Cb)return Ud;Cb=1;const l=CC(),e=Sw(),{log:t}=Wf(),i=Yf(),s=Aw(),{defaultOptions:a,spawnWorker:o,terminateWorker:u,onMessage:d,loadImage:f,send:p}=IC();let m=0;return Ud=async(b="eng",v=s.LSTM_ONLY,S={},w={})=>{const E=i("Worker",m),{logger:x,errorHandler:C,...T}=l({...a,...S}),D={},M=typeof b=="string"?b.split("+"):b;let N=v,k=w;const z=[s.DEFAULT,s.LSTM_ONLY].includes(v)&&!T.legacyCore;let H,ne;const ie=new Promise((re,de)=>{ne=re,H=de}),ce=re=>{H(re.message)};let ge=o(T);ge.onerror=ce,m+=1;const le=({id:re,action:de,payload:Se})=>new Promise((ot,ht)=>{t(`[${E}]: Start ${re}, action=${de}`);const dt=`${de}-${re}`;D[dt]={resolve:ot,reject:ht},p(ge,{workerId:E,jobId:re,action:de,payload:Se})}),ue=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),j=re=>le(e({id:re,action:"load",payload:{options:{lstmOnly:z,corePath:T.corePath,logging:T.logging}}})),J=(re,de,Se)=>le(e({id:Se,action:"FS",payload:{method:"writeFile",args:[re,de]}})),oe=(re,de)=>le(e({id:de,action:"FS",payload:{method:"readFile",args:[re,{encoding:"utf8"}]}})),K=(re,de)=>le(e({id:de,action:"FS",payload:{method:"unlink",args:[re]}})),X=(re,de,Se)=>le(e({id:Se,action:"FS",payload:{method:re,args:de}})),O=(re,de)=>le(e({id:de,action:"loadLanguage",payload:{langs:re,options:{langPath:T.langPath,dataPath:T.dataPath,cachePath:T.cachePath,cacheMethod:T.cacheMethod,gzip:T.gzip,lstmOnly:[s.DEFAULT,s.LSTM_ONLY].includes(N)&&!T.legacyLang}}})),U=(re,de,Se,ot)=>le(e({id:ot,action:"initialize",payload:{langs:re,oem:de,config:Se}})),q=(re="eng",de,Se,ot)=>{if(z&&[s.TESSERACT_ONLY,s.TESSERACT_LSTM_COMBINED].includes(de))throw Error("Legacy model requested but code missing.");const ht=de||N;N=ht;const dt=Se||k;k=dt;const en=(typeof re=="string"?re.split("+"):re).filter(qc=>!M.includes(qc));return M.push(...en),en.length>0?O(en,ot).then(()=>U(re,ht,dt,ot)):U(re,ht,dt,ot)},se=(re={},de)=>le(e({id:de,action:"setParameters",payload:{params:re}})),V=async(re,de={},Se={text:!0},ot)=>le(e({id:ot,action:"recognize",payload:{image:await f(re),options:de,output:Se}})),I=async(re,de)=>{if(z)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return le(e({id:de,action:"detect",payload:{image:await f(re)}}))},W=async()=>(ge!==null&&(u(ge),ge=null),Promise.resolve());d(ge,({workerId:re,jobId:de,status:Se,action:ot,data:ht})=>{const dt=`${ot}-${de}`;if(Se==="resolve")t(`[${re}]: Complete ${de}`),D[dt].resolve({jobId:de,data:ht}),delete D[dt];else if(Se==="reject")if(D[dt].reject(ht),delete D[dt],ot==="load"&&H(ht),C)C(ht);else throw Error(ht);else Se==="progress"&&x({...ht,userJobId:de})});const ae={id:E,worker:ge,load:ue,writeText:J,readText:oe,removeFile:K,FS:X,reinitialize:q,setParameters:se,recognize:V,detect:I,terminate:W};return j().then(()=>O(b)).then(()=>U(b,v,w)).then(()=>ne(ae)).catch(()=>{}),ie},Ud}var Fd,Rb;function BC(){if(Rb)return Fd;Rb=1;const l=Ew();return Fd={recognize:async(i,s,a)=>{const o=await l(s,1,a);return o.recognize(i).finally(async()=>{await o.terminate()})},detect:async(i,s)=>{const a=await l("osd",0,s);return a.detect(i).finally(async()=>{await a.terminate()})}},Fd}var zd,kb;function UC(){return kb||(kb=1,zd={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),zd}var Hd,Ob;function FC(){return Ob||(Ob=1,Hd={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),Hd}var qd,Db;function zC(){if(Db)return qd;Db=1,AC();const l=EC(),e=Ew(),t=BC(),i=UC(),s=Aw(),a=FC(),{setLogging:o}=Wf();return qd={languages:i,OEM:s,PSM:a,createScheduler:l,createWorker:e,setLogging:o,...t},qd}var HC=zC();const qC=Of(HC),$t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),mf=[.001,0,0,.001,0,0],$d=1.35,fi={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ns={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ho="pdfjs_internal_editor_",Te={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},je={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},$C={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},yf={TRIANGLES:1,LATTICE:2},Lt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},gc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},_t={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Lr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},jc={ERRORS:0,WARNINGS:1,INFOS:5},fo={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Wa={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},GC={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Ic=jc.WARNINGS;function VC(l){Number.isInteger(l)&&(Ic=l)}function YC(){return Ic}function Bc(l){Ic>=jc.INFOS&&console.info(`Info: ${l}`)}function xe(l){Ic>=jc.WARNINGS&&console.warn(`Warning: ${l}`)}function Ke(l){throw new Error(l)}function Ie(l,e){l||Ke(e)}function WC(l){switch(l?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function xw(l,e=null,t=null){if(!l)return null;if(t&&typeof l=="string"&&(t.addDefaultProtocol&&l.startsWith("www.")&&l.match(/\./g)?.length>=2&&(l=`http://${l}`),t.tryConvertEncoding))try{l=ZC(l)}catch{}const i=e?URL.parse(l,e):URL.parse(l);return WC(i)?i:null}function Tw(l,e,t=!1){const i=URL.parse(l);return i?(i.hash=e,i.href):t&&xw(l,"http://example.com")?l.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Re(l,e,t,i=!1){return Object.defineProperty(l,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Us=(function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e})();class Mb extends Us{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Gd extends Us{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class bf extends Us{constructor(e){super(e,"InvalidPDFException")}}class Tc extends Us{constructor(e,t,i){super(e,"ResponseException"),this.status=t,this.missing=i}}class XC extends Us{constructor(e){super(e,"FormatError")}}class rs extends Us{constructor(e){super(e,"AbortException")}}function Cw(l){(typeof l!="object"||l?.length===void 0)&&Ke("Invalid argument for bytesToString");const e=l.length,t=8192;if(e<t)return String.fromCharCode.apply(null,l);const i=[];for(let s=0;s<e;s+=t){const a=Math.min(s+t,e),o=l.subarray(s,a);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function _o(l){typeof l!="string"&&Ke("Invalid argument for stringToBytes");const e=l.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=l.charCodeAt(i)&255;return t}function KC(l){return String.fromCharCode(l>>24&255,l>>16&255,l>>8&255,l&255)}function QC(){const l=new Uint8Array(4);return l[0]=1,new Uint32Array(l.buffer,0,1)[0]===1}function JC(){try{return new Function(""),!0}catch{return!1}}class Bt{static get isLittleEndian(){return Re(this,"isLittleEndian",QC())}static get isEvalSupported(){return Re(this,"isEvalSupported",JC())}static get isOffscreenCanvasSupported(){return Re(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Re(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return Re(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return Re(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Re(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return Re(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Vd=Array.from(Array(256).keys(),l=>l.toString(16).padStart(2,"0"));class pe{static makeHexColor(e,t,i){return`#${Vd[e]}${Vd[t]}${Vd[i]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,i=0){const s=e[i],a=e[i+1];e[i]=s*t[0]+a*t[2]+t[4],e[i+1]=s*t[1]+a*t[3]+t[5]}static applyTransformToBezier(e,t,i=0){const s=t[0],a=t[1],o=t[2],u=t[3],d=t[4],f=t[5];for(let p=0;p<6;p+=2){const m=e[i+p],b=e[i+p+1];e[i+p]=m*s+b*o+d,e[i+p+1]=m*a+b*u+f}}static applyInverseTransform(e,t){const i=e[0],s=e[1],a=t[0]*t[3]-t[1]*t[2];e[0]=(i*t[3]-s*t[2]+t[2]*t[5]-t[4]*t[3])/a,e[1]=(-i*t[1]+s*t[0]+t[4]*t[1]-t[5]*t[0])/a}static axialAlignedBoundingBox(e,t,i){const s=t[0],a=t[1],o=t[2],u=t[3],d=t[4],f=t[5],p=e[0],m=e[1],b=e[2],v=e[3];let S=s*p+d,w=S,E=s*b+d,x=E,C=u*m+f,T=C,D=u*v+f,M=D;if(a!==0||o!==0){const N=a*p,k=a*b,z=o*m,H=o*v;S+=z,x+=z,E+=H,w+=H,C+=N,M+=N,D+=k,T+=k}i[0]=Math.min(i[0],S,E,w,x),i[1]=Math.min(i[1],C,D,T,M),i[2]=Math.max(i[2],S,E,w,x),i[3]=Math.max(i[3],C,D,T,M)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const i=e[0],s=e[1],a=e[2],o=e[3],u=i**2+s**2,d=i*a+s*o,f=a**2+o**2,p=(u+f)/2,m=Math.sqrt(p**2-(u*f-d**2));t[0]=Math.sqrt(p+m||1),t[1]=Math.sqrt(p-m||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;const a=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return a>o?null:[i,a,s,o]}static pointBoundingBox(e,t,i){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}static rectBoundingBox(e,t,i,s,a){a[0]=Math.min(a[0],e,i),a[1]=Math.min(a[1],t,s),a[2]=Math.max(a[2],e,i),a[3]=Math.max(a[3],t,s)}static#e(e,t,i,s,a,o,u,d,f,p){if(f<=0||f>=1)return;const m=1-f,b=f*f,v=b*f,S=m*(m*(m*e+3*f*t)+3*b*i)+v*s,w=m*(m*(m*a+3*f*o)+3*b*u)+v*d;p[0]=Math.min(p[0],S),p[1]=Math.min(p[1],w),p[2]=Math.max(p[2],S),p[3]=Math.max(p[3],w)}static#t(e,t,i,s,a,o,u,d,f,p,m,b){if(Math.abs(f)<1e-12){Math.abs(p)>=1e-12&&this.#e(e,t,i,s,a,o,u,d,-m/p,b);return}const v=p**2-4*m*f;if(v<0)return;const S=Math.sqrt(v),w=2*f;this.#e(e,t,i,s,a,o,u,d,(-p+S)/w,b),this.#e(e,t,i,s,a,o,u,d,(-p-S)/w,b)}static bezierBoundingBox(e,t,i,s,a,o,u,d,f){f[0]=Math.min(f[0],e,u),f[1]=Math.min(f[1],t,d),f[2]=Math.max(f[2],e,u),f[3]=Math.max(f[3],t,d),this.#t(e,i,a,u,t,s,o,d,3*(-e+3*(i-a)+u),6*(e-2*i+a),3*(i-e),f),this.#t(e,i,a,u,t,s,o,d,3*(-t+3*(s-o)+d),6*(t-2*s+o),3*(s-t),f)}}function ZC(l){return decodeURIComponent(escape(l))}let Yd=null,Nb=null;function e2(l){return Yd||(Yd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Nb=new Map([["","t"]])),l.replaceAll(Yd,(e,t,i)=>t?t.normalize("NFKC"):Nb.get(i))}function Rw(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const l=new Uint8Array(32);return crypto.getRandomValues(l),Cw(l)}const Ir="pdfjs_internal_id_";function t2(l,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[i,s,...a]=t;if(!l(i)&&!Number.isInteger(i)||!e(s))return!1;const o=a.length;let u=!0;switch(s.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;u=!1;break;default:return!1}for(const d of a)if(!(typeof d=="number"||u&&d===null))return!1;return!0}function Gt(l,e,t){return Math.min(Math.max(l,e),t)}function kw(l){return Uint8Array.prototype.toBase64?l.toBase64():btoa(Cw(l))}function i2(l){return Uint8Array.fromBase64?Uint8Array.fromBase64(l):_o(atob(l))}typeof Promise.try!="function"&&(Promise.try=function(l,...e){return new Promise(t=>{t(l(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(l){return l.reduce((e,t)=>e+t,0)});class po{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function s(a){if(!a)return;let o=null;const u=a.name;if(u==="#text")o=a.value;else if(po.shouldBuildText(u))a?.attributes?.textContent?o=a.attributes.textContent:a.value&&(o=a.value);else return;if(o!==null&&t.push({str:o}),!!a.children)for(const d of a.children)s(d)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class Ow{static setupStorage(e,t,i,s,a){const o=s.getValue(t,{value:null});switch(i.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),a==="print")break;e.addEventListener("input",u=>{s.setValue(t,{value:u.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(o.value===i.attributes.xfaOn?e.setAttribute("checked",!0):o.value===i.attributes.xfaOff&&e.removeAttribute("checked"),a==="print")break;e.addEventListener("change",u=>{s.setValue(t,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),a==="print")break;e.addEventListener("input",u=>{s.setValue(t,{value:u.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const u of i.children)u.attributes.value===o.value?u.attributes.selected=!0:u.attributes.hasOwnProperty("selected")&&delete u.attributes.selected}e.addEventListener("input",u=>{const d=u.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;s.setValue(t,{value:f})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:a}){const{attributes:o}=t,u=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(const[d,f]of Object.entries(o))if(f!=null)switch(d){case"class":f.length&&e.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!u||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,f)}u&&a.addLinkAttributes(e,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(e,o.dataId,t,i)}static render(e){const t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,a=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:a,linkService:i});const u=a!=="richText",d=e.div;if(d.append(o),e.viewport){const m=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=m}u&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(s.children.length===0){if(s.value){const m=document.createTextNode(s.value);o.append(m),u&&po.shouldBuildText(s.name)&&f.push(m)}return{textDivs:f}}const p=[[s,-1,o]];for(;p.length>0;){const[m,b,v]=p.at(-1);if(b+1===m.children.length){p.pop();continue}const S=m.children[++p.at(-1)[1]];if(S===null)continue;const{name:w}=S;if(w==="#text"){const x=document.createTextNode(S.value);f.push(x),v.append(x);continue}const E=S?.attributes?.xmlns?document.createElementNS(S.attributes.xmlns,w):document.createElement(w);if(v.append(E),S.attributes&&this.setAttributes({html:E,element:S,storage:t,intent:a,linkService:i}),S.children?.length>0)p.push([S,-1,E]);else if(S.value){const x=document.createTextNode(S.value);u&&po.shouldBuildText(w)&&f.push(x),E.append(x)}}for(const m of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:f}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const _n="http://www.w3.org/2000/svg";class Yr{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function So(l,e="text"){if(to(l,document.baseURI)){const t=await fetch(l);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const s=new XMLHttpRequest;s.open("GET",l,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class Ao{constructor({viewBox:e,userUnit:t,scale:i,rotation:s,offsetX:a=0,offsetY:o=0,dontFlip:u=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=s,this.offsetX=a,this.offsetY=o,i*=t;const d=(e[2]+e[0])/2,f=(e[3]+e[1])/2;let p,m,b,v;switch(s%=360,s<0&&(s+=360),s){case 180:p=-1,m=0,b=0,v=1;break;case 90:p=0,m=1,b=1,v=0;break;case 270:p=0,m=-1,b=-1,v=0;break;case 0:p=1,m=0,b=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}u&&(b=-b,v=-v);let S,w,E,x;p===0?(S=Math.abs(f-e[1])*i+a,w=Math.abs(d-e[0])*i+o,E=(e[3]-e[1])*i,x=(e[2]-e[0])*i):(S=Math.abs(d-e[0])*i+a,w=Math.abs(f-e[1])*i+o,E=(e[2]-e[0])*i,x=(e[3]-e[1])*i),this.transform=[p*i,m*i,b*i,v*i,S-p*i*d-b*i*f,w-m*i*d-v*i*f],this.width=E,this.height=x}get rawDims(){const e=this.viewBox;return Re(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:a=!1}={}){return new Ao({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:a})}convertToViewportPoint(e,t){const i=[e,t];return pe.applyTransform(i,this.transform),i}convertToViewportRectangle(e){const t=[e[0],e[1]];pe.applyTransform(t,this.transform);const i=[e[2],e[3]];return pe.applyTransform(i,this.transform),[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){const i=[e,t];return pe.applyInverseTransform(i,this.transform),i}}class Xf extends Us{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Uc(l){const e=l.length;let t=0;for(;t<e&&l[t].trim()==="";)t++;return l.substring(t,t+5).toLowerCase()==="data:"}function Kf(l){return typeof l=="string"&&/\.pdf$/i.test(l)}function n2(l){return[l]=l.split(/[#?]/,1),l.substring(l.lastIndexOf("/")+1)}function s2(l,e="document.pdf"){if(typeof l!="string")return e;if(Uc(l))return xe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const i=(u=>{try{return new URL(u)}catch{try{return new URL(decodeURIComponent(u))}catch{try{return new URL(u,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(u),"https://foo.bar")}catch{return null}}}}})(l);if(!i)return e;const s=u=>{try{let d=decodeURIComponent(u);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:u):d}catch{return u}},a=/\.pdf$/i,o=i.pathname.split("/").at(-1);if(a.test(o))return s(o);if(i.searchParams.size>0){const u=Array.from(i.searchParams.values()).reverse();for(const f of u)if(a.test(f))return s(f);const d=Array.from(i.searchParams.keys()).reverse();for(const f of d)if(a.test(f))return s(f)}if(i.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(d)return s(d[0])}return e}class Lb{started=Object.create(null);times=[];time(e){e in this.started&&xe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||xe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:s,end:a}of this.times)e.push(`${i.padEnd(t)} ${a-s}ms
`);return e.join("")}}function to(l,e){const t=e?URL.parse(l,e):URL.parse(l);return t?.protocol==="http:"||t?.protocol==="https:"}function Mi(l){l.preventDefault()}function ut(l){l.preventDefault(),l.stopPropagation()}function r2(l){console.log("Deprecated API usage: "+l)}class vf{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const i=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let a=parseInt(t[3],10);a=a>=1&&a<=31?a:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let u=parseInt(t[5],10);u=u>=0&&u<=59?u:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const f=t[7]||"Z";let p=parseInt(t[8],10);p=p>=0&&p<=23?p:0;let m=parseInt(t[9],10)||0;return m=m>=0&&m<=59?m:0,f==="-"?(o+=p,u+=m):f==="+"&&(o-=p,u-=m),new Date(Date.UTC(i,s,a,o,u,d))}}function a2(l,{scale:e=1,rotation:t=0}){const{width:i,height:s}=l.attributes.style,a=[0,0,parseInt(i),parseInt(s)];return new Ao({viewBox:a,userUnit:1,scale:e,rotation:t})}function Eo(l){if(l.startsWith("#")){const e=parseInt(l.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return l.startsWith("rgb(")?l.slice(4,-1).split(",").map(e=>parseInt(e)):l.startsWith("rgba(")?l.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(xe(`Not a valid color format: "${l}"`),[0,0,0])}function o2(l){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of l.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;l.set(t,Eo(i))}e.remove()}function nt(l){const{a:e,b:t,c:i,d:s,e:a,f:o}=l.getTransform();return[e,t,i,s,a,o]}function Vi(l){const{a:e,b:t,c:i,d:s,e:a,f:o}=l.getTransform().invertSelf();return[e,t,i,s,a,o]}function Is(l,e,t=!1,i=!0){if(e instanceof Ao){const{pageWidth:s,pageHeight:a}=e.rawDims,{style:o}=l,u=Bt.isCSSRoundSupported,d=`var(--total-scale-factor) * ${s}px`,f=`var(--total-scale-factor) * ${a}px`,p=u?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,m=u?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!t||e.rotation%180===0?(o.width=p,o.height=m):(o.width=m,o.height=p)}i&&l.setAttribute("data-main-rotation",e.rotation)}class Ki{constructor(){const{pixelRatio:e}=Ki;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,i,s,a=-1){let o=1/0,u=1/0,d=1/0;i=Ki.capPixels(i,a),i>0&&(o=Math.sqrt(i/(e*t))),s!==-1&&(u=s/e,d=s/t);const f=Math.min(o,u,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,i):i}return e}}const wf=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class l2{static get isDarkMode(){return Re(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class c2{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:i}=window.getComputedStyle(e);return e.remove(),Re(this,"commentForegroundColor",Eo(i))}}function u2(l,e,t,i){i=Math.min(Math.max(i??1,0),1);const s=255*(1-i);return l=Math.round(l*i+s),e=Math.round(e*i+s),t=Math.round(t*i+s),[l,e,t]}function Pb(l,e){const t=l[0]/255,i=l[1]/255,s=l[2]/255,a=Math.max(t,i,s),o=Math.min(t,i,s),u=(a+o)/2;if(a===o)e[0]=e[1]=0;else{const d=a-o;switch(e[1]=u<.5?d/(a+o):d/(2-a-o),a){case t:e[0]=((i-s)/d+(i<s?6:0))*60;break;case i:e[0]=((s-t)/d+2)*60;break;case s:e[0]=((t-i)/d+4)*60;break}}e[2]=u}function _f(l,e){const t=l[0],i=l[1],s=l[2],a=(1-Math.abs(2*s-1))*i,o=a*(1-Math.abs(t/60%2-1)),u=s-a/2;switch(Math.floor(t/60)){case 0:e[0]=a+u,e[1]=o+u,e[2]=u;break;case 1:e[0]=o+u,e[1]=a+u,e[2]=u;break;case 2:e[0]=u,e[1]=a+u,e[2]=o+u;break;case 3:e[0]=u,e[1]=o+u,e[2]=a+u;break;case 4:e[0]=o+u,e[1]=u,e[2]=a+u;break;case 5:case 6:e[0]=a+u,e[1]=u,e[2]=o+u;break}}function jb(l){return l<=.03928?l/12.92:((l+.055)/1.055)**2.4}function Ib(l,e,t){_f(l,t),t.map(jb);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];_f(e,t),t.map(jb);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];return i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)}const Bb=new Map;function h2(l,e){const t=l[0]+l[1]*256+l[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let i=Bb.get(t);if(i)return i;const s=new Float32Array(9),a=s.subarray(0,3),o=s.subarray(3,6);Pb(l,o);const u=s.subarray(6,9);Pb(e,u);const d=u[2]<.5,f=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Ib(o,u,a)<f){let p,m;d?(p=o[2],m=1):(p=0,m=o[2]);const b=.005;for(;m-p>b;){const v=o[2]=(p+m)/2;d===Ib(o,u,a)<f?p=v:m=v}o[2]=d?m:p}return _f(o,a),i=pe.makeHexColor(Math.round(a[0]*255),Math.round(a[1]*255),Math.round(a[2]*255)),Bb.set(t,i),i}function Dw({html:l,dir:e,className:t},i){const s=document.createDocumentFragment();if(typeof l=="string"){const a=document.createElement("p");a.dir=e||"auto";const o=l.split(/(?:\r\n?|\n)/);for(let u=0,d=o.length;u<d;++u){const f=o[u];a.append(document.createTextNode(f)),u<d-1&&a.append(document.createElement("br"))}s.append(a)}else Ow.render({xfaHtml:l,div:s,intent:"richText"});s.firstChild.classList.add("richText",t),i.append(s)}function Mw(l){const e=new Path2D;if(!l)return e;for(let t=0,i=l.length;t<i;)switch(l[t++]){case Wa.moveTo:e.moveTo(l[t++],l[t++]);break;case Wa.lineTo:e.lineTo(l[t++],l[t++]);break;case Wa.curveTo:e.bezierCurveTo(l[t++],l[t++],l[t++],l[t++],l[t++],l[t++]);break;case Wa.quadraticCurveTo:e.quadraticCurveTo(l[t++],l[t++],l[t++],l[t++]);break;case Wa.closePath:e.closePath();break;default:xe(`Unrecognized drawing path operator: ${l[t-1]}`);break}return e}class ao{#e=null;#t=null;#n;#i=null;#a=null;#r=null;#s=null;#o=null;static#c=null;constructor(e){this.#n=e,ao.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#n._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Mi,{signal:t}),e.addEventListener("pointerdown",ao.#l,{signal:t}));const i=this.#i=document.createElement("div");i.className="buttons",e.append(i);const s=this.#n.toolbarPosition;if(s){const{style:a}=e,o=this.#n._uiManager.direction==="ltr"?1-s[0]:s[0];a.insetInlineEnd=`${100*o}%`,a.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#d(e){this.#n._focusEventsAllowed=!1,ut(e)}#h(e){this.#n._focusEventsAllowed=!0,ut(e)}#f(e){const t=this.#n._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Mi,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#a?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#n,i=document.createElement("button");i.classList.add("basic","deleteButton"),i.tabIndex=0,i.setAttribute("data-l10n-id",ao.#c[e]),this.#f(i)&&i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#i.append(i)}get#m(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#i.append(t,this.#m),this.#a=e}addComment(e,t=null){if(this.#r)return;const i=e.renderForToolbar();if(!i)return;this.#f(i);const s=this.#s=this.#m;t?(this.#i.insertBefore(i,t),this.#i.insertBefore(s,t)):this.#i.append(i,s),this.#r=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#i.append(t,this.#m)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#n);this.#f(t),this.#i.append(t,this.#m)}removeButton(e){switch(e){case"comment":this.#r?.removeToolbarCommentButton(),this.#r=null,this.#s?.remove(),this.#s=null;break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,i){if(!t&&e==="comment")return;const s=this.#i.querySelector(i);s&&e==="comment"&&this.addComment(t,s)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class d2{#e=null;#t=null;#n;constructor(e){this.#n=e}#i(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#n._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Mi,{signal:t});const i=this.#e=document.createElement("div");return i.className="buttons",e.append(i),this.#n.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),e}#a(e,t){let i=0,s=0;for(const a of e){const o=a.y+a.height;if(o<i)continue;const u=a.x+(t?a.width:0);if(o>i){s=u,i=o;continue}t?u>s&&(s=u):u<s&&(s=u)}return[t?1-s:s,i]}show(e,t,i){const[s,a]=this.#a(t,i),{style:o}=this.#t||=this.#i();e.append(this.#t),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#r(e,t,i,s){const a=document.createElement("button");a.classList.add("basic",e),a.tabIndex=0,a.setAttribute("data-l10n-id",t);const o=document.createElement("span");a.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",i);const u=this.#n._signal;u instanceof AbortSignal&&!u.aborted&&(a.addEventListener("contextmenu",Mi,{signal:u}),a.addEventListener("click",s,{signal:u})),this.#e.append(a)}}function Nw(l,e,t){for(const i of t)e.addEventListener(i,l[i].bind(l))}class He{static#e=NaN;static#t=null;static#n=NaN;static#i=null;static initializeAndAddPointerId(e){(He.#t||=new Set).add(e)}static setPointer(e,t){He.#e||=t,He.#i??=e}static setTimeStamp(e){He.#n=e}static isSamePointerId(e){return He.#e===e}static isSamePointerIdOrRemove(e){return He.#e===e?!0:(He.#t?.delete(e),!1)}static isSamePointerType(e){return He.#i===e}static isInitializedAndDifferentPointerType(e){return He.#i!==null&&!He.isSamePointerType(e)}static isSameTimeStamp(e){return He.#n===e}static isUsingMultiplePointers(){return He.#t?.size>=1}static clearPointerType(){He.#i=null}static clearPointerIds(){He.#e=NaN,He.#t=null}static clearTimeStamp(){He.#n=NaN}}class f2{#e=0;get id(){return`${ho}${this.#e++}`}}class Qf{#e=Rw();#t=0;#n=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const a=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Re(this,"_isSVGFittingCanvas",a)}async#i(e,t){this.#n||=new Map;let i=this.#n.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(i.url=t,s=await So(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const a=Qf._isSVGFittingCanvas,o=new FileReader,u=new Image,d=new Promise((f,p)=>{u.onload=()=>{i.bitmap=u,i.isSvg=!0,f()},o.onload=async()=>{const m=i.svgUrl=o.result;u.src=await a?`${m}#svgView(preserveAspectRatio(none))`:m},u.onerror=o.onerror=p});o.readAsDataURL(s),await d}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){xe(s),i=null}return this.#n.set(e,i),i&&this.#n.set(i.id,i),i}async getFromFile(e){const{lastModified:t,name:i,size:s,type:a}=e;return this.#i(`${t}_${i}_${s}_${a}`,e)}async getFromUrl(e){return this.#i(e,e)}async getFromBlob(e,t){const i=await t;return this.#i(e,i)}async getFromId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#n||=new Map;let i=this.#n.get(e);if(i?.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,i),this.#n.set(i.id,i),i}getSvgUrl(e){const t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class p2{#e=[];#t=!1;#n;#i=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:i,mustExec:s,type:a=NaN,overwriteIfSameType:o=!1,keepUndo:u=!1}){if(s&&e(),this.#t)return;const d={cmd:e,undo:t,post:i,type:a};if(this.#i===-1){this.#e.length>0&&(this.#e.length=0),this.#i=0,this.#e.push(d);return}if(o&&this.#e[this.#i].type===a){u&&(d.undo=this.#e[this.#i].undo),this.#e[this.#i]=d;return}const f=this.#i+1;f===this.#n?this.#e.splice(0,1):(this.#i=f,f<this.#e.length&&this.#e.splice(f)),this.#e.push(d)}undo(){if(this.#i===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1,this.#i-=1}redo(){if(this.#i<this.#e.length-1){this.#i+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#e.length-1}cleanType(e){if(this.#i!==-1){for(let t=this.#i;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#i-t),this.#i=t;return}this.#e.length=0,this.#i=-1}}destroy(){this.#e=null}}class xo{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Bt.platform;for(const[i,s,a={}]of e)for(const o of i){const u=o.startsWith("mac+");t&&u?(this.callbacks.set(o.slice(4),{callback:s,options:a}),this.allKeys.add(o.split("+").at(-1))):!t&&!u&&(this.callbacks.set(o,{callback:s,options:a}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(this.#e(t));if(!i)return;const{callback:s,options:{bubbles:a=!1,args:o=[],checker:u=null}}=i;u&&!u(e,t)||(s.bind(e,...o,t)(),a||ut(t))}}class Jf{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return o2(e),Re(this,"_colors",e)}convert(e){const t=Eo(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,s]of this._colors)if(s.every((a,o)=>a===t[o]))return Jf._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?pe.makeHexColor(...t):e}}class as{#e=new AbortController;#t=null;#n=null;#i=new Map;#a=new Map;#r=null;#s=null;#o=null;#c=new p2;#l=null;#d=null;#h=null;#f=0;#m=new Set;#g=null;#u=null;#p=new Set;_editorUndoBar=null;#y=!1;#v=!1;#b=!1;#x=null;#A=null;#_=null;#C=null;#w=!1;#E=null;#O=new f2;#R=!1;#k=!1;#I=!1;#M=null;#L=null;#B=null;#P=null;#$=null;#T=Te.NONE;#S=new Set;#N=null;#U=null;#z=null;#Y=null;#V=null;#W={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#j=null;#G=null;#J=null;#Z=null;#F=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=as.prototype,t=o=>o.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),i=(o,{target:u})=>{if(u instanceof HTMLInputElement){const{type:d}=u;return d!=="text"&&d!=="number"}return!0},s=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return Re(this,"_keyboardManager",new xo([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&o.#G.contains(u)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:u})=>!(u instanceof HTMLButtonElement)&&o.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:t}]]))}constructor(e,t,i,s,a,o,u,d,f,p,m,b,v,S,w,E){const x=this._signal=this.#e.signal;this.#G=e,this.#J=t,this.#Z=i,this.#r=s,this.#l=a,this.#U=o,this.#V=d,this._eventBus=u,u._on("editingaction",this.onEditingAction.bind(this),{signal:x}),u._on("pagechanging",this.onPageChanging.bind(this),{signal:x}),u._on("scalechanging",this.onScaleChanging.bind(this),{signal:x}),u._on("rotationchanging",this.onRotationChanging.bind(this),{signal:x}),u._on("setpreference",this.onSetPreference.bind(this),{signal:x}),u._on("switchannotationeditorparams",C=>this.updateParams(C.type,C.value),{signal:x}),window.addEventListener("pointerdown",()=>{this.#k=!0},{capture:!0,signal:x}),window.addEventListener("pointerup",()=>{this.#k=!1},{capture:!0,signal:x}),this.#ae(),this.#de(),this.#te(),this.#s=d.annotationStorage,this.#x=d.filterFactory,this.#z=f,this.#C=p||null,this.#y=m,this.#v=b,this.#b=v,this.#$=S||null,this.viewParameters={realScale:Yr.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=w||null,this._supportsPinchToZoom=E!==!1,a?.setSidebarUiManager(this)}destroy(){this.#F?.resolve(),this.#F=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#a.values())e.destroy();this.#a.clear(),this.#i.clear(),this.#p.clear(),this.#P?.clear(),this.#t=null,this.#S.clear(),this.#c.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#E?.hide(),this.#E=null,this.#B?.destroy(),this.#B=null,this.#n=null,this.#A&&(clearTimeout(this.#A),this.#A=null),this.#j&&(clearTimeout(this.#j),this.#j=null),this._editorUndoBar?.destroy(),this.#V=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#$}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return Re(this,"hcmFilter",this.#z?this.#x.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return Re(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return Re(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return Re(this,"highlightColors",null);const t=new Map,i=!!this.#z;for(const[s,a]of e){const o=s.endsWith("_HCM");if(i&&o){t.set(s.replace("_HCM",""),a);continue}!i&&!o&&t.set(s,a)}return Re(this,"highlightColors",t)}get highlightColorNames(){return Re(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=e}setMainHighlightColorPicker(e){this.#B=e}editAltText(e,t=!1){this.#r?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,i,s){this.#l?.showDialog(this,e,t,i,s)}selectComment(e,t){this.#a.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}toggleComment(e,t,i=void 0){this.#l?.toggleCommentPopup(e,t,i)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#a.has(e-1))return;const{resolve:t,promise:i}=Promise.withResolvers(),s=a=>{a.pageNumber===e&&(this._eventBus._off("editorsrendered",s),t())};this._eventBus.on("editorsrendered",s),await i}getSignature(e){this.#U?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#U}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#b=t;break}}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#G.focus()}findParent(e,t){for(const i of this.#a.values()){const{x:s,y:a,width:o,height:u}=i.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=a&&t<=a+u)return i}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Yr.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Q({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of this.#a.values())if(i.hasTextLayer(e))return i;return null}highlightSelection(e="",t=!1){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:s,anchorOffset:a,focusNode:o,focusOffset:u}=i,d=i.toString(),p=this.#Q(i).closest(".textLayer"),m=this.getSelectionBoxes(p);if(!m)return;i.empty();const b=this.#ee(p),v=this.#T===Te.NONE,S=()=>{const w=b?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:m,anchorNode:s,anchorOffset:a,focusNode:o,focusOffset:u,text:d});v&&this.showAllEditors("highlight",!0,!0),t&&w?.editComment()};if(v){this.switchToMode(Te.HIGHLIGHT,S);return}S()}commentSelection(e=""){this.highlightSelection(e,!0)}#se(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=this.#Q(e).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#E||=new d2(this),this.#E.show(i,s,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#s)return null;const t=`${ho}${e}`,i=this.#s.getRawValue(t);return i&&this.#s.remove(t),i}addToAnnotationStorage(e){!e.isEmpty()&&this.#s&&!this.#s.has(e.id)&&this.#s.setValue(e.id,e)}a11yAlert(e,t=null){const i=this.#Z;i&&(i.setAttribute("data-l10n-id",e),t?i.setAttribute("data-l10n-args",JSON.stringify(t)):i.removeAttribute("data-l10n-args"))}#re(){const e=document.getSelection();if(!e||e.isCollapsed){this.#N&&(this.#E?.hide(),this.#N=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#N)return;const s=this.#Q(e).closest(".textLayer");if(!s){this.#N&&(this.#E?.hide(),this.#N=null,this.#D({hasSelectedText:!1}));return}if(this.#E?.hide(),this.#N=t,this.#D({hasSelectedText:!0}),!(this.#T!==Te.HIGHLIGHT&&this.#T!==Te.NONE)&&(this.#T===Te.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const a=this.#T===Te.HIGHLIGHT?this.#ee(s):null;if(a?.toggleDrawing(),this.#k){const o=new AbortController,u=this.combinedSignal(o),d=f=>{f.type==="pointerup"&&f.button!==0||(o.abort(),a?.toggleDrawing(!0),f.type==="pointerup"&&this.#X("main_toolbar"))};window.addEventListener("pointerup",d,{signal:u}),window.addEventListener("blur",d,{signal:u})}else a?.toggleDrawing(!0),this.#X("main_toolbar")}}#X(e=""){this.#T===Te.HIGHLIGHT?this.highlightSelection(e):this.#y&&this.#se()}#ae(){document.addEventListener("selectionchange",this.#re.bind(this),{signal:this._signal})}#oe(){if(this.#_)return;this.#_=new AbortController;const e=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#le(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#S)if(t.div.contains(e)){this.#L=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#L)return;const[e,t]=this.#L;this.#L=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#M)return;this.#M=new AbortController;const e=this.combinedSignal(this.#M);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#ce(){this.#M?.abort(),this.#M=null}#ue(){if(this.#d)return;this.#d=new AbortController;const e=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#he(){this.#d?.abort(),this.#d=null}#de(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.setEditingState(!0)}removeEditListeners(){this.#ce(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of this.#u)if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of this.#u)if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of this.#S){const s=i.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const a of t.items)for(const o of this.#u)if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(a){xe(`paste: "${a.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const a=[];for(const d of i){const f=await s.deserialize(d);if(!f)return;a.push(f)}const o=()=>{for(const d of a)this.#ie(d);this.#ne(a)},u=()=>{for(const d of a)d.remove()};this.addCommands({cmd:o,undo:u,mustExec:!0})}catch(a){xe(`paste: "${a.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==Te.NONE&&!this.isEditorHandlingKeyboard&&as._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#X("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#D(e){Object.entries(e).some(([i,s])=>this.#W[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#W,e)}),this.#T===Te.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#q([[je.HIGHLIGHT_FREE,!0]]))}#q(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#oe(),this.#ue(),this.#D({isEditing:this.#T!==Te.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#le(),this.#he(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#u){this.#u=e;for(const t of this.#u)this.#q(t.defaultPropertiesToUpdate)}}getId(){return this.#O.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(e){return this.#a.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#a.set(e.pageIndex,e),this.#R?e.enable():e.disable()}removeLayer(e){this.#a.delete(e.pageIndex)}async updateMode(e,t=null,i=!1,s=!1,a=!1){if(this.#T!==e&&!(this.#F&&(await this.#F.promise,!this.#F))){if(this.#F=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#T===Te.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=e,e===Te.NONE){this.setEditingState(!1),this.#pe();for(const o of this.#i.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#F.resolve();return}for(const o of this.#i.values())o.addStandaloneCommentButton();e===Te.SIGNATURE&&await this.#U?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const o of this.#a.values())o.updateMode(e);if(e===Te.POPUP){this.#n||=await this.#V.getAnnotationsByType(new Set(this.#u.map(d=>d._editorType)));const o=new Set,u=[];for(const d of this.#i.values()){const{annotationElementId:f,hasComment:p,deleted:m}=d;f&&o.add(f),p&&!m&&u.push(d.getData())}for(const d of this.#n){const{id:f,popupRef:p,contentsObj:m}=d;p&&m?.str&&!o.has(f)&&!this.#m.has(f)&&u.push(d)}this.#l?.showSidebar(u)}if(!t){i&&this.addNewEditorFromKeyboard(),this.#F.resolve();return}for(const o of this.#i.values())o.uid===t?(this.setSelected(o),a?o.editComment():s?o.enterInEditMode():o.focus()):o.unselect();this.#F.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#u){switch(e){case je.CREATE:this.currentLayer.addNewEditor(t);return;case je.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#Y||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const i of this.#S)i.updateParams(e,t);else for(const i of this.#u)i.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){for(const a of this.#i.values())a.editorType===e&&a.show(t);(this.#Y?.get(je.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#q([[je.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#I!==e){this.#I=e;for(const t of this.#a.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#R){this.#R=!0;const e=[];for(const t of this.#a.values())e.push(t.enable());await Promise.all(e);for(const t of this.#i.values())t.enable()}}#pe(){if(this.unselectAll(),this.#R){this.#R=!1;for(const e of this.#a.values())e.disable();for(const e of this.#i.values())e.disable()}}*getEditors(e){for(const t of this.#i.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#i.get(e)}addEditor(e){this.#i.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#A&&clearTimeout(this.#A),this.#A=setTimeout(()=>{this.focusMainContainer(),this.#A=null},0)),this.#i.delete(e.id),e.annotationElementId&&this.#P?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#m.has(e.annotationElementId))&&this.#s?.remove(e.id)}addDeletedAnnotationElement(e){this.#m.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#m.has(e)}removeDeletedAnnotationElement(e){this.#m.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#ie(e){const t=this.#a.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#q(e.propertiesToUpdate))}get#ge(){let e=null;for(e of this.#S);return e}updateUI(e){this.#ge===e&&this.#q(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#q(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#S.has(e)){this.#S.delete(e),e.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#S.add(e),e.select(),this.#q(e.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#h?.commitOrRemove();for(const t of this.#S)t!==e&&t.unselect();this.#S.clear(),this.#S.add(e),e.select(),this.#q(e.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(e){return this.#S.has(e)}get firstSelectedEditor(){return this.#S.values().next().value}unselect(e){e.unselect(),this.#S.delete(e),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#S.size!==0}get isEnterHandled(){return this.#S.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#D({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(e){this.#c.add(e),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(e){this.#c.cleanType(e)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const e of this.#i.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#S],i=()=>{this._editorUndoBar?.show(s,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},s=()=>{for(const a of t)this.#ie(a)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#ne(e){for(const t of this.#S)t.unselect();this.#S.clear();for(const t of e)t.isEmpty()||(this.#S.add(t),t.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#S)e.commit();this.#ne(this.#i.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#T!==Te.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const e of this.#S)e.unselect();this.#S.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=e,this.#H[1]+=t;const[s,a]=this.#H,o=[...this.#S],u=1e3;this.#j&&clearTimeout(this.#j),this.#j=setTimeout(()=>{this.#j=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const d of o)this.#i.has(d.id)&&(d.translateInPage(s,a),d.translationDone())},undo:()=>{for(const d of o)this.#i.has(d.id)&&(d.translateInPage(-s,-a),d.translationDone())},mustExec:!1})},u);for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const e of this.#S)this.#g.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const e=this.#g;this.#g=null;let t=!1;for(const[{x:s,y:a,pageIndex:o},u]of e)u.newX=s,u.newY=a,u.newPageIndex=o,t||=s!==u.savedX||a!==u.savedY||o!==u.savedPageIndex;if(!t)return!1;const i=(s,a,o,u)=>{if(this.#i.has(s.id)){const d=this.#a.get(u);d?s._setParentAndPosition(d,a,o):(s.pageIndex=u,s.x=a,s.y=o)}};return this.addCommands({cmd:()=>{for(const[s,{newX:a,newY:o,newPageIndex:u}]of e)i(s,a,o,u)},undo:()=>{for(const[s,{savedX:a,savedY:o,savedPageIndex:u}]of e)i(s,a,o,u)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#g)for(const i of this.#g.keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#S.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#T}isEditingMode(){return this.#T!==Te.NONE}get imageManager(){return Re(this,"imageManager",new Qf)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let f=0,p=t.rangeCount;f<p;f++)if(!e.contains(t.getRangeAt(f).commonAncestorContainer))return null;const{x:i,y:s,width:a,height:o}=e.getBoundingClientRect();let u;switch(e.getAttribute("data-main-rotation")){case"90":u=(f,p,m,b)=>({x:(p-s)/o,y:1-(f+m-i)/a,width:b/o,height:m/a});break;case"180":u=(f,p,m,b)=>({x:1-(f+m-i)/a,y:1-(p+b-s)/o,width:m/a,height:b/o});break;case"270":u=(f,p,m,b)=>({x:1-(p+b-s)/o,y:(f-i)/a,width:b/o,height:m/a});break;default:u=(f,p,m,b)=>({x:(f-i)/a,y:(p-s)/o,width:m/a,height:b/o});break}const d=[];for(let f=0,p=t.rangeCount;f<p;f++){const m=t.getRangeAt(f);if(!m.collapsed)for(const{x:b,y:v,width:S,height:w}of m.getClientRects())S===0||w===0||d.push(u(b,v,S,w))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const i=this.#s.getRawValue(t);i&&(this.#T===Te.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}setMissingCanvas(e,t,i){const s=this.#P?.get(e);s&&(s.setCanvas(t,i),this.#P.delete(e))}addMissingCanvas(e,t){(this.#P||=new Map).set(e,t)}}class Xi{#e=null;#t=!1;#n=null;#i=null;#a=null;#r=null;#s=!1;#o=null;#c=null;#l=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#h=e._uiManager.useNewAltTextFlow,Xi.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){Xi._l10n??=e}async render(){const e=this.#n=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#i=document.createElement("span");e.append(t),this.#h?(e.classList.add("new"),e.setAttribute("data-l10n-id",Xi.#f.missing),t.setAttribute("data-l10n-id",Xi.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#c._uiManager._signal;e.addEventListener("contextmenu",Mi,{signal:i}),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:i});const s=a=>{a.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return e.addEventListener("click",s,{capture:!0,signal:i}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#s=!0,s(a))},{signal:i}),await this.#g(),e}get#m(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#s}),this.#s=!1)}isEmpty(){return this.#h?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#h?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#d=await Xi._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#g())}toggleAltTextBadge(e=!1){if(!this.#h||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#d),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:s,cancel:a=!1}){i&&(this.#l=i,this.#d=s),!(this.#e===e&&this.#t===t)&&(a||(this.#e=e,this.#t=t),this.#g())}toggle(e=!1){this.#n&&(!e&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#a=null,this.#o?.remove(),this.#o=null}async#g(){const e=this.#n;if(!e)return;if(this.#h){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",Xi.#f[this.#m]),this.#i?.setAttribute("data-l10n-id",Xi.#f[`${this.#m}-label`]),!this.#e){this.#a?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#a?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#a;if(!t){this.#a=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const s=100,a=this.#c._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:a}),e.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#a?.classList.remove("show")},{signal:a})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class nc{#e=null;#t=null;#n=!1;#i=null;#a=null;#r=null;#s=null;#o=null;#c=!1;#l=null;constructor(e){this.#i=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#d(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#i.commentButtonPosition;if(t){const{style:i}=e;i.insetInlineEnd=`calc(${100*(this.#i._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,i.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const s=this.#i.commentButtonColor;s&&(i.backgroundColor=s)}return this.#d(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#i.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#i._uiManager.updatePopupColor(this.#i)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#i.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:i}=this.#e.getBoundingClientRect(),{x:s,y:a,width:o,height:u}=this.#i.parent.boundingClientRect;return[(e-s)/o,(t+i-a)/u]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#d(e,t){if(!this.#i._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#i._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const i=this.#i._uiManager._signal;if(!(i instanceof AbortSignal)||i.aborted)return e;e.addEventListener("contextmenu",Mi,{signal:i}),t&&(e.addEventListener("focusin",a=>{this.#i._focusEventsAllowed=!1,ut(a)},{capture:!0,signal:i}),e.addEventListener("focusout",a=>{this.#i._focusEventsAllowed=!0,ut(a)},{capture:!0,signal:i})),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:i});const s=a=>{a.preventDefault(),e===this.#t?this.edit():this.#i.toggleComment(!0)};return e.addEventListener("click",s,{capture:!0,signal:i}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#n=!0,s(a))},{signal:i}),e.addEventListener("pointerenter",()=>{this.#i.toggleComment(!1,!0)},{signal:i}),e.addEventListener("pointerleave",()=>{this.#i.toggleComment(!1,!1)},{signal:i}),e}edit(e){const t=this.commentPopupPositionInLayer;let i,s;if(t)[i,s]=t;else{[i,s]=this.#i.commentButtonPosition;const{width:p,height:m,x:b,y:v}=this.#i;i=b+i*p,s=v+s*m}const a=this.#i.parent.boundingClientRect,{x:o,y:u,width:d,height:f}=a;this.#i._uiManager.editComment(this.#i,o+i*d,u+s*f,{...e,parentDimensions:a})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#c||this.#s===""}isEmpty(){return this.#s===null}hasBeenEdited(){return this.isDeleted()||this.#s!==this.#a}serialize(){return this.data}get data(){return{text:this.#s,richText:this.#r,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#s&&(this.#r=null),e===null){this.#s="",this.#c=!0;return}this.#s=e,this.#o=new Date,this.#c=!1}setInitialText(e,t=null){this.#a=e,this.data=e,this.#o=null,this.#r=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#s="",this.#r=null,this.#o=null,this.#i=null,this.#n=!1,this.#c=!1}}class Fc{#e;#t=!1;#n=null;#i;#a;#r;#s;#o=null;#c;#l=null;#d;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:a=null,onPinchEnd:o=null,signal:u}){this.#e=e,this.#n=i,this.#i=t,this.#a=s,this.#r=a,this.#s=o,this.#d=new AbortController,this.#c=AbortSignal.any([u,this.#d.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ki.pixelRatio}#f(e){if(this.#i?.())return;if(e.touches.length===1){if(this.#o)return;const s=this.#o=new AbortController,a=AbortSignal.any([this.#c,s.signal]),o=this.#e,u={capture:!0,signal:a,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};o.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(ut(f),d(f))},u),o.addEventListener("pointerup",d,u),o.addEventListener("pointercancel",d,u);return}if(!this.#h){this.#h=new AbortController;const s=AbortSignal.any([this.#c,this.#h.signal]),a=this.#e,o={signal:s,capture:!1,passive:!1};a.addEventListener("touchmove",this.#m.bind(this),o);const u=this.#g.bind(this);a.addEventListener("touchend",u,o),a.addEventListener("touchcancel",u,o),o.capture=!0,a.addEventListener("pointerdown",ut,o),a.addEventListener("pointermove",ut,o),a.addEventListener("pointercancel",ut,o),a.addEventListener("pointerup",ut,o),this.#a?.()}if(ut(e),e.touches.length!==2||this.#n?.()){this.#l=null;return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#m(e){if(!this.#l||e.touches.length!==2)return;ut(e);let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:s,screenY:a}=t,{screenX:o,screenY:u}=i,d=this.#l,{touch0X:f,touch0Y:p,touch1X:m,touch1Y:b}=d,v=m-f,S=b-p,w=o-s,E=u-a,x=Math.hypot(w,E)||1,C=Math.hypot(v,S)||1;if(!this.#t&&Math.abs(C-x)<=Fc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=s,d.touch0Y=a,d.touch1X=o,d.touch1Y=u,!this.#t){this.#t=!0;return}const T=[(s+o)/2,(a+u)/2];this.#r?.(T,C,x)}#g(e){e.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#s?.()),this.#l&&(ut(e),this.#l=null,this.#t=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class we{#e=null;#t=null;#n=null;#i=null;#a=null;#r=!1;#s=null;#o="";#c=null;#l=null;#d=null;#h=null;#f=null;#m="";#g=!1;#u=null;#p=!1;#y=!1;#v=!1;#b=null;#x=0;#A=0;#_=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#E=we._zIndex++;static _borderLineWidth=-1;static _colorManager=new Jf;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=we.prototype._resizeWithKeyboard,t=as.TRANSLATE_SMALL,i=as.TRANSLATE_BIG;return Re(this,"_resizerKeyboardManager",new xo([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],we.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:a,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[a,o];const[u,d]=this.parentDimensions;this.x=e.x/u,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Re(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new g2({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(we._l10n??=e,we._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),we._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);we._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Ke("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(e){this.#w=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#j(),this.#h?.remove(),this.#h=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){const[a,o]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/a,this.y=(t+s)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[i,s]=this.parentDimensions;this.setAt(e*i,t*s,this.width*i,this.height*s),this._onTranslated()}#O([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#O(this.parentDimensions,e,t)}translateInPage(e,t){this.#u||=[this.x,this.y,this.width,this.height],this.#O(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#u||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[s,a]}=this;if(this.x+=e/s,this.y+=t/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:m,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,m,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:u}=this;const[d,f]=this.getBaseTranslation();o+=d,u+=f;const{style:p}=i;p.left=`${(100*o).toFixed(2)}%`,p.top=`${(100*u).toFixed(2)}%`,this._onTranslating(o,u),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=we,s=i/e,a=i/t;switch(this.rotation){case 90:return[-s,a];case 180:return[s,a];case 270:return[s,-a];default:return[-s,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,s]}=this;let{x:a,y:o,width:u,height:d}=this;if(u*=i,d*=s,a*=i,o*=s,this._mustFixPosition)switch(e){case 0:a=Gt(a,0,i-u),o=Gt(o,0,s-d);break;case 90:a=Gt(a,0,i-d),o=Gt(o,u,s);break;case 180:a=Gt(a,u,i),o=Gt(o,d,s);break;case 270:a=Gt(a,d,i),o=Gt(o,0,s-u);break}this.x=a/=i,this.y=o/=s;const[f,p]=this.getBaseTranslation();a+=f,o+=p,t.left=`${(100*a).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#R(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return we.#R(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return we.#R(e,t,360-this.parentRotation)}#k(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(){const{div:{style:e},width:t,height:i}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*i).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#I(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const s=document.createElement("div");this.#c.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#M.bind(this,i),{signal:t}),s.addEventListener("contextmenu",Mi,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#c)}#M(e,t){t.preventDefault();const{isMac:i}=Bt.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#n?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const a=new AbortController,o=this._uiManager.combinedSignal(a);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#P.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ut,{passive:!1,signal:o}),window.addEventListener("contextmenu",Mi,{signal:o}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const u=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{a.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=u,this.div.style.cursor=d,this.#B()};window.addEventListener("pointerup",f,{signal:o}),window.addEventListener("blur",f,{signal:o})}#L(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#B(){if(!this.#d)return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=this.#d;this.#d=null;const a=this.x,o=this.y,u=this.width,d=this.height;a===e&&o===t&&u===i&&d===s||this.addCommands({cmd:this.#L.bind(this,a,o,u,d),undo:this.#L.bind(this,e,t,i,s),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#P(e,t){const[i,s]=this.parentDimensions,a=this.x,o=this.y,u=this.width,d=this.height,f=we.MIN_SIZE/i,p=we.MIN_SIZE/s,m=this.#k(this.rotation),b=(j,J)=>[m[0]*j+m[2]*J,m[1]*j+m[3]*J],v=this.#k(360-this.rotation),S=(j,J)=>[v[0]*j+v[2]*J,v[1]*j+v[3]*J];let w,E,x=!1,C=!1;switch(e){case"topLeft":x=!0,w=(j,J)=>[0,0],E=(j,J)=>[j,J];break;case"topMiddle":w=(j,J)=>[j/2,0],E=(j,J)=>[j/2,J];break;case"topRight":x=!0,w=(j,J)=>[j,0],E=(j,J)=>[0,J];break;case"middleRight":C=!0,w=(j,J)=>[j,J/2],E=(j,J)=>[0,J/2];break;case"bottomRight":x=!0,w=(j,J)=>[j,J],E=(j,J)=>[0,0];break;case"bottomMiddle":w=(j,J)=>[j/2,J],E=(j,J)=>[j/2,0];break;case"bottomLeft":x=!0,w=(j,J)=>[0,J],E=(j,J)=>[j,0];break;case"middleLeft":C=!0,w=(j,J)=>[0,J/2],E=(j,J)=>[j,J/2];break}const T=w(u,d),D=E(u,d);let M=b(...D);const N=we._round(a+M[0]),k=we._round(o+M[1]);let z=1,H=1,ne,ie;if(t.fromKeyboard)({deltaX:ne,deltaY:ie}=t);else{const{screenX:j,screenY:J}=t,[oe,K]=this.#l;[ne,ie]=this.screenToPageTranslation(j-oe,J-K),this.#l[0]=j,this.#l[1]=J}if([ne,ie]=S(ne/i,ie/s),x){const j=Math.hypot(u,d);z=H=Math.max(Math.min(Math.hypot(D[0]-T[0]-ne,D[1]-T[1]-ie)/j,1/u,1/d),f/u,p/d)}else C?z=Gt(Math.abs(D[0]-T[0]-ne),f,1)/u:H=Gt(Math.abs(D[1]-T[1]-ie),p,1)/d;const ce=we._round(u*z),ge=we._round(d*H);M=b(...E(ce,ge));const le=N-M[0],ue=k-M[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=ce,this.height=ge,this.x=le,this.y=ue,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new ao(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,i]of e)await this._editToolbar.addButton(t,i);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(Xi.initialize(we._l10n),this.#n=new Xi(this),this.#e&&(this.#n.data=this.#e,this.#e=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(e){await this.#n?.setGuessedText(e)}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#i?.focusButton()}addCommentButton(){return this.canAddComment?this.#i||=new nc(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#i.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#i.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:i,deleted:s}}=this.#i;return{text:t,richText:e,date:i,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#i||=new nc(this),this.#i.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:i}){if(!t||(this.#i||=new nc(this),this.#i.setInitialText(e,i),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){return this.#i?.hasBeenEdited()}get hasDeletedComment(){return this.#i?.isDeleted()}get hasComment(){return!!this.#i&&!this.#i.isEmpty()&&!this.#i.isDeleted()}async editComment(e){this.#i||=new nc(this),this.#i.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#i.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,s]=e.rect,[a]=this.pageDimensions,[o]=this.pageTranslation,u=o+a+1,d=s-100,f=u+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[u,d,f,s]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#i.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#r?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#z();const[t,i]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*i/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/i).toFixed(2)}%`);const[s,a]=this.getInitialTranslation();return this.translate(s,a),Nw(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new Fc({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#$.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#S.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#$(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(e,t,i){let a=.7*(i/t)+1-.7;if(a===1)return;const o=this.#k(this.rotation),u=(N,k)=>[o[0]*N+o[2]*k,o[1]*N+o[3]*k],[d,f]=this.parentDimensions,p=this.x,m=this.y,b=this.width,v=this.height,S=we.MIN_SIZE/d,w=we.MIN_SIZE/f;a=Math.max(Math.min(a,1/b,1/v),S/b,w/v);const E=we._round(b*a),x=we._round(v*a);if(E===b&&x===v)return;this.#u||=[p,m,b,v];const C=u(b/2,v/2),T=we._round(p+C[0]),D=we._round(m+C[1]),M=u(E/2,x/2);this.x=T-M[0],this.y=D-M[1],this.width=E,this.height=x,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#S(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#B()}pointerdown(e){const{isMac:t}=Bt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#U(e);return}this.#N(e)}#N(e){const{isMac:t}=Bt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,a=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:a},u=f=>{s.abort(),this.#s=null,this.#g=!1,this._uiManager.endDragSession()||this.#N(f),i&&this._onStopDragging()};t&&(this.#x=e.clientX,this.#A=e.clientY,this.#s=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",f=>{i||(i=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:p,clientY:m,pointerId:b}=f;if(b!==this.#s){ut(f);return}const[v,S]=this.screenToPageTranslation(p-this.#x,m-this.#A);this.#x=p,this.#A=m,this._uiManager.dragSelectedEditors(v,S)},o),window.addEventListener("touchmove",ut,o),window.addEventListener("pointerdown",f=>{f.pointerType===this.#o&&(this.#C||f.isPrimary)&&u(f),ut(f)},o));const d=f=>{if(!this.#s||this.#s===f.pointerId){u(f);return}ut(f)};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const s=this.parentScale,[a,o]=this.pageDimensions,[u,d]=this.pageTranslation,f=e/s,p=t/s,m=this.x*a,b=this.y*o,v=this.width*a,S=this.height*o;switch(i){case 0:return[m+f+u,o-b-p-S+d,m+f+v+u,o-b-p+d];case 90:return[m+p+u,o-b+f+d,m+p+S+u,o-b+f+v+d];case 180:return[m-f-v+u,o-b+p+d,m-f+u,o-b+p+S+d];case 270:return[m-p-S+u,o-b-f-v+d,m-p+u,o-b-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,s,a,o]=e,u=a-i,d=o-s;switch(this.rotation){case 0:return[i,t-o,u,d];case 90:return[i,t-s,d,u];case 180:return[a,t-s,u,d];case 270:return[a,t-o,d,u];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&we._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#i?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:i,opacity:s,deleted:a,richText:o},uid:u,pageIndex:d,creationDate:f,modificationDate:p}=this;return{id:u,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:f,modificationDate:i||p,popupRef:!a,color:t,opacity:s}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#v}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:a,innerWidth:o}=window;return t<o&&s>0&&e<a&&i>0}#z(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#z()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,i){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});s.rotation=e.rotation,s.#e=e.accessibilityData,s._isCopy=e.isCopy||!1;const[a,o]=s.pageDimensions,[u,d,f,p]=s.getRectInCurrentCoords(e.rect,o);return s.x=u/a,s.y=d/o,s.width=f/a,s.height=p/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#j(),this.removeEditToolbar(),this.#_){for(const e of this.#_.values())clearTimeout(e);this.#_=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#I(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[i,s,a,o]=this.getPDFRect();return[we._round(i+(a-i)*e),we._round(s+(o-s)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#i.commentPopupPositionInLayer}set commentPopupPosition(e){this.#i.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#i.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#i.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#i?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const o=this.#Y.bind(this),u=this.#V.bind(this),d=this._uiManager._signal;for(const f of this.#t){const p=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",o,{signal:d}),f.addEventListener("blur",u,{signal:d}),f.addEventListener("focus",this.#W.bind(this,p),{signal:d}),f.setAttribute("data-l10n-id",we._l10nResizer[p])}}const i=this.#t[0];let s=0;for(const o of t){if(o===i)break;s++}const a=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(a!==s){if(a<s)for(let u=0;u<s-a;u++)this.#c.append(this.#c.firstChild);else if(a>s)for(let u=0;u<a-s;u++)this.#c.firstChild.before(this.#c.lastChild);let o=0;for(const u of t){const f=this.#t[o++].getAttribute("data-resizer-name");u.setAttribute("data-l10n-id",we._l10nResizer[f])}}this.#H(0),this.#v=!0,this.#c.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#Y(e){we._resizerKeyboardManager.exec(this,e)}#V(e){this.#v&&e.relatedTarget?.parentNode!==this.#c&&this.#j()}#W(e){this.#m=this.#v?e:""}#H(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#v&&this.#P(this.#m,{deltaX:e,deltaY:t,fromKeyboard:!0})}#j(){this.#v=!1,this.#H(-1),this.#B()}_stopResizingWithKeyboard(){this.#j(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#_||=new Map;const{action:i}=e;let s=this.#_.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#_.delete(i),this.#_.size===0&&(this.#_=null)},we._telemetryTimeout),this.#_.set(i,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(e){if(!this.#h&&!this.deleted){this.#h=e.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class g2 extends we{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ub=3285377520,Ci=4294901760,Yi=65535;class Lw{constructor(e){this.h1=e?e&4294967295:Ub,this.h2=e?e&4294967295:Ub}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let w=0,E=e.length;w<E;w++){const x=e.charCodeAt(w);x<=255?t[i++]=x:(t[i++]=x>>>8,t[i++]=x&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,a=i-s*4,o=new Uint32Array(t.buffer,0,s);let u=0,d=0,f=this.h1,p=this.h2;const m=3432918353,b=461845907,v=m&Yi,S=b&Yi;for(let w=0;w<s;w++)w&1?(u=o[w],u=u*m&Ci|u*v&Yi,u=u<<15|u>>>17,u=u*b&Ci|u*S&Yi,f^=u,f=f<<13|f>>>19,f=f*5+3864292196):(d=o[w],d=d*m&Ci|d*v&Yi,d=d<<15|d>>>17,d=d*b&Ci|d*S&Yi,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(u=0,a){case 3:u^=t[s*4+2]<<16;case 2:u^=t[s*4+1]<<8;case 1:u^=t[s*4],u=u*m&Ci|u*v&Yi,u=u<<15|u>>>17,u=u*b&Ci|u*S&Yi,s&1?f^=u:p^=u}this.h1=f,this.h2=p}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ci|e*36045&Yi,t=t*4283543511&Ci|((t<<16|e>>>16)*2950163797&Ci)>>>16,e^=t>>>1,e=e*444984403&Ci|e*60499&Yi,t=t*3301882366&Ci|((t<<16|e>>>16)*3120437893&Ci)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Sf=Object.freeze({map:null,hash:"",transfer:void 0});class Zf{#e=!1;#t=null;#n=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=this.#i.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#i.get(e)}remove(e){const t=this.#i.get(e);if(t!==void 0&&(t instanceof we&&this.#n.delete(t.annotationElementId),this.#i.delete(e),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const i of this.#i.values())if(i instanceof we)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=this.#i.get(e);let s=!1;if(i!==void 0)for(const[a,o]of Object.entries(t))i[a]!==o&&(s=!0,i[a]=o);else s=!0,this.#i.set(e,t);s&&this.#a(),t instanceof we&&((this.#n||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#i.has(e)}get size(){return this.#i.size}#a(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Pw(this)}get serializable(){if(this.#i.size===0)return Sf;const e=new Map,t=new Lw,i=[],s=Object.create(null);let a=!1;for(const[o,u]of this.#i){const d=u instanceof we?u.serialize(!1,s):u;d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),a||=!!d.bitmap)}if(a)for(const o of e.values())o.bitmap&&i.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:Sf}get editorStats(){let e=null;const t=new Map;let i=0,s=0;for(const a of this.#i.values()){if(!(a instanceof we)){a.popup&&(a.popup.deleted?s+=1:i+=1);continue}a.isCommentDeleted?s+=1:a.hasEditedComment&&(i+=1);const o=a.telemetryFinalData;if(!o)continue;const{type:u}=o;t.has(u)||t.set(u,Object.getPrototypeOf(a).constructor),e||=Object.create(null);const d=e[u]||=new Map;for(const[f,p]of Object.entries(o)){if(f==="type")continue;let m=d.get(f);m||(m=new Map,d.set(f,m));const b=m.get(p)??0;m.set(p,b+1)}}if((s>0||i>0)&&(e||=Object.create(null),e.comments={deleted:s,edited:i}),!e)return null;for(const[a,o]of t)e[a]=o.computeTelemetryFinalData(e[a]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const i=this.#n?.get(e);return i?(i.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#n?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#n)for(const t of this.#n.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class Pw extends Zf{#e;constructor(e){super();const{map:t,hash:i,transfer:s}=e.serializable,a=structuredClone(t,s?{transfer:s}:null);this.#e={map:a,hash:i,transfer:s}}get print(){Ke("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return Re(this,"modifiedIds",{ids:new Set,hash:""})}}class m2{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:i}){if(!(!e||this.#e.has(e.loadedName))){if(Ie(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:a,style:o}=e,u=new FontFace(s,a,o);this.addNativeFontFace(u);try{await u.load(),this.#e.add(s),i?.(e)}catch{xe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(u)}return}Ke("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw xe(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return Re(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Re(this,"isSyncFontLoadingSupported",$t||Bt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Ie(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const a=i.shift();setTimeout(a.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Re(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(D,M){return D.charCodeAt(M)<<24|D.charCodeAt(M+1)<<16|D.charCodeAt(M+2)<<8|D.charCodeAt(M+3)&255}function s(D,M,N,k){const z=D.substring(0,M),H=D.substring(M+N);return z+k+H}let a,o;const u=this._document.createElement("canvas");u.width=1,u.height=1;const d=u.getContext("2d");let f=0;function p(D,M){if(++f>30){xe("Load test font never loaded."),M();return}if(d.font="30px "+D,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){M();return}setTimeout(p.bind(null,D,M))}const m=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=s(b,976,m.length,m);const S=16,w=1482184792;let E=i(b,S);for(a=0,o=m.length-3;a<o;a+=4)E=E-w+i(m,a)|0;a<m.length&&(E=E-w+i(m+"XXX",a)|0),b=s(b,S,4,KC(E));const x=`url(data:font/opentype;base64,${btoa(b)});`,C=`@font-face {font-family:"${m}";src:${x}}`;this.insertRule(C);const T=this._document.createElement("div");T.style.visibility="hidden",T.style.width=T.style.height="10px",T.style.position="absolute",T.style.top=T.style.left="0px";for(const D of[e.loadedName,m]){const M=this._document.createElement("span");M.textContent="Hi",M.style.fontFamily=D,T.append(M)}this._document.body.append(T),p(m,()=>{T.remove(),t.complete()})}}class y2{#e;constructor(e,t=null,i,s){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,i&&Object.assign(this,i),s&&(this.charProcOperatorList=s)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${kw(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let s;try{s=e.get(i)}catch(o){xe(`getPathGenerator - ignoring character: "${o}".`)}const a=Mw(s);return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=a}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}class zr{#e;#t;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,i={};let s=0;for(const f of zr.strings){const p=t.encode(e[f]);i[f]=p,s+=4+p.length}const a=new ArrayBuffer(s),o=new Uint8Array(a),u=new DataView(a);let d=0;for(const f of zr.strings){const p=i[f],m=p.length;u.setUint32(d,m),o.set(p,d+4),d+=4+m}return Ie(d===a.byteLength,"CssFontInfo.write: Buffer overflow"),a}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}#i(e){Ie(e<zr.strings.length,"Invalid string index");let t=0;for(let s=0;s<e;s++)t+=this.#t.getUint32(t)+4;const i=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,i))}get fontFamily(){return this.#i(0)}get fontWeight(){return this.#i(1)}get italicAngle(){return this.#i(2)}}class Hr{#e;#t;#n;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,i={};let s=0;for(const b of Hr.strings){const v=t.encode(e[b]);i[b]=v,s+=4+v.length}s+=4;let a,o,u=1+s;e.style&&(a=t.encode(e.style.style),o=t.encode(e.style.weight),u+=4+a.length+4+o.length);const d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let m=0;p.setUint8(m++,e.guessFallback?1:0),p.setUint32(m,0),m+=4,s=0;for(const b of Hr.strings){const v=i[b],S=v.length;s+=4+S,p.setUint32(m,S),f.set(v,m+4),m+=4+S}return p.setUint32(m-s-4,s),e.style&&(p.setUint32(m,a.length),f.set(a,m+4),m+=4+a.length,p.setUint32(m,o.length),f.set(o,m+4),m+=4+o.length),Ie(m<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(m)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#i(e){Ie(e<Hr.strings.length,"Invalid string index");let t=5;for(let s=0;s<e;s++)t+=this.#t.getUint32(t)+4;const i=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,i))}get css(){return this.#i(0)}get loadedName(){return this.#i(1)}get baseFontName(){return this.#i(2)}get src(){return this.#i(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),i=this.#n.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const s=this.#t.getUint32(e),a=this.#n.decode(new Uint8Array(this.#e,e+4,s));return{style:i,weight:a}}}class We{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#n=this.#t+1+8;static#i=this.#n+1+48;static#a=this.#i+1+6;#r;#s;#o;constructor({data:e,extra:t}){this.#r=e,this.#s=new TextDecoder,this.#o=new DataView(this.#r),t&&Object.assign(this,t)}#c(e){Ie(e<We.bools.length,"Invalid boolean index");const t=Math.floor(e/4),i=e*2%8,s=this.#o.getUint8(t)>>i&3;return s===0?void 0:s===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return Ie(e<We.numbers.length,"Invalid number index"),this.#o.getFloat64(We.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=We.#t;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let s=0;s<4;s++)i.push(this.#o.getInt16(e,!0)),e+=2;return i}get fontMatrix(){let e=We.#n;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let s=0;s<6;s++)i.push(this.#o.getFloat64(e,!0)),e+=8;return i}get defaultVMetrics(){let e=We.#i;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let s=0;s<3;s++)i.push(this.#o.getInt16(e,!0)),e+=2;return i}#d(e){Ie(e<We.strings.length,"Invalid string index");let t=We.#a+4;for(let a=0;a<e;a++)t+=this.#o.getUint32(t)+4;const i=this.#o.getUint32(t),s=new Uint8Array(i);return s.set(new Uint8Array(this.#r,t+4,i)),this.#s.decode(s)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let e=We.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const s=this.#o.getUint32(e);e+=4+s;const a=this.#o.getUint32(e);if(a!==0)return new Uint8Array(this.#r,e+4,a)}clearData(){let e=We.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const s=this.#o.getUint32(e);e+=4+s;const a=this.#o.getUint32(e);new Uint8Array(this.#r,e+4,a).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=We.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const s=this.#o.getUint32(e);if(s===0)return null;const a=new Uint8Array(s);return a.set(new Uint8Array(this.#r,e+4,s)),new zr(a.buffer)}get systemFontInfo(){let e=We.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);if(i===0)return null;const s=new Uint8Array(i);return s.set(new Uint8Array(this.#r,e+4,i)),new Hr(s.buffer)}static write(e){const t=e.systemFontInfo?Hr.write(e.systemFontInfo):null,i=e.cssFontInfo?zr.write(e.cssFontInfo):null,s=new TextEncoder,a={};let o=0;for(const w of We.strings)a[w]=s.encode(e[w]),o+=4+a[w].length;const u=We.#a+4+o+4+(t?t.byteLength:0)+4+(i?i.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(u),f=new Uint8Array(d),p=new DataView(d);let m=0;const b=We.bools.length;let v=0,S=0;for(let w=0;w<b;w++){const E=e[We.bools[w]];v|=(E===void 0?0:E?2:1)<<S,S+=2,(S===8||w===b-1)&&(p.setUint8(m++,v),v=0,S=0)}Ie(m===We.#e,"FontInfo.write: Boolean properties offset mismatch");for(const w of We.numbers)p.setFloat64(m,e[w]),m+=8;if(Ie(m===We.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){p.setUint8(m++,4);for(const w of e.bbox)p.setInt16(m,w,!0),m+=2}else p.setUint8(m++,0),m+=8;if(Ie(m===We.#n,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){p.setUint8(m++,6);for(const w of e.fontMatrix)p.setFloat64(m,w,!0),m+=8}else p.setUint8(m++,0),m+=48;if(Ie(m===We.#i,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){p.setUint8(m++,1);for(const w of e.defaultVMetrics)p.setInt16(m,w,!0),m+=2}else p.setUint8(m++,0),m+=6;Ie(m===We.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),p.setUint32(We.#a,0),m+=4;for(const w of We.strings){const E=a[w],x=E.length;p.setUint32(m,x),f.set(E,m+4),m+=4+x}if(p.setUint32(We.#a,m-We.#a-4),!t)p.setUint32(m,0),m+=4;else{const w=t.byteLength;p.setUint32(m,w),Ie(m+4+w<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(t),m+4),m+=4+w}if(!i)p.setUint32(m,0),m+=4;else{const w=i.byteLength;p.setUint32(m,w),Ie(m+4+w<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(i),m+4),m+=4+w}return e.data===void 0?(p.setUint32(m,0),m+=4):(p.setUint32(m,e.data.length),f.set(e.data,m+4),m+=4+e.data.length),Ie(m<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(m)}}class Ct{static#e=0;static#t=1;static#n=2;static#i=3;static#a=4;static#r=8;static#s=12;static#o=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,i=null,s=[],a=[],o=[],u=[],d=null,f=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,i=e[2],o=e[3],t===1?s.push(...e[4],...e[5]):s.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,d=e[1],s=e[2],a=e[3],u=e[4]||[],i=e[6],f=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const p=Math.floor(s.length/2),m=Math.floor(a.length/3),b=o.length,v=u.length;let S=0;for(const M of u)S+=1,S=Math.ceil(S/4)*4,S+=4+M.coords.length*4,S+=4+M.colors.length*4,M.verticesPerRow!==void 0&&(S+=4);const w=20+p*8+m*3+b*8+(i?16:0)+(f?3:0)+S,E=new ArrayBuffer(w),x=new DataView(E),C=new Uint8Array(E);x.setUint8(Ct.#e,t),x.setUint8(Ct.#t,i?1:0),x.setUint8(Ct.#n,f?1:0),x.setUint8(Ct.#i,d),x.setUint32(Ct.#a,p,!0),x.setUint32(Ct.#r,m,!0),x.setUint32(Ct.#s,b,!0),x.setUint32(Ct.#o,v,!0);let T=20;new Float32Array(E,T,p*2).set(s),T+=p*8,C.set(a,T),T+=m*3;for(const[M,N]of o)x.setFloat32(T,M,!0),T+=4,x.setUint32(T,parseInt(N.slice(1),16),!0),T+=4;if(i)for(const M of i)x.setFloat32(T,M,!0),T+=4;f&&(C.set(f,T),T+=3);for(let M=0;M<u.length;M++){const N=u[M];x.setUint8(T,N.type),T+=1,T=Math.ceil(T/4)*4,x.setUint32(T,N.coords.length,!0),T+=4,new Int32Array(E,T,N.coords.length).set(N.coords),T+=N.coords.length*4,x.setUint32(T,N.colors.length,!0),T+=4,new Int32Array(E,T,N.colors.length).set(N.colors),T+=N.colors.length*4,N.verticesPerRow!==void 0&&(x.setUint32(T,N.verticesPerRow,!0),T+=4)}return E}getIR(){const e=this.view,t=this.data[Ct.#e],i=!!this.data[Ct.#t],s=!!this.data[Ct.#n],a=e.getUint32(Ct.#a,!0),o=e.getUint32(Ct.#r,!0),u=e.getUint32(Ct.#s,!0),d=e.getUint32(Ct.#o,!0);let f=20;const p=new Float32Array(this.buffer,f,a*2);f+=a*8;const m=new Uint8Array(this.buffer,f,o*3);f+=o*3;const b=[];for(let E=0;E<u;++E){const x=e.getFloat32(f,!0);f+=4;const C=e.getUint32(f,!0);f+=4,b.push([x,`#${C.toString(16).padStart(6,"0")}`])}let v=null;if(i){v=[];for(let E=0;E<4;++E)v.push(e.getFloat32(f,!0)),f+=4}let S=null;s&&(S=new Uint8Array(this.buffer,f,3),f+=3);const w=[];for(let E=0;E<d;++E){const x=e.getUint8(f);f+=1,f=Math.ceil(f/4)*4;const C=e.getUint32(f,!0);f+=4;const T=new Int32Array(this.buffer,f,C);f+=C*4;const D=e.getUint32(f,!0);f+=4;const M=new Int32Array(this.buffer,f,D);f+=D*4;const N={type:x,coords:T,colors:M};x===yf.LATTICE&&(N.verticesPerRow=e.getUint32(f,!0),f+=4),w.push(N)}if(t===1)return["RadialAxial","axial",v,b,Array.from(p.slice(0,2)),Array.from(p.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",v,b,[p[0],p[1]],[p[3],p[4]],p[2],p[5]];if(t===3){const E=this.data[Ct.#i];let x=null;if(p.length>0){let C=p[0],T=p[0],D=p[1],M=p[1];for(let N=0;N<p.length;N+=2){const k=p[N],z=p[N+1];C=C>k?k:C,D=D>z?z:D,T=T<k?k:T,M=M<z?z:M}x=[C,D,T,M]}return["Mesh",E,p,m,w,x,v,S]}throw new Error(`Unsupported pattern kind: ${t}`)}}function b2(l){if(l instanceof URL)return l.href;if(typeof l=="string"){if($t)return l;const e=URL.parse(l,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function v2(l){if($t&&typeof Buffer<"u"&&l instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(l instanceof Uint8Array&&l.byteLength===l.buffer.byteLength)return l;if(typeof l=="string")return _o(l);if(l instanceof ArrayBuffer||ArrayBuffer.isView(l)||typeof l=="object"&&!isNaN(l?.length))return new Uint8Array(l);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function sc(l){if(typeof l!="string")return null;if(l.endsWith("/"))return l;throw new Error(`Invalid factory url: "${l}" must include trailing slash.`)}const Af=l=>typeof l=="object"&&Number.isInteger(l?.num)&&l.num>=0&&Number.isInteger(l?.gen)&&l.gen>=0,w2=l=>typeof l=="object"&&typeof l?.name=="string",_2=t2.bind(null,Af,w2);class S2{#e=new Map;#t=Promise.resolve();postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[s]of this.#e)s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if(i?.signal instanceof AbortSignal){const{signal:a}=i;if(a.aborted){xe("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);s=()=>a.removeEventListener("abort",o),a.addEventListener("abort",o)}this.#e.set(t,s)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const rc={DATA:1,ERROR:2},wt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Fb(){}function ti(l){if(l instanceof rs||l instanceof bf||l instanceof Mb||l instanceof Tc||l instanceof Gd)return l;switch(l instanceof Error||typeof l=="object"&&l!==null||Ke('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),l.name){case"AbortException":return new rs(l.message);case"InvalidPDFException":return new bf(l.message);case"PasswordException":return new Mb(l.message,l.code);case"ResponseException":return new Tc(l.message,l.status,l.missing);case"UnknownErrorException":return new Gd(l.message,l.details)}return new Gd(l.message,l.toString())}class io{#e=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#i(e);return}if(e.callback){const i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===rc.DATA)s.resolve(e.data);else if(e.callback===rc.ERROR)s.reject(ti(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,s=e.sourceName,a=this.comObj;Promise.try(t,e.data).then(function(o){a.postMessage({sourceName:i,targetName:s,callback:rc.DATA,callbackId:e.callbackId,data:o})},function(o){a.postMessage({sourceName:i,targetName:s,callback:rc.ERROR,callbackId:e.callbackId,reason:ti(o)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const s=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[s]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(o){a.reject(o)}return a.promise}sendWithStream(e,t,i,s){const a=this.streamId++,o=this.sourceName,u=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const p=Promise.withResolvers();return this.streamControllers[a]={controller:f,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:u,action:e,streamId:a,data:t,desiredSize:f.desiredSize},s),p.promise},pull:f=>{const p=Promise.withResolvers();return this.streamControllers[a].pullCall=p,d.postMessage({sourceName:o,targetName:u,stream:wt.PULL,streamId:a,desiredSize:f.desiredSize}),p.promise},cancel:f=>{Ie(f instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[a].cancelCall=p,this.streamControllers[a].isClosed=!0,d.postMessage({sourceName:o,targetName:u,stream:wt.CANCEL,streamId:a,reason:ti(f)}),p.promise}},i)}#n(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,a=this.comObj,o=this,u=this.actionHandler[e.action],d={enqueue(f,p=1,m){if(this.isCancelled)return;const b=this.desiredSize;this.desiredSize-=p,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:i,targetName:s,stream:wt.ENQUEUE,streamId:t,chunk:f},m)},close(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:s,stream:wt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(f){Ie(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:s,stream:wt.ERROR,streamId:t,reason:ti(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(u,e.data,d).then(function(){a.postMessage({sourceName:i,targetName:s,stream:wt.START_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:s,stream:wt.START_COMPLETE,streamId:t,reason:ti(f)})})}#i(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,a=this.comObj,o=this.streamControllers[t],u=this.streamSinks[t];switch(e.stream){case wt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(ti(e.reason));break;case wt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(ti(e.reason));break;case wt.PULL:if(!u){a.postMessage({sourceName:i,targetName:s,stream:wt.PULL_COMPLETE,streamId:t,success:!0});break}u.desiredSize<=0&&e.desiredSize>0&&u.sinkCapability.resolve(),u.desiredSize=e.desiredSize,Promise.try(u.onPull||Fb).then(function(){a.postMessage({sourceName:i,targetName:s,stream:wt.PULL_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:s,stream:wt.PULL_COMPLETE,streamId:t,reason:ti(f)})});break;case wt.ENQUEUE:if(Ie(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case wt.CLOSE:if(Ie(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#a(o,t);break;case wt.ERROR:Ie(o,"error should have stream controller"),o.controller.error(ti(e.reason)),this.#a(o,t);break;case wt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(ti(e.reason)),this.#a(o,t);break;case wt.CANCEL:if(!u)break;const d=ti(e.reason);Promise.try(u.onCancel||Fb,d).then(function(){a.postMessage({sourceName:i,targetName:s,stream:wt.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:s,stream:wt.CANCEL_COMPLETE,streamId:t,reason:ti(f)})}),u.sinkCapability.reject(d),u.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#a(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class jw{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Ke("Abstract method `_createCanvas` called.")}}class A2 extends jw{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class Iw{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Ke("Abstract method `_fetch` called.")}}class zb extends Iw{async _fetch(e){const t=await So(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):_o(t)}}class Bw{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,a){return"none"}destroy(e=!1){}}class E2 extends Bw{#e;#t;#n;#i;#a;#r;#s=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#i=e,this.#a=t}get#o(){return this.#t||=new Map}get#c(){return this.#r||=new Map}get#l(){if(!this.#n){const e=this.#a.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const i=this.#a.createElementNS(_n,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#n=this.#a.createElementNS(_n,"defs"),e.append(i),i.append(this.#n),this.#a.body.append(e)}return this.#n}#d(e){if(e.length===1){const d=e[0],f=new Array(256);for(let m=0;m<256;m++)f[m]=d[m]/255;const p=f.join(",");return[p,p,p]}const[t,i,s]=e,a=new Array(256),o=new Array(256),u=new Array(256);for(let d=0;d<256;d++)a[d]=t[d]/255,o[d]=i[d]/255,u[d]=s[d]/255;return[a.join(","),o.join(","),u.join(",")]}#h(e){if(this.#e===void 0){this.#e="";const t=this.#a.URL;t!==this.#a.baseURI&&(Uc(t)?xe('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=Tw(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[i,s,a]=this.#d(e),o=e.length===1?i:`${i}${s}${a}`;if(t=this.#o.get(o),t)return this.#o.set(e,t),t;const u=`g_${this.#i}_transfer_map_${this.#s++}`,d=this.#h(u);this.#o.set(e,d),this.#o.set(o,d);const f=this.#g(u);return this.#p(i,s,a,f),d}addHCMFilter(e,t){const i=`${e}-${t}`,s="base";let a=this.#c.get(s);if(a?.key===i||(a?(a.filter?.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},this.#c.set(s,a)),!e||!t))return a.url;const o=this.#v(e);e=pe.makeHexColor(...o);const u=this.#v(t);if(t=pe.makeHexColor(...u),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return a.url;const d=new Array(256);for(let v=0;v<=255;v++){const S=v/255;d[v]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const f=d.join(","),p=`g_${this.#i}_hcm_filter`,m=a.filter=this.#g(p);this.#p(f,f,f,m),this.#m(m);const b=(v,S)=>{const w=o[v]/255,E=u[v]/255,x=new Array(S+1);for(let C=0;C<=S;C++)x[C]=w+C/S*(E-w);return x.join(",")};return this.#p(b(0,5),b(1,5),b(2,5),m),a.url=this.#h(p),a.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[i]=this.#d([e]),s=`alpha_${i}`;if(t=this.#o.get(s),t)return this.#o.set(e,t),t;const a=`g_${this.#i}_alpha_map_${this.#s++}`,o=this.#h(a);this.#o.set(e,o),this.#o.set(s,o);const u=this.#g(a);return this.#y(i,u),o}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let i,s;if(e?([i]=this.#d([e]),s=`luminosity_${i}`):s="luminosity",t=this.#o.get(s),t)return this.#o.set(e,t),t;const a=`g_${this.#i}_luminosity_map_${this.#s++}`,o=this.#h(a);this.#o.set(e,o),this.#o.set(s,o);const u=this.#g(a);return this.#f(u),e&&this.#y(i,u),o}addHighlightHCMFilter(e,t,i,s,a){const o=`${t}-${i}-${s}-${a}`;let u=this.#c.get(e);if(u?.key===o||(u?(u.filter?.remove(),u.key=o,u.url="none",u.filter=null):(u={key:o,url:"none",filter:null},this.#c.set(e,u)),!t||!i))return u.url;const[d,f]=[t,i].map(this.#v.bind(this));let p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),m=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[b,v]=[s,a].map(this.#v.bind(this));m<p&&([p,m,b,v]=[m,p,v,b]),this.#l.style.color="";const S=(x,C,T)=>{const D=new Array(256),M=(m-p)/T,N=x/255,k=(C-x)/(255*T);let z=0;for(let H=0;H<=T;H++){const ne=Math.round(p+H*M),ie=N+H*k;for(let ce=z;ce<=ne;ce++)D[ce]=ie;z=ne+1}for(let H=z;H<256;H++)D[H]=D[z-1];return D.join(",")},w=`g_${this.#i}_hcm_${e}_filter`,E=u.filter=this.#g(w);return this.#m(E),this.#p(S(b[0],v[0],5),S(b[1],v[1],5),S(b[2],v[2],5),E),u.url=this.#h(w),u.url}destroy(e=!1){e&&this.#r?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#r?.clear(),this.#r=null,this.#s=0)}#f(e){const t=this.#a.createElementNS(_n,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#m(e){const t=this.#a.createElementNS(_n,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#g(e){const t=this.#a.createElementNS(_n,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#u(e,t,i){const s=this.#a.createElementNS(_n,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),e.append(s)}#p(e,t,i,s){const a=this.#a.createElementNS(_n,"feComponentTransfer");s.append(a),this.#u(a,"feFuncR",e),this.#u(a,"feFuncG",t),this.#u(a,"feFuncB",i)}#y(e,t){const i=this.#a.createElementNS(_n,"feComponentTransfer");t.append(i),this.#u(i,"feFuncA",e)}#v(e){return this.#l.style.color=e,Eo(getComputedStyle(this.#l).getPropertyValue("color"))}}class Uw{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Ke("Abstract method `_fetch` called.")}}class Hb extends Uw{async _fetch(e){const t=await So(e,"arraybuffer");return new Uint8Array(t)}}class Fw{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Ke("Abstract method `_fetch` called.")}}class qb extends Fw{async _fetch(e){const t=await So(e,"arraybuffer");return new Uint8Array(t)}}$t&&xe("Please use the `legacy` build in Node.js environments.");async function ep(l){const t=await process.getBuiltinModule("fs").promises.readFile(l);return new Uint8Array(t)}class x2 extends Bw{}class T2 extends jw{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class C2 extends Iw{async _fetch(e){return ep(e)}}class R2 extends Uw{async _fetch(e){return ep(e)}}class k2 extends Fw{async _fetch(e){return ep(e)}}const Or="__forcedDependency",{floor:$b,ceil:Gb}=Math;function ac(l,e,t,i,s,a){l[e*4+0]=Math.min(l[e*4+0],t),l[e*4+1]=Math.min(l[e*4+1],i),l[e*4+2]=Math.max(l[e*4+2],s),l[e*4+3]=Math.max(l[e*4+3],a)}const Ef=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class O2{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===Ef}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const oc=(l,e)=>{if(!l)return;let t=l.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},l.set(e,t)),t};class D2{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[Or]:[]};#n=new Map;#i=[];#a=[];#r=[[1,0,0,1,0,0]];#s=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#d=new Map;#h=new Map;#f;#m;#g;#u;#p;constructor(e,t,i=!1){this.#f=e.width,this.#m=e.height,this.#y(t),i&&(this.#p=new Map)}growOperationsCount(e){e>=this.#u.length&&this.#y(e,this.#u)}#y(e,t){const i=new ArrayBuffer(e*4);this.#g=new Uint8ClampedArray(i),this.#u=new Uint32Array(i),t&&t.length>0?(this.#u.set(t),this.#u.fill(Ef,t.length)):this.#u.fill(Ef)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[Or]:{__proto__:this.#t[Or]}},this.#s={__proto__:this.#s},this.#i.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#s=Object.getPrototypeOf(this.#s);const i=this.#i.pop();return i!==void 0&&(oc(this.#p,e)?.dependencies.add(i),this.#u[e]=this.#u[i]),this}recordOpenMarker(e){return this.#i.push(e),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)}recordCloseMarker(e){const t=this.#i.pop();return t!==void 0&&(oc(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}beginMarkedContent(e){return this.#a.push(e),this}endMarkedContent(e){const t=this.#a.pop();return t!==void 0&&(oc(this.#p,e)?.dependencies.add(t),this.#u[e]=this.#u[t]),this}pushBaseTransform(e){return this.#r.push(pe.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#n.set(e,t),this}recordSimpleDataFromNamed(e,t,i){this.#e[e]=this.#n.get(t)??i}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Or,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(Or,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,i,s,a,o){const u=pe.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];pe.axialAlignedBoundingBox([i,a,s,o],u,d);const f=pe.intersect(this.#s,d);return f?(this.#s[0]=f[0],this.#s[1]=f[1],this.#s[2]=f[2],this.#s[3]=f[3]):(this.#s[0]=this.#s[1]=1/0,this.#s[2]=this.#s[3]=-1/0),this}recordBBox(e,t,i,s,a,o){const u=this.#s;if(u[0]===1/0)return this;const d=pe.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform());if(u[0]===-1/0)return pe.axialAlignedBoundingBox([i,a,s,o],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return pe.axialAlignedBoundingBox([i,a,s,o],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],u[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],u[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],u[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],u[3])),this}recordCharacterBBox(e,t,i,s=1,a=0,o=0,u){const d=i.bbox;let f,p;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#h.get(i),f!==!1&&(p=[0,0,0,0],pe.axialAlignedBoundingBox(d,i.fontMatrix,p),(s!==1||a!==0||o!==0)&&pe.scaleMinMax([s,0,0,-s,a,o],p),f)))return this.recordBBox(e,t,p[0],p[2],p[1],p[3]);if(!u)return this.recordFullPageBBox(e);const m=u();return d&&p&&f===void 0&&(f=p[0]<=a-m.actualBoundingBoxLeft&&p[2]>=a+m.actualBoundingBoxRight&&p[1]<=o-m.actualBoundingBoxAscent&&p[3]>=o+m.actualBoundingBoxDescent,this.#h.set(i,f),f)?this.recordBBox(e,t,p[0],p[2],p[1],p[3]):this.recordBBox(e,t,a-m.actualBoundingBoxLeft,a+m.actualBoundingBoxRight,o-m.actualBoundingBoxAscent,o+m.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#s[0]),this.#o[1]=Math.max(0,this.#s[1]),this.#o[2]=Math.min(this.#f,this.#s[2]),this.#o[3]=Math.min(this.#m,this.#s[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const i=this.#l,s=this.#e,a=this.#t;for(const o of t)o in this.#e?i.add(s[o]):o in a&&a[o].forEach(i.add,i);return this}recordNamedDependency(e,t){return this.#n.has(t)&&this.#l.add(this.#n.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Or]),this.#p){const i=oc(this.#p,e),{dependencies:s}=i;this.#l.forEach(s.add,s),this.#i.forEach(s.add,s),this.#a.forEach(s.add,s),s.delete(e),i.isRenderingOperation=!0}if(this.#c===e){const i=$b(this.#o[0]*256/this.#f),s=$b(this.#o[1]*256/this.#m),a=Gb(this.#o[2]*256/this.#f),o=Gb(this.#o[3]*256/this.#m);ac(this.#g,e,i,s,a,o);for(const u of this.#l)u!==e&&ac(this.#g,u,i,s,a,o);for(const u of this.#i)u!==e&&ac(this.#g,u,i,s,a,o);for(const u of this.#a)u!==e&&ac(this.#g,u,i,s,a,o);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const i=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const s of i)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#s[0]=Math.max(this.#s[0],this.#o[0]),this.#s[1]=Math.max(this.#s[1],this.#o[1]),this.#s[2]=Math.min(this.#s[2],this.#o[2]),this.#s[3]=Math.min(this.#s[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#d.get(e);return this.#d.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#h.clear(),new O2(this.#u,this.#g)}takeDebugMetadata(){return this.#p}}class Cc{#e;#t;#n;#i=0;#a=0;constructor(e,t,i){if(e instanceof Cc&&e.#n===!!i)return e;this.#e=e,this.#t=t,this.#n=!!i}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#a++,this.#e.save(this.#t),this}restore(e){return this.#a>0&&(this.#e.restore(this.#t),this.#a--),this}recordOpenMarker(e){return this.#i++,this}getOpenMarker(){return this.#i>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#i--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,i){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#n||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,i,s,a,o){return this.#n||this.#e.recordClipBox(this.#t,t,i,s,a,o),this}recordBBox(e,t,i,s,a,o){return this.#n||this.#e.recordBBox(this.#t,t,i,s,a,o),this}recordCharacterBBox(e,t,i,s,a,o,u){return this.#n||this.#e.recordCharacterBBox(this.#t,t,i,s,a,o,u),this}recordFullPageBBox(e){return this.#n||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#n||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Ri={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},It={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function xf(l,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),l.clip(s)}class tp{isModifyingCurrentTransform(){return!1}getPattern(){Ke("Abstract method `getPattern` called.")}}class M2 extends tp{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let a;if(s===It.STROKE||s===It.FILL){const o=t.current.getClippedPathBoundingBox(s,nt(e))||[0,0,0,0],u=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,f=t.cachedCanvases.getCanvas("pattern",u,d),p=f.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-o[0],-o[1]),i=pe.transform(i,[1,0,0,1,o[0],o[1]]),p.transform(...t.baseTransform),this.matrix&&p.transform(...this.matrix),xf(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),a=e.createPattern(f.canvas,"no-repeat");const m=new DOMMatrix(i);a.setTransform(m)}else xf(e,this._bbox),a=this._createGradient(e);return a}}function Wd(l,e,t,i,s,a,o,u){const d=e.coords,f=e.colors,p=l.data,m=l.width*4;let b;d[t+1]>d[i+1]&&(b=t,t=i,i=b,b=a,a=o,o=b),d[i+1]>d[s+1]&&(b=i,i=s,s=b,b=o,o=u,u=b),d[t+1]>d[i+1]&&(b=t,t=i,i=b,b=a,a=o,o=b);const v=(d[t]+e.offsetX)*e.scaleX,S=(d[t+1]+e.offsetY)*e.scaleY,w=(d[i]+e.offsetX)*e.scaleX,E=(d[i+1]+e.offsetY)*e.scaleY,x=(d[s]+e.offsetX)*e.scaleX,C=(d[s+1]+e.offsetY)*e.scaleY;if(S>=C)return;const T=f[a],D=f[a+1],M=f[a+2],N=f[o],k=f[o+1],z=f[o+2],H=f[u],ne=f[u+1],ie=f[u+2],ce=Math.round(S),ge=Math.round(C);let le,ue,j,J,oe,K,X,O;for(let U=ce;U<=ge;U++){if(U<E){const W=U<S?0:(S-U)/(S-E);le=v-(v-w)*W,ue=T-(T-N)*W,j=D-(D-k)*W,J=M-(M-z)*W}else{let W;U>C?W=1:E===C?W=0:W=(E-U)/(E-C),le=w-(w-x)*W,ue=N-(N-H)*W,j=k-(k-ne)*W,J=z-(z-ie)*W}let q;U<S?q=0:U>C?q=1:q=(S-U)/(S-C),oe=v-(v-x)*q,K=T-(T-H)*q,X=D-(D-ne)*q,O=M-(M-ie)*q;const se=Math.round(Math.min(le,oe)),V=Math.round(Math.max(le,oe));let I=m*U+se*4;for(let W=se;W<=V;W++)q=(le-W)/(le-oe),q<0?q=0:q>1&&(q=1),p[I++]=ue-(ue-K)*q|0,p[I++]=j-(j-X)*q|0,p[I++]=J-(J-O)*q|0,p[I++]=255}}function N2(l,e,t){const i=e.coords,s=e.colors;let a,o;switch(e.type){case yf.LATTICE:const u=e.verticesPerRow,d=Math.floor(i.length/u)-1,f=u-1;for(a=0;a<d;a++){let p=a*u;for(let m=0;m<f;m++,p++)Wd(l,t,i[p],i[p+1],i[p+u],s[p],s[p+1],s[p+u]),Wd(l,t,i[p+u+1],i[p+1],i[p+u],s[p+u+1],s[p+1],s[p+u])}break;case yf.TRIANGLES:for(a=0,o=i.length;a<o;a+=3)Wd(l,t,i[a],i[a+1],i[a+2],s[a],s[a+1],s[a+2]);break;default:throw new Error("illegal figure")}}class L2 extends tp{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,i){const u=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-u,p=Math.ceil(this._bounds[3])-d,m=Math.min(Math.ceil(Math.abs(f*e[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(p*e[1]*1.1)),3e3),v=f/m,S=p/b,w={coords:this._coords,colors:this._colors,offsetX:-u,offsetY:-d,scaleX:1/v,scaleY:1/S},E=m+4,x=b+4,C=i.getCanvas("mesh",E,x),T=C.context,D=T.createImageData(m,b);if(t){const N=D.data;for(let k=0,z=N.length;k<z;k+=4)N[k]=t[0],N[k+1]=t[1],N[k+2]=t[2],N[k+3]=255}for(const N of this._figures)N2(D,N,w);return T.putImageData(D,2,2),{canvas:C.canvas,offsetX:u-2*v,offsetY:d-2*S,scaleX:v,scaleY:S}}isModifyingCurrentTransform(){return!0}getPattern(e,t,i,s){xf(e,this._bbox);const a=new Float32Array(2);if(s===It.SHADING)pe.singularValueDecompose2dScale(nt(e),a);else if(this.matrix){pe.singularValueDecompose2dScale(this.matrix,a);const[u,d]=a;pe.singularValueDecompose2dScale(t.baseTransform,a),a[0]*=u,a[1]*=d}else pe.singularValueDecompose2dScale(t.baseTransform,a);const o=this._createMeshCanvas(a,s===It.SHADING?null:this._background,t.cachedCanvases);return s!==It.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class P2 extends tp{getPattern(){return"hotpink"}}function j2(l){switch(l[0]){case"RadialAxial":return new M2(l);case"Mesh":return new L2(l);case"Dummy":return new P2}throw new Error(`Unknown IR type: ${l[0]}`)}const Vb={COLORED:1,UNCOLORED:2};class ip{static MAX_PATTERN_SIZE=3e3;constructor(e,t,i,s){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(e,t){const{bbox:i,operatorList:s,paintType:a,tilingType:o,color:u,canvasGraphicsFactory:d}=this;let{xstep:f,ystep:p}=this;f=Math.abs(f),p=Math.abs(p),Bc("TilingType: "+o);const m=i[0],b=i[1],v=i[2],S=i[3],w=v-m,E=S-b,x=new Float32Array(2);pe.singularValueDecompose2dScale(this.matrix,x);const[C,T]=x;pe.singularValueDecompose2dScale(this.baseTransform,x);const D=C*x[0],M=T*x[1];let N=w,k=E,z=!1,H=!1;const ne=Math.ceil(f*D),ie=Math.ceil(p*M),ce=Math.ceil(w*D),ge=Math.ceil(E*M);ne>=ce?N=f:z=!0,ie>=ge?k=p:H=!0;const le=this.getSizeAndScale(N,this.ctx.canvas.width,D),ue=this.getSizeAndScale(k,this.ctx.canvas.height,M),j=e.cachedCanvases.getCanvas("pattern",le.size,ue.size),J=j.context,oe=d.createCanvasGraphics(J,t);if(oe.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(oe,a,u),J.translate(-le.scale*m,-ue.scale*b),oe.transform(0,le.scale,0,0,ue.scale,0,0),J.save(),oe.dependencyTracker?.save(),this.clipBbox(oe,m,b,v,S),oe.baseTransform=nt(oe.ctx),oe.executeOperatorList(s),oe.endDrawing(),oe.dependencyTracker?.restore(),J.restore(),z||H){const K=j.canvas;z&&(N=f),H&&(k=p);const X=this.getSizeAndScale(N,this.ctx.canvas.width,D),O=this.getSizeAndScale(k,this.ctx.canvas.height,M),U=X.size,q=O.size,se=e.cachedCanvases.getCanvas("pattern-workaround",U,q),V=se.context,I=z?Math.floor(w/f):0,W=H?Math.floor(E/p):0;for(let ae=0;ae<=I;ae++)for(let re=0;re<=W;re++)V.drawImage(K,U*ae,q*re,U,q,0,0,U,q);return{canvas:se.canvas,scaleX:X.scale,scaleY:O.scale,offsetX:m,offsetY:b}}return{canvas:j.canvas,scaleX:le.scale,scaleY:ue.scale,offsetX:m,offsetY:b}}getSizeAndScale(e,t,i){const s=Math.max(ip.MAX_PATTERN_SIZE,t);let a=Math.ceil(e*i);return a>=s?a=s:i=a/e,{scale:i,size:a}}clipBbox(e,t,i,s,a){const o=s-t,u=a-i;e.ctx.rect(t,i,o,u),pe.axialAlignedBoundingBox([t,i,s,a],nt(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const s=e.ctx,a=e.current;switch(t){case Vb.COLORED:const{fillStyle:o,strokeStyle:u}=this.ctx;s.fillStyle=a.fillColor=o,s.strokeStyle=a.strokeColor=u;break;case Vb.UNCOLORED:s.fillStyle=s.strokeStyle=i,a.fillColor=a.strokeColor=i;break;default:throw new XC(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,i,s,a){let o=i;s!==It.SHADING&&(o=pe.transform(o,t.baseTransform),this.matrix&&(o=pe.transform(o,this.matrix)));const u=this.createPatternCanvas(t,a);let d=new DOMMatrix(o);d=d.translate(u.offsetX,u.offsetY),d=d.scale(1/u.scaleX,1/u.scaleY);const f=e.createPattern(u.canvas,"repeat");return f.setTransform(d),f}}function I2({src:l,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:a=4294967295,inverseDecode:o=!1}){const u=Bt.isLittleEndian?4278190080:255,[d,f]=o?[a,u]:[u,a],p=i>>3,m=i&7,b=l.length;t=new Uint32Array(t.buffer);let v=0;for(let S=0;S<s;S++){for(const E=e+p;e<E;e++){const x=e<b?l[e]:255;t[v++]=x&128?f:d,t[v++]=x&64?f:d,t[v++]=x&32?f:d,t[v++]=x&16?f:d,t[v++]=x&8?f:d,t[v++]=x&4?f:d,t[v++]=x&2?f:d,t[v++]=x&1?f:d}if(m===0)continue;const w=e<b?l[e++]:255;for(let E=0;E<m;E++)t[v++]=w&1<<7-E?f:d}return{srcPos:e,destPos:v}}const Yb=16,Wb=100,B2=15,Xb=10,ii=16,Xd=new DOMMatrix,pi=new Float32Array(2),Br=new Float32Array([1/0,1/0,-1/0,-1/0]);function U2(l,e){if(l._removeMirroring)throw new Error("Context is already forwarding operations.");l.__originalSave=l.save,l.__originalRestore=l.restore,l.__originalRotate=l.rotate,l.__originalScale=l.scale,l.__originalTranslate=l.translate,l.__originalTransform=l.transform,l.__originalSetTransform=l.setTransform,l.__originalResetTransform=l.resetTransform,l.__originalClip=l.clip,l.__originalMoveTo=l.moveTo,l.__originalLineTo=l.lineTo,l.__originalBezierCurveTo=l.bezierCurveTo,l.__originalRect=l.rect,l.__originalClosePath=l.closePath,l.__originalBeginPath=l.beginPath,l._removeMirroring=()=>{l.save=l.__originalSave,l.restore=l.__originalRestore,l.rotate=l.__originalRotate,l.scale=l.__originalScale,l.translate=l.__originalTranslate,l.transform=l.__originalTransform,l.setTransform=l.__originalSetTransform,l.resetTransform=l.__originalResetTransform,l.clip=l.__originalClip,l.moveTo=l.__originalMoveTo,l.lineTo=l.__originalLineTo,l.bezierCurveTo=l.__originalBezierCurveTo,l.rect=l.__originalRect,l.closePath=l.__originalClosePath,l.beginPath=l.__originalBeginPath,delete l._removeMirroring},l.save=function(){e.save(),this.__originalSave()},l.restore=function(){e.restore(),this.__originalRestore()},l.translate=function(t,i){e.translate(t,i),this.__originalTranslate(t,i)},l.scale=function(t,i){e.scale(t,i),this.__originalScale(t,i)},l.transform=function(t,i,s,a,o,u){e.transform(t,i,s,a,o,u),this.__originalTransform(t,i,s,a,o,u)},l.setTransform=function(t,i,s,a,o,u){e.setTransform(t,i,s,a,o,u),this.__originalSetTransform(t,i,s,a,o,u)},l.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},l.rotate=function(t){e.rotate(t),this.__originalRotate(t)},l.clip=function(t){e.clip(t),this.__originalClip(t)},l.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},l.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},l.bezierCurveTo=function(t,i,s,a,o,u){e.bezierCurveTo(t,i,s,a,o,u),this.__originalBezierCurveTo(t,i,s,a,o,u)},l.rect=function(t,i,s,a){e.rect(t,i,s,a),this.__originalRect(t,i,s,a)},l.closePath=function(){e.closePath(),this.__originalClosePath()},l.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class F2{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function lc(l,e,t,i,s,a,o,u,d,f){const[p,m,b,v,S,w]=nt(l);if(m===0&&b===0){const C=o*p+S,T=Math.round(C),D=u*v+w,M=Math.round(D),N=(o+d)*p+S,k=Math.abs(Math.round(N)-T)||1,z=(u+f)*v+w,H=Math.abs(Math.round(z)-M)||1;return l.setTransform(Math.sign(p),0,0,Math.sign(v),T,M),l.drawImage(e,t,i,s,a,0,0,k,H),l.setTransform(p,m,b,v,S,w),[k,H]}if(p===0&&v===0){const C=u*b+S,T=Math.round(C),D=o*m+w,M=Math.round(D),N=(u+f)*b+S,k=Math.abs(Math.round(N)-T)||1,z=(o+d)*m+w,H=Math.abs(Math.round(z)-M)||1;return l.setTransform(0,Math.sign(m),Math.sign(b),0,T,M),l.drawImage(e,t,i,s,a,0,0,H,k),l.setTransform(p,m,b,v,S,w),[H,k]}l.drawImage(e,t,i,s,a,o,u,d,f);const E=Math.hypot(p,m),x=Math.hypot(b,v);return[E*d,x*f]}class Kb{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=mf;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Lt.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,i){i?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Br.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=It.FILL,t=null){const i=this.minMax.slice();if(e===It.STROKE){t||Ke("Stroke bounding box must include transform."),pe.singularValueDecompose2dScale(t,pi);const s=pi[0]*this.lineWidth/2,a=pi[1]*this.lineWidth/2;i[0]-=s,i[1]-=a,i[2]+=s,i[3]+=a}return i}updateClipFromPath(){const e=pe.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Br,0)}getClippedPathBoundingBox(e=It.FILL,t=null){return pe.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Qb(l,e){if(e instanceof ImageData){l.putImageData(e,0,0);return}const t=e.height,i=e.width,s=t%ii,a=(t-s)/ii,o=s===0?a:a+1,u=l.createImageData(i,ii);let d=0,f;const p=e.data,m=u.data;let b,v,S,w;if(e.kind===gc.GRAYSCALE_1BPP){const E=p.byteLength,x=new Uint32Array(m.buffer,0,m.byteLength>>2),C=x.length,T=i+7>>3,D=4294967295,M=Bt.isLittleEndian?4278190080:255;for(b=0;b<o;b++){for(S=b<a?ii:s,f=0,v=0;v<S;v++){const N=E-d;let k=0;const z=N>T?i:N*8-7,H=z&-8;let ne=0,ie=0;for(;k<H;k+=8)ie=p[d++],x[f++]=ie&128?D:M,x[f++]=ie&64?D:M,x[f++]=ie&32?D:M,x[f++]=ie&16?D:M,x[f++]=ie&8?D:M,x[f++]=ie&4?D:M,x[f++]=ie&2?D:M,x[f++]=ie&1?D:M;for(;k<z;k++)ne===0&&(ie=p[d++],ne=128),x[f++]=ie&ne?D:M,ne>>=1}for(;f<C;)x[f++]=0;l.putImageData(u,0,b*ii)}}else if(e.kind===gc.RGBA_32BPP){for(v=0,w=i*ii*4,b=0;b<a;b++)m.set(p.subarray(d,d+w)),d+=w,l.putImageData(u,0,v),v+=ii;b<o&&(w=i*s*4,m.set(p.subarray(d,d+w)),l.putImageData(u,0,v))}else if(e.kind===gc.RGB_24BPP)for(S=ii,w=i*S,b=0;b<o;b++){for(b>=a&&(S=s,w=i*S),f=0,v=w;v--;)m[f++]=p[d++],m[f++]=p[d++],m[f++]=p[d++],m[f++]=255;l.putImageData(u,0,b*ii)}else throw new Error(`bad image kind: ${e.kind}`)}function Jb(l,e){if(e.bitmap){l.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,s=t%ii,a=(t-s)/ii,o=s===0?a:a+1,u=l.createImageData(i,ii);let d=0;const f=e.data,p=u.data;for(let m=0;m<o;m++){const b=m<a?ii:s;({srcPos:d}=I2({src:f,srcPos:d,dest:p,width:i,height:b,nonBlackColor:0})),l.putImageData(u,0,m*ii)}}function Xa(l,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)l[i]!==void 0&&(e[i]=l[i]);l.setLineDash!==void 0&&(e.setLineDash(l.getLineDash()),e.lineDashOffset=l.lineDashOffset)}function cc(l){l.strokeStyle=l.fillStyle="#000000",l.fillRule="nonzero",l.globalAlpha=1,l.lineWidth=1,l.lineCap="butt",l.lineJoin="miter",l.miterLimit=10,l.globalCompositeOperation="source-over",l.font="10px sans-serif",l.setLineDash!==void 0&&(l.setLineDash([]),l.lineDashOffset=0);const{filter:e}=l;e!=="none"&&e!==""&&(l.filter="none")}function Zb(l,e){if(e)return!0;pe.singularValueDecompose2dScale(l,pi);const t=Math.fround(Ki.pixelRatio*Yr.PDF_TO_CSS_UNITS);return pi[0]<=t&&pi[1]<=t}const z2=["butt","round","square"],H2=["miter","round","bevel"],q2={},ev={};class qr{constructor(e,t,i,s,a,{optionalContentConfig:o,markedContentStack:u=null},d,f,p){this.ctx=e,this.current=new Kb(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=a,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=u||[],this.optionalContentConfig=o,this.cachedCanvases=new F2(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=p??null}getObject(e,t,i=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):i}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){const a=this.ctx.canvas.width,o=this.ctx.canvas.height,u=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,a,o),this.ctx.fillStyle=u,i){const d=this.cachedCanvases.getCanvas("transparent",a,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...nt(this.compositeCtx))}this.ctx.save(),cc(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=nt(this.ctx)}executeOperatorList(e,t,i,s,a){const o=e.argsArray,u=e.fnArray;let d=t||0;const f=o.length;if(f===d)return d;const p=f-d>Xb&&typeof i=="function",m=p?Date.now()+B2:0;let b=0;const v=this.commonObjs,S=this.objs;let w,E;for(;;){if(s!==void 0&&d===s.nextBreakPoint)return s.breakIt(d,i),d;if(!a||a(d))if(w=u[d],E=o[d]??null,w!==fo.dependency)E===null?this[w](d):this[w](d,...E);else for(const x of E){this.dependencyTracker?.recordNamedData(x,d);const C=x.startsWith("g_")?v:S;if(!C.has(x))return C.get(x,i),d}if(d++,d===f)return d;if(p&&++b>Xb){if(Date.now()>m)return i(),d;b=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const i=e.width??e.displayWidth,s=e.height??e.displayHeight;let a=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),u=i,d=s,f="prescale1",p,m;for(;a>2&&u>1||o>2&&d>1;){let b=u,v=d;a>2&&u>1&&(b=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u/2),a/=u/b),o>2&&d>1&&(v=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/v),p=this.cachedCanvases.getCanvas(f,b,v),m=p.context,m.clearRect(0,0,b,v),m.drawImage(e,0,0,u,d,0,0,b,v),e=p.canvas,u=b,d=v,f=f==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:u,paintHeight:d}}_createMaskCanvas(e,t){const i=this.ctx,{width:s,height:a}=t,o=this.current.fillColor,u=this.current.patternFill,d=nt(i);let f,p,m,b;if((t.bitmap||t.data)&&t.count>1){const ne=t.bitmap||t.data.buffer;p=JSON.stringify(u?d:[d.slice(0,4),o]),f=this._cachedBitmapsMap.get(ne),f||(f=new Map,this._cachedBitmapsMap.set(ne,f));const ie=f.get(p);if(ie&&!u){const ce=Math.round(Math.min(d[0],d[2])+d[4]),ge=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(e,Ri.transformAndFill),{canvas:ie,offsetX:ce,offsetY:ge}}m=ie}m||(b=this.cachedCanvases.getCanvas("maskCanvas",s,a),Jb(b.context,t));let v=pe.transform(d,[1/s,0,0,-1/a,0,0]);v=pe.transform(v,[1,0,0,1,0,-a]);const S=Br.slice();pe.axialAlignedBoundingBox([0,0,s,a],v,S);const[w,E,x,C]=S,T=Math.round(x-w)||1,D=Math.round(C-E)||1,M=this.cachedCanvases.getCanvas("fillCanvas",T,D),N=M.context,k=w,z=E;N.translate(-k,-z),N.transform(...v),m||(m=this._scaleImage(b.canvas,Vi(N)),m=m.img,f&&u&&f.set(p,m)),N.imageSmoothingEnabled=Zb(nt(N),t.interpolate),lc(N,m,0,0,m.width,m.height,0,0,s,a),N.globalCompositeOperation="source-in";const H=pe.transform(Vi(N),[1,0,0,1,-k,-z]);return N.fillStyle=u?o.getPattern(i,this,H,It.FILL,e):o,N.fillRect(0,0,s,a),f&&!u&&(this.cachedCanvases.delete("fillCanvas"),f.set(p,M.canvas)),this.dependencyTracker?.recordDependencies(e,Ri.transformAndFill),{canvas:M.canvas,offsetX:Math.round(k),offsetY:Math.round(z)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=z2[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=H2[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,i){this.dependencyTracker?.recordSimpleData("dash",e);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=i)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[i,s]of t)switch(i){case"LW":this.setLineWidth(e,s);break;case"LC":this.setLineCap(e,s);break;case"LJ":this.setLineJoin(e,s);break;case"ML":this.setMiterLimit(e,s);break;case"D":this.setDash(e,s[0],s[1]);break;case"RI":this.setRenderingIntent(e,s);break;case"FL":this.setFlatness(e,s);break;case"Font":this.setFont(e,s[0],s[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=s;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=s;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,i=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,a=this.cachedCanvases.getCanvas(s,t,i);this.suspendedCtx=this.ctx;const o=this.ctx=a.context;o.setTransform(this.suspendedCtx.getTransform()),Xa(this.suspendedCtx,o),U2(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Xa(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){const a=s[0],o=s[1],u=s[2]-a,d=s[3]-o;u===0||d===0||(this.genericComposeSMask(t.context,i,u,d,t.subtype,t.backdrop,t.transferMap,a,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,a,o,u,d,f,p,m){let b=e.canvas,v=d-p,S=f-m;if(o)if(v<0||S<0||v+i>b.width||S+s>b.height){const E=this.cachedCanvases.getCanvas("maskExtension",i,s),x=E.context;x.drawImage(b,-v,-S),x.globalCompositeOperation="destination-atop",x.fillStyle=o,x.fillRect(0,0,i,s),x.globalCompositeOperation="source-over",b=E.canvas,v=S=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const E=new Path2D;E.rect(v,S,i,s),e.clip(E),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(v,S,i,s),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),a==="Alpha"&&u?t.filter=this.filterFactory.addAlphaFilter(u):a==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(u));const w=new Path2D;w.rect(d,f,i,s),t.clip(w),t.globalCompositeOperation="destination-in",t.drawImage(b,v,S,i,s,d,f,i,s),t.restore()}save(e){this.inSMaskMode&&Xa(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Xa(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,i,s,a,o,u){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,i,s,a,o,u),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i,s){let[a]=i;if(!s){a||=i[0]=new Path2D,this[t](e,a);return}if(this.dependencyTracker!==null){const o=t===fo.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,s[0]-o,s[2]+o,s[1]-o,s[3]+o).recordDependencies(e,["transform"])}a instanceof Path2D||(a=i[0]=Mw(a)),pe.axialAlignedBoundingBox(s,nt(this.ctx),this.current.minMax),this[t](e,a),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,i=!0){const s=this.ctx,a=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof a=="object"&&a?.getPattern){const o=a.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=a.getPattern(s,this,Vi(s),It.STROKE,e),o){const u=new Path2D;u.addPath(t,s.getTransform().invertSelf().multiplySelf(o)),t=u}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,Ri.stroke),i&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(It.STROKE,nt(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,i=!0){const s=this.ctx,a=this.current.fillColor,o=this.current.patternFill;let u=!1;if(o){const f=a.isModifyingCurrentTransform()?s.getTransform():null;if(this.dependencyTracker?.save(e),s.save(),s.fillStyle=a.getPattern(s,this,Vi(s),It.FILL,e),f){const p=new Path2D;p.addPath(t,s.getTransform().invertSelf().multiplySelf(f)),t=p}u=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),this.dependencyTracker?.recordDependencies(e,Ri.fill),u&&(s.restore(),this.dependencyTracker?.restore(e)),i&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,Ri.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=q2}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=ev}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,i=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;t!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",e),s.recordCloseMarker(e)}if(t!==void 0){const s=new Path2D,a=i.getTransform().invertSelf();for(const{transform:o,x:u,y:d,fontSize:f,path:p}of t)p&&s.addPath(p,new DOMMatrix(o).preMultiplySelf(a).translate(u,d).scale(f,-f));i.clip(s)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,i){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const s=this.commonObjs.get(t),a=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(a.fontMatrix=s.fontMatrix||mf,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&xe("Invalid font matrix for font "+t),i<0?(i=-i,a.fontDirection=-1):a.fontDirection=1,this.current.font=s,this.current.fontSize=i,s.isType3Font)return;const o=s.loadedName||"sans-serif",u=s.systemFontInfo?.css||`"${o}", ${s.fallbackName}`;let d="normal";s.black?d="900":s.bold&&(d="bold");const f=s.italic?"italic":"normal";let p=i;i<Yb?p=Yb:i>Wb&&(p=Wb),this.current.fontSizeScale=i/p,this.ctx.font=`${f} ${d} ${p}px ${u}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,i){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=i}setLeadingMoveText(e,t,i){this.setLeading(e,-i),this.moveText(e,t,i)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:i}=this;i.textMatrix=t,i.textMatrixScale=Math.hypot(t[0],t[1]),i.x=i.lineX=0,i.y=i.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#n(e,t,i){const s=new Path2D;return s.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),s}paintChar(e,t,i,s,a,o){const u=this.ctx,d=this.current,f=d.font,p=d.textRenderingMode,m=d.fontSize/d.fontSizeScale,b=p&Lt.FILL_STROKE_MASK,v=!!(p&Lt.ADD_TO_PATH_FLAG),S=d.patternFill&&!f.missingFile,w=d.patternStroke&&!f.missingFile;let E;if((f.disableFontFace||v||S||w)&&!f.missingFile&&(E=f.getPathGenerator(this.commonObjs,t)),E&&(f.disableFontFace||S||w)){u.save(),u.translate(i,s),u.scale(m,-m),this.dependencyTracker?.recordCharacterBBox(e,u,f);let x;if(b===Lt.FILL||b===Lt.FILL_STROKE)if(a){x=u.getTransform(),u.setTransform(...a);const C=this.#n(E,x,a);u.fill(C)}else u.fill(E);if(b===Lt.STROKE||b===Lt.FILL_STROKE)if(o){x||=u.getTransform(),u.setTransform(...o);const{a:C,b:T,c:D,d:M}=x,N=pe.inverseTransform(o),k=pe.transform([C,T,D,M,0,0],N);pe.singularValueDecompose2dScale(k,pi),u.lineWidth*=Math.max(pi[0],pi[1])/m,u.stroke(this.#n(E,x,o))}else u.lineWidth/=m,u.stroke(E);u.restore()}else(b===Lt.FILL||b===Lt.FILL_STROKE)&&(u.fillText(t,i,s),this.dependencyTracker?.recordCharacterBBox(e,u,f,m,i,s,()=>u.measureText(t))),(b===Lt.STROKE||b===Lt.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,u,f,m,i,s,()=>u.measureText(t)).recordDependencies(e,Ri.stroke),u.strokeText(t,i,s));v&&((this.pendingTextPaths||=[]).push({transform:nt(u),x:i,y:s,fontSize:m,path:E}),this.dependencyTracker?.recordCharacterBBox(e,u,f,m,i,s))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return Re(this,"isFontSubpixelAAEnabled",i)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Ri.showText).resetBBox(e),this.current.textRenderingMode&Lt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const i=this.current,s=i.font;if(s.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const a=i.fontSize;if(a===0){this.dependencyTracker?.recordOperation(e);return}const o=this.ctx,u=i.fontSizeScale,d=i.charSpacing,f=i.wordSpacing,p=i.fontDirection,m=i.textHScale*p,b=t.length,v=s.vertical,S=v?1:-1,w=s.defaultVMetrics,E=a*i.fontMatrix[0],x=i.textRenderingMode===Lt.FILL&&!s.disableFontFace&&!i.patternFill;o.save(),i.textMatrix&&o.transform(...i.textMatrix),o.translate(i.x,i.y+i.textRise),p>0?o.scale(m,-1):o.scale(m,1);let C,T;if(i.patternFill){o.save();const z=i.fillColor.getPattern(o,this,Vi(o),It.FILL,e);C=nt(o),o.restore(),o.fillStyle=z}if(i.patternStroke){o.save();const z=i.strokeColor.getPattern(o,this,Vi(o),It.STROKE,e);T=nt(o),o.restore(),o.strokeStyle=z}let D=i.lineWidth;const M=i.textMatrixScale;if(M===0||D===0){const z=i.textRenderingMode&Lt.FILL_STROKE_MASK;(z===Lt.STROKE||z===Lt.FILL_STROKE)&&(D=this.getSinglePixelWidth())}else D/=M;if(u!==1&&(o.scale(u,u),D/=u),o.lineWidth=D,s.isInvalidPDFjsFont){const z=[];let H=0;for(const ie of t)z.push(ie.unicode),H+=ie.width;const ne=z.join("");if(o.fillText(ne,0,0),this.dependencyTracker!==null){const ie=o.measureText(ne);this.dependencyTracker.recordBBox(e,this.ctx,-ie.actualBoundingBoxLeft,ie.actualBoundingBoxRight,-ie.actualBoundingBoxAscent,ie.actualBoundingBoxDescent).recordShowTextOperation(e)}i.x+=H*E*m,o.restore(),this.compose();return}let N=0,k;for(k=0;k<b;++k){const z=t[k];if(typeof z=="number"){N+=S*z*a/1e3;continue}let H=!1;const ne=(z.isSpace?f:0)+d,ie=z.fontChar,ce=z.accent;let ge,le,ue=z.width;if(v){const oe=z.vmetric||w,K=-(z.vmetric?oe[1]:ue*.5)*E,X=oe[2]*E;ue=oe?-oe[0]:ue,ge=K/u,le=(N+X)/u}else ge=N/u,le=0;let j;if(s.remeasure&&ue>0){j=o.measureText(ie);const oe=j.width*1e3/a*u;if(ue<oe&&this.isFontSubpixelAAEnabled){const K=ue/oe;H=!0,o.save(),o.scale(K,1),ge/=K}else ue!==oe&&(ge+=(ue-oe)/2e3*a/u)}if(this.contentVisible&&(z.isInFont||s.missingFile)){if(x&&!ce)o.fillText(ie,ge,le),this.dependencyTracker?.recordCharacterBBox(e,o,j?{bbox:null}:s,a/u,ge,le,()=>j??o.measureText(ie));else if(this.paintChar(e,ie,ge,le,C,T),ce){const oe=ge+a*ce.offset.x/u,K=le-a*ce.offset.y/u;this.paintChar(e,ce.fontChar,oe,K,C,T)}}const J=v?ue*E-ne*p:ue*E+ne*p;N+=J,H&&o.restore()}v?i.y-=N:i.x+=N*m,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const i=this.ctx,s=this.current,a=s.font,o=s.fontSize,u=s.fontDirection,d=a.vertical?1:-1,f=s.charSpacing,p=s.wordSpacing,m=s.textHScale*u,b=s.fontMatrix||mf,v=t.length,S=s.textRenderingMode===Lt.INVISIBLE;let w,E,x,C;if(S||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),s.textMatrix&&i.transform(...s.textMatrix),i.translate(s.x,s.y+s.textRise),i.scale(m,u);const T=this.dependencyTracker;for(this.dependencyTracker=T?new Cc(T,e):null,w=0;w<v;++w){if(E=t[w],typeof E=="number"){C=d*E*o/1e3,this.ctx.translate(C,0),s.x+=C*m;continue}const D=(E.isSpace?p:0)+f,M=a.charProcOperatorList[E.operatorListId];M?this.contentVisible&&(this.save(),i.scale(o,o),i.transform(...b),this.executeOperatorList(M),this.restore()):xe(`Type3 character "${E.operatorListId}" is not available.`);const N=[E.width,0];pe.applyTransform(N,b),x=N[0]*o+D,i.translate(x,0),s.x+=x*m}i.restore(),T&&(this.dependencyTracker=T)}setCharWidth(e,t,i){}setCharWidthAndBounds(e,t,i,s,a,o,u){const d=new Path2D;d.rect(s,a,o-s,u-a),this.ctx.clip(d),this.dependencyTracker?.recordBBox(e,this.ctx,s,o,a,u).recordClipBox(e,this.ctx,s,o,a,u),this.endPath(e)}getColorN_Pattern(e,t){let i;if(t[0]==="TilingPattern"){const s=this.baseTransform||nt(this.ctx),a={createCanvasGraphics:(o,u)=>new qr(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Cc(this.dependencyTracker,u,!0):null)};i=new ip(t,this.ctx,a,s)}else i=this._getPattern(e,t[1],t[2]);return i}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,i=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=j2(this.getObject(e,t)),this.cachedPatterns.set(t,s)),i&&(s.matrix=i),s}shadingFill(e,t){if(!this.contentVisible)return;const i=this.ctx;this.save(e);const s=this._getPattern(e,t);i.fillStyle=s.getPattern(i,this,Vi(i),It.SHADING,e);const a=Vi(i);if(a){const{width:o,height:u}=i.canvas,d=Br.slice();pe.axialAlignedBoundingBox([0,0,o,u],a,d);const[f,p,m,b]=d;this.ctx.fillRect(f,p,m-f,b-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Ri.transform).recordDependencies(e,Ri.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Ke("Should not call beginInlineImage")}beginImageData(){Ke("Should not call beginImageData")}paintFormXObjectBegin(e,t,i){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=nt(this.ctx),i)){pe.axialAlignedBoundingBox(i,this.baseTransform,this.current.minMax);const[s,a,o,u]=i,d=new Path2D;d.rect(s,a,o-s,u-a),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(e,this.ctx,s,o,a,u),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const i=this.ctx;t.isolated||Bc("TODO: Support non-isolated groups."),t.knockout&&xe("Knockout groups not supported.");const s=nt(i);if(t.matrix&&i.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let a=Br.slice();pe.axialAlignedBoundingBox(t.bbox,nt(i),a);const o=[0,0,i.canvas.width,i.canvas.height];a=pe.intersect(a,o)||[0,0,0,0];const u=Math.floor(a[0]),d=Math.floor(a[1]),f=Math.max(Math.ceil(a[2])-u,1),p=Math.max(Math.ceil(a[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,p]);let m="groupAt"+this.groupLevel;t.smask&&(m+="_smask_"+this.smaskCounter++%2);const b=this.cachedCanvases.getCanvas(m,f,p),v=b.context;v.translate(-u,-d),v.transform(...s);let S=new Path2D;const[w,E,x,C]=t.bbox;if(S.rect(w,E,x-w,C-E),t.matrix){const T=new Path2D;T.addPath(S,new DOMMatrix(t.matrix)),S=T}v.clip(S),t.smask&&this.smaskStack.push({canvas:b.canvas,context:v,offsetX:u,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(i.setTransform(1,0,0,1,0,0),i.translate(u,d),i.save()),Xa(i,v),this.ctx=v,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(i),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(i),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const i=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=nt(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...a);const o=Br.slice();pe.axialAlignedBoundingBox([0,0,i.canvas.width,i.canvas.height],a,o),this.ctx.drawImage(i.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,i,s,a,o){if(this.#e(),cc(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),i){const u=i[2]-i[0],d=i[3]-i[1];if(o&&this.annotationCanvasMap){s=s.slice(),s[4]-=i[0],s[5]-=i[1],i=i.slice(),i[0]=i[1]=0,i[2]=u,i[3]=d,pe.singularValueDecompose2dScale(nt(this.ctx),pi);const{viewportScale:f}=this,p=Math.ceil(u*this.outputScaleX*f),m=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(p,m);const{canvas:b,context:v}=this.annotationCanvas;this.annotationCanvasMap.set(t,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=v,this.ctx.save(),this.ctx.setTransform(pi[0],0,0,-pi[1],0,d*pi[1]),cc(this.ctx)}else{cc(this.ctx),this.endPath(e);const f=new Path2D;f.rect(i[0],i[1],u,d),this.ctx.clip(f)}}this.current=new Kb(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...s),this.transform(e,...a)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const i=t.count;t=this.getObject(e,t.data,t),t.count=i;const s=this.ctx,a=this._createMaskCanvas(e,t),o=a.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,a.offsetX,a.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,a.offsetX,a.offsetX+o.width,a.offsetY,a.offsetY+o.height).recordOperation(e),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i,s=0,a=0,o,u){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const f=nt(d);d.transform(i,s,a,o,0,0);const p=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,p.offsetX-f[4],p.offsetY-f[5]),this.dependencyTracker?.resetBBox(e);for(let m=0,b=u.length;m<b;m+=2){const v=pe.transform(f,[i,s,a,o,u[m],u[m+1]]);d.drawImage(p.canvas,v[4],v[5]),this.dependencyTracker?.recordBBox(e,this.ctx,v[4],v[4]+p.canvas.width,v[5],v[5]+p.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx,s=this.current.fillColor,a=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,Ri.transformAndFill);for(const o of t){const{data:u,width:d,height:f,transform:p}=o,m=this.cachedCanvases.getCanvas("maskCanvas",d,f),b=m.context;b.save();const v=this.getObject(e,u,o);Jb(b,v),b.globalCompositeOperation="source-in",b.fillStyle=a?s.getPattern(b,this,Vi(i),It.FILL,e):s,b.fillRect(0,0,d,f),b.restore(),i.save(),i.transform(...p),i.scale(1,-1),lc(i,m.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(e,i,0,d,0,f),i.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const i=this.getObject(e,t);if(!i){xe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,i)}paintImageXObjectRepeat(e,t,i,s,a){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){xe("Dependent image isn't ready yet");return}const u=o.width,d=o.height,f=[];for(let p=0,m=a.length;p<m;p+=2)f.push({transform:[i,0,0,s,a[p],a[p+1]],x:0,y:0,w:u,h:d});this.paintInlineImageXObjectGroup(e,o,f)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:s}=e,a=this.cachedCanvases.getCanvas("inlineImage",i,s),o=a.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",a.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const i=t.width,s=t.height,a=this.ctx;this.save(e);const{filter:o}=a;o!=="none"&&o!==""&&(a.filter="none"),a.scale(1/i,-1/s);let u;if(t.bitmap)u=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)u=t;else{const p=this.cachedCanvases.getCanvas("inlineImage",i,s).context;Qb(p,t),u=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(u,Vi(a));a.imageSmoothingEnabled=Zb(nt(a),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,a,0,i,-s,0).recordDependencies(e,Ri.imageXObject).recordOperation(e),lc(a,d.img,0,0,d.paintWidth,d.paintHeight,0,-s,i,s),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,i){if(!this.contentVisible)return;const s=this.ctx;let a;if(t.bitmap)a=t.bitmap;else{const o=t.width,u=t.height,f=this.cachedCanvases.getCanvas("inlineImage",o,u).context;Qb(f,t),a=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(e);for(const o of i)s.save(),s.transform(...o.transform),s.scale(1,-1),lc(s,a,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,s,0,1,-1,0),s.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Ri.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,i){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,i){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(i)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,i){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const a=this.ctx;this.pendingClip?(s||(this.pendingClip===ev?a.clip(t,"evenodd"):a.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=nt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:s,d:a}=this.ctx.getTransform();let o,u;if(i===0&&s===0){const d=Math.abs(t),f=Math.abs(a);if(d===f)if(e===0)o=u=1/d;else{const p=d*e;o=u=p<1?1/p:1}else if(e===0)o=1/d,u=1/f;else{const p=d*e,m=f*e;o=p<1?1/p:1,u=m<1?1/m:1}}else{const d=Math.abs(t*a-i*s),f=Math.hypot(t,i),p=Math.hypot(s,a);if(e===0)o=p/d,u=f/d;else{const m=e*d;o=p>m?p/m:1,u=f>m?f/m:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=u}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:i,current:{lineWidth:s}}=this,[a,o]=this.getScaleForStroking();if(a===o){i.lineWidth=(s||1)*a,i.stroke(e);return}const u=i.getLineDash();t&&i.save(),i.scale(a,o),Xd.a=1/a,Xd.d=1/o;const d=new Path2D;if(d.addPath(e,Xd),u.length>0){const f=Math.max(a,o);i.setLineDash(u.map(p=>p/f)),i.lineDashOffset/=f}i.lineWidth=s||1,i.stroke(d),t&&i.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const l in fo)qr.prototype[l]!==void 0&&(qr.prototype[fo[l]]=qr.prototype[l]);class $r{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class $2{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Pr=Symbol("INTERNAL");class G2{#e=!1;#t=!1;#n=!1;#i=!0;constructor(e,{name:t,intent:i,usage:s,rbGroups:a}){this.#e=!!(e&fi.DISPLAY),this.#t=!!(e&fi.PRINT),this.name=t,this.intent=i,this.usage=s,this.rbGroups=a}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Pr&&Ke("Internal method `_setVisible` called."),this.#n=i,this.#i=t}}class V2{#e=null;#t=new Map;#n=null;#i=null;constructor(e,t=fi.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#i=e.order;for(const i of e.groups)this.#t.set(i.id,new G2(t,i));if(e.baseState==="OFF")for(const i of this.#t.values())i._setVisible(Pr,!1);for(const i of e.on)this.#t.get(i)._setVisible(Pr,!0);for(const i of e.off)this.#t.get(i)._setVisible(Pr,!1);this.#n=this.getHash()}}#a(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let s=1;s<t;s++){const a=e[s];let o;if(Array.isArray(a))o=this.#a(a);else if(this.#t.has(a))o=this.#t.get(a).visible;else return xe(`Optional content group not found: ${a}`),!0;switch(i){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return i==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return Bc("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(xe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#a(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return xe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return xe(`Unknown optional content policy ${e.policy}.`),!0}return xe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){const s=this.#t.get(e);if(!s){xe(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(const a of s.rbGroups)for(const o of a)o!==e&&this.#t.get(o)?._setVisible(Pr,!1,!0);s._setVisible(Pr,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let i;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const a=this.#t.get(s);if(a)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!a.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#i?this.#i.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new Lw;for(const[t,i]of this.#t)e.update(`${t}:${i.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class Y2{constructor(e,{disableRange:t=!1,disableStream:i=!1}){Ie(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:a,progressiveDone:o,contentDispositionFilename:u}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=u,a?.length>0){const d=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),e.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(a){return a._begin!==e?!1:(a._enqueue(i),!0)});Ie(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Ie(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new W2(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new X2(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class W2{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=Kf(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class X2{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function K2(l){let e=!0,t=i("filename\\*","i").exec(l);if(t){t=t[1];let p=u(t);return p=unescape(p),p=d(p),p=f(p),a(p)}if(t=o(l),t){const p=f(t);return a(p)}if(t=i("filename","i").exec(l),t){t=t[1];let p=u(t);return p=f(p),a(p)}function i(p,m){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function s(p,m){if(p){if(!/^[\x00-\xFF]+$/.test(m))return m;try{const b=new TextDecoder(p,{fatal:!0}),v=_o(m);m=b.decode(v),e=!1}catch{}}return m}function a(p){return e&&/[\x80-\xff]/.test(p)&&(p=s("utf-8",p),e&&(p=s("iso-8859-1",p))),p}function o(p){const m=[];let b;const v=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=v.exec(p))!==null;){let[,w,E,x]=b;if(w=parseInt(w,10),w in m){if(w===0)break;continue}m[w]=[E,x]}const S=[];for(let w=0;w<m.length&&w in m;++w){let[E,x]=m[w];x=u(x),E&&(x=unescape(x),w===0&&(x=d(x))),S.push(x)}return S.join("")}function u(p){if(p.startsWith('"')){const m=p.slice(1).split('\\"');for(let b=0;b<m.length;++b){const v=m[b].indexOf('"');v!==-1&&(m[b]=m[b].slice(0,v),m.length=b+1),m[b]=m[b].replaceAll(/\\(.)/g,"$1")}p=m.join('"')}return p}function d(p){const m=p.indexOf("'");if(m===-1)return p;const b=p.slice(0,m),S=p.slice(m+1).replace(/^[^']*'/,"");return s(b,S)}function f(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,b,v,S){if(v==="q"||v==="Q")return S=S.replaceAll("_"," "),S=S.replaceAll(/=([0-9a-fA-F]{2})/g,function(w,E){return String.fromCharCode(parseInt(E,16))}),s(b,S);try{S=atob(S)}catch{}return s(b,S)})}return""}function zw(l,e){const t=new Headers;if(!l||!e||typeof e!="object")return t;for(const i in e){const s=e[i];s!==void 0&&t.append(i,s)}return t}function zc(l){return URL.parse(l)?.origin??null}function Hw({responseHeaders:l,isHttp:e,rangeChunkSize:t,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(l.get("Content-Length"),10);return!Number.isInteger(a)||(s.suggestedLength=a,a<=2*t)||i||!e||l.get("Accept-Ranges")!=="bytes"||(l.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function qw(l){const e=l.get("Content-Disposition");if(e){let t=K2(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Kf(t))return t}return null}function To(l,e){return new Tc(`Unexpected server response (${l}) while retrieving PDF "${e}".`,l,l===404||l===0&&e.startsWith("file:"))}function $w(l){return l===200||l===206}function Gw(l,e,t){return{method:"GET",headers:l,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Vw(l){return l instanceof Uint8Array?l.buffer:l instanceof ArrayBuffer?l:(xe(`getArrayBuffer - unexpected data format: ${l}`),new Uint8Array(l).buffer)}class Q2{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=zw(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ie(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new J2(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Z2(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class J2{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),s=t.url;fetch(s,Gw(i,this._withCredentials,this._abortController)).then(a=>{if(e._responseOrigin=zc(a.url),!$w(a.status))throw To(a.status,s);this._reader=a.body.getReader(),this._headersCapability.resolve();const o=a.headers,{allowRangeRequests:u,suggestedLength:d}=Hw({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=u,this._contentLength=d||this._contentLength,this._filename=qw(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new rs("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Vw(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class Z2{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const a=new Headers(e.headers);a.append("Range",`bytes=${t}-${i-1}`);const o=s.url;fetch(o,Gw(a,this._withCredentials,this._abortController)).then(u=>{const d=zc(u.url);if(d!==e._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${e._responseOrigin}".`);if(!$w(u.status))throw To(u.status,o);this._readCapability.resolve(),this._reader=u.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Vw(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const Kd=200,Qd=206;function eR(l){const e=l.response;return typeof e!="string"?e:_o(e).buffer}class tR{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=zw(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[a,o]of this.headers)t.setRequestHeader(a,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=Qd):s.expectedStatus=Kd,t.responseType="arraybuffer",Ie(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){const i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError(s.status);return}const a=s.status||Kd;if(!(a===Kd&&i.expectedStatus===Qd)&&a!==i.expectedStatus){i.onError(s.status);return}const u=eR(s);if(a===Qd){const d=s.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?i.onDone({begin:parseInt(f[1],10),chunk:u}):(xe('Missing or invalid "Content-Range" header.'),i.onError(0))}else u?i.onDone({begin:0,chunk:u}):i.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class iR{constructor(e){this._source=e,this._manager=new tR(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Ie(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new nR(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new sR(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class nR{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=zc(t.responseURL);const i=t.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(u=>{const[d,...f]=u.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:o}=Hw({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});a&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=qw(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=To(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class sR{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=zc(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=To(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const rR=/^[a-z][a-z0-9\-+.]+:/i;function aR(l){if(rR.test(l))return new URL(l);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(l))}class oR{constructor(e){this.source=e,this.url=aR(e.url),Ie(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ie(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new lR(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new cR(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class lR{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=To(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new rs("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class cR{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Ka=Symbol("INITIAL_DATA");class Yw{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:Ka}}get(e,t=null){if(t){const s=this.#t(e);return s.promise.then(()=>t(s.data)),null}const i=this.#e[e];if(!i||i.data===Ka)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=this.#e[e];return!!t&&t.data!==Ka}delete(e){const t=this.#e[e];return!t||t.data===Ka?!1:(delete this.#e[e],!0)}resolve(e,t=null){const i=this.#t(e);i.data=t,i.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==Ka&&(yield[e,t])}}}const uR=1e5,tv=30;class qt{#e=Promise.withResolvers();#t=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#a=null;#r=null;#s=0;#o=0;#c=null;#l=null;#d=0;#h=0;#f=Object.create(null);#m=[];#g=null;#u=[];#p=new WeakMap;#y=null;static#v=new Map;static#b=new Map;static#x=new WeakMap;static#A=null;static#_=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#g=e;else if(typeof e=="object")this.#g=new ReadableStream({start(d){d.enqueue(e),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#h=i.scale*Ki.pixelRatio,this.#d=i.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:a,pageX:o,pageY:u}=i.rawDims;this.#y=[1,0,0,-1,-o,u+a],this.#o=s,this.#s=a,qt.#k(),Is(t,i),this.#e.promise.finally(()=>{qt.#_.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Bt.platform;return Re(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:i})=>{if(i){this.#e.resolve();return}this.#a??=t.lang,Object.assign(this.#f,t.styles),this.#C(t.items),e()},this.#e.reject)};return this.#c=this.#g.getReader(),qt.#_.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const i=e.scale*Ki.pixelRatio,s=e.rotation;if(s!==this.#d&&(t?.(),this.#d=s,Is(this.#l,{rotation:s})),i!==this.#h){t?.(),this.#h=i;const a={div:null,properties:null,ctx:qt.#O(this.#a)};for(const o of this.#u)a.properties=this.#p.get(o),a.div=o,this.#E(a)}}cancel(){const e=new rs("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#m}#C(e){if(this.#n)return;this.#r.ctx??=qt.#O(this.#a);const t=this.#u,i=this.#m;for(const s of e){if(t.length>uR){xe("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const a=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),s.id&&this.#t.setAttribute("id",`${s.id}`),a.append(this.#t)}else s.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}i.push(s.str),this.#w(s)}}#w(e){const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#u.push(t);const s=pe.transform(this.#y,e.transform);let a=Math.atan2(s[1],s[0]);const o=this.#f[e.fontName];o.vertical&&(a+=Math.PI/2);let u=this.#i&&o.fontSubstitution||o.fontFamily;u=qt.fontFamilyMap.get(u)||u;const d=Math.hypot(s[2],s[3]),f=d*qt.#I(u,o,this.#a);let p,m;a===0?(p=s[4],m=s[5]-f):(p=s[4]+f*Math.sin(a),m=s[5]-f*Math.cos(a));const b="calc(var(--total-scale-factor) *",v=t.style;this.#t===this.#l?(v.left=`${(100*p/this.#o).toFixed(2)}%`,v.top=`${(100*m/this.#s).toFixed(2)}%`):(v.left=`${b}${p.toFixed(2)}px)`,v.top=`${b}${m.toFixed(2)}px)`),v.fontSize=`${b}${(qt.#A*d).toFixed(2)}px)`,v.fontFamily=u,i.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#i&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),a!==0&&(i.angle=a*(180/Math.PI));let S=!1;if(e.str.length>1)S=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const w=Math.abs(e.transform[0]),E=Math.abs(e.transform[3]);w!==E&&Math.max(w,E)/Math.min(w,E)>1.5&&(S=!0)}if(S&&(i.canvasWidth=o.vertical?e.height:e.width),this.#p.set(t,i),this.#r.div=t,this.#r.properties=i,this.#E(this.#r),i.hasText&&this.#t.append(t),i.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#t.append(w)}}#E(e){const{div:t,properties:i,ctx:s}=e,{style:a}=t;let o="";if(qt.#A>1&&(o=`scale(${1/qt.#A})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:u}=a,{canvasWidth:d,fontSize:f}=i;qt.#R(s,f*this.#h,u);const{width:p}=s.measureText(t.textContent);p>0&&(o=`scaleX(${d*this.#h/p}) ${o}`)}i.angle!==0&&(o=`rotate(${i.angle}deg) ${o}`),o.length>0&&(a.transform=o)}static cleanup(){if(!(this.#_.size>0)){this.#v.clear();for(const{canvas:e}of this.#b.values())e.remove();this.#b.clear()}}static#O(e=null){let t=this.#b.get(e||="");if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(e,t),this.#x.set(t,{size:0,family:""})}return t}static#R(e,t,i){const s=this.#x.get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)}static#k(){if(this.#A!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#A=e.getBoundingClientRect().height,e.remove()}static#I(e,t,i){const s=this.#v.get(e);if(s)return s;const a=this.#O(i);a.canvas.width=a.canvas.height=tv,this.#R(a,tv,e);const o=a.measureText(""),u=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);a.canvas.width=a.canvas.height=0;let f=.8;return u?f=u/(u+d):(Bt.platform.isFirefox&&xe("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?f=t.ascent:t.descent&&(f=1+t.descent)),this.#v.set(e,f),f}}const hR=100;function Ww(l={}){typeof l=="string"||l instanceof URL?l={url:l}:(l instanceof ArrayBuffer||ArrayBuffer.isView(l))&&(l={data:l});const e=new np,{docId:t}=e,i=l.url?b2(l.url):null,s=l.data?v2(l.data):null,a=l.httpHeaders||null,o=l.withCredentials===!0,u=l.password??null,d=l.range instanceof Xw?l.range:null,f=Number.isInteger(l.rangeChunkSize)&&l.rangeChunkSize>0?l.rangeChunkSize:2**16;let p=l.worker instanceof go?l.worker:null;const m=l.verbosity,b=typeof l.docBaseUrl=="string"&&!Uc(l.docBaseUrl)?l.docBaseUrl:null,v=sc(l.cMapUrl),S=l.cMapPacked!==!1,w=l.CMapReaderFactory||($t?C2:zb),E=sc(l.iccUrl),x=sc(l.standardFontDataUrl),C=l.StandardFontDataFactory||($t?R2:Hb),T=sc(l.wasmUrl),D=l.WasmFactory||($t?k2:qb),M=l.stopAtErrors!==!0,N=Number.isInteger(l.maxImageSize)&&l.maxImageSize>-1?l.maxImageSize:-1,k=l.isEvalSupported!==!1,z=typeof l.isOffscreenCanvasSupported=="boolean"?l.isOffscreenCanvasSupported:!$t,H=typeof l.isImageDecoderSupported=="boolean"?l.isImageDecoderSupported:!$t&&(Bt.platform.isFirefox||!globalThis.chrome),ne=Number.isInteger(l.canvasMaxAreaInBytes)?l.canvasMaxAreaInBytes:-1,ie=typeof l.disableFontFace=="boolean"?l.disableFontFace:$t,ce=l.fontExtraProperties===!0,ge=l.enableXfa===!0,le=l.ownerDocument||globalThis.document,ue=l.disableRange===!0,j=l.disableStream===!0,J=l.disableAutoFetch===!0,oe=l.pdfBug===!0,K=l.CanvasFactory||($t?T2:A2),X=l.FilterFactory||($t?x2:E2),O=l.enableHWA===!0,U=l.useWasm!==!1,q=d?d.length:l.length??NaN,se=typeof l.useSystemFonts=="boolean"?l.useSystemFonts:!$t&&!ie,V=typeof l.useWorkerFetch=="boolean"?l.useWorkerFetch:!!(w===zb&&C===Hb&&D===qb&&v&&x&&T&&to(v,document.baseURI)&&to(x,document.baseURI)&&to(T,document.baseURI)),I=null;VC(m);const W={canvasFactory:new K({ownerDocument:le,enableHWA:O}),filterFactory:new X({docId:t,ownerDocument:le}),cMapReaderFactory:V?null:new w({baseUrl:v,isCompressed:S}),standardFontDataFactory:V?null:new C({baseUrl:x}),wasmFactory:V?null:new D({baseUrl:T})};p||(p=go.create({verbosity:m,port:$r.workerPort}),e._worker=p);const ae={docId:t,apiVersion:"5.4.394",data:s,password:u,disableAutoFetch:J,rangeChunkSize:f,length:q,docBaseUrl:b,enableXfa:ge,evaluatorOptions:{maxImageSize:N,disableFontFace:ie,ignoreErrors:M,isEvalSupported:k,isOffscreenCanvasSupported:z,isImageDecoderSupported:H,canvasMaxAreaInBytes:ne,fontExtraProperties:ce,useSystemFonts:se,useWasm:U,useWorkerFetch:V,cMapUrl:v,iccUrl:E,standardFontDataUrl:x,wasmUrl:T}},re={ownerDocument:le,pdfBug:oe,styleElement:I,loadingParams:{disableAutoFetch:J,enableXfa:ge}};return p.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const de=p.messageHandler.sendWithPromise("GetDocRequest",ae,s?[s.buffer]:null);let Se;if(d)Se=new Y2(d,{disableRange:ue,disableStream:j});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const ot=to(i)?Q2:$t?oR:iR;Se=new ot({url:i,length:q,httpHeaders:a,withCredentials:o,rangeChunkSize:f,disableRange:ue,disableStream:j})}return de.then(ot=>{if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const ht=new io(t,ot,p.port),dt=new pR(ht,e,Se,re,W,O);e._transport=dt,ht.send("Ready",null)})}).catch(e._capability.reject),e}class np{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${np.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Xw{#e=Promise.withResolvers();#t=[];#n=[];#i=[];#a=[];constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s}addRangeListener(e){this.#a.push(e)}addProgressListener(e){this.#i.push(e)}addProgressiveReadListener(e){this.#n.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const i of this.#a)i(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const i of this.#i)i(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#n)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){Ke("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class dR{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Re(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class fR{#e=!1;constructor(e,t,i,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Lb:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new Yw,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:a=!1}={}){return new Ao({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:a})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Re(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:i,intent:s="display",annotationMode:a=ns.ENABLE,transform:o=null,background:u=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:p=null,printAnnotationStorage:m=null,isEditing:b=!1,recordOperations:v=!1,operationsFilter:S=null}){this._stats?.time("Overall");const w=this._transport.getRenderingIntent(s,a,m,b),{renderingIntent:E,cacheKey:x}=w;this.#e=!1,d||=this._transport.getOptionalContentConfig(E);let C=this._intentStates.get(x);C||(C=Object.create(null),this._intentStates.set(x,C)),C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null);const T=!!(E&fi.PRINT);C.displayReadyCapability||(C.displayReadyCapability=Promise.withResolvers(),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(w));const D=!!(this._pdfBug&&globalThis.StepperManager?.enabled),M=!this.recordedBBoxes&&(v||D),N=H=>{if(C.renderTasks.delete(k),M){const ne=k.gfx?.dependencyTracker.take();ne&&(k.stepper&&k.stepper.setOperatorBBoxes(ne,k.gfx.dependencyTracker.takeDebugMetadata()),v&&(this.recordedBBoxes=ne))}T&&(this.#e=!0),this.#t(),H?(k.capability.reject(H),this._abortOperatorList({intentState:C,reason:H instanceof Error?H:new Error(H)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new Ur({callback:N,params:{canvas:t,canvasContext:e,dependencyTracker:M?new D2(t,C.operatorList.length,D):null,viewport:i,transform:o,background:u},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:C.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!T,pdfBug:this._pdfBug,pageColors:p,enableHWA:this._transport.enableHWA,operationsFilter:S});(C.renderTasks||=new Set).add(k);const z=k.task;return Promise.all([C.displayReadyCapability.promise,d]).then(([H,ne])=>{if(this.destroyed){N();return}if(this._stats?.time("Rendering"),!(ne.renderingIntent&E))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:H,optionalContentConfig:ne}),k.operatorListChanged()}).catch(N),z}getOperatorList({intent:e="display",annotationMode:t=ns.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function a(){u.operatorList.lastChunk&&(u.opListReadCapability.resolve(u.operatorList),u.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,i,s,!0);let u=this._intentStates.get(o.cacheKey);u||(u=Object.create(null),this._intentStates.set(o.cacheKey,u));let d;return u.opListReadCapability||(d=Object.create(null),d.operatorListChanged=a,u.opListReadCapability=Promise.withResolvers(),(u.renderTasks||=new Set).add(d),u.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),u.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>po.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,s){function a(){o.read().then(function({value:d,done:f}){if(f){i(u);return}u.lang??=d.lang,Object.assign(u.styles,d.styles),u.items.push(...d.items),a()},s)}const o=t.getReader(),u={items:[],styles:Object.create(null),lang:null};a()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new Lb),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){const{map:a,transfer:o}=i,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:a,modifiedIds:s},o).getReader(),f=this._intentStates.get(t);f.streamReader=d;const p=()=>{d.read().then(({value:m,done:b})=>{if(b){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(m,f),p())},m=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const b of f.renderTasks)b.operatorListChanged();this.#t()}if(f.displayReadyCapability)f.displayReadyCapability.reject(m);else if(f.opListReadCapability)f.opListReadCapability.reject(m);else throw m}})};p()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof Xf){let s=hR;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new rs(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,a]of this._intentStates)if(a===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var ss,Ui,En,Ls,kc,Ps,js,Vt,mc,Kw,Qw,no,Gr,yc;const it=class it{constructor({name:e=null,port:t=null,verbosity:i=YC()}={}){$i(this,Vt);$i(this,ss,Promise.withResolvers());$i(this,Ui,null);$i(this,En,null);$i(this,Ls,null);if(this.name=e,this.destroyed=!1,this.verbosity=i,t){if(tt(it,js).has(t))throw new Error("Cannot use more than one PDFWorker per port.");tt(it,js).set(t,this),Gi(this,Vt,Kw).call(this,t)}else Gi(this,Vt,Qw).call(this)}get promise(){return tt(this,ss).promise}get port(){return tt(this,En)}get messageHandler(){return tt(this,Ui)}destroy(){this.destroyed=!0,tt(this,Ls)?.terminate(),ei(this,Ls,null),tt(it,js).delete(tt(this,En)),ei(this,En,null),tt(this,Ui)?.destroy(),ei(this,Ui,null)}static create(e){const t=tt(this,js).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new it(e)}static get workerSrc(){if($r.workerSrc)return $r.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Re(this,"_setupFakeWorkerGlobal",(async()=>tt(this,Gr,yc)?tt(this,Gr,yc):(await import(this.workerSrc)).WorkerMessageHandler)())}};ss=new WeakMap,Ui=new WeakMap,En=new WeakMap,Ls=new WeakMap,kc=new WeakMap,Ps=new WeakMap,js=new WeakMap,Vt=new WeakSet,mc=function(){tt(this,ss).resolve(),tt(this,Ui).send("configure",{verbosity:this.verbosity})},Kw=function(e){ei(this,En,e),ei(this,Ui,new io("main","worker",e)),tt(this,Ui).on("ready",()=>{}),Gi(this,Vt,mc).call(this)},Qw=function(){if(tt(it,Ps)||tt(it,Gr,yc)){Gi(this,Vt,no).call(this);return}let{workerSrc:e}=it;try{it._isSameOrigin(window.location,e)||(e=it._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new io("main","worker",t),s=()=>{a.abort(),i.destroy(),t.terminate(),this.destroyed?tt(this,ss).reject(new Error("Worker was destroyed")):Gi(this,Vt,no).call(this)},a=new AbortController;t.addEventListener("error",()=>{tt(this,Ls)||s()},{signal:a.signal}),i.on("test",u=>{if(a.abort(),this.destroyed||!u){s();return}ei(this,Ui,i),ei(this,En,t),ei(this,Ls,t),Gi(this,Vt,mc).call(this)}),i.on("ready",u=>{if(a.abort(),this.destroyed){s();return}try{o()}catch{Gi(this,Vt,no).call(this)}});const o=()=>{const u=new Uint8Array;i.send("test",u,[u.buffer])};o();return}catch{Bc("The worker has been disabled.")}Gi(this,Vt,no).call(this)},no=function(){tt(it,Ps)||(xe("Setting up fake worker."),ei(it,Ps,!0)),it._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){tt(this,ss).reject(new Error("Worker was destroyed"));return}const t=new S2;ei(this,En,t);const i=`fake${h0(it,kc)._++}`,s=new io(i+"_worker",i,t);e.setup(s,t),ei(this,Ui,new io(i,i+"_worker",t)),Gi(this,Vt,mc).call(this)}).catch(e=>{tt(this,ss).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Gr=new WeakSet,yc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},$i(it,Gr),$i(it,kc,0),$i(it,Ps,!1),$i(it,js,new WeakMap),$t&&(ei(it,Ps,!0),$r.workerSrc||="./pdf.worker.mjs"),it._isSameOrigin=(e,t)=>{const i=URL.parse(e);if(!i?.origin||i.origin==="null")return!1;const s=new URL(t,i);return i.origin===s.origin},it._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},it.fromPort=e=>{if(r2("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return it.create(e)};let go=it;class pR{#e=new Map;#t=new Map;#n=new Map;#i=new Map;#a=null;constructor(e,t,i,s,a,o){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Yw,this.fontLoader=new m2({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#r(e,t=null){const i=this.#e.get(e);if(i)return i;const s=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,s),s}get annotationStorage(){return Re(this,"annotationStorage",new Zf)}getRenderingIntent(e,t=ns.ENABLE,i=null,s=!1,a=!1){let o=fi.DISPLAY,u=Sf;switch(e){case"any":o=fi.ANY;break;case"display":break;case"print":o=fi.PRINT;break;default:xe(`getRenderingIntent - invalid intent: ${e}`)}const d=o&fi.PRINT&&i instanceof Pw?i:this.annotationStorage;switch(t){case ns.DISABLE:o+=fi.ANNOTATIONS_DISABLE;break;case ns.ENABLE:break;case ns.ENABLE_FORMS:o+=fi.ANNOTATIONS_FORMS;break;case ns.ENABLE_STORAGE:o+=fi.ANNOTATIONS_STORAGE,u=d.serializable;break;default:xe(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=fi.IS_EDITING),a&&(o+=fi.OPLIST);const{ids:f,hash:p}=d.modifiedIds,m=[o,u.hash,p];return{renderingIntent:o,cacheKey:m.join("_"),annotationStorageSerializable:u,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),qt.cleanup(),this._networkStream?.cancelAllRequests(new rs("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{Ie(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},s.onPull=()=>{this._fullReader.read().then(function({value:a,done:o}){if(o){s.close();return}Ie(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{this._fullReader.cancel(a),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:a,contentLength:o}=this._fullReader;return(!s||!a)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=u=>{t.onProgress?.({loaded:u.loaded,total:u.total})}),{isStreamingSupported:s,isRangeSupported:a,contentLength:o}}),e.on("GetRangeReader",(i,s)=>{Ie(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(i.begin,i.end);if(!a){s.close();return}s.onPull=()=>{a.read().then(function({value:o,done:u}){if(u){s.close();return}Ie(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{a.cancel(o),s.ready.catch(u=>{if(!this.destroyed)throw u})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new dR(i,this))}),e.on("DocException",i=>{t._capability.reject(ti(i))}),e.on("PasswordRequest",i=>{this.#a=Promise.withResolvers();try{if(!t.onPassword)throw ti(i);const s=a=>{a instanceof Error?this.#a.reject(a):this.#a.resolve({password:a})};t.onPassword(s,i.code)}catch(s){this.#a.reject(s)}return this.#a.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,a])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in a){const m=a.error;xe(`Error during font loading: ${m}`),this.commonObjs.resolve(i,m);break}const o=new We(a),u=this._params.pdfBug&&globalThis.FontInspector?.enabled?(m,b)=>globalThis.FontInspector.fontAdded(m,b):null,d=new y2(o,u,a.extra,a.charProcOperatorList);this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":const{imageRef:f}=a;Ie(f,"The imageRef must be defined.");for(const m of this.#t.values())for(const[,b]of m.objs)if(b?.ref===f)return b.dataLen?(this.commonObjs.resolve(i,structuredClone(b)),b.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(i,a);break;case"Pattern":const p=new Ct(a);this.commonObjs.resolve(i,p.getIR());break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,a,o])=>{if(this.destroyed)return;const u=this.#t.get(s);if(!u.objs.has(i)){if(u._intentStates.size===0){o?.bitmap?.close();return}switch(a){case"Image":case"Pattern":u.objs.resolve(i,o);break;default:throw new Error(`Got unknown object type ${a}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&xe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=this.#n.get(t);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&this.#i.set(a.refStr,e);const o=new fR(t,a,this,this._params.pdfBug);return this.#t.set(t,o),o});return this.#n.set(t,s),s}getPageIndex(e){return Af(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#r("GetFieldObjects")}hasJSActions(){return this.#r("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#r("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#r("GetOptionalContentConfig").then(t=>new V2(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new $2(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),qt.cleanup()}}cachedPageNumber(e){if(!Af(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#i.get(t)??null}}class gR{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class Ur{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:a,operatorList:o,pageIndex:u,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:p=!1,pdfBug:m=!1,pageColors:b=null,enableHWA:v=!1,operationsFilter:S=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=u,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=m,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new gR(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=v,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=S}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(Ur.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ur.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:s,background:a,dependencyTracker:o}=this.params,u=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new qr(u,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:s,viewport:i,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Ur.#t.delete(this._canvas),e||=new Xf(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ur.#t.delete(this._canvas),this.callback())))}}const Jw="5.4.394",mR="2cc809ade";class ki{#e=null;#t=null;#n;#i=null;#a=!1;#r=!1;#s=null;#o;#c=null;#l=null;static#d=null;static get _keyboardManager(){return Re(this,"_keyboardManager",new xo([[["Escape","mac+Escape"],ki.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ki.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ki.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ki.prototype._moveToPrevious],[["Home","mac+Home"],ki.prototype._moveToBeginning],[["End","mac+End"],ki.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#r=!1,this.#s=e):this.#r=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#n=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",ki.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#s&&(e.ariaControls=`${this.#s.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#g.bind(this),{signal:t}),e.addEventListener("keydown",this.#m.bind(this),{signal:t});const i=this.#t=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#n,e.append(i),e}renderMainDropdown(){const e=this.#i=this.#h();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#h(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",Mi,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#s&&(e.id=`${this.#s.id}_colorpicker_dropdown`);for(const[i,s]of this.#l.highlightColors){const a=document.createElement("button");a.tabIndex="0",a.role="option",a.setAttribute("data-color",s),a.title=i,a.setAttribute("data-l10n-id",ki.#d[i]);const o=document.createElement("span");a.append(o),o.className="swatch",o.style.backgroundColor=s,a.ariaSelected=s===this.#n,a.addEventListener("click",this.#f.bind(this,s),{signal:t}),e.append(a)}return e.addEventListener("keydown",this.#m.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:je.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#g(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#p){this.#g(e);return}if(e.target===this.#e){this.#i.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#i?.firstChild||e.target===this.#e){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#p){this.#g(e);return}this.#i.firstChild?.focus()}_moveToEnd(e){if(!this.#p){this.#g(e);return}this.#i.lastChild?.focus()}#m(e){ki._keyboardManager.exec(this,e)}#g(e){if(this.#p){this.hideDropdown();return}if(this.#a=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const t=this.#i=this.#h();this.#e.append(t)}#u(e){this.#i?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#s?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#i)return;const t=this.#l.highlightColors.values();for(const i of this.#i.children)i.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#i?.remove(),this.#i=null}}class mo{#e=null;#t=null;#n=null;static#i=null;constructor(e){this.#t=e,this.#n=e._uiManager,mo.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,color:i}=this.#t,s=this.#e=document.createElement("input");return s.type="color",s.value=i||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",mo.#i[e]),s.addEventListener("input",()=>{this.#n.updateParams(t,s.value)},{signal:this.#n._signal}),s}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function iv(l){return Math.floor(Math.max(0,Math.min(1,l))*255).toString(16).padStart(2,"0")}function Qa(l){return Math.max(0,Math.min(255,255*l))}class nv{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Qa(e),[e,e,e]}static G_HTML([e]){const t=iv(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Qa)}static RGB_HTML(e){return`#${e.map(iv).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[Qa(1-Math.min(1,e+s)),Qa(1-Math.min(1,i+s)),Qa(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const s=1-e,a=1-t,o=1-i,u=Math.min(s,a,o);return["CMYK",s,a,o,u]}}class yR{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Ke("Abstract method `_createSVG` called.")}}class Rc extends yR{_createSVG(e){return document.createElementNS(_n,e)}}const bR=9,Bs=new WeakSet,vR=new Date().getTimezoneOffset()*60*1e3;class Jd{static create(e){switch(e.data.annotationType){case _t.LINK:return new sp(e);case _t.TEXT:return new _R(e);case _t.WIDGET:switch(e.data.fieldType){case"Tx":return new SR(e);case"Btn":return e.data.radioButton?new Zw(e):e.data.checkBox?new ER(e):new xR(e);case"Ch":return new TR(e);case"Sig":return new AR(e)}return new Fs(e);case _t.POPUP:return new Tf(e);case _t.FREETEXT:return new e_(e);case _t.LINE:return new RR(e);case _t.SQUARE:return new kR(e);case _t.CIRCLE:return new OR(e);case _t.POLYLINE:return new t_(e);case _t.CARET:return new MR(e);case _t.INK:return new rp(e);case _t.POLYGON:return new DR(e);case _t.HIGHLIGHT:return new i_(e);case _t.UNDERLINE:return new NR(e);case _t.SQUIGGLY:return new LR(e);case _t.STRIKEOUT:return new PR(e);case _t.STAMP:return new n_(e);case _t.FILEATTACHMENT:return new jR(e);default:return new at(e)}}}class at{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return at._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:i,rect:s}=this.data;let a=-1/0,o=-1/0;if(t?.length>=8){for(let u=0;u<t.length;u+=8)t[u+1]>o?(o=t[u+1],a=t[u+2]):t[u+1]===o&&(a=Math.max(a,t[u+2]));return[a,o]}if(i?.length>=1){for(const u of i)for(let d=0,f=u.length;d<f;d+=2)u[d+1]>o?(o=u[d+1],a=u[d]):u[d+1]===o&&(a=Math.max(a,u[d]));if(a!==1/0)return[a,o]}return s?[s[2],s[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:i,pageHeight:s,pageX:a,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-a)/i,e[1]=100*(e[1]-o)/s,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${ho}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,i={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:i})||this.annotationStorage.setValue(`${ho}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:i,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:i}=e;t&&this.#i(t);let s=this.#n?.popup||this.popup;!s&&i?.text&&(this._createPopup(i),s=this.#n.popup),s&&(s.updateEdited(e),i?.deleted&&(s.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#e&&(this.#i(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#i(e){const{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:a,pageHeight:o,pageX:u,pageY:d}}}}=this;i?.splice(0,4,...e),t.left=`${100*(e[0]-u)/a}%`,t.top=`${100*(o-e[3]+d)/o}%`,s===0?(t.width=`${100*(e[2]-e[0])/a}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(s)}_createContainer(e){const{data:t,parent:{page:i,viewport:s}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",t.id),!(this instanceof Fs)&&!(this instanceof sp)&&(a.tabIndex=0);const{style:o}=a;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(a.title=t.alternativeText),t.noRotate&&a.classList.add("norotate"),!t.rect||this instanceof Tf){const{rotation:w}=t;return!t.hasOwnCanvas&&w!==0&&this.setRotation(w,a),a}const{width:u,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const w=t.borderStyle.horizontalCornerRadius,E=t.borderStyle.verticalCornerRadius;if(w>0||E>0){const C=`calc(${w}px * var(--total-scale-factor)) / calc(${E}px * var(--total-scale-factor))`;o.borderRadius=C}else if(this instanceof Zw){const C=`calc(${u}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=C}switch(t.borderStyle.style){case Lr.SOLID:o.borderStyle="solid";break;case Lr.DASHED:o.borderStyle="dashed";break;case Lr.BEVELED:xe("Unimplemented border style: beveled");break;case Lr.INSET:xe("Unimplemented border style: inset");break;case Lr.UNDERLINE:o.borderBottomStyle="solid";break}const x=t.borderColor||null;x?(this.#t=!0,o.borderColor=pe.makeHexColor(x[0]|0,x[1]|0,x[2]|0)):o.borderWidth=0}const f=pe.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:p,pageHeight:m,pageX:b,pageY:v}=s.rawDims;o.left=`${100*(f[0]-b)/p}%`,o.top=`${100*(f[1]-v)/m}%`;const{rotation:S}=t;return t.hasOwnCanvas||S===0?(o.width=`${100*u/p}%`,o.height=`${100*d/m}%`):this.setRotation(S,a),a}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:a,height:o}=this;e%180!==0&&([a,o]=[o,a]),t.style.width=`${100*a/i}%`,t.style.height=`${100*o/s}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,s)=>{const a=s.detail[t],o=a[0],u=a.slice(1);s.target.style[i]=nv[`${o}_HTML`](u),this.annotationStorage.setValue(this.data.id,{[i]:nv[`${o}_rgb`](u)})};return Re(this,"_commonActions",{display:t=>{const{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const s of Object.keys(t.detail))(e[s]||i[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[s,a]of Object.entries(t)){const o=i[s];if(o){const u={detail:{[s]:a},target:e};o(u),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,s,a]=this.data.rect.map(w=>Math.fround(w));if(e.length===8){const[w,E,x,C]=e.subarray(2,6);if(s===w&&a===E&&t===x&&i===C)return}const{style:o}=this.container;let u;if(this.#t){const{borderColor:w,borderWidth:E}=o;o.borderWidth=0,u=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${w}" stroke-width="${E}">`],this.container.classList.add("hasBorder")}const d=s-t,f=a-i,{svgFactory:p}=this,m=p.createElement("svg");m.classList.add("quadrilateralsContainer"),m.setAttribute("width",0),m.setAttribute("height",0),m.role="none";const b=p.createElement("defs");m.append(b);const v=p.createElement("clipPath"),S=`clippath_${this.data.id}`;v.setAttribute("id",S),v.setAttribute("clipPathUnits","objectBoundingBox"),b.append(v);for(let w=2,E=e.length;w<E;w+=8){const x=e[w],C=e[w+1],T=e[w+2],D=e[w+3],M=p.createElement("rect"),N=(T-t)/d,k=(a-C)/f,z=(x-T)/d,H=(C-D)/f;M.setAttribute("x",N),M.setAttribute("y",k),M.setAttribute("width",z),M.setAttribute("height",H),v.append(M),u?.push(`<rect vector-effect="non-scaling-stroke" x="${N}" y="${k}" width="${z}" height="${H}"/>`)}this.#t&&(u.push("</g></svg>')"),o.backgroundImage=u.join("")),this.container.append(m),this.container.style.clipPath=`url(#${S})`}_createPopup(e=null){const{data:t}=this;let i,s;e?(i={str:e.text},s=e.date):(i=t.contentsObj,s=t.modificationDate),this.#n=new Tf({data:{color:t.color,titleObj:t.titleObj,modificationDate:s,contentsObj:i,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){Ke("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:a,id:o,exportValues:u}of s){if(a===-1||o===t)continue;const d=typeof u=="string"?u:null,f=document.querySelector(`[data-element-id="${o}"]`);if(f&&!Bs.has(f)){xe(`_getElementsByName - element not allowed: ${o}`);continue}i.push({id:o,exportValue:d,domElement:f})}return i}for(const s of document.getElementsByName(e)){const{exportValue:a}=s,o=s.getAttribute("data-element-id");o!==t&&Bs.has(s)&&i.push({id:o,exportValue:a,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class wR extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class sp extends at{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(i,e.action,e.overlaidText),s=!0):e.attachment?(this.#t(i,e.attachment,e.overlaidText,e.attachmentDest),s=!0):e.setOCGState?(this.#n(i,e.setOCGState,e.overlaidText),s=!0):e.dest?(this._bindLink(i,e.dest,e.overlaidText),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),s=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&(this.contentElement=i,this.container.append(i)),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,i=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),i&&(e.title=i)}_bindNamedAction(e,t,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),i&&(e.title=i),this.#e()}#t(e,t,i="",s=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:i&&(e.title=i),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,s),!1),this.#e()}#n(e,t,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),i&&(e.title=i),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(t.actions)){const a=i.get(s);a&&(e[a]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){xe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();const{fields:s,refs:a,include:o}=t,u=[];if(s.length!==0||a.length!==0){const p=new Set(a);for(const m of s){const b=this._fieldObjects[m]||[];for(const{id:v}of b)p.add(v)}for(const m of Object.values(this._fieldObjects))for(const b of m)p.has(b.id)===o&&u.push(b)}else for(const p of Object.values(this._fieldObjects))u.push(...p);const d=this.annotationStorage,f=[];for(const p of u){const{id:m}=p;switch(f.push(m),p.type){case"text":{const v=p.defaultValue||"";d.setValue(m,{value:v});break}case"checkbox":case"radiobutton":{const v=p.defaultValue===p.exportValues;d.setValue(m,{value:v});break}case"combobox":case"listbox":{const v=p.defaultValue||"";d.setValue(m,{value:v});break}default:continue}const b=document.querySelector(`[data-element-id="${m}"]`);if(b){if(!Bs.has(b)){xe(`_bindResetFormAction - element not allowed: ${m}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class _R extends at{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class Fs extends at{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Bt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,a){i.includes("mouse")?e.addEventListener(i,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(i,o=>{if(i==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:a(o)}})})}_setEventListeners(e,t,i,s){for(const[a,o]of i)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,a,o,s),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":pe.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||bR,a=e.style;let o;const u=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u),p=Math.round(f/($d*s))||1,m=f/p;o=Math.min(s,d(m/$d))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-u);o=Math.min(s,d(f/$d))}a.fontSize=`calc(${o}px * var(--total-scale-factor))`,a.color=pe.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(a.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class SR extends Fs{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){const a=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=i),a.setValue(o.id,{[s]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=e.getValue(t,{value:this.data.fieldValue});let a=s.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&a.length>o&&(a=a.slice(0,o));let u=s.formattedValue||this.data.textContent?.join(`
`)||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const d={userValue:a,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=u??a,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",u??a),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Bs.add(i),this.contentElement=i,i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:f,datetimeType:p,timeStep:m}=this.data,b=!!p&&this.enableScripting;f&&(i.title=f),this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",S=>{e.setValue(t,{value:S.target.value}),this.setPropertyOnSiblings(i,"value",S.target.value,"value"),d.formattedValue=null}),i.addEventListener("resetform",S=>{const w=this.data.defaultFieldValue??"";i.value=d.userValue=w,d.formattedValue=null});let v=S=>{const{formattedValue:w}=d;w!=null&&(S.target.value=w),S.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",w=>{if(d.focused)return;const{target:E}=w;if(b&&(E.type=p,m&&(E.step=m)),d.userValue){const x=d.userValue;if(b)if(p==="time"){const C=new Date(x),T=[C.getHours(),C.getMinutes(),C.getSeconds()];E.value=T.map(D=>D.toString().padStart(2,"0")).join(":")}else E.value=new Date(x-vR).toISOString().split(p==="date"?"T":".",1)[0];else E.value=x}d.lastCommittedValue=E.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),i.addEventListener("updatefromsandbox",w=>{this.showElementAndHideCanvas(w.target);const E={value(x){d.userValue=x.detail.value??"",b||e.setValue(t,{value:d.userValue.toString()}),x.target.value=d.userValue},formattedValue(x){const{formattedValue:C}=x.detail;d.formattedValue=C,C!=null&&x.target!==document.activeElement&&(x.target.value=C);const T={formattedValue:C};b&&(T.value=C),e.setValue(t,T)},selRange(x){x.target.setSelectionRange(...x.detail.selRange)},charLimit:x=>{const{charLimit:C}=x.detail,{target:T}=x;if(C===0){T.removeAttribute("maxLength");return}T.setAttribute("maxLength",C);let D=d.userValue;!D||D.length<=C||(D=D.slice(0,C),T.value=d.userValue=D,e.setValue(t,{value:D}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:D,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}};this._dispatchEventFromSandbox(E,w)}),i.addEventListener("keydown",w=>{d.commitKey=1;let E=-1;if(w.key==="Escape"?E=0:w.key==="Enter"&&!this.data.multiLine?E=2:w.key==="Tab"&&(d.commitKey=3),E===-1)return;const{value:x}=w.target;d.lastCommittedValue!==x&&(d.lastCommittedValue=x,d.userValue=x,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:E,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}))});const S=v;v=null,i.addEventListener("blur",w=>{if(!d.focused||!w.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:E}=w;let{value:x}=E;if(b){if(x&&p==="time"){const C=x.split(":").map(T=>parseInt(T,10));x=new Date(2e3,0,1,C[0],C[1],C[2]||0).valueOf(),E.step=""}else x.includes("T")||(x=`${x}T00:00`),x=new Date(x).valueOf();E.type="text"}d.userValue=x,d.lastCommittedValue!==x&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:d.commitKey,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}),S(w)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",w=>{d.lastCommittedValue=null;const{data:E,target:x}=w,{value:C,selectionStart:T,selectionEnd:D}=x;let M=T,N=D;switch(w.inputType){case"deleteWordBackward":{const k=C.substring(0,T).match(/\w*[^\w]*$/);k&&(M-=k[0].length);break}case"deleteWordForward":{const k=C.substring(T).match(/^[^\w]*\w*/);k&&(N+=k[0].length);break}case"deleteContentBackward":T===D&&(M-=1);break;case"deleteContentForward":T===D&&(N+=1);break}w.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,change:E||"",willCommit:!1,selStart:M,selEnd:N}})}),this._setEventListeners(i,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.value)}if(v&&i.addEventListener("blur",v),this.data.comb){const w=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${w}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class AR extends Fs{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class ER extends Fs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return Bs.add(a),a.setAttribute("data-element-id",i),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=t.fieldName,s&&a.setAttribute("checked",!0),a.setAttribute("exportValue",t.exportValue),a.tabIndex=0,a.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,i)){const p=d&&f.exportValue===t.exportValue;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}e.setValue(i,{value:d})}),a.addEventListener("resetform",o=>{const u=t.defaultFieldValue||"Off";o.target.checked=u===t.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",o=>{const u={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(i,{value:d.target.checked})}};this._dispatchEventFromSandbox(u,o)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class Zw extends Fs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(const o of this._getElementsByName(t.fieldName,i))e.setValue(o.id,{value:!1});const a=document.createElement("input");if(Bs.add(a),a.setAttribute("data-element-id",i),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=t.fieldName,s&&a.setAttribute("checked",!0),a.tabIndex=0,a.addEventListener("change",o=>{const{name:u,checked:d}=o.target;for(const f of this._getElementsByName(u,i))e.setValue(f.id,{value:!1});e.setValue(i,{value:d})}),a.addEventListener("resetform",o=>{const u=t.defaultFieldValue;o.target.checked=u!=null&&u===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;a.addEventListener("updatefromsandbox",u=>{const d={value:f=>{const p=o===f.detail.value;for(const m of this._getElementsByName(f.target.name)){const b=p&&m.id===i;m.domElement&&(m.domElement.checked=b),e.setValue(m.id,{value:b})}}};this._dispatchEventFromSandbox(d,u)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class xR extends sp{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class TR extends Fs{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Bs.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",p=>{const m=this.data.defaultFieldValue;for(const b of s.options)b.selected=b.value===m});for(const p of this.data.options){const m=document.createElement("option");m.textContent=p.displayValue,m.value=p.exportValue,i.value.includes(p.exportValue)&&(m.setAttribute("selected",!0),a=!1),s.append(m)}let o=null;if(a){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),s.prepend(p),o=()=>{p.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}const u=p=>{const m=p?"value":"textContent",{options:b,multiple:v}=s;return v?Array.prototype.filter.call(b,S=>S.selected).map(S=>S[m]):b.selectedIndex===-1?null:b[b.selectedIndex][m]};let d=u(!1);const f=p=>{const m=p.target.options;return Array.prototype.map.call(m,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",p=>{const m={value(b){o?.();const v=b.detail.value,S=new Set(Array.isArray(v)?v:[v]);for(const w of s.options)w.selected=S.has(w.value);e.setValue(t,{value:u(!0)}),d=u(!1)},multipleSelection(b){s.multiple=!0},remove(b){const v=s.options,S=b.detail.remove;v[S].selected=!1,s.remove(S),v.length>0&&Array.prototype.findIndex.call(v,E=>E.selected)===-1&&(v[0].selected=!0),e.setValue(t,{value:u(!0),items:f(b)}),d=u(!1)},clear(b){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),d=u(!1)},insert(b){const{index:v,displayValue:S,exportValue:w}=b.detail.insert,E=s.children[v],x=document.createElement("option");x.textContent=S,x.value=w,E?E.before(x):s.append(x),e.setValue(t,{value:u(!0),items:f(b)}),d=u(!1)},items(b){const{items:v}=b.detail;for(;s.length!==0;)s.remove(0);for(const S of v){const{displayValue:w,exportValue:E}=S,x=document.createElement("option");x.textContent=w,x.value=E,s.append(x)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:u(!0),items:f(b)}),d=u(!1)},indices(b){const v=new Set(b.detail.indices);for(const S of b.target.options)S.selected=v.has(S.index);e.setValue(t,{value:u(!0)}),d=u(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(m,p)}),s.addEventListener("input",p=>{const m=u(!0),b=u(!1);e.setValue(t,{value:m}),p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:b,changeEx:m,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):s.addEventListener("input",function(p){e.setValue(t,{value:u(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Tf extends at{constructor(e){const{data:t,elements:i,parent:s}=e,a=!!s._commentManager;if(super(e,{isRenderable:!a&&at._hasPopupData(t)}),this.elements=i,a&&at._hasPopupData(t)){const o=this.popup=this.#e();for(const u of i)u.popup=o}else this.popup=null}#e(){return new CR({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),i=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",i.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(s=>`${Ir}${s}`).join(",")),this.container}}class CR{#e=null;#t=this.#$.bind(this);#n=this.#U.bind(this);#i=this.#N.bind(this);#a=this.#S.bind(this);#r=null;#s=null;#o=null;#c=null;#l=null;#d=null;#h=null;#f=!1;#m=null;#g=null;#u=null;#p=null;#y=null;#v=null;#b=null;#x=null;#A=null;#_=null;#C=!1;#w=null;#E=null;constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:a,contentsObj:o,richText:u,parent:d,rect:f,parentRect:p,open:m,commentManager:b=null}){this.#s=e,this.#A=s,this.#o=o,this.#x=u,this.#d=d,this.#r=t,this.#b=f,this.#h=p,this.#l=i,this.#e=b,this.#w=i[0],this.#c=vf.toDateObject(a),this.trigger=i.flatMap(v=>v.getElementsToTriggerPopup()),b||(this.#O(),this.#s.hidden=!0,m&&this.#S())}#O(){if(this.#g)return;this.#g=new AbortController;const{signal:e}=this.#g;for(const t of this.trigger)t.addEventListener("click",this.#a,{signal:e}),t.addEventListener("pointerenter",this.#i,{signal:e}),t.addEventListener("pointerleave",this.#n,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#R(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#y=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#w.container.after(this.#p);return}if(this.#y||this.#R(),!this.#y)return;const{signal:e}=this.#g=new AbortController,t=this.#w.hasOwnCommentButton,i=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},s=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},a=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#p=this.#w.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",i,{signal:e}),o.addEventListener("pointerenter",s,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=this.#p=document.createElement("button");o.className="annotationCommentButton";const u=this.#w.container;o.style.zIndex=u.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#I(),this.#k(),o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",i,{signal:e}),o.addEventListener("pointerenter",s,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),u.after(o)}}#k(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#p||this.renderCommentButton();const[e,t]=this.#y,{style:i}=this.#p;i.left=`calc(${e}%)`,i.top=`calc(${t}% - var(--comment-button-dim))`}#I(){this.#w.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#w.commentData;return e?this.#d._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:e,color:t,opacity:i,creationDate:s,modificationDate:a}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:i,creationDate:s,modificationDate:a}}get elementBeforePopup(){return this.#p}get comment(){return this.#E||=this.#w.commentText,this.#E}set comment(e){e!==this.comment&&(this.#w.commentText=this.#E=e)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#p&&(this.#p.classList.toggle("selected",e),this.#p.ariaExpanded=t)}setSelectedCommentButton(e){this.#p.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#v)return this.#v;const{x:e,y:t,height:i}=this.#p.getBoundingClientRect(),{x:s,y:a,width:o,height:u}=this.#w.layer.getBoundingClientRect();return[(e-s)/o,(t+i-a)/u]}set commentPopupPosition(e){this.#v=e}hasDefaultPopupPosition(){return this.#v===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,i]=this.#v||this.commentButtonPosition.map(f=>f/100),s=this.parentBoundingClientRect,{x:a,y:o,width:u,height:d}=s;this.#e.showDialog(null,this,a+t*u,o+i*d,{...e,parentDimensions:s})}render(){if(this.#m)return;const e=this.#m=document.createElement("div");if(e.className="popup",this.#r){const i=e.style.outlineColor=pe.makeHexColor(...this.#r);e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#A?.str){const i=document.createElement("span");i.className="title",t.append(i),{dir:i.dir,str:i.textContent}=this.#A}if(e.append(t),this.#c){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),i.dateTime=this.#c.toISOString(),t.append(i)}Dw({html:this.#M||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#s.append(e)}get#M(){const e=this.#x,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#x.html||null}get#L(){return this.#M?.attributes?.style?.fontSize||0}get#B(){return this.#M?.attributes?.style?.color||null}#P(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#B,fontSize:this.#L?`calc(${this.#L}px * var(--total-scale-factor))`:""}};for(const a of e.split(`
`))t.push({name:"span",value:a,attributes:s});return i}#$(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#S()}updateEdited({rect:e,popup:t,deleted:i}){if(this.#e){i?(this.remove(),this.#E=null):t&&(t.deleted?this.remove():(this.#I(),this.#E=t.text)),e&&(this.#y=null,this.#R(),this.#k());return}if(i||t?.deleted){this.remove();return}this.#O(),this.#_||={contentsObj:this.#o,richText:this.#x},e&&(this.#u=null),t&&t.text&&(this.#x=this.#P(t.text),this.#c=vf.toDateObject(t.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#_&&({contentsObj:this.#o,richText:this.#x}=this.#_,this.#_=null,this.#m?.remove(),this.#m=null,this.#u=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#T(){if(this.#u!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:a}}}=this.#d;let o=!!this.#h,u=o?this.#h:this.#b;for(const S of this.#l)if(!u||pe.intersect(S.data.rect,u)!==null){u=S.data.rect,o=!0;break}const d=pe.normalizeRect([u[0],e[3]-u[1]+e[1],u[2],e[3]-u[3]+e[1]]),p=o?u[2]-u[0]+5:0,m=d[0]+p,b=d[1];this.#u=[100*(m-s)/t,100*(b-a)/i];const{style:v}=this.#s;v.left=`${this.#u[0]}%`,v.top=`${this.#u[1]}%`}#S(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#N(),this.#s.addEventListener("click",this.#a),this.#s.addEventListener("keydown",this.#t)):(this.#U(),this.#s.removeEventListener("click",this.#a),this.#s.removeEventListener("keydown",this.#t))}#N(){this.#m||this.render(),this.isVisible?this.#f&&this.#s.classList.add("focused"):(this.#T(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#U(){this.#s.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#s.hidden=!0)}maybeShow(){this.#e||(this.#O(),this.#C&&(this.#m||this.#N(),this.#C=!1,this.#s.hidden=!1))}get isVisible(){return this.#e?!1:this.#s.hidden===!1}}class e_ extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Te.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class RR extends at{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),a=this.#e=this.svgFactory.createElement("svg:line");return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class kR extends at{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),a=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",t-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class OR extends at{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),a=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",i/2),o.setAttribute("rx",t/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class t_ extends at{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:i,popupRef:s},width:a,height:o}=this;if(!t)return this.container;const u=this.svgFactory.create(a,o,!0);let d=[];for(let p=0,m=t.length;p<m;p+=2){const b=t[p]-e[0],v=e[3]-t[p+1];d.push(`${b},${v}`)}d=d.join(" ");const f=this.#e=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),u.append(f),this.container.append(u),!s&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class DR extends t_{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class MR extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class rp extends at{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Te.HIGHLIGHT:Te.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:i,borderStyle:s,popupRef:a}}=this,{transform:o,width:u,height:d}=this.#n(t,e),f=this.svgFactory.create(u,d,!0),p=this.#e=this.svgFactory.createElement("svg:g");f.append(p),p.setAttribute("stroke-width",s.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",o);for(let m=0,b=i.length;m<b;m++){const v=this.svgFactory.createElement(this.svgElementName);this.#t.push(v),v.setAttribute("points",i[m].join(",")),p.append(v)}return!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:i,rect:s}=e,a=this.#e;if(t>=0&&a.setAttribute("stroke-width",t||1),i)for(let o=0,u=this.#t.length;o<u;o++)this.#t[o].setAttribute("points",i[o].join(","));if(s){const{transform:o,width:u,height:d}=this.#n(this.data.rotation,s);a.parentElement.setAttribute("viewBox",`0 0 ${u} ${d}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class i_ extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Te.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class NR extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class LR extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class PR extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class n_ extends at{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Te.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class jR extends at{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#t.bind(this)),this.#e=i;const{isMac:s}=Bt.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(s?a.metaKey:a.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ap{#e=null;#t=null;#n=null;#i=new Map;#a=null;#r=null;#s=[];#o=!1;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:a,viewport:o,structTreeLayer:u,commentManager:d,linkService:f,annotationStorage:p}){this.div=e,this.#e=t,this.#t=i,this.#a=u||null,this.#r=f||null,this.#n=p||new Zf,this.page=a,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=d||null}hasEditableAnnotations(){return this.#i.size>0}async render(e){const{annotations:t}=e,i=this.div;Is(i,this.viewport);const s=new Map,a=[],o={data:null,layer:i,linkService:this.#r,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Rc,annotationStorage:this.#n,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const u of t){if(u.noHTML)continue;const d=u.annotationType===_t.POPUP;if(d){const m=s.get(u.id);if(!m)continue;if(!this._commentManager){a.push(u);continue}o.elements=m}else if(u.rect[2]===u.rect[0]||u.rect[3]===u.rect[1])continue;o.data=u;const f=Jd.create(o);if(!f.isRenderable)continue;if(!d&&(this.#s.push(f),u.popupRef)){const m=s.get(u.popupRef);m?m.push(f):s.set(u.popupRef,[f])}const p=f.render();u.hidden&&(p.style.visibility="hidden"),f._isEditable&&(this.#i.set(f.data.id,f),this._annotationEditorUIManager?.renderAnnotationElement(f))}await this.#c();for(const u of a){const d=o.elements=s.get(u.id);o.data=u;const f=Jd.create(o);if(!f.isRenderable)continue;const p=f.render();f.contentElement.id=`${Ir}${u.id}`,u.hidden&&(p.style.visibility="hidden"),d.at(-1).container.after(p)}this.#l()}async#c(){if(this.#s.length===0)return;this.div.replaceChildren();const e=[];if(!this.#o){this.#o=!0;for(const{contentElement:i,data:{id:s}}of this.#s){const a=i.id=`${Ir}${s}`;e.push(this.#a?.getAriaAttributes(a).then(o=>{if(o)for(const[u,d]of o)i.setAttribute(u,d)}))}}this.#s.sort(({data:{rect:[i,s,a,o]}},{data:{rect:[u,d,f,p]}})=>{if(i===a&&s===o)return 1;if(u===f&&d===p)return-1;const m=o,b=s,v=(s+o)/2,S=p,w=d,E=(d+p)/2;if(v>=S&&E<=b)return-1;if(E>=m&&v<=w)return 1;const x=(i+a)/2,C=(u+f)/2;return x-C});const t=document.createDocumentFragment();for(const i of this.#s)t.append(i.container),this._commentManager?(i.extraPopupElement?.popup||i.popup)?.renderCommentButton():i.extraPopupElement&&t.append(i.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#e)for(const i of this.#s)this.#e.addPointerInTextLayer(i.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#r,svgFactory:new Rc,parent:this};for(const i of e){i.borderStyle||=ap._defaultBorderStyle,t.data=i;const s=Jd.create(t);s.isRenderable&&(s.render(),s.contentElement.id=`${Ir}${i.id}`,this.#s.push(s))}await this.#c()}update({viewport:e}){const t=this.div;this.viewport=e,Is(t,{rotation:e.rotation}),this.#l(),t.hidden=!1}#l(){if(!this.#t)return;const e=this.div;for(const[t,i]of this.#t){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:a}=s;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):s.append(i);const o=this.#i.get(t);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,s.id,i),o._hasNoCanvas=!1):o.canvas=i)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:i,rotation:s}=e,a=new wR({data:{id:i,rect:e.getPDFRect(),rotation:s},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#n});return a.render(),a.contentElement.id=`${Ir}${i}`,a.createOrUpdatePopup(),this.#s.push(a),a}removeAnnotation(e){const t=this.#s.findIndex(s=>s.data.id===e);if(t<0)return;const[i]=this.#s.splice(t,1);this.#e?.removePointerInTextLayer(i.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return Re(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Lr.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const uc=/\r\n?|\n/g;class Rt extends we{#e="";#t=`${this.id}-editor`;#n=null;#i;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=Rt.prototype,t=a=>a.isEmpty(),i=as.TRANSLATE_SMALL,s=as.TRANSLATE_BIG;return Re(this,"_keyboardManager",new xo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=Te.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||Rt._defaultColor||we._defaultLineColor,this.#i=e.fontSize||Rt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){we.initialize(e,t);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case je.FREETEXT_SIZE:Rt._defaultFontSize=t;break;case je.FREETEXT_COLOR:Rt._defaultColor=t;break}}updateParams(e,t){switch(e){case je.FREETEXT_SIZE:this.#a(t);break;case je.FREETEXT_COLOR:this.#r(t);break}}static get defaultPropertiesToUpdate(){return[[je.FREETEXT_SIZE,Rt._defaultFontSize],[je.FREETEXT_COLOR,Rt._defaultColor||we._defaultLineColor]]}get propertiesToUpdate(){return[[je.FREETEXT_SIZE,this.#i],[je.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new mo(this),[["colorPicker",this._colorPicker]]}get colorType(){return je.FREETEXT_COLOR}#a(e){const t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#i)*this.parentScale),this.#i=s,this.#o()},i=this.#i;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:je.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(e){const t=s=>{this.color=s,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:je.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-Rt._internalPadding*e,-(Rt._internalPadding+this.#i)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const e=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#s(){const e=[];this.editorDiv.normalize();let t=null;for(const i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(Rt.#c(i)),t=i);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:a}=this,o=a.style.display,u=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",s.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",u)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#s().trimEnd();if(e===t)return;const i=s=>{if(this.#e=s,!s){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Rt._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[u,d]=this.getInitialTranslation();[u,d]=this.pageTranslationToScreen(u,d);const[f,p]=this.pageDimensions,[m,b]=this.pageTranslation;let v,S;switch(this.rotation){case 0:v=e+(o[0]-m)/f,S=t+this.height-(o[1]-b)/p;break;case 90:v=e+(o[0]-m)/f,S=t-(o[1]-b)/p,[u,d]=[d,-u];break;case 180:v=e-this.width+(o[0]-m)/f,S=t-(o[1]-b)/p,[u,d]=[-u,-d];break;case 270:v=e+(o[0]-m-this.height*p)/f,S=t+(o[1]-b-this.width*f)/p,[u,d]=[-d,u];break}this.setAt(v*s,S*a,u,d)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(uc,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const s=Rt.#h(t.getData("text")||"").replaceAll(uc,`
`);if(!s)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!s.includes(`
`)){o.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:u,startOffset:d}=o,f=[],p=[];if(u.nodeType===Node.TEXT_NODE){const v=u.parentElement;if(p.push(u.nodeValue.slice(d).replaceAll(uc,"")),v!==this.editorDiv){let S=f;for(const w of this.editorDiv.childNodes){if(w===v){S=p;continue}S.push(Rt.#c(w))}}f.push(u.nodeValue.slice(0,d).replaceAll(uc,""))}else if(u===this.editorDiv){let v=f,S=0;for(const w of this.editorDiv.childNodes)S++===d&&(v=p),v.push(Rt.#c(w))}this.#e=`${f.join(`
`)}${s}${p.join(`
`)}`,this.#l();const m=new Range;let b=Math.sumPrecise(f.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const S=v.nodeValue.length;if(b<=S){m.setStart(v,b),m.setEnd(v,b);break}b-=S}a.removeAllRanges(),a.addRange(m)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#d(){return this.#e.replaceAll(""," ")}static#h(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=Rt._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,i){let s=null;if(e instanceof e_){const{data:{defaultAppearanceData:{fontSize:o,fontColor:u},rect:d,rotation:f,id:p,popupRef:m,richText:b,contentsObj:v,creationDate:S,modificationDate:w},textContent:E,textPosition:x,parent:{page:{pageNumber:C}}}=e;if(!E||E.length===0)return null;s=e={annotationType:Te.FREETEXT,color:Array.from(u),fontSize:o,value:E.join(`
`),position:x,pageIndex:C-1,rect:d.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:m,comment:v?.str||null,richText:b,creationDate:S,modificationDate:w}}const a=await super.deserialize(e,t,i);return a.#i=e.fontSize,a.color=pe.makeHexColor(...e.color),a.#e=Rt.#h(e.value),a._initialData=s,e.comment&&a.setCommentData(e),a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=we._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(e),{color:t,fontSize:this.#i,value:this.#d()});return this.addComment(i),e?(i.isCopy=!0,i):this.annotationElementId&&!this.#f(i)?null:(i.id=this.annotationElementId,i)}#f(e){const{value:t,fontSize:i,color:s,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((o,u)=>o!==s[u])||e.pageIndex!==a}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:i}=t;i.fontSize=`calc(${this.#i}px * var(--total-scale-factor))`,i.color=this.color,t.replaceChildren();for(const s of this.#e.split(`
`)){const a=document.createElement("div");a.append(s?document.createTextNode(s):document.createElement("br")),t.append(a)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class he{static PRECISION=1e-4;toSVGPath(){Ke("Abstract method `toSVGPath` must be implemented.")}get box(){Ke("Abstract getter `box` must be implemented.")}serialize(e,t){Ke("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,s,a,o){o||=new Float32Array(e.length);for(let u=0,d=e.length;u<d;u+=2)o[u]=t+e[u]*s,o[u+1]=i+e[u+1]*a;return o}static _rescaleAndSwap(e,t,i,s,a,o){o||=new Float32Array(e.length);for(let u=0,d=e.length;u<d;u+=2)o[u]=t+e[u+1]*s,o[u+1]=i+e[u]*a;return o}static _translate(e,t,i,s){s||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)s[a]=t+e[a],s[a+1]=i+e[a+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,s,a){switch(a){case 90:return[1-t/i,e/s];case 180:return[1-e/i,1-t/s];case 270:return[t/i,1-e/s];default:return[e/i,t/s]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,s,a,o){return[(e+5*i)/6,(t+5*s)/6,(5*i+a)/6,(5*s+o)/6,(i+a)/2,(s+o)/2]}}class Ns{#e;#t=[];#n;#i;#a=[];#r=new Float32Array(18);#s;#o;#c;#l;#d;#h;#f=[];static#m=8;static#g=2;static#u=Ns.#m+Ns.#g;constructor({x:e,y:t},i,s,a,o,u=0){this.#e=i,this.#h=a*s,this.#i=o,this.#r.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=u,this.#l=Ns.#m*s,this.#c=Ns.#u*s,this.#d=s,this.#f.push(e,t)}isEmpty(){return isNaN(this.#r[8])}#p(){const e=this.#r.subarray(4,6),t=this.#r.subarray(16,18),[i,s,a,o]=this.#e;return[(this.#s+(e[0]-t[0])/2-i)/a,(this.#o+(e[1]-t[1])/2-s)/o,(this.#s+(t[0]-e[0])/2-i)/a,(this.#o+(t[1]-e[1])/2-s)/o]}add({x:e,y:t}){this.#s=e,this.#o=t;const[i,s,a,o]=this.#e;let[u,d,f,p]=this.#r.subarray(8,12);const m=e-f,b=t-p,v=Math.hypot(m,b);if(v<this.#c)return!1;const S=v-this.#l,w=S/v,E=w*m,x=w*b;let C=u,T=d;u=f,d=p,f+=E,p+=x,this.#f?.push(e,t);const D=-x/S,M=E/S,N=D*this.#h,k=M*this.#h;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([f+N,p+k],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([f-N,p-k],16),isNaN(this.#r[6])?(this.#a.length===0&&(this.#r.set([u+N,d+k],2),this.#a.push(NaN,NaN,NaN,NaN,(u+N-i)/a,(d+k-s)/o),this.#r.set([u-N,d-k],14),this.#t.push(NaN,NaN,NaN,NaN,(u-N-i)/a,(d-k-s)/o)),this.#r.set([C,T,u,d,f,p],6),!this.isEmpty()):(this.#r.set([C,T,u,d,f,p],6),Math.abs(Math.atan2(T-d,C-u)-Math.atan2(x,E))<Math.PI/2?([u,d,f,p]=this.#r.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((u+f)/2-i)/a,((d+p)/2-s)/o),[u,d,C,T]=this.#r.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((C+u)/2-i)/a,((T+d)/2-s)/o),!0):([C,T,u,d,f,p]=this.#r.subarray(0,6),this.#a.push(((C+5*u)/6-i)/a,((T+5*d)/6-s)/o,((5*u+f)/6-i)/a,((5*d+p)/6-s)/o,((u+f)/2-i)/a,((d+p)/2-s)/o),[f,p,u,d,C,T]=this.#r.subarray(12,18),this.#t.push(((C+5*u)/6-i)/a,((T+5*d)/6-s)/o,((5*u+f)/6-i)/a,((5*d+p)/6-s)/o,((u+f)/2-i)/a,((d+p)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#a,t=this.#t;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#y();const i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#b(i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#v(i),i.join(" ")}#y(){const[e,t,i,s]=this.#e,[a,o,u,d]=this.#p();return`M${(this.#r[2]-e)/i} ${(this.#r[3]-t)/s} L${(this.#r[4]-e)/i} ${(this.#r[5]-t)/s} L${a} ${o} L${u} ${d} L${(this.#r[16]-e)/i} ${(this.#r[17]-t)/s} L${(this.#r[14]-e)/i} ${(this.#r[15]-t)/s} Z`}#v(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#b(e){const[t,i,s,a]=this.#e,o=this.#r.subarray(4,6),u=this.#r.subarray(16,18),[d,f,p,m]=this.#p();e.push(`L${(o[0]-t)/s} ${(o[1]-i)/a} L${d} ${f} L${p} ${m} L${(u[0]-t)/s} ${(u[1]-i)/a}`)}newFreeDrawOutline(e,t,i,s,a,o){return new s_(e,t,i,s,a,o)}getOutlines(){const e=this.#a,t=this.#t,i=this.#r,[s,a,o,u]=this.#e,d=new Float32Array((this.#f?.length??0)+2);for(let m=0,b=d.length-2;m<b;m+=2)d[m]=(this.#f[m]-s)/o,d[m+1]=(this.#f[m+1]-a)/u;if(d[d.length-2]=(this.#s-s)/o,d[d.length-1]=(this.#o-a)/u,isNaN(i[6])&&!this.isEmpty())return this.#x(d);const f=new Float32Array(this.#a.length+24+this.#t.length);let p=e.length;for(let m=0;m<p;m+=2){if(isNaN(e[m])){f[m]=f[m+1]=NaN;continue}f[m]=e[m],f[m+1]=e[m+1]}p=this.#_(f,p);for(let m=t.length-6;m>=6;m-=6)for(let b=0;b<6;b+=2){if(isNaN(t[m+b])){f[p]=f[p+1]=NaN,p+=2;continue}f[p]=t[m+b],f[p+1]=t[m+b+1],p+=2}return this.#A(f,p),this.newFreeDrawOutline(f,d,this.#e,this.#d,this.#n,this.#i)}#x(e){const t=this.#r,[i,s,a,o]=this.#e,[u,d,f,p]=this.#p(),m=new Float32Array(36);return m.set([NaN,NaN,NaN,NaN,(t[2]-i)/a,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-i)/a,(t[5]-s)/o,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(t[16]-i)/a,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-i)/a,(t[15]-s)/o],0),this.newFreeDrawOutline(m,e,this.#e,this.#d,this.#n,this.#i)}#A(e,t){const i=this.#t;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#_(e,t){const i=this.#r.subarray(4,6),s=this.#r.subarray(16,18),[a,o,u,d]=this.#e,[f,p,m,b]=this.#p();return e.set([NaN,NaN,NaN,NaN,(i[0]-a)/u,(i[1]-o)/d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,m,b,NaN,NaN,NaN,NaN,(s[0]-a)/u,(s[1]-o)/d],t),t+=24}}class s_ extends he{#e;#t=new Float32Array(4);#n;#i;#a;#r;#s;constructor(e,t,i,s,a,o){super(),this.#s=e,this.#a=t,this.#e=i,this.#r=s,this.#n=a,this.#i=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(o);const[u,d,f,p]=this.#t;for(let m=0,b=e.length;m<b;m+=2)e[m]=(e[m]-u)/f,e[m+1]=(e[m+1]-d)/p;for(let m=0,b=t.length;m<b;m+=2)t[m]=(t[m]-u)/f,t[m+1]=(t[m+1]-d)/p}toSVGPath(){const e=[`M${this.#s[4]} ${this.#s[5]}`];for(let t=6,i=this.#s.length;t<i;t+=6){if(isNaN(this.#s[t])){e.push(`L${this.#s[t+4]} ${this.#s[t+5]}`);continue}e.push(`C${this.#s[t]} ${this.#s[t+1]} ${this.#s[t+2]} ${this.#s[t+3]} ${this.#s[t+4]} ${this.#s[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,s],a){const o=i-e,u=s-t;let d,f;switch(a){case 0:d=he._rescale(this.#s,e,s,o,-u),f=he._rescale(this.#a,e,s,o,-u);break;case 90:d=he._rescaleAndSwap(this.#s,e,t,o,u),f=he._rescaleAndSwap(this.#a,e,t,o,u);break;case 180:d=he._rescale(this.#s,i,t,-o,u),f=he._rescale(this.#a,i,t,-o,u);break;case 270:d=he._rescaleAndSwap(this.#s,i,s,-o,-u),f=he._rescaleAndSwap(this.#a,i,s,-o,-u);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(e){const t=this.#s;let i=t[4],s=t[5];const a=[i,s,i,s];let o=i,u=s,d=i,f=s;const p=e?Math.max:Math.min,m=new Float32Array(4);for(let v=6,S=t.length;v<S;v+=6){const w=t[v+4],E=t[v+5];isNaN(t[v])?(pe.pointBoundingBox(w,E,a),u>E?(o=w,u=E):u===E&&(o=p(o,w)),f<E?(d=w,f=E):f===E&&(d=p(d,w))):(m[0]=m[1]=1/0,m[2]=m[3]=-1/0,pe.bezierBoundingBox(i,s,...t.slice(v,v+6),m),pe.rectBoundingBox(m[0],m[1],m[2],m[3],a),u>m[1]?(o=m[0],u=m[1]):u===m[1]&&(o=p(o,m[0])),f<m[3]?(d=m[2],f=m[3]):f===m[3]&&(d=p(d,m[2]))),i=w,s=E}const b=this.#t;b[0]=a[0]-this.#n,b[1]=a[1]-this.#n,b[2]=a[2]-a[0]+2*this.#n,b[3]=a[3]-a[1]+2*this.#n,this.firstPoint=[o,u],this.lastPoint=[d,f]}get box(){return this.#t}newOutliner(e,t,i,s,a,o=0){return new Ns(e,t,i,s,a,o)}getNewOutline(e,t){const[i,s,a,o]=this.#t,[u,d,f,p]=this.#e,m=a*f,b=o*p,v=i*f+u,S=s*p+d,w=this.newOutliner({x:this.#a[0]*m+v,y:this.#a[1]*b+S},this.#e,this.#r,e,this.#i,t??this.#n);for(let E=2;E<this.#a.length;E+=2)w.add({x:this.#a[E]*m+v,y:this.#a[E+1]*b+S});return w.getOutlines()}}class Cf{#e;#t;#n;#i=[];#a=[];constructor(e,t=0,i=0,s=!0){const a=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:w,y:E,width:x,height:C}of e){const T=Math.floor((w-t)/o)*o,D=Math.ceil((w+x+t)/o)*o,M=Math.floor((E-t)/o)*o,N=Math.ceil((E+C+t)/o)*o,k=[T,M,N,!0],z=[D,M,N,!1];this.#i.push(k,z),pe.rectBoundingBox(T,M,D,N,a)}const u=a[2]-a[0]+2*i,d=a[3]-a[1]+2*i,f=a[0]-i,p=a[1]-i;let m=s?-1/0:1/0,b=1/0;const v=this.#i.at(s?-1:-2),S=[v[0],v[2]];for(const w of this.#i){const[E,x,C,T]=w;!T&&s?x<b?(b=x,m=E):x===b&&(m=Math.max(m,E)):T&&!s&&(x<b?(b=x,m=E):x===b&&(m=Math.min(m,E))),w[0]=(E-f)/u,w[1]=(x-p)/d,w[2]=(C-p)/d}this.#e=new Float32Array([f,p,u,d]),this.#t=[m,b],this.#n=S}getOutlines(){this.#i.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of this.#i)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#r(e)}#r(e){const t=[],i=new Set;for(const o of e){const[u,d,f]=o;t.push([u,d,o],[u,f,o])}t.sort((o,u)=>o[1]-u[1]||o[0]-u[0]);for(let o=0,u=t.length;o<u;o+=2){const d=t[o][2],f=t[o+1][2];d.push(f),f.push(d),i.add(d),i.add(f)}const s=[];let a;for(;i.size>0;){const o=i.values().next().value;let[u,d,f,p,m]=o;i.delete(o);let b=u,v=d;for(a=[u,f],s.push(a);;){let S;if(i.has(p))S=p;else if(i.has(m))S=m;else break;i.delete(S),[u,d,f,p,m]=S,b!==u&&(a.push(b,v,u,v===d?d:f),b=u),v=v===d?f:d}a.push(b,v)}return new IR(s,this.#e,this.#t,this.#n)}#s(e){const t=this.#a;let i=0,s=t.length-1;for(;i<=s;){const a=i+s>>1,o=t[a][0];if(o===e)return a;o<e?i=a+1:s=a-1}return s+1}#o([,e,t]){const i=this.#s(e);this.#a.splice(i,0,[e,t])}#c([,e,t]){const i=this.#s(e);for(let s=i;s<this.#a.length;s++){const[a,o]=this.#a[s];if(a!==e)break;if(a===e&&o===t){this.#a.splice(s,1);return}}for(let s=i-1;s>=0;s--){const[a,o]=this.#a[s];if(a!==e)break;if(a===e&&o===t){this.#a.splice(s,1);return}}}#l(e){const[t,i,s]=e,a=[[t,i,s]],o=this.#s(s);for(let u=0;u<o;u++){const[d,f]=this.#a[u];for(let p=0,m=a.length;p<m;p++){const[,b,v]=a[p];if(!(f<=b||v<=d)){if(b>=d){if(v>f)a[p][1]=f;else{if(m===1)return[];a.splice(p,1),p--,m--}continue}a[p][2]=d,v>f&&a.push([t,f,v])}}}return a}}class IR extends he{#e;#t;constructor(e,t,i,s){super(),this.#t=e,this.#e=t,this.firstPoint=i,this.lastPoint=s}toSVGPath(){const e=[];for(const t of this.#t){let[i,s]=t;e.push(`M${i} ${s}`);for(let a=2;a<t.length;a+=2){const o=t[a],u=t[a+1];o===i?(e.push(`V${u}`),s=u):u===s&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,t,i,s],a){const o=[],u=i-e,d=s-t;for(const f of this.#t){const p=new Array(f.length);for(let m=0;m<f.length;m+=2)p[m]=e+f[m]*u,p[m+1]=s-f[m+1]*d;o.push(p)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class Rf extends Ns{newFreeDrawOutline(e,t,i,s,a,o){return new BR(e,t,i,s,a,o)}}class BR extends s_{newOutliner(e,t,i,s,a,o=0){return new Rf(e,t,i,s,a,o)}}class gt extends we{#e=null;#t=0;#n;#i=null;#a=null;#r=null;#s=null;#o=0;#c=null;#l=null;#d=null;#h=!1;#f=null;#m=null;#g=null;#u="";#p;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Te.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=gt.prototype;return Re(this,"_keyboardManager",new xo([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||gt._defaultColor,this.#p=e.thickness||gt._defaultThickness,this.opacity=e.opacity||gt._defaultOpacity,this.#n=e.boxes||null,this.#y=e.methodOfCreation||"",this.#u=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#h=!0,this.#b(e),this.#w()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#s=e.focusNode,this.#o=e.focusOffset,this.#v(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#v(){const e=new Cf(this.#n,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new Cf(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#r=t.getOutlines();const{firstPoint:i}=this.#l;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height];const{lastPoint:s}=this.#r;this.#m=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#b({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#l=e;const s=1.5;if(this.#r=e.getNewOutline(this.#p/2+s,.0025),t>=0)this.#d=t,this.#i=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:gt.#E(this.#l.box,(m-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:gt.#E(this.#r.box,m),path:{d:this.#r.toSVGPath()}})}const[a,o,u,d]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=u,this.height=d;break;case 90:{const[m,b]=this.parentDimensions;this.x=o,this.y=1-a,this.width=u*b/m,this.height=d*m/b;break}case 180:this.x=1-a,this.y=1-o,this.width=u,this.height=d;break;case 270:{const[m,b]=this.parentDimensions;this.x=1-o,this.y=a,this.width=u*b/m,this.height=d*m/b;break}}const{firstPoint:f}=e;this.#f=[(f[0]-a)/u,(f[1]-o)/d];const{lastPoint:p}=this.#r;this.#m=[(p[0]-a)/u,(p[1]-o)/d]}static initialize(e,t){we.initialize(e,t),gt._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case je.HIGHLIGHT_COLOR:gt._defaultColor=t;break;case je.HIGHLIGHT_THICKNESS:gt._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case je.HIGHLIGHT_COLOR:this.#x(t);break;case je.HIGHLIGHT_THICKNESS:this.#A(t);break}}static get defaultPropertiesToUpdate(){return[[je.HIGHLIGHT_COLOR,gt._defaultColor],[je.HIGHLIGHT_THICKNESS,gt._defaultThickness]]}get propertiesToUpdate(){return[[je.HIGHLIGHT_COLOR,this.color||gt._defaultColor],[je.HIGHLIGHT_THICKNESS,this.#p||gt._defaultThickness],[je.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#x(e){const t=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},i=this.color,s=this.opacity;this.addCommands({cmd:t.bind(this,e,gt._defaultOpacity),undo:t.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:je.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#A(e){const t=this.#p,i=s=>{this.#p=s,this.#_(s)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:je.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new ki({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#k())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#C():e&&(this.#w(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#_(e){this.#h&&(this.#b({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#w(e=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#i}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#i))}static#E([e,t,i,s],a){switch(a){case 90:return[1-t-s,e,s,i];case 180:return[1-e-i,1-t-s,i,s];case 270:return[t,1-e-i,s,i]}return[e,t,i,s]}rotate(e){const{drawLayer:t}=this.parent;let i;this.#h?(e=(e-this.rotation+360)%360,i=gt.#E(this.#l.box,e)):i=gt.#E([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#d,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#g,{bbox:gt.#E(this.#r.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#u&&(e.setAttribute("aria-label",this.#u),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#O.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#i,this.setDims(),Nw(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#O(e){gt._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#s,this.#o)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#h||this.#R(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!e}}))}#k(){return this.#h?this.rotation:0}#I(){if(this.#h)return null;const[e,t]=this.pageDimensions,[i,s]=this.pageTranslation,a=this.#n,o=new Float32Array(a.length*8);let u=0;for(const{x:d,y:f,width:p,height:m}of a){const b=d*e+i,v=(1-f)*t+s;o[u]=o[u+4]=b,o[u+1]=o[u+3]=v,o[u+2]=o[u+6]=b+p*e,o[u+5]=o[u+7]=v-m*t,u+=8}return o}#M(e){return this.#l.serialize(e,this.#k())}static startHighlighting(e,t,{target:i,x:s,y:a}){const{x:o,y:u,width:d,height:f}=i.getBoundingClientRect(),p=new AbortController,m=e.combinedSignal(p),b=v=>{p.abort(),this.#B(e,v)};window.addEventListener("blur",b,{signal:m}),window.addEventListener("pointerup",b,{signal:m}),window.addEventListener("pointerdown",ut,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Mi,{signal:m}),i.addEventListener("pointermove",this.#L.bind(this,e),{signal:m}),this._freeHighlight=new Rf({x:s,y:a},[o,u,d,f],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#L(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#B(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,i){let s=null;if(e instanceof i_){const{data:{quadPoints:S,rect:w,rotation:E,id:x,color:C,opacity:T,popupRef:D,richText:M,contentsObj:N,creationDate:k,modificationDate:z},parent:{page:{pageNumber:H}}}=e;s=e={annotationType:Te.HIGHLIGHT,color:Array.from(C),opacity:T,quadPoints:S,boxes:null,pageIndex:H-1,rect:w.slice(0),rotation:E,annotationElementId:x,id:x,deleted:!1,popupRef:D,richText:M,comment:N?.str||null,creationDate:k,modificationDate:z}}else if(e instanceof rp){const{data:{inkLists:S,rect:w,rotation:E,id:x,color:C,borderStyle:{rawWidth:T},popupRef:D,richText:M,contentsObj:N,creationDate:k,modificationDate:z},parent:{page:{pageNumber:H}}}=e;s=e={annotationType:Te.HIGHLIGHT,color:Array.from(C),thickness:T,inkLists:S,boxes:null,pageIndex:H-1,rect:w.slice(0),rotation:E,annotationElementId:x,id:x,deleted:!1,popupRef:D,richText:M,comment:N?.str||null,creationDate:k,modificationDate:z}}const{color:a,quadPoints:o,inkLists:u,opacity:d}=e,f=await super.deserialize(e,t,i);f.color=pe.makeHexColor(...a),f.opacity=d||1,u&&(f.#p=e.thickness),f._initialData=s,e.comment&&f.setCommentData(e);const[p,m]=f.pageDimensions,[b,v]=f.pageTranslation;if(o){const S=f.#n=[];for(let w=0;w<o.length;w+=8)S.push({x:(o[w]-b)/p,y:1-(o[w+1]-v)/m,width:(o[w+2]-o[w])/p,height:(o[w+1]-o[w+5])/m});f.#v(),f.#w(),f.rotate(f.rotation)}else if(u){f.#h=!0;const S=u[0],w={x:S[0]-b,y:m-(S[1]-v)},E=new Rf(w,[0,0,p,m],1,f.#p/2,!0,.001);for(let T=0,D=S.length;T<D;T+=2)w.x=S[T]-b,w.y=m-(S[T+1]-v),E.add(w);const{id:x,clipPathId:C}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:E.toSVGPath()}},!0,!0);f.#b({highlightOutlines:E.getOutlines(),highlightId:x,clipPathId:C}),f.#w(),f.rotate(f.parentRotation)}return f}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=we._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(e);return Object.assign(i,{color:t,opacity:this.opacity,thickness:this.#p,quadPoints:this.#I(),outlines:this.#M(i.rect)}),this.addComment(i),this.annotationElementId&&!this.#P(i)?null:(i.id=this.annotationElementId,i)}#P(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((i,s)=>i!==t[s])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class r_{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,i)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Ke("Not implemented")}}class ze extends we{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#a=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#r(e),this.#c())}#r({drawOutlines:e,drawId:t,drawingOptions:i}){this.#e=e,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#s(e,this.parent),this.#h(e.box)}#s(e,t){const{id:i}=t.drawLayer.draw(ze._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(e,t){const i=new Set(Object.keys(e));for(const[s,a]of Object.entries(t))i.has(s)?Object.assign(e[s],a):e[s]=a;return e}static getDefaultDrawingOptions(e){Ke("Not implemented")}static get typesMap(){Ke("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,t),this._currentParent&&(ze.#n.updateProperty(i,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[i,s]of this.typesMap)e.push([i,t[s]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[i,s]of this.constructor.typesMap)e.push([i,t[s]]);return e}_updateProperty(e,t,i){const s=this._drawingOptions,a=s[t],o=u=>{s.updateProperty(t,u);const d=this.#e.updateProperty(t,u);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#h(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#o()):e&&(this._uiManager.addShouldRescale(this),this.#c(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#s(this.#e,e)}}#l([e,t,i,s]){const{parentDimensions:[a,o],rotation:u}=this;switch(u){case 90:return[t,1-e,i*(o/a),s*(a/o)];case 180:return[1-e,1-t,i,s];case 270:return[1-t,e,i*(o/a),s*(a/o)];default:return[e,t,i,s]}}#d(){const{x:e,y:t,width:i,height:s,parentDimensions:[a,o],rotation:u}=this;switch(u){case 90:return[1-t,e,i*(a/o),s*(o/a)];case 180:return[1-e,1-t,i,s];case 270:return[t,1-e,i*(a/o),s*(o/a)];default:return[e,t,i,s]}}#h(e){[this.x,this.y,this.width,this.height]=this.#l(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:e,y:t,width:i,height:s,rotation:a,parentRotation:o,parentDimensions:[u,d]}=this;switch((a*4+o)/90){case 1:return[1-t-s,e,s,i];case 2:return[1-e-i,1-t-s,i,s];case 3:return[t,1-e-i,s,i];case 4:return[e,t-i*(u/d),s*(d/u),i*(u/d)];case 5:return[1-t,e,i*(u/d),s*(d/u)];case 6:return[1-e-s*(d/u),1-t,s*(d/u),i*(u/d)];case 7:return[t-i*(u/d),1-e-s*(d/u),i*(u/d),s*(d/u)];case 8:return[e-i,t-s,i,s];case 9:return[1-t,e-i,s,i];case 10:return[1-e,1-t,i,s];case 11:return[t-s,1-e,s,i];case 12:return[e-s*(d/u),t,s*(d/u),i*(u/d)];case 13:return[1-t-i*(u/d),e-s*(d/u),i*(u/d),s*(d/u)];case 14:return[1-e,1-t-i*(u/d),s*(d/u),i*(u/d)];case 15:return[t,1-e,i*(u/d),s*(d/u)];default:return[e,t,i,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,ze._mergeSVGProperties({bbox:this.#f()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const i=super.render();i.classList.add("draw");const s=document.createElement("div");return i.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),i}static createDrawerInstance(e,t,i,s,a){Ke("Not implemented")}static startDrawing(e,t,i,s){const{target:a,offsetX:o,offsetY:u,pointerId:d,pointerType:f}=s;if(He.isInitializedAndDifferentPointerType(f))return;const{viewport:{rotation:p}}=e,{width:m,height:b}=a.getBoundingClientRect(),v=ze.#i=new AbortController,S=e.combinedSignal(v);if(He.setPointer(f,d),window.addEventListener("pointerup",w=>{He.isSamePointerIdOrRemove(w.pointerId)&&this._endDraw(w)},{signal:S}),window.addEventListener("pointercancel",w=>{He.isSamePointerIdOrRemove(w.pointerId)&&this._currentParent.endDrawingSession()},{signal:S}),window.addEventListener("pointerdown",w=>{He.isSamePointerType(w.pointerType)&&(He.initializeAndAddPointerId(w.pointerId),ze.#n.isCancellable()&&(ze.#n.removeLastElement(),ze.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:S}),window.addEventListener("contextmenu",Mi,{signal:S}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:S}),a.addEventListener("touchmove",w=>{He.isSameTimeStamp(w.timeStamp)&&ut(w)},{signal:S}),e.toggleDrawing(),t._editorUndoBar?.hide(),ze.#n){e.drawLayer.updateProperties(this._currentDrawId,ze.#n.startNew(o,u,m,b,p));return}t.updateUIForDefaultProperties(this),ze.#n=this.createDrawerInstance(o,u,m,b,p),ze.#a=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(ze.#a.toSVGProperties(),ze.#n.defaultSVGProperties),!0,!1)}static _drawMove(e){if(He.isSameTimeStamp(e.timeStamp),!ze.#n)return;const{offsetX:t,offsetY:i,pointerId:s}=e;if(He.isSamePointerId(s)){if(He.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,ze.#n.add(t,i)),He.setTimeStamp(e.timeStamp),ut(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,ze.#n=null,ze.#a=null,He.clearPointerType(),He.clearTimeStamp()),ze.#i&&(ze.#i.abort(),ze.#i=null,He.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,ze.#n.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=ze.#n,s=this._currentDrawId,a=i.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(s,i.setLastElement(a))},undo:()=>{t.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:je.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(je.DRAW_STEP),!ze.#n.isEmpty()){const{pageDimensions:[i,s],scale:a}=t,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:ze.#n.getOutlines(i*a,s*a,a,this._INNER_MARGIN),drawingOptions:ze.#a,mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,i,s,a,o){Ke("Not implemented")}static async deserialize(e,t,i){const{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:u}}=t.viewport,d=this.deserializeDraw(o,u,s,a,this._INNER_MARGIN,e),f=await super.deserialize(e,t,i);return f.createDrawingOptions(e),f.#r({drawOutlines:d}),f.#c(),f.onScaleChanging(),f.rotate(),f}serializeDraw(e){const[t,i]=this.pageTranslation,[s,a]=this.pageDimensions;return this.#e.serialize([t,i,s,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class UR{#e=new Float64Array(6);#t;#n;#i;#a;#r;#s="";#o=0;#c=new Co;#l;#d;constructor(e,t,i,s,a,o){this.#l=i,this.#d=s,this.#i=a,this.#a=o,[e,t]=this.#h(e,t);const u=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#r=[e,t],this.#n=[{line:u,points:this.#r}],this.#e.set(u,0)}updateProperty(e,t){e==="stroke-width"&&(this.#a=t)}#h(e,t){return he._normalizePoint(e,t,this.#l,this.#d,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#r.length<=10}add(e,t){[e,t]=this.#h(e,t);const[i,s,a,o]=this.#e.subarray(2,6),u=e-a,d=t-o;return Math.hypot(this.#l*u,this.#d*d)<=2?null:(this.#r.push(e,t),isNaN(i)?(this.#e.set([a,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([i,s,a,o,e,t],0),this.#t.push(...he.createBezierPoints(i,s,a,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,a){this.#l=i,this.#d=s,this.#i=a,[e,t]=this.#h(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#r=[e,t];const u=this.#n.at(-1);return u&&(u.line=new Float32Array(u.line),u.points=new Float32Array(u.points)),this.#n.push({line:o,points:this.#r}),this.#e.set(o,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#r=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#c.removeLastElement();this.#n.pop(),this.#s="";for(let e=0,t=this.#n.length;e<t;e++){const{line:i,points:s}=this.#n[e];this.#t=i,this.#r=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#s}}}toSVGPath(){const e=he.svgRound(this.#t[4]),t=he.svgRound(this.#t[5]);if(this.#r.length===2)return this.#s=`${this.#s} M ${e} ${t} Z`,this.#s;if(this.#r.length<=6){const s=this.#s.lastIndexOf("M");this.#s=`${this.#s.slice(0,s)} M ${e} ${t}`,this.#o=6}if(this.#r.length===4){const s=he.svgRound(this.#t[10]),a=he.svgRound(this.#t[11]);return this.#s=`${this.#s} L ${s} ${a}`,this.#o=12,this.#s}const i=[];this.#o===0&&(i.push(`M ${e} ${t}`),this.#o=6);for(let s=this.#o,a=this.#t.length;s<a;s+=6){const[o,u,d,f,p,m]=this.#t.slice(s,s+6).map(he.svgRound);i.push(`C${o} ${u} ${d} ${f} ${p} ${m}`)}return this.#s+=i.join(" "),this.#o=this.#t.length,this.#s}getOutlines(e,t,i,s){const a=this.#n.at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),this.#c.build(this.#n,e,t,i,this.#i,this.#a,s),this.#e=null,this.#t=null,this.#n=null,this.#s=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Co extends he{#e;#t=0;#n;#i;#a;#r;#s;#o;#c;build(e,t,i,s,a,o,u){this.#a=t,this.#r=i,this.#s=s,this.#o=a,this.#c=o,this.#n=u??0,this.#i=e,this.#h()}get thickness(){return this.#c}setLastElement(e){return this.#i.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#i){if(e.push(`M${he.svgRound(t[4])} ${he.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${he.svgRound(t[10])} ${he.svgRound(t[11])}`);continue}for(let i=6,s=t.length;i<s;i+=6){const[a,o,u,d,f,p]=t.subarray(i,i+6).map(he.svgRound);e.push(`C${a} ${o} ${u} ${d} ${f} ${p}`)}}return e.join("")}serialize([e,t,i,s],a){const o=[],u=[],[d,f,p,m]=this.#d();let b,v,S,w,E,x,C,T,D;switch(this.#o){case 0:D=he._rescale,b=e,v=t+s,S=i,w=-s,E=e+d*i,x=t+(1-f-m)*s,C=e+(d+p)*i,T=t+(1-f)*s;break;case 90:D=he._rescaleAndSwap,b=e,v=t,S=i,w=s,E=e+f*i,x=t+d*s,C=e+(f+m)*i,T=t+(d+p)*s;break;case 180:D=he._rescale,b=e+i,v=t,S=-i,w=s,E=e+(1-d-p)*i,x=t+f*s,C=e+(1-d)*i,T=t+(f+m)*s;break;case 270:D=he._rescaleAndSwap,b=e+i,v=t+s,S=-i,w=-s,E=e+(1-f-m)*i,x=t+(1-d-p)*s,C=e+(1-f)*i,T=t+(1-d)*s;break}for(const{line:M,points:N}of this.#i)o.push(D(M,b,v,S,w,a?new Array(M.length):null)),u.push(D(N,b,v,S,w,a?new Array(N.length):null));return{lines:o,points:u,rect:[E,x,C,T]}}static deserialize(e,t,i,s,a,{paths:{lines:o,points:u},rotation:d,thickness:f}){const p=[];let m,b,v,S,w;switch(d){case 0:w=he._rescale,m=-e/i,b=t/s+1,v=1/i,S=-1/s;break;case 90:w=he._rescaleAndSwap,m=-t/s,b=-e/i,v=1/s,S=1/i;break;case 180:w=he._rescale,m=e/i+1,b=-t/s,v=-1/i,S=1/s;break;case 270:w=he._rescaleAndSwap,m=t/s+1,b=e/i+1,v=-1/s,S=-1/i;break}if(!o){o=[];for(const x of u){const C=x.length;if(C===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(C===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const T=new Float32Array(3*(C-2));o.push(T);let[D,M,N,k]=x.subarray(0,4);T.set([NaN,NaN,NaN,NaN,D,M],0);for(let z=4;z<C;z+=2){const H=x[z],ne=x[z+1];T.set(he.createBezierPoints(D,M,N,k,H,ne),(z-2)*3),[D,M,N,k]=[N,k,H,ne]}}}for(let x=0,C=o.length;x<C;x++)p.push({line:w(o[x].map(T=>T??NaN),m,b,v,S),points:w(u[x].map(T=>T??NaN),m,b,v,S)});const E=new this.prototype.constructor;return E.build(p,i,s,1,d,f,a),E}#l(e=this.#c){const t=this.#n+e/2*this.#s;return this.#o%180===0?[t/this.#a,t/this.#r]:[t/this.#r,t/this.#a]}#d(){const[e,t,i,s]=this.#e,[a,o]=this.#l(0);return[e+a,t+o,i-2*a,s-2*o]}#h(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#i){if(s.length<=12){for(let u=4,d=s.length;u<d;u+=6)pe.pointBoundingBox(s[u],s[u+1],e);continue}let a=s[4],o=s[5];for(let u=6,d=s.length;u<d;u+=6){const[f,p,m,b,v,S]=s.subarray(u,u+6);pe.bezierBoundingBox(a,o,f,p,m,b,v,S,e),a=v,o=S}}const[t,i]=this.#l();e[0]=Gt(e[0]-t,0,1),e[1]=Gt(e[1]-i,0,1),e[2]=Gt(e[2]+t,0,1),e[3]=Gt(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,i]=this.#l();this.#c=e;const[s,a]=this.#l(),[o,u]=[s-t,a-i],d=this.#e;return d[0]-=o,d[1]-=u,d[2]+=2*o,d[3]+=2*u,d}updateParentDimensions([e,t],i){const[s,a]=this.#l();this.#a=e,this.#r=t,this.#s=i;const[o,u]=this.#l(),d=o-s,f=u-a,p=this.#e;return p[0]-=d,p[1]-=f,p[2]+=2*d,p[3]+=2*f,p}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(he.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${he.svgRound(e)} ${he.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let i=0,s=0,a=0,o=0,u=0,d=0;switch(this.#t){case 90:s=t/e,a=-e/t,u=e;break;case 180:i=-1,o=-1,u=e,d=t;break;case 270:s=-t/e,a=e/t,d=t;break;default:return""}return`matrix(${i} ${s} ${a} ${o} ${he.svgRound(u)} ${he.svgRound(d)})`}getPathResizingSVGProperties([e,t,i,s]){const[a,o]=this.#l(),[u,d,f,p]=this.#e;if(Math.abs(f-a)<=he.PRECISION||Math.abs(p-o)<=he.PRECISION){const w=e+i/2-(u+f/2),E=t+s/2-(d+p/2);return{path:{"transform-origin":`${he.svgRound(e)} ${he.svgRound(t)}`,transform:`${this.rotationTransform} translate(${w} ${E})`}}}const m=(i-2*a)/(f-2*a),b=(s-2*o)/(p-2*o),v=f/i,S=p/s;return{path:{"transform-origin":`${he.svgRound(u)} ${he.svgRound(d)}`,transform:`${this.rotationTransform} scale(${v} ${S}) translate(${he.svgRound(a)} ${he.svgRound(o)}) scale(${m} ${b}) translate(${he.svgRound(-a)} ${he.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,i,s]){const[a,o]=this.#l(),u=this.#e,[d,f,p,m]=u;if(u[0]=e,u[1]=t,u[2]=i,u[3]=s,Math.abs(p-a)<=he.PRECISION||Math.abs(m-o)<=he.PRECISION){const E=e+i/2-(d+p/2),x=t+s/2-(f+m/2);for(const{line:C,points:T}of this.#i)he._translate(C,E,x,C),he._translate(T,E,x,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${he.svgRound(e)} ${he.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(i-2*a)/(p-2*a),v=(s-2*o)/(m-2*o),S=-b*(d+a)+e+a,w=-v*(f+o)+t+o;if(b!==1||v!==1||S!==0||w!==0)for(const{line:E,points:x}of this.#i)he._rescale(E,S,w,b,v,E),he._rescale(x,S,w,b,v,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${he.svgRound(e)} ${he.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){const[s,a]=i,o=this.#e,u=e-o[0],d=t-o[1];if(this.#a===s&&this.#r===a)for(const{line:f,points:p}of this.#i)he._translate(f,u,d,f),he._translate(p,u,d,p);else{const f=this.#a/s,p=this.#r/a;this.#a=s,this.#r=a;for(const{line:m,points:b}of this.#i)he._rescale(m,u,d,f,p,m),he._rescale(b,u,d,f,p,b);o[2]*=f,o[3]*=p}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${he.svgRound(e)} ${he.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${he.svgRound(e[0])} ${he.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Hc extends r_{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:we._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Hc(this._viewParameters);return e.updateAll(this),e}}class op extends ze{static _type="ink";static _editorType=Te.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){we.initialize(e,t),this._defaultDrawingOptions=new Hc(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return Re(this,"typesMap",new Map([[je.INK_THICKNESS,"stroke-width"],[je.INK_COLOR,"stroke"],[je.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,s,a){return new UR(e,t,i,s,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,s,a,o){return Co.deserialize(e,t,i,s,a,o)}static async deserialize(e,t,i){let s=null;if(e instanceof rp){const{data:{inkLists:o,rect:u,rotation:d,id:f,color:p,opacity:m,borderStyle:{rawWidth:b},popupRef:v,richText:S,contentsObj:w,creationDate:E,modificationDate:x},parent:{page:{pageNumber:C}}}=e;s=e={annotationType:Te.INK,color:Array.from(p),thickness:b,opacity:m,paths:{points:o},boxes:null,pageIndex:C-1,rect:u.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:v,richText:S,comment:w?.str||null,creationDate:E,modificationDate:x}}const a=await super.deserialize(e,t,i);return a._initialData=s,e.comment&&a.setCommentData(e),a}get toolbarButtons(){return this._colorPicker||=new mo(this),[["colorPicker",this._colorPicker]]}get colorType(){return je.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=op.getDefaultDrawingOptions({stroke:pe.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:i}=this.serializeDraw(e),{_drawingOptions:{stroke:s,"stroke-opacity":a,"stroke-width":o}}=this,u=Object.assign(super.serialize(e),{color:we._colorManager.convert(s),opacity:a,thickness:o,paths:{lines:t,points:i}});return this.addComment(u),e?(u.isCopy=!0,u):this.annotationElementId&&!this.#e(u)?null:(u.id=this.annotationElementId,u)}#e(e){const{color:t,thickness:i,opacity:s,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,u)=>o!==t[u])||e.thickness!==i||e.opacity!==s||e.pageIndex!==a}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class kf extends Co{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const hc=8,Ja=3;class jr{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,i,s){return i-=e,s-=t,i===0?s>0?0:4:i===1?s+6:2-s}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(e,t,i,s,a,o,u){const d=this.#t(i,s,a,o);for(let f=0;f<8;f++){const p=(-f+d-u+16)%8,m=this.#n[2*p],b=this.#n[2*p+1];if(e[(i+m)*t+(s+b)]!==0)return p}return-1}static#a(e,t,i,s,a,o,u){const d=this.#t(i,s,a,o);for(let f=0;f<8;f++){const p=(f+d+u+16)%8,m=this.#n[2*p],b=this.#n[2*p+1];if(e[(i+m)*t+(s+b)]!==0)return p}return-1}static#r(e,t,i,s){const a=e.length,o=new Int32Array(a);for(let p=0;p<a;p++)o[p]=e[p]<=s?1:0;for(let p=1;p<i-1;p++)o[p*t]=o[p*t+t-1]=0;for(let p=0;p<t;p++)o[p]=o[t*i-1-p]=0;let u=1,d;const f=[];for(let p=1;p<i-1;p++){d=1;for(let m=1;m<t-1;m++){const b=p*t+m,v=o[b];if(v===0)continue;let S=p,w=m;if(v===1&&o[b-1]===0)u+=1,w-=1;else if(v>=1&&o[b+1]===0)u+=1,w+=1,v>1&&(d=v);else{v!==1&&(d=Math.abs(v));continue}const E=[m,p],x=w===m+1,C={isHole:x,points:E,id:u,parent:0};f.push(C);let T;for(const ie of f)if(ie.id===d){T=ie;break}T?T.isHole?C.parent=x?T.parent:d:C.parent=x?d:T.parent:C.parent=x?d:0;const D=this.#i(o,t,p,m,S,w,0);if(D===-1){o[b]=-u,o[b]!==1&&(d=Math.abs(o[b]));continue}let M=this.#n[2*D],N=this.#n[2*D+1];const k=p+M,z=m+N;S=k,w=z;let H=p,ne=m;for(;;){const ie=this.#a(o,t,H,ne,S,w,1);M=this.#n[2*ie],N=this.#n[2*ie+1];const ce=H+M,ge=ne+N;E.push(ge,ce);const le=H*t+ne;if(o[le+1]===0?o[le]=-u:o[le]===1&&(o[le]=u),ce===p&&ge===m&&H===k&&ne===z){o[b]!==1&&(d=Math.abs(o[b]));break}else S=H,w=ne,H=ce,ne=ge}}}return f}static#s(e,t,i,s){if(i-t<=4){for(let k=t;k<i-2;k+=2)s.push(e[k],e[k+1]);return}const a=e[t],o=e[t+1],u=e[i-4]-a,d=e[i-3]-o,f=Math.hypot(u,d),p=u/f,m=d/f,b=p*o-m*a,v=d/u,S=1/f,w=Math.atan(v),E=Math.cos(w),x=Math.sin(w),C=S*(Math.abs(E)+Math.abs(x)),T=S*(1-C+C**2),D=Math.max(Math.atan(Math.abs(x+E)*T),Math.atan(Math.abs(x-E)*T));let M=0,N=t;for(let k=t+2;k<i-2;k+=2){const z=Math.abs(b-p*e[k+1]+m*e[k]);z>M&&(N=k,M=z)}M>(f*D)**2?(this.#s(e,t,N+2,s),this.#s(e,N,i,s)):s.push(a,o)}static#o(e){const t=[],i=e.length;return this.#s(e,0,i,t),t.push(e[i-2],e[i-1]),t.length<=4?null:t}static#c(e,t,i,s,a,o){const u=new Float32Array(o**2),d=-2*s**2,f=o>>1;for(let w=0;w<o;w++){const E=(w-f)**2;for(let x=0;x<o;x++)u[w*o+x]=Math.exp((E+(x-f)**2)/d)}const p=new Float32Array(256),m=-2*a**2;for(let w=0;w<256;w++)p[w]=Math.exp(w**2/m);const b=e.length,v=new Uint8Array(b),S=new Uint32Array(256);for(let w=0;w<i;w++)for(let E=0;E<t;E++){const x=w*t+E,C=e[x];let T=0,D=0;for(let N=0;N<o;N++){const k=w+N-f;if(!(k<0||k>=i))for(let z=0;z<o;z++){const H=E+z-f;if(H<0||H>=t)continue;const ne=e[k*t+H],ie=u[N*o+z]*p[Math.abs(ne-C)];T+=ne*ie,D+=ie}}const M=v[x]=Math.round(T/D);S[M]++}return[v,S]}static#l(e){const t=new Uint32Array(256);for(const i of e)t[i]++;return t}static#d(e){const t=e.length,i=new Uint8ClampedArray(t>>2);let s=-1/0,a=1/0;for(let u=0,d=i.length;u<d;u++){const f=i[u]=e[u<<2];s=Math.max(s,f),a=Math.min(a,f)}const o=255/(s-a);for(let u=0,d=i.length;u<d;u++)i[u]=(i[u]-a)*o;return i}static#h(e){let t,i=-1/0,s=-1/0;const a=e.findIndex(d=>d!==0);let o=a,u=a;for(t=a;t<256;t++){const d=e[t];d>i&&(t-o>s&&(s=t-o,u=t-1),i=d,o=t)}for(t=u-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:i,height:s}=e,{maxDim:a}=this.#e;let o=i,u=s;if(i>a||s>a){let b=i,v=s,S=Math.log2(Math.max(i,s)/a);const w=Math.floor(S);S=S===w?w-1:w;for(let x=0;x<S;x++){o=Math.ceil(b/2),u=Math.ceil(v/2);const C=new OffscreenCanvas(o,u);C.getContext("2d").drawImage(e,0,0,b,v,0,0,o,u),b=o,v=u,e!==t&&e.close(),e=C.transferToImageBitmap()}const E=Math.min(a/o,a/u);o=Math.round(o*E),u=Math.round(u*E)}const f=new OffscreenCanvas(o,u).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,o,u),f.filter="grayscale(1)",f.drawImage(e,0,0,e.width,e.height,0,0,o,u);const p=f.getImageData(0,0,o,u).data;return[this.#d(p),o,u]}static extractContoursFromText(e,{fontFamily:t,fontStyle:i,fontWeight:s},a,o,u,d){let f=new OffscreenCanvas(1,1),p=f.getContext("2d",{alpha:!1});const m=200,b=p.font=`${i} ${s} ${m}px ${t}`,{actualBoundingBoxLeft:v,actualBoundingBoxRight:S,actualBoundingBoxAscent:w,actualBoundingBoxDescent:E,fontBoundingBoxAscent:x,fontBoundingBoxDescent:C,width:T}=p.measureText(e),D=1.5,M=Math.ceil(Math.max(Math.abs(v)+Math.abs(S)||0,T)*D),N=Math.ceil(Math.max(Math.abs(w)+Math.abs(E)||m,Math.abs(x)+Math.abs(C)||m)*D);f=new OffscreenCanvas(M,N),p=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),p.font=b,p.filter="grayscale(1)",p.fillStyle="white",p.fillRect(0,0,M,N),p.fillStyle="black",p.fillText(e,M*(D-1)/2,N*(3-D)/2);const k=this.#d(p.getImageData(0,0,M,N).data),z=this.#l(k),H=this.#h(z),ne=this.#r(k,M,N,H);return this.processDrawnLines({lines:{curves:ne,width:M,height:N},pageWidth:a,pageHeight:o,rotation:u,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,i,s,a){const[o,u,d]=this.#f(e),[f,p]=this.#c(o,u,d,Math.hypot(u,d)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),m=this.#h(p),b=this.#r(f,u,d,m);return this.processDrawnLines({lines:{curves:b,width:u,height:d},pageWidth:t,pageHeight:i,rotation:s,innerMargin:a,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:s,innerMargin:a,mustSmooth:o,areContours:u}){s%180!==0&&([t,i]=[i,t]);const{curves:d,width:f,height:p}=e,m=e.thickness??0,b=[],v=Math.min(t/f,i/p),S=v/t,w=v/i,E=[];for(const{points:C}of d){const T=o?this.#o(C):C;if(!T)continue;E.push(T);const D=T.length,M=new Float32Array(D),N=new Float32Array(3*(D===2?2:D-2));if(b.push({line:N,points:M}),D===2){M[0]=T[0]*S,M[1]=T[1]*w,N.set([NaN,NaN,NaN,NaN,M[0],M[1]],0);continue}let[k,z,H,ne]=T;k*=S,z*=w,H*=S,ne*=w,M.set([k,z,H,ne],0),N.set([NaN,NaN,NaN,NaN,k,z],0);for(let ie=4;ie<D;ie+=2){const ce=M[ie]=T[ie]*S,ge=M[ie+1]=T[ie+1]*w;N.set(he.createBezierPoints(k,z,H,ne,ce,ge),(ie-2)*3),[k,z,H,ne]=[H,ne,ce,ge]}}if(b.length===0)return null;const x=u?new kf:new Co;return x.build(b,t,i,1,s,u?0:m,a),{outline:x,newCurves:E,areContours:u,thickness:m,width:f,height:p}}static async compressSignature({outlines:e,areContours:t,thickness:i,width:s,height:a}){let o=1/0,u=-1/0,d=0;for(const T of e){d+=T.length;for(let D=2,M=T.length;D<M;D++){const N=T[D]-T[D-2];o=Math.min(o,N),u=Math.max(u,N)}}let f;o>=-128&&u<=127?f=Int8Array:o>=-32768&&u<=32767?f=Int16Array:f=Int32Array;const p=e.length,m=hc+Ja*p,b=new Uint32Array(m);let v=0;b[v++]=m*Uint32Array.BYTES_PER_ELEMENT+(d-2*p)*f.BYTES_PER_ELEMENT,b[v++]=0,b[v++]=s,b[v++]=a,b[v++]=t?0:1,b[v++]=Math.max(0,Math.floor(i??0)),b[v++]=p,b[v++]=f.BYTES_PER_ELEMENT;for(const T of e)b[v++]=T.length-2,b[v++]=T[0],b[v++]=T[1];const S=new CompressionStream("deflate-raw"),w=S.writable.getWriter();await w.ready,w.write(b);const E=f.prototype.constructor;for(const T of e){const D=new E(T.length-2);for(let M=2,N=T.length;M<N;M++)D[M-2]=T[M]-T[M-2];w.write(D)}w.close();const x=await new Response(S.readable).arrayBuffer(),C=new Uint8Array(x);return kw(C)}static async decompressSignature(e){try{const t=i2(e),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),a=s.getWriter();await a.ready,a.write(t).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,u=0;for await(const T of i)o||=new Uint8Array(new Uint32Array(T.buffer,0,4)[0]),o.set(T,u),u+=T.length;const d=new Uint32Array(o.buffer,0,o.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const p=d[2],m=d[3],b=d[4]===0,v=d[5],S=d[6],w=d[7],E=[],x=(hc+Ja*S)*Uint32Array.BYTES_PER_ELEMENT;let C;switch(w){case Int8Array.BYTES_PER_ELEMENT:C=new Int8Array(o.buffer,x);break;case Int16Array.BYTES_PER_ELEMENT:C=new Int16Array(o.buffer,x);break;case Int32Array.BYTES_PER_ELEMENT:C=new Int32Array(o.buffer,x);break}u=0;for(let T=0;T<S;T++){const D=d[Ja*T+hc],M=new Float32Array(D+2);E.push(M);for(let N=0;N<Ja-1;N++)M[N]=d[Ja*T+hc+N+1];for(let N=0;N<D;N++)M[N+2]=M[N]+C[u++]}return{areContours:b,thickness:v,outlines:E,width:p,height:m}}catch(t){return xe(`decompressSignature: ${t}`),null}}}class lp extends r_{constructor(){super(),super.updateProperties({fill:we._defaultLineColor,"stroke-width":0})}clone(){const e=new lp;return e.updateAll(this),e}}class cp extends Hc{constructor(e){super(e),super.updateProperties({stroke:we._defaultLineColor,"stroke-width":1})}clone(){const e=new cp(this._viewParameters);return e.updateAll(this),e}}class Wi extends ze{#e=!1;#t=null;#n=null;#i=null;static _type="signature";static _editorType=Te.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){we.initialize(e,t),this._defaultDrawingOptions=new lp,this._defaultDrawnSignatureOptions=new cp(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return Re(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:s,mustSmooth:a,areContours:o,description:u,uuid:d,heightInPage:f}=this.#n,{rawDims:{pageWidth:p,pageHeight:m},rotation:b}=this.parent.viewport,v=jr.processDrawnLines({lines:s,pageWidth:p,pageHeight:m,rotation:b,innerMargin:Wi._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(v,f,u,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#i=e,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:i,width:s,height:a}=this.#n,o=Math.max(s,a),u=jr.processDrawnLines({lines:{curves:e.map(d=>({points:d})),thickness:i,width:s,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:u.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,i,s){const{x:a,y:o}=this,{outline:u}=this.#n=e;this.#e=u instanceof kf,this.description=i;let d;this.#e?d=Wi.getDefaultDrawingOptions():(d=Wi._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":u.thickness})),this._addOutlines({drawOutlines:u,drawingOptions:d});const[,f]=this.pageDimensions;let p=t/f;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:s}=this.parent.viewport;return jr.process(e,t,i,s,Wi._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:i,pageHeight:s},rotation:a}=this.parent.viewport;return jr.extractContoursFromText(e,t,i,s,a,Wi._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:s}=this.parent.viewport;return jr.processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:s,innerMargin:Wi._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=Wi.getDefaultDrawingOptions():(this._drawingOptions=Wi._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:i}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":s}}=this,a=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:s});return this.addComment(a),e?(a.paths={lines:t,points:i},a.uuid=this.#i,a.isCopy=!0):a.lines=t,this.#t&&(a.accessibilityData={type:"Figure",alt:this.#t}),a}static deserializeDraw(e,t,i,s,a,o){return o.areContours?kf.deserialize(e,t,i,s,a,o):Co.deserialize(e,t,i,s,a,o)}static async deserialize(e,t,i){const s=await super.deserialize(e,t,i);return s.#e=e.areContours,s.description=e.accessibilityData?.alt||"",s.#i=e.uuid,s}}class FR extends we{#e=null;#t=null;#n=null;#i=null;#a=null;#r="";#s=null;#o=!1;#c=null;#l=!1;#d=!1;static _type="stamp";static _editorType=Te.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#i=e.bitmapUrl,this.#a=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){we.initialize(e,t)}static isHandlingMimeForPasting(e){return wf.includes(e)}static paste(e,t){t.pasteEditor({mode:Te.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#r=e.file.name),this.#g()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#s){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,u=await i.guess({name:"altText",request:{data:s,width:a,height:o,channels:s.length/(a*o)}});if(!u)throw new Error("No response from the AI service.");if(u.error)throw new Error("Error from the AI service.");if(u.cancel)return null;if(!u.output)throw new Error("No valid response from the AI service.");const d=u.output;return await this.setGuessedAltText(d),t&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#m(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(i=>this.#h(i,!0)).finally(()=>this.#f());return}if(this.#i){const i=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#h(s)).finally(()=>this.#f());return}if(this.#a){const i=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(i).then(s=>this.#h(s)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=wf.join(",");const t=this._uiManager._signal;this.#n=new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(s)}i()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#s?.remove(),this.#s=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#m();return}super.rebuild(),this.div!==null&&(this.#t&&this.#s===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#i||this.#a||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:i,bitmap:s}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#t=i,s&&(this.#e=s),this.#o=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},e)}#g(){const{div:e}=this;let{width:t,height:i}=this.#e;const[s,a]=this.pageDimensions,o=.75;if(this.width)t=this.width*s,i=this.height*a;else if(t>o*s||i>o*a){const d=Math.min(o*s/t,o*a/i);t*=d,i*=d}this._uiManager.enableWaiting(!1);const u=this.#s=document.createElement("canvas");u.setAttribute("role","img"),this.addContainer(u),this.width=t/s,this.height=i/a,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,i=!1){e||(e=224);const{width:s,height:a}=this.#e,o=new Ki;let u=this.#e,d=s,f=a,p=null;if(t){if(s>t||a>t){const N=Math.min(t/s,t/a);d=Math.floor(s*N),f=Math.floor(a*N)}p=document.createElement("canvas");const b=p.width=Math.ceil(d*o.sx),v=p.height=Math.ceil(f*o.sy);this.#l||(u=this.#u(b,v));const S=p.getContext("2d");S.filter=this._uiManager.hcmFilter;let w="white",E="#cfcfd8";this._uiManager.hcmFilter!=="none"?E="black":l2.isDarkMode&&(w="#8f8f9d",E="#42414d");const x=15,C=x*o.sx,T=x*o.sy,D=new OffscreenCanvas(C*2,T*2),M=D.getContext("2d");M.fillStyle=w,M.fillRect(0,0,C*2,T*2),M.fillStyle=E,M.fillRect(0,0,C,T),M.fillRect(C,T,C,T),S.fillStyle=S.createPattern(D,"repeat"),S.fillRect(0,0,b,v),S.drawImage(u,0,0,u.width,u.height,0,0,b,v)}let m=null;if(i){let b,v;if(o.symmetric&&u.width<e&&u.height<e)b=u.width,v=u.height;else if(u=this.#e,s>e||a>e){const E=Math.min(e/s,e/a);b=Math.floor(s*E),v=Math.floor(a*E),this.#l||(u=this.#u(b,v))}const w=new OffscreenCanvas(b,v).getContext("2d",{willReadFrequently:!0});w.drawImage(u,0,0,u.width,u.height,0,0,b,v),m={width:b,height:v,data:w.getImageData(0,0,b,v).data}}return{canvas:p,width:d,height:f,imageData:m}}#u(e,t){const{width:i,height:s}=this.#e;let a=i,o=s,u=this.#e;for(;a>2*e||o>2*t;){const d=a,f=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const p=new OffscreenCanvas(a,o);p.getContext("2d").drawImage(u,0,0,d,f,0,0,a,o),u=p.transferToImageBitmap()}return u}#p(){const[e,t]=this.parentDimensions,{width:i,height:s}=this,a=new Ki,o=Math.ceil(i*e*a.sx),u=Math.ceil(s*t*a.sy),d=this.#s;if(!d||d.width===o&&d.height===u)return;d.width=o,d.height=u;const f=this.#l?this.#e:this.#u(o,u),p=d.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(f,0,0,f.width,f.height,0,0,o,u)}#y(e){if(e){if(this.#l){const s=this._uiManager.imageManager.getSvgUrl(this.#t);if(s)return s}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,i]=this.pageDimensions,s=Math.round(this.width*t*Yr.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*Yr.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(s,a);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,s,a),o.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,i){let s=null,a=!1;if(e instanceof n_){const{data:{rect:w,rotation:E,id:x,structParent:C,popupRef:T,richText:D,contentsObj:M,creationDate:N,modificationDate:k},container:z,parent:{page:{pageNumber:H}},canvas:ne}=e;let ie,ce;ne?(delete e.canvas,{id:ie,bitmap:ce}=i.imageManager.getFromCanvas(z.id,ne),ne.remove()):(a=!0,e._hasNoCanvas=!0);const ge=(await t._structTree.getAriaAttributes(`${Ir}${x}`))?.get("aria-label")||"";s=e={annotationType:Te.STAMP,bitmapId:ie,bitmap:ce,pageIndex:H-1,rect:w.slice(0),rotation:E,annotationElementId:x,id:x,deleted:!1,accessibilityData:{decorative:!1,altText:ge},isSvg:!1,structParent:C,popupRef:T,richText:D,comment:M?.str||null,creationDate:N,modificationDate:k}}const o=await super.deserialize(e,t,i),{rect:u,bitmap:d,bitmapUrl:f,bitmapId:p,isSvg:m,accessibilityData:b}=e;a?(i.addMissingCanvas(e.id,o),o.#o=!0):p&&i.imageManager.isValidId(p)?(o.#t=p,d&&(o.#e=d)):o.#i=f,o.#l=m;const[v,S]=o.pageDimensions;return o.width=(u[2]-u[0])/v,o.height=(u[3]-u[1])/S,b&&(o.altTextData=b),o._initialData=s,e.comment&&o.setCommentData(e),o.#d=!!s,o}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(i),e)return i.bitmapUrl=this.#y(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:s,altText:a}=this.serializeAltText(!1);if(!s&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const u=this.#v(i);return u.isSame?null:(u.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(t===null)return i;t.stamps||=new Map;const o=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:i}),i.bitmap=this.#y(!1);else if(this.#l){const u=t.stamps.get(this.#t);o>u.area&&(u.area=o,u.serialized.bitmap.close(),u.serialized.bitmap=this.#y(!1))}return i}#v(e){const{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,s=e.pageIndex===t,a=(e.accessibilityData?.alt||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&s&&a,isSameAltText:a}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class An{#e;#t=!1;#n=null;#i=null;#a=null;#r=new Map;#s=!1;#o=!1;#c=!1;#l=null;#d=null;#h=null;#f=null;#m=null;#g=-1;#u;static _initialized=!1;static#p=new Map([Rt,op,FR,gt,Wi].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:s,accessibilityManager:a,annotationLayer:o,drawLayer:u,textLayer:d,viewport:f,l10n:p}){const m=[...An.#p.values()];if(!An._initialized){An._initialized=!0;for(const b of m)b.initialize(p,e)}e.registerEditorTypes(m),this.#u=e,this.pageIndex=t,this.div=i,this.#e=a,this.#n=o,this.viewport=f,this.#h=d,this.drawLayer=u,this._structTree=s,this.#u.addLayer(this)}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===Te.NONE}updateToolbar(e){this.#u.updateToolbar(e)}updateMode(e=this.#u.getMode()){switch(this.#_(),e){case Te.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Te.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Te.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Te.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const i of An.#p.values())t.toggle(`${i._type}Editing`,e===i._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#h?.div}setEditingState(e){this.#u.setEditingState(e)}addCommands(e){this.#u.addCommands(e)}cleanUndoStack(e){this.#u.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#n?.togglePointerEvents(e)}get#y(){return this.#r.size!==0?this.#r.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const e=new Set;for(const i of this.#y)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#u.removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=this.#n;if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),this.#u.isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#m){this.#m=new AbortController;const s=this.#u.combinedSignal(this.#m);this.#h.div.addEventListener("pointerdown",a=>{const{clientX:u,clientY:d,timeStamp:f}=a,p=this.#g;if(f-p>500){this.#g=f;return}this.#g=-1;const{classList:m}=this.div;m.toggle("getElements",!0);const b=document.elementsFromPoint(u,d);if(m.toggle("getElements",!1),!this.div.contains(b[0]))return;let v;const S=new RegExp(`^${ho}[0-9]+$`);for(const E of b)if(S.test(E.id)){v=E.id;break}if(!v)return;const w=this.#r.get(v);w?.annotationElementId===null&&(a.stopPropagation(),a.preventDefault(),w.dblclick(a))},{signal:s,capture:!0})}const e=this.#n,t=[];if(e){const s=new Map,a=new Map;for(const u of this.#y){if(u.disableEditing(),!u.annotationElementId){t.push(u);continue}if(u.serialize()!==null){s.set(u.annotationElementId,u);continue}else a.set(u.annotationElementId,u);this.getEditableAnnotation(u.annotationElementId)?.show(),u.remove()}const o=e.getEditableAnnotations();for(const u of o){const{id:d}=u.data;if(this.#u.isDeletedAnnotationElement(d)){u.updateEdited({deleted:!0});continue}let f=a.get(d);if(f){f.resetAnnotationElement(u),f.show(!1),u.show();continue}f=s.get(d),f&&(this.#u.addChangedExistingAnnotation(f),f.renderAnnotationElement(u)&&f.show(!1)),u.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of An.#p.values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#o=!1}getEditableAnnotation(e){return this.#n?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#u.getActive()!==e&&this.#u.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const e=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#v.bind(this),{signal:e}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#v(e){this.#u.unselectAll();const{target:t}=e;if(t===this.#h.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#h.div.contains(t)){const{isMac:i}=Bt.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),gt.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:e.x,y:e.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),e.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const e=this.#u.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#i?.abort(),this.#i=null}attach(e){this.#r.set(e.id,e);const{annotationElementId:t}=e;t&&this.#u.isDeletedAnnotationElement(t)&&this.#u.removeDeletedAnnotationElement(e)}detach(e){this.#r.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#u.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#u.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#u.addDeletedAnnotationElement(e.annotationElementId),we.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#u.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#u.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#a&&(e._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getEditorByUID(e){for(const t of this.#r.values())if(t.uid===e)return t;return null}getNextId(){return this.#u.getId()}get#b(){return An.#p.get(this.#u.getMode())}combinedSignal(e){return this.#u.combinedSignal(e)}#x(e){const t=this.#b;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#u.updateMode(e.mode);const{offsetX:i,offsetY:s}=this.#A(),a=this.getNextId(),o=this.#x({parent:this,id:a,x:i,y:s,uiManager:this.#u,isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await An.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#u)||null}createAndAddNewEditor(e,t,i={}){const s=this.getNextId(),a=this.#x({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:this.#u,isCentered:t,...i});return a&&this.add(a),a}get boundingClientRect(){return this.div.getBoundingClientRect()}#A(){const{x:e,y:t,width:i,height:s}=this.boundingClientRect,a=Math.max(0,e),o=Math.max(0,t),u=Math.min(window.innerWidth,e+i),d=Math.min(window.innerHeight,t+s),f=(a+u)/2-e,p=(o+d)/2-t,[m,b]=this.viewport.rotation%180===0?[f,p]:[p,f];return{offsetX:m,offsetY:b}}addNewEditor(e={}){this.createAndAddNewEditor(this.#A(),!0,e)}setSelected(e){this.#u.setSelected(e)}toggleSelected(e){this.#u.toggleSelected(e)}unselect(e){this.#u.unselect(e)}pointerup(e){const{isMac:t}=Bt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#s||(this.#s=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const i=this.#u.getMode();if(i===Te.STAMP||i===Te.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#u.getMode()===Te.HIGHLIGHT&&this.enableTextSelection(),this.#s){this.#s=!1;return}const{isMac:t}=Bt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#s=!0,this.#b?.isDrawer){this.startDrawingSession(e);return}const i=this.#u.getActive();this.#t=!i||i.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#b.startDrawing(this,this.#u,!1,e);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#d=null,this.commitOrRemove())},{signal:t}),this.#b.startDrawing(this,this.#u,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#d=t);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(e=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#b.endDrawing(e)):null}findNewParent(e,t,i){const s=this.#u.findParent(t,i);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const e of this.#r.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#r.clear(),this.#u.removeLayer(this)}#_(){for(const e of this.#r.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Is(this.div,e);for(const t of this.#u.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#u.commitOrRemove(),this.#_();const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,Is(this.div,{rotation:i}),t!==i)for(const s of this.#r.values())s.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#u.viewParameters.realScale}}class jt{#e=null;#t=new Map;#n=new Map;static#i=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return Re(this,"_svgFactory",new Rc)}static#a(e,[t,i,s,a]){const{style:o}=e;o.top=`${100*i}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*a}%`}#r(){const e=jt._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#s(e,t){const i=jt._svgFactory.createElement("clipPath");e.append(i);const s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const a=jt._svgFactory.createElement("use");return i.append(a),a.setAttribute("href",`#${t}`),a.classList.add("clip"),s}#o(e,t){for(const[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)}draw(e,t=!1,i=!1){const s=jt.#i++,a=this.#r(),o=jt._svgFactory.createElement("defs");a.append(o);const u=jt._svgFactory.createElement("path");o.append(u);const d=`path_p${this.pageIndex}_${s}`;u.setAttribute("id",d),u.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#n.set(s,u);const f=i?this.#s(o,d):null,p=jt._svgFactory.createElement("use");return a.append(p),p.setAttribute("href",`#${d}`),this.updateProperties(a,e),this.#t.set(s,a),{id:s,clipPathId:`url(#${f})`}}drawOutline(e,t){const i=jt.#i++,s=this.#r(),a=jt._svgFactory.createElement("defs");s.append(a);const o=jt._svgFactory.createElement("path");a.append(o);const u=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",u),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const m=jt._svgFactory.createElement("mask");a.append(m),d=`mask_p${this.pageIndex}_${i}`,m.setAttribute("id",d),m.setAttribute("maskUnits","objectBoundingBox");const b=jt._svgFactory.createElement("rect");m.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");const v=jt._svgFactory.createElement("use");m.append(v),v.setAttribute("href",`#${u}`),v.setAttribute("stroke","none"),v.setAttribute("fill","black"),v.setAttribute("fill-rule","nonzero"),v.classList.add("mask")}const f=jt._svgFactory.createElement("use");s.append(f),f.setAttribute("href",`#${u}`),d&&f.setAttribute("mask",`url(#${d})`);const p=f.cloneNode();return s.append(p),f.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#t.set(i,s),i}finalizeDraw(e,t){this.#n.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:i,bbox:s,rootClass:a,path:o}=t,u=typeof e=="number"?this.#t.get(e):e;if(u){if(i&&this.#o(u,i),s&&jt.#a(u,s),a){const{classList:d}=u;for(const[f,p]of Object.entries(a))d.toggle(f,p)}if(o){const f=u.firstChild.firstChild;this.#o(f,o)}}}updateParent(e,t){if(t===this)return;const i=this.#t.get(e);i&&(t.#e.append(i),this.#t.delete(e),t.#t.set(e,i))}remove(e){this.#n.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Cf};globalThis.pdfjsLib={AbortException:rs,AnnotationEditorLayer:An,AnnotationEditorParamsType:je,AnnotationEditorType:Te,AnnotationEditorUIManager:as,AnnotationLayer:ap,AnnotationMode:ns,AnnotationType:_t,applyOpacity:u2,build:mR,ColorPicker:ki,createValidAbsoluteUrl:xw,CSSConstants:c2,DOMSVGFactory:Rc,DrawLayer:jt,FeatureTest:Bt,fetchData:So,findContrastColor:h2,getDocument:Ww,getFilenameFromUrl:n2,getPdfFilenameFromUrl:s2,getRGB:Eo,getUuid:Rw,getXfaPageViewport:a2,GlobalWorkerOptions:$r,ImageKind:gc,InvalidPDFException:bf,isDataScheme:Uc,isPdfFile:Kf,isValidExplicitDest:_2,MathClamp:Gt,noContextMenu:Mi,normalizeUnicode:e2,OPS:fo,OutputScale:Ki,PasswordResponses:GC,PDFDataRangeTransport:Xw,PDFDateString:vf,PDFWorker:go,PermissionFlag:$C,PixelsPerInch:Yr,RenderingCancelledException:Xf,renderRichText:Dw,ResponseException:Tc,setLayerDimensions:Is,shadow:Re,SignatureExtractor:jr,stopEvent:ut,SupportedImageMimeTypes:wf,TextLayer:qt,TouchManager:Fc,updateUrlHash:Tw,Util:pe,VerbosityLevel:jc,version:Jw,XfaLayer:Ow};$r.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${Jw}/pdf.worker.min.js`;const zR=async l=>{const e=l.type;try{return e==="application/pdf"?await HR(l):e.startsWith("image/")?await qR(l):(console.warn("Unsupported file type:",e),null)}catch(t){return console.error("Error extracting text from file:",t),null}},HR=async l=>new Promise((e,t)=>{const i=new FileReader;i.onload=async s=>{try{const a=s.target.result,o=await Ww({data:a}).promise;let u="";for(let d=1;d<=o.numPages;d++){const m=(await(await o.getPage(d)).getTextContent()).items.map(b=>b.str).join(" ");u+=m+`

`}e({text:u.trim(),pages:o.numPages,info:o.fingerprints})}catch(a){t(a)}},i.onerror=t,i.readAsArrayBuffer(l)}),qR=async l=>new Promise((e,t)=>{const i=new FileReader;i.onload=async s=>{try{const a=await qC.recognize(s.target.result,"eng",{logger:o=>console.log("OCR Progress:",o)});e({text:a.data.text,confidence:a.data.confidence})}catch(a){t(a)}},i.onerror=t,i.readAsDataURL(l)});function $R(){const l=Zi(),e=Ji(),{patientEmail:t,patientName:i}=e.state||{},[s,a]=B.useState(""),[o,u]=B.useState([]),[d,f]=B.useState(""),[p,m]=B.useState(!0),[b,v]=B.useState(!1),[S,w]=B.useState({}),[E,x]=B.useState(!1),[C,T]=B.useState(null),[D,M]=B.useState(!1),[N,k]=B.useState(""),[z,H]=B.useState([]),[ne,ie]=B.useState(!1),[ce,ge]=B.useState({demographics:!0,conditions:!1,medications:!1,notes:!1,documents:!1});B.useEffect(()=>{le()},[]);const le=async()=>{const V=await Lc();if(!V||V.userType!=="doctor"){alert(" No active session found! Please log in."),l("/login");return}if(!t){alert(" Missing patient information"),l("/doctor");return}a(V.email),j(V.email,t),ue(V.email)},ue=async V=>{try{const I=await _w(V);x(I)}catch(I){console.log("Error checking Epic connection:",I)}},j=async(V,I)=>{try{const{data:W,error:ae}=await Oe.from("patient_files").select("*").eq("patient_email",I).eq("doctor_email",V).order("created_at",{ascending:!1});if(ae)console.error("Error loading files:",ae);else if(W){const re=W.filter(Se=>Se.file_type==="file"),de=W.find(Se=>Se.file_type==="video");u(re),f(de?.file_url||"")}}catch(W){console.log("Error loading files:",W)}m(!1)},J=async V=>{const I=V.target.files[0];if(I){v(!0);try{console.log(" Extracting text from file...");let W=null;try{W=await zR(I),W?.text?console.log(" Text extraction successful:",W.text.substring(0,100)+"..."):console.log(" Text extraction returned no data")}catch(en){console.error(" Text extraction failed (non-critical):",en),W=null}const ae=Date.now(),re=`${t}/${ae}-${I.name}`;console.log(" Uploading to Supabase Storage..."),console.log(" Bucket: patient-files"),console.log(" Path:",re);const{data:de,error:Se}=await Oe.storage.from("patient-files").upload(re,I,{cacheControl:"3600",upsert:!1});if(Se){console.error(" Storage upload error:",Se),alert(" Storage upload failed: "+Se.message+`

Make sure storage policies are set up.`),v(!1);return}console.log(" File uploaded to storage:",de);const{data:ot}=Oe.storage.from("patient-files").getPublicUrl(re),ht=ot.publicUrl;console.log(" Public URL:",ht),console.log(" Saving metadata to database...");const{data:dt,error:kn}=await Oe.from("patient_files").insert([{doctor_email:s,patient_email:t,file_type:"file",file_url:ht,file_name:I.name,extracted_text:W?.text||null}]).select();if(kn){console.error(" Database error:",kn),alert(" Database error: "+kn.message),v(!1);return}console.log(" Complete! File uploaded and saved."),W?.text&&console.log(" Extracted text:",W.text.substring(0,200)+"..."),await j(s,t),alert(" File uploaded successfully!"+(W?.text?" Text extracted and saved.":""))}catch(W){console.error(" Upload failed:",W),alert(" Upload failed: "+W.message)}v(!1)}},oe=async(V,I,W)=>{if(confirm(`Delete "${I}"?`))try{console.log(" Deleting file:",{fileId:V,fileName:I,fileUrl:W});const re=W.split("/patient-files/")[1];if(re){console.log(" Deleting from storage:",re);const{error:Se}=await Oe.storage.from("patient-files").remove([re]);Se&&console.warn(" Storage delete warning:",Se)}const{error:de}=await Oe.from("patient_files").delete().eq("id",V);if(de){alert(" Error deleting file: "+de.message);return}console.log(" File deleted successfully"),await j(s,t),alert(" File deleted!")}catch(ae){console.error(" Delete failed:",ae),alert(" Delete failed: "+ae.message)}},K=async()=>{try{console.log(" Generating video...");const V="/images/20251121_0810_01kakjqdsse5jb6f3mdz9p3j0t.mp4",{data:I,error:W}=await Oe.from("patient_files").insert([{doctor_email:s,patient_email:t,file_type:"video",file_url:V,file_name:"generated_video.mp4"}]).select();if(W&&console.error("Error saving video:",W),f(V),C){const ae=hC(C);console.log("Clinical Summary for Video:",ae)}alert(" Video generated successfully!")}catch(V){console.error("Error generating video:",V),alert("Error generating video: "+V.message)}},X=()=>{M(!0)},O=async()=>{if(!N.trim()){alert("Please enter a patient name or MRN to search");return}ie(!0);try{const V=await gC(s,N);H(V),V.length===0&&alert("No patients found matching: "+N)}catch(V){console.error("Epic search error:",V),alert("Failed to search Epic: "+V.message)}ie(!1)},U=async V=>{ie(!0),M(!1);try{console.log("Fetching patient data from Epic:",V.id);const I=await yC(s,V.id);T(I),alert(`Successfully pulled data for ${V.name} from Epic!`)}catch(I){console.error("Failed to fetch Epic data:",I),alert("Failed to fetch patient data: "+I.message)}ie(!1)},q=V=>{ge(I=>({...I,[V]:!I[V]}))},se=async()=>{await Vf(),l("/login")};return p?_.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #fdf4ff 0%, #fae8ff 50%, #f5f3ff 100%)"},children:_.jsx("div",{style:{color:"#A855F7",fontSize:"1.1rem",fontWeight:"600"},children:"Loading..."})}):_.jsxs("div",{style:{minHeight:"100vh",background:"#ffffff",padding:"2rem 6%"},children:[_.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto"},children:[_.jsxs("div",{style:{marginBottom:"3rem",textAlign:"center"},children:[_.jsxs("h1",{style:{fontSize:"2.5rem",fontWeight:"700",marginBottom:"0.5rem",color:"#1f2937"},children:["Manage Files for ",i," "]}),_.jsxs("p",{style:{fontSize:"1.125rem",color:"#64748b"},children:["Patient: ",t]}),_.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"1rem",justifyContent:"center"},children:[_.jsx("button",{onClick:()=>l("/doctor"),style:{padding:"0.75rem 1.75rem",background:"white",border:"2px solid #e5e7eb",borderRadius:"10px",color:"#64748b",fontWeight:"500",cursor:"pointer",fontSize:"0.95rem",transition:"all 0.2s"},onMouseEnter:V=>V.currentTarget.style.borderColor="#7c3aed",onMouseLeave:V=>V.currentTarget.style.borderColor="#e5e7eb",children:" Back to Dashboard"}),_.jsx("button",{onClick:se,style:{padding:"0.75rem 1.75rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",border:"none",borderRadius:"10px",color:"white",fontWeight:"600",cursor:"pointer",fontSize:"0.95rem"},children:"Logout"})]})]}),_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",border:"1px solid #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",marginBottom:"2rem"},children:[_.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"700",marginBottom:"1.5rem",color:"#1f2937"},children:"Upload Files & Generate Video"}),_.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[E&&_.jsx("button",{onClick:X,disabled:ne,style:{flex:1,padding:"1rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",color:"white",border:"none",borderRadius:"10px",fontSize:"0.95rem",fontWeight:"600",cursor:ne?"not-allowed":"pointer",transition:"all 0.2s",opacity:ne?.6:1},children:ne?" Loading from Plasma FHIR...":" Pull from Plasma FHIR (Epic)"}),_.jsx("label",{htmlFor:"file-upload",style:{flex:1,display:"block",padding:"1rem 1.5rem",background:"white",border:"2px dashed #e5e7eb",borderRadius:"10px",textAlign:"center",cursor:"pointer",color:"#64748b",fontWeight:"500",transition:"all 0.2s"},onMouseEnter:V=>{V.currentTarget.style.borderColor="#7c3aed",V.currentTarget.style.background="#faf5ff"},onMouseLeave:V=>{V.currentTarget.style.borderColor="#e5e7eb",V.currentTarget.style.background="white"},children:b?"Uploading...":" Click to Upload File"}),_.jsx("input",{id:"file-upload",type:"file",onChange:J,style:{display:"none"},disabled:b}),_.jsx("button",{onClick:K,style:{flex:1,padding:"1rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",color:"white",border:"none",borderRadius:"10px",fontSize:"1rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},children:"Generate Video "})]})]}),d&&_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",border:"1px solid #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",marginBottom:"2rem"},children:[_.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"700",marginBottom:"1rem",color:"#1f2937"},children:"Generated Video Preview"}),_.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"1rem",background:"#000",display:"flex",alignItems:"center",justifyContent:"center"},children:_.jsxs("video",{controls:!0,style:{width:"100%",maxHeight:"500px",borderRadius:"8px"},children:[_.jsx("source",{src:d,type:"video/mp4"}),"Your browser does not support the video tag."]})})]}),_.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem"},children:[C?_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",border:"1px solid #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[_.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[_.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"700",color:"#1f2937",margin:0},children:"Plasma FHIR Data (Epic)"}),_.jsxs("p",{style:{fontSize:"0.85rem",color:"#9ca3af",margin:0},children:["Last synced: ",new Date().toLocaleString()]})]}),C.patient&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("button",{onClick:()=>q("demographics"),style:{width:"100%",padding:"1rem",background:ce.demographics?"#faf5ff":"white",border:"1px solid #e5e7eb",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontFamily:"inherit"},children:[_.jsx("span",{style:{fontWeight:"600",color:"#1f2937"},children:" Patient Demographics"}),_.jsx("span",{style:{color:"#7c3aed"},children:ce.demographics?"":"+"})]}),ce.demographics&&_.jsxs("div",{style:{padding:"1rem",background:"#faf5ff",borderRadius:"0 0 8px 8px",marginTop:"-1px"},children:[_.jsxs("p",{style:{color:"#1f2937",marginBottom:"0.5rem"},children:[_.jsx("strong",{children:"Name:"})," ",C.patient.name]}),_.jsxs("p",{style:{color:"#1f2937",marginBottom:"0.5rem"},children:[_.jsx("strong",{children:"Age:"})," ",C.patient.age," years"]}),_.jsxs("p",{style:{color:"#1f2937",marginBottom:"0.5rem"},children:[_.jsx("strong",{children:"Gender:"})," ",C.patient.gender]}),_.jsxs("p",{style:{color:"#1f2937"},children:[_.jsx("strong",{children:"MRN:"})," ",C.patient.mrn]})]})]}),C.conditions&&C.conditions.length>0&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("button",{onClick:()=>q("conditions"),style:{width:"100%",padding:"1rem",background:ce.conditions?"#faf5ff":"white",border:"1px solid #e5e7eb",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontFamily:"inherit"},children:[_.jsxs("span",{style:{fontWeight:"600",color:"#1f2937"},children:[" Diagnoses (",C.conditions.length,")"]}),_.jsx("span",{style:{color:"#7c3aed"},children:ce.conditions?"":"+"})]}),ce.conditions&&_.jsx("div",{style:{padding:"1rem",background:"#faf5ff",borderRadius:"0 0 8px 8px",marginTop:"-1px"},children:C.conditions.map((V,I)=>_.jsxs("div",{style:{marginBottom:"0.75rem",paddingBottom:"0.75rem",borderBottom:I<C.conditions.length-1?"1px solid #e5e7eb":"none"},children:[_.jsx("p",{style:{fontWeight:"600",marginBottom:"0.25rem",color:"#1f2937"},children:V.display}),_.jsxs("p",{style:{fontSize:"0.9rem",color:"#64748b"},children:["Status: ",V.clinicalStatus||"Unknown",V.onsetDate&&`  Since: ${new Date(V.onsetDate).toLocaleDateString()}`]})]},I))})]}),C.medications&&C.medications.length>0&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("button",{onClick:()=>q("medications"),style:{width:"100%",padding:"1rem",background:ce.medications?"#faf5ff":"white",border:"1px solid #e5e7eb",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontFamily:"inherit"},children:[_.jsxs("span",{style:{fontWeight:"600",color:"#1f2937"},children:[" Medications (",C.medications.length,")"]}),_.jsx("span",{style:{color:"#7c3aed"},children:ce.medications?"":"+"})]}),ce.medications&&_.jsx("div",{style:{padding:"1rem",background:"#faf5ff",borderRadius:"0 0 8px 8px",marginTop:"-1px"},children:C.medications.map((V,I)=>_.jsxs("div",{style:{marginBottom:"0.75rem",paddingBottom:"0.75rem",borderBottom:I<C.medications.length-1?"1px solid #e5e7eb":"none"},children:[_.jsx("p",{style:{fontWeight:"600",marginBottom:"0.25rem",color:"#1f2937"},children:V.name}),_.jsxs("p",{style:{fontSize:"0.9rem",color:"#64748b"},children:[V.dosage&&`Dosage: ${V.dosage}`,V.frequency&&`  ${V.frequency}`]})]},I))})]}),C.clinical_notes&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("button",{onClick:()=>q("notes"),style:{width:"100%",padding:"1rem",background:ce.notes?"#faf5ff":"white",border:"1px solid #e5e7eb",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontFamily:"inherit"},children:[_.jsx("span",{style:{fontWeight:"600",color:"#1f2937"},children:" Full Clinical Notes"}),_.jsx("span",{style:{color:"#7c3aed"},children:ce.notes?"":"+"})]}),ce.notes&&_.jsx("div",{style:{padding:"1.5rem",background:"#faf5ff",borderRadius:"0 0 8px 8px",marginTop:"-1px",maxHeight:"600px",overflowY:"auto"},children:_.jsx("div",{style:{fontFamily:"monospace",fontSize:"0.85rem",color:"#1f2937",whiteSpace:"pre-wrap",background:"white",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb",lineHeight:"1.6"},children:C.clinical_notes})})]}),C.documents&&C.documents.length>0&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("button",{onClick:()=>q("documents"),style:{width:"100%",padding:"1rem",background:ce.documents?"#faf5ff":"white",border:"1px solid #e5e7eb",borderRadius:"8px",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",fontFamily:"inherit"},children:[_.jsxs("span",{style:{fontWeight:"600",color:"#1f2937"},children:[" Related Documents (",C.documents.length,")"]}),_.jsx("span",{style:{color:"#7c3aed"},children:ce.documents?"":"+"})]}),ce.documents&&_.jsx("div",{style:{padding:"1rem",background:"#faf5ff",borderRadius:"0 0 8px 8px",marginTop:"-1px"},children:C.documents.map((V,I)=>_.jsxs("div",{style:{marginBottom:"0.75rem",paddingBottom:"0.75rem",borderBottom:I<C.documents.length-1?"1px solid #e5e7eb":"none",background:"white",padding:"1rem",borderRadius:"6px"},children:[_.jsx("p",{style:{fontWeight:"600",marginBottom:"0.5rem",color:"#1f2937"},children:V.type}),_.jsxs("p",{style:{fontSize:"0.85rem",color:"#64748b",marginBottom:"0.5rem"},children:[V.date&&`Date: ${new Date(V.date).toLocaleDateString()}`,V.author&&`  Author: ${V.author}`]}),V.content&&_.jsx("p",{style:{fontSize:"0.9rem",color:"#374151",marginTop:"0.5rem",fontStyle:"italic"},children:V.content})]},I))})]})]}):_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"3rem 2rem",border:"2px dashed #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[_.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),_.jsx("p",{style:{color:"#9ca3af",fontSize:"1.1rem",marginBottom:"0.5rem"},children:"No Epic Data Loaded"}),_.jsx("p",{style:{color:"#d1d5db",fontSize:"0.95rem"},children:'Click "Pull from Plasma FHIR" above to load patient data'})]}),_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",border:"1px solid #e5e7eb",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[_.jsxs("h3",{style:{fontSize:"1.25rem",fontWeight:"700",marginBottom:"1rem",color:"#1f2937"},children:["Uploaded Files (",o.length,")"]}),o.length===0?_.jsxs("div",{style:{border:"2px dashed #e5e7eb",borderRadius:"8px",padding:"3rem 2rem",textAlign:"center",background:"#fafafa",minHeight:"400px",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[_.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),_.jsx("p",{style:{color:"#9ca3af",fontSize:"1.1rem",marginBottom:"0.5rem"},children:"No files uploaded yet"}),_.jsx("p",{style:{color:"#d1d5db",fontSize:"0.95rem"},children:"Upload files using the section above"})]}):_.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",maxHeight:"600px",overflowY:"auto"},children:o.map((V,I)=>_.jsxs("div",{style:{padding:"1rem",background:"#fafafa",borderRadius:"8px",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e5e7eb",transition:"all 0.2s"},onMouseEnter:W=>W.currentTarget.style.background="#f5f3ff",onMouseLeave:W=>W.currentTarget.style.background="#fafafa",children:[_.jsx("div",{style:{fontSize:"2rem"},children:""}),_.jsxs("div",{style:{flex:1},children:[_.jsx("p",{style:{fontWeight:"600",fontSize:"0.95rem",marginBottom:"0.25rem",color:"#1f2937"},children:V.file_name}),_.jsxs("p",{style:{fontSize:"0.8rem",color:"#9ca3af"},children:["Uploaded ",new Date(V.created_at).toLocaleDateString()]})]}),_.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[_.jsx("a",{href:V.file_url,target:"_blank",rel:"noopener noreferrer",style:{padding:"0.5rem 1rem",background:"linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%)",color:"white",border:"none",borderRadius:"6px",fontSize:"0.8rem",fontWeight:"600",cursor:"pointer",textDecoration:"none",transition:"all 0.2s"},children:"View"}),_.jsx("button",{onClick:()=>oe(V.id,V.file_name,V.file_url),style:{padding:"0.5rem 1rem",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",fontSize:"0.8rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},children:"Delete"})]})]},I))})]})]})]}),D&&_.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:()=>M(!1),children:_.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",width:"90%",maxWidth:"600px",maxHeight:"80vh",overflow:"auto",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.2)",border:"none"},onClick:V=>V.stopPropagation(),children:[_.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:"700",marginBottom:"1rem",color:"#1a1a1a"},children:" Search Patients (Plasma FHIR)"}),_.jsx("p",{style:{fontSize:"0.95rem",color:"#666",marginBottom:"1.5rem"},children:"Enter patient name or MRN to search via Plasma FHIR (synced with Epic)"}),_.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1.5rem"},children:[_.jsx("input",{type:"text",value:N,onChange:V=>k(V.target.value),placeholder:"Patient name or MRN",onKeyPress:V=>V.key==="Enter"&&O(),style:{flex:1,padding:"0.875rem",fontSize:"1rem",borderRadius:"8px",border:"2px solid #e0e0e0",fontFamily:"inherit"}}),_.jsx("button",{onClick:O,disabled:ne,style:{padding:"0.875rem 1.5rem",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:"8px",color:"white",fontWeight:"600",cursor:ne?"not-allowed":"pointer",fontSize:"1rem",opacity:ne?.6:1},children:ne?"...":"Search"})]}),z.length>0&&_.jsxs("div",{style:{marginBottom:"1rem"},children:[_.jsxs("h4",{style:{fontSize:"1.1rem",fontWeight:"600",marginBottom:"1rem",color:"#1a1a1a"},children:["Results (",z.length,")"]}),_.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",maxHeight:"300px",overflowY:"auto"},children:z.map((V,I)=>_.jsxs("div",{onClick:()=>U(V),style:{padding:"1rem",background:"#f9fafb",borderRadius:"8px",border:"1px solid #e0e0e0",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:W=>{W.currentTarget.style.background="#f0f0f0",W.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:W=>{W.currentTarget.style.background="#f9fafb",W.currentTarget.style.borderColor="#e0e0e0"},children:[_.jsx("p",{style:{fontWeight:"600",marginBottom:"0.25rem",color:"#1a1a1a"},children:V.name}),_.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:[V.birthDate&&`DOB: ${V.birthDate}`,V.mrn&&`  MRN: ${V.mrn}`,V.gender&&`  ${V.gender}`]})]},I))})]}),_.jsx("div",{style:{display:"flex",gap:"1rem",marginTop:"1.5rem"},children:_.jsx("button",{onClick:()=>M(!1),style:{flex:1,padding:"0.875rem",background:"white",border:"1px solid #e0e0e0",borderRadius:"8px",color:"#666",fontWeight:"600",cursor:"pointer",fontSize:"1rem"},children:"Cancel"})})]})})]})}function GR(){const l=Zi(),[e]=rE(),[t,i]=B.useState("processing"),[s,a]=B.useState("Connecting to Epic...");B.useEffect(()=>{o()},[]);const o=async()=>{try{const u=e.get("code"),d=e.get("state"),f=e.get("error"),p=e.get("error_description");if(f){i("error"),a(`Epic authorization failed: ${p||f}`),console.error("Epic OAuth error:",f,p),setTimeout(()=>l("/doctor"),3e3);return}if(!u){i("error"),a("No authorization code received from Epic"),setTimeout(()=>l("/doctor"),3e3);return}if(!d){i("error"),a("No state parameter received - possible security issue"),setTimeout(()=>l("/doctor"),3e3);return}if(a("Exchanging authorization code for access token..."),(await pC(u,d)).success)i("success"),a("Successfully connected to Epic! Redirecting..."),console.log(" Epic connection successful"),setTimeout(()=>l("/doctor"),2e3);else throw new Error("Callback processing failed")}catch(u){console.error(" Epic callback error:",u),i("error"),a(`Connection failed: ${u.message}`),setTimeout(()=>l("/doctor"),4e3)}};return _.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",padding:"2rem"},children:[_.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"3rem 2rem",maxWidth:"500px",width:"100%",textAlign:"center",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.1)",border:"1px solid #e0e0e0"},children:[_.jsxs("div",{style:{width:"80px",height:"80px",margin:"0 auto 2rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",background:t==="processing"?"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)":t==="success"?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"white",animation:t==="processing"?"spin 2s linear infinite":"none"},children:[t==="processing"&&"",t==="success"&&"",t==="error"&&""]}),_.jsxs("h1",{style:{fontSize:"2rem",fontWeight:"800",marginBottom:"1rem",color:"#1a1a1a",fontFamily:"Plus Jakarta Sans, sans-serif"},children:[t==="processing"&&"Connecting to Epic...",t==="success"&&"Connection Successful!",t==="error"&&"Connection Failed"]}),_.jsx("p",{style:{fontSize:"1.125rem",color:"#666",lineHeight:"1.7",marginBottom:"2rem"},children:s}),t==="processing"&&_.jsx("div",{style:{width:"100%",height:"4px",background:"#f0f0f0",borderRadius:"2px",overflow:"hidden",marginBottom:"1rem"},children:_.jsx("div",{style:{width:"50%",height:"100%",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",animation:"progress 1.5s ease-in-out infinite"}})}),t==="error"&&_.jsx("button",{onClick:()=>l("/doctor"),style:{padding:"1rem 2rem",background:"linear-gradient(135deg, #E879F9 0%, #A855F7 100%)",border:"none",borderRadius:"12px",color:"white",fontSize:"1rem",fontWeight:"600",cursor:"pointer",marginTop:"1rem",fontFamily:"inherit"},children:"Return to Dashboard"}),t==="success"&&_.jsx("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"rgba(16, 185, 129, 0.1)",borderRadius:"8px",border:"1px solid rgba(16, 185, 129, 0.3)"},children:_.jsx("p",{style:{fontSize:"0.95rem",color:"#059669",margin:0},children:"You can now access patient data from Epic EHR system"})})]}),_.jsx("style",{children:`
        @keyframes spin {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }

        @keyframes progress {
          0% {
            transform: translateX(-100%);
          }
          100% {
            transform: translateX(200%);
          }
        }
      `})]})}const sv="/images/Black Elephant Flat Illustrative Company Logo.png";function VR(){const l=Zi(),[e,t]=B.useState({name:"",email:"",organization:""}),[i,s]=B.useState(null),[a,o]=B.useState(!1),u=p=>{p.preventDefault(),console.log("Demo requested:",e),alert("Thank you! We'll be in touch shortly to schedule your demo."),t({name:"",email:"",organization:""})},d=p=>{s(i===p?null:p)},f=()=>{o(!0),setTimeout(()=>{document.querySelector(".demo-toggle-btn")?.scrollIntoView({behavior:"smooth",block:"center"})},100)};return _.jsxs("div",{className:"app",children:[_.jsxs("nav",{className:"navbar",children:[_.jsxs("div",{className:"logo",children:[_.jsx("img",{src:sv,alt:"Amma",className:"logo-image"}),_.jsx("span",{className:"logo-text",children:"Amma"})]}),_.jsxs("div",{className:"nav-links",children:[_.jsx("button",{className:"nav-link",onClick:()=>l("/contact"),children:"Contact"}),_.jsx("button",{className:"nav-cta",onClick:()=>l("/login"),children:"Get Started"})]})]}),_.jsxs("section",{className:"hero",children:[_.jsx("div",{className:"section-label",children:"HERO"}),_.jsxs("div",{className:"hero-content",children:[_.jsxs("div",{className:"announcement-badge",children:[_.jsx("span",{className:"pulse-dot"}),"Backed by Sam Altman's The Residency"]}),_.jsxs("h1",{className:"hero-title",children:["AI Video Generation",_.jsx("br",{}),_.jsx("span",{className:"gradient-text",children:"for Modern Healthcare"})]}),_.jsx("p",{className:"hero-description",children:"Automatically turn each diagnosis into a personalized animated video for every patient."}),_.jsxs("div",{className:"hero-stats",children:[_.jsxs("div",{className:"stat",children:[_.jsx("div",{className:"stat-number",children:"50%"}),_.jsx("div",{className:"stat-label",children:"shorter appointments"})]}),_.jsxs("div",{className:"stat",children:[_.jsx("div",{className:"stat-number",children:"100+"}),_.jsx("div",{className:"stat-label",children:"clinicians inside"})]}),_.jsxs("div",{className:"stat",children:[_.jsx("div",{className:"stat-number",children:"5000+"}),_.jsx("div",{className:"stat-label",children:"videos generated"})]})]}),_.jsx("button",{className:"demo-toggle-btn",onClick:()=>o(!a),children:a?"Close Form ":"Book a Demo "}),a&&_.jsxs("form",{onSubmit:u,className:"demo-form",children:[_.jsx("input",{type:"text",placeholder:"Full Name",value:e.name,onChange:p=>t({...e,name:p.target.value}),required:!0,className:"form-input"}),_.jsx("input",{type:"email",placeholder:"Work Email",value:e.email,onChange:p=>t({...e,email:p.target.value}),required:!0,className:"form-input"}),_.jsx("input",{type:"text",placeholder:"Organization",value:e.organization,onChange:p=>t({...e,organization:p.target.value}),required:!0,className:"form-input"}),_.jsx("button",{type:"submit",className:"submit-btn",children:"Submit Demo Request "})]})]}),_.jsx("div",{className:"gradient-blur"})]}),_.jsxs("section",{className:"problem-section",children:[_.jsx("div",{className:"section-label",children:"PROBLEM"}),_.jsxs("div",{className:"problem-content",children:[_.jsxs("h2",{className:"problem-title",children:["Patient confusion is ",_.jsx("span",{className:"gradient-text",children:"costing you time"})]}),_.jsx("p",{className:"problem-description",children:"Repeated explanations. Endless follow-up calls. Poor treatment adherence. Your patients leave confused, and your staff spends hours answering the same questions."})]})]}),_.jsxs("section",{className:"features-section",children:[_.jsxs("h2",{className:"section-heading",children:["How ",_.jsx("span",{className:"gradient-text",children:"Amma works"})]}),_.jsx("p",{className:"section-subheading",children:"From diagnosis to recovery, Amma transforms complex medical information into personalized animated videos that patients actually understand and follow."}),_.jsxs("div",{className:"feature-showcase",children:[_.jsxs("div",{className:"feature-large",children:[_.jsx("div",{className:"feature-visual",children:_.jsxs("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"feature-video",children:[_.jsx("source",{src:"/images/20251121_0810_01kakjqdsse5jb6f3mdz9p3j0t.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]})}),_.jsxs("div",{className:"feature-text",children:[_.jsx("h3",{children:"Instant Personalized Videos"}),_.jsx("p",{children:"Upload clinical notes or select a diagnosis, and Amma instantly generates hyper-personalized animated videos. Each video explains the condition and treatment in plain language tailored to your patient's specific situation."})]})]}),_.jsxs("div",{className:"feature-large reverse",children:[_.jsx("div",{className:"feature-visual",children:_.jsx("img",{src:"/images/Screenshot 2025-11-21 at 5.50.24 PM.png",alt:"Daily Follow-Up Animations",className:"feature-image"})}),_.jsxs("div",{className:"feature-text",children:[_.jsx("h3",{children:"Daily Follow-Up Animations"}),_.jsx("p",{children:"After the visit, patients receive daily bite-sized animations through the paired mobile app. Each animation guides medications, exercises, and follow-ups step-by-step, ensuring patients actually stick to their recovery plan."})]})]}),_.jsxs("div",{className:"feature-large",children:[_.jsx("div",{className:"feature-visual",children:_.jsx("img",{src:"/images/Screenshot 2025-11-21 at 5.50.39 PM.png",alt:"Real-Time AI Q&A",className:"feature-image"})}),_.jsxs("div",{className:"feature-text",children:[_.jsx("h3",{children:"Real-Time AI Q&A"}),_.jsx("p",{children:"Patients can ask questions anytimeAmma's AI answers instantly in chat or generates a new video on the spot. Clinicians stay in the loop through the shared app, so they're always aware without fielding every call."})]})]})]})]}),_.jsxs("section",{className:"testimonial-section",children:[_.jsx("div",{className:"section-label",children:"TESTIMONIAL"}),_.jsxs("div",{className:"testimonial-content",children:[_.jsx("h2",{className:"testimonial-quote",children:`"We've cut follow-up calls in half. Patients finally understand their treatment, and my staff has time to focus on actual care instead of answering the same questions."`}),_.jsxs("div",{className:"testimonial-author",children:[_.jsx("div",{className:"author-name",children:"Dr. Vani Velkuru"}),_.jsx("div",{className:"author-title",children:"Head Rheumotologist, Washington Hospital"})]})]}),_.jsxs("div",{className:"trusted-by",children:[_.jsx("p",{children:"Trusted by clinics and practices including:"}),_.jsxs("div",{className:"logo-strip",children:[_.jsx("div",{className:"company-logo",children:"Valley Ortho"}),_.jsx("div",{className:"company-logo",children:"Bay Area PT"}),_.jsx("div",{className:"company-logo",children:"Summit Cardiology"}),_.jsx("div",{className:"company-logo",children:"Westside Family Med"})]})]})]}),_.jsxs("section",{className:"benefits-section",children:[_.jsx("div",{className:"section-label",children:"BENEFITS"}),_.jsx("h2",{className:"section-heading",children:"What we actually change"}),_.jsx("p",{className:"section-subheading",children:"Cut confusion, reduce callbacks, and boost adherencewithout adding to your staff's workload."}),_.jsxs("div",{className:"benefits-grid",children:[_.jsxs("div",{className:"benefit-card",children:[_.jsx("h3",{children:"Dramatically Fewer Follow-Up Calls"}),_.jsx("p",{children:"When patients actually understand their treatment through personalized videos, they stop calling with the same questions. Your staff reclaims hours every week."})]}),_.jsxs("div",{className:"benefit-card",children:[_.jsx("h3",{children:"Better Treatment Adherence"}),_.jsx("p",{children:"Daily bite-sized animations keep patients on track with medications, exercises, and follow-ups. No more guessing if they're following the plan."})]}),_.jsxs("div",{className:"benefit-card",children:[_.jsx("h3",{children:"Save Time Per Patient"}),_.jsx("p",{children:"Stop repeating the same explanations every visit. Amma handles patient education automatically, freeing you to focus on diagnosis and treatment."})]}),_.jsxs("div",{className:"benefit-card",children:[_.jsx("h3",{children:"HIPAA-Compliant & Secure"}),_.jsx("p",{children:"Everything runs in a fully secure, HIPAA-compliant environment. You get peace of mind while delivering better patient care."})]})]})]}),_.jsxs("section",{className:"faq-section",children:[_.jsx("div",{className:"section-label",children:"FAQ"}),_.jsx("h2",{className:"section-heading",children:"Frequently asked questions"}),_.jsx("p",{className:"section-subheading",children:"Here are some of our most frequently asked questions."}),_.jsxs("div",{className:"faq-container",children:[_.jsxs("div",{className:`faq-item ${i===0?"open":""}`,children:[_.jsxs("button",{className:"faq-question",onClick:()=>d(0),children:[_.jsx("span",{children:"What types of conditions and specialties does Amma support?"}),_.jsx("span",{className:"faq-icon",children:i===0?"":"+"})]}),i===0&&_.jsx("div",{className:"faq-answer",children:"Amma works across specialtiesorthopedics, cardiology, physical therapy, primary care, and more. Whether it's post-op instructions, chronic disease management, or medication adherence, our AI generates personalized videos for any diagnosis or treatment plan."})]}),_.jsxs("div",{className:`faq-item ${i===1?"open":""}`,children:[_.jsxs("button",{className:"faq-question",onClick:()=>d(1),children:[_.jsx("span",{children:"How does pricing work?"}),_.jsx("span",{className:"faq-icon",children:i===1?"":"+"})]}),i===1&&_.jsx("div",{className:"faq-answer",children:"We offer flexible per-clinician or per-patient pricing based on your practice size. Most clinics start with a pilot and scale up as they see results. Book a demo to discuss what works best for your workflow."})]}),_.jsxs("div",{className:`faq-item ${i===2?"open":""}`,children:[_.jsxs("button",{className:"faq-question",onClick:()=>d(2),children:[_.jsx("span",{children:"Is Amma HIPAA compliant?"}),_.jsx("span",{className:"faq-icon",children:i===2?"":"+"})]}),i===2&&_.jsx("div",{className:"faq-answer",children:"Yes, absolutely. Amma runs in a fully HIPAA-compliant environment with enterprise-grade encryption, secure data storage, and comprehensive Business Associate Agreements (BAAs). Patient privacy and security are our top priority."})]}),_.jsxs("div",{className:`faq-item ${i===3?"open":""}`,children:[_.jsxs("button",{className:"faq-question",onClick:()=>d(3),children:[_.jsx("span",{children:"How long does setup take?"}),_.jsx("span",{className:"faq-icon",children:i===3?"":"+"})]}),i===3&&_.jsx("div",{className:"faq-answer",children:"Most clinics are up and running within a few days. We provide simple onboarding, staff training, and support to get you started. No complex EHR integration required just upload notes or select a diagnosis and you're ready to go."})]}),_.jsxs("div",{className:`faq-item ${i===4?"open":""}`,children:[_.jsxs("button",{className:"faq-question",onClick:()=>d(4),children:[_.jsx("span",{children:"Do patients need to download an app?"}),_.jsx("span",{className:"faq-icon",children:i===4?"":"+"})]}),i===4&&_.jsx("div",{className:"faq-answer",children:"Yes, patients receive their personalized videos via the Amma mobile app, which also delivers daily follow-up animations and allows them to ask questions anytime. The app is available on iOS and Android and takes seconds to set up."})]})]})]}),_.jsxs("section",{className:"final-cta",children:[_.jsx("div",{className:"section-label",children:"GET STARTED"}),_.jsxs("div",{className:"cta-content",children:[_.jsx("h2",{className:"cta-title",children:"Stop repeating yourself. Start healing better."}),_.jsx("p",{className:"cta-description",children:"Join 100+ clinicians using Amma to save time, reduce callbacks, and help patients actually follow through on their care."}),_.jsx("button",{className:"cta-button",onClick:f,children:"Book Your Demo "})]})]}),_.jsx("footer",{className:"footer",children:_.jsxs("div",{className:"footer-content",children:[_.jsxs("div",{className:"footer-brand",children:[_.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[_.jsx("img",{src:sv,alt:"Amma",style:{height:"35px",width:"auto"}}),_.jsx("span",{className:"logo-text",children:"Amma"})]}),_.jsx("p",{className:"footer-tagline",children:"AI copilot for patient understanding and follow-through."})]}),_.jsxs("div",{className:"footer-links",children:[_.jsx("a",{href:"#privacy",children:"Privacy Policy"}),_.jsx("span",{children:""}),_.jsx("a",{href:"#terms",children:"Terms of Service"}),_.jsx("span",{children:""}),_.jsx("a",{href:"#contact",children:"Contact"})]})]})})]})}function YR(){return _.jsxs(OA,{children:[_.jsx(wn,{path:"/",element:_.jsx(VR,{})}),_.jsx(wn,{path:"/contact",element:_.jsx(hE,{})}),_.jsx(wn,{path:"/login",element:_.jsx($T,{})}),_.jsx(wn,{path:"/profile",element:_.jsx(GT,{})}),_.jsx(wn,{path:"/patient",element:_.jsx(uC,{})}),_.jsx(wn,{path:"/doctor",element:_.jsx(SC,{})}),_.jsx(wn,{path:"/patient-files",element:_.jsx($R,{})}),_.jsx(wn,{path:"/epic-callback",element:_.jsx(GR,{})})]})}const WR="158294585814-rjagi60pklm8f2g5b3pertvlsqei53ca.apps.googleusercontent.com";U1.createRoot(document.getElementById("root")).render(_.jsx(B.StrictMode,{children:_.jsx(eE,{children:_.jsx(fE,{clientId:WR,children:_.jsx(YR,{})})})}));
